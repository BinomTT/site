"use strict";ASC.installBundle("subst",["dbi"],{"/substitution/online.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("react-dom"),a=t("./subst"),o=t("../asc/asc_react"),l=t("../asc/edurequest"),c=t("../timetable/timeoff_r"),u=r.Fragment,d=t("../rpr/dbi"),m=t("./online/rightpanel"),p=t("./online/leftpanel");t("../rpr/server/maindbi"),t("../substitution/server/substdbi");var b=t("../asc/actions"),f=t("./online/timetable"),_=t("./dlg/addcard"),h=t("./dlg/ttitem"),g=t("../timetable/ttitem"),v=t("./commands"),y=t("./server/commands"),E=t("../react/ribbon"),w=t("../react/splitline"),S=t("../react/datatable"),x=t("../react/datefield"),T=t("../asc/lib_date"),C=t("../rpr/dbi_react"),k=t("../react/menu"),D=t("./dlg/absent"),I=t("../timetable/ttview_components"),R=t("../dashboard/dbi_events"),A=t("./filter"),N=t("./online/editduties"),B=t("./server/generator"),j=t("../rpr/maindbi_ui"),P=t("../calendar/event_popup"),M=t("../asc/purchase"),O="SubstOnline",z={"":"",ok:a.ICON_subst_ok,zle:a.ICON_subst_kolizia,zle_ignored:a.ICON_subst_kolizia_ignored,spoj:a.ICON_subst_spojenie,changelesson:a.ICON_subst_changelesson,addlesson:a.ICON_subst_addlesson,addlesson_todo:"/substitution/pics/subst_add_todo_32.svg",cancelled:a.ICON_subst_cancelled,movelesson:a.ICON_subst_movelesson,movelesson_todo:"/substitution/pics/subst_move_todo_32.svg",movedlesson:a.ICON_subst_moved,nomatch:"/substitution/pics/nomatch_32.png",error:"/substitution/pics/error_16.png"},F=["spoj","zle_ignored","nomatch","zle","error"],L=["officialtimetables","teachers","subjects","absent_types","substitution_types","approbations"],G=["absent_types","substitution_types","approbations"],U={mode:"substs",date:"2000-01-01",filter:{},join_doubles:!0,selectedOtherId:"",selectedSubstId:"",tt:{teachers:{},classes:{},classrooms:{}},leftWidth:200,rightWidthPercent:25};function q(e,t,n,r){try{var i=[],o=new Map,l=[],c=new g.TTItemTimeProvider(e);c.setDate(e.rowData("substonline_dates",n),null);for(var u=e.tableFilterData("substonline_substitutions",{date:n}),m=e.tableFilterData("substonline_ttitems",{date:n}),p=function(n){var r=n.absent;if(r&&"classes"==a.absentGetTable(r))return"continue";var u=a.coreTTItemOfSubst(n,!1),p=a.coreTTItemOfSubst(n,!0),b=a.findTTItemFromSubstId(m,n.id,n.cancelled),_=b;if(_||n.cancelled||(_=a.findTTItemFromSubstId(m,n.id,!0)),_&&_.cancelled_absent)return"continue";var h=s.__assign(s.__assign({},n),{stav:"",starttime:c.provide(u).starttime,ttitemid:b?b.id:"",kolizie:[]});if(!b)return h.stav="nomatch",l.push(h),"continue";if(!r)if(a.substIsAddCard(n)){var g=0<(null==b?void 0:b.teacherids.length)||n.cancel_teacher;n.origid?h.stav=g?"movelesson":"movelesson_todo":h.stav=g?"addlesson":"addlesson_todo"}else h.stav="changelesson";for(var v=0,y=f.getSubstTTItemKolizie(e,t,b,[b.id]);v<y.length;v++){var E=y[v];if(E.item){if(E.table){var w=!1;if(p.uniperiod!=u.uniperiod&&(w=!0),a.substIsAddCard(n)&&(w=!0),d.idsArrayMatchI(a.substTTItem_tableIds(p,E.table),a.substTTItem_tableIds(u,E.table))||(w=!0),!w)continue}if(E.join)h.stav||(h.stav="spoj");else{for(var S=E.item.subjectid,x=0,T=["classids","groupnames","teacherids","classroomids"];x<T.length;x++){var C=T[x];S+="|",S+=E.item[C].join(",")}h.kolizie.push(S),0<=n.kolizie_ignored.indexOf(S)?"zle"!=h.stav&&(h.stav="zle_ignored"):h.stav="zle"}}E.absent&&(h.stav="zle")}if(n.cancelled&&(0<(null===(x=n.origofids)||void 0===x?void 0:x.length)?h.stav="movedlesson":h.stav="cancelled"),n.orig_err&&(h.stav="error"),r){var k=a.absentGetTable(r),D=a.absentGetId(r),I=n.changes.find(function(e){return a.changeColumn2table(e.column)==k&&e.old==D});I&&!h.stav&&(I.new?h.stav="ok":"teachers"==k&&n.cancel_teacher&&(h.stav="ok"))}0==h.kolizie.length&&(h.kolizie=void 0),i.push(h),o.set(h.id,h)},b=0,_=u;b<_.length;b++)p(_[b]);var h=a.buildSubstOnlineTTItemsEx(e,n,r),v=new Map;h.map(function(e){return[e.id,e]});var y=new Map;if(h.forEach(function(e){v.set(e.id,e),e.join_substid2first&&e.join_substid2first.forEach(function(e,t){y.set(t,o.get(e))})}),r)i=i.filter(function(e){var t=v.get(e.ttitemid);if(t)return e.join_duration=t.durationperiods,!0;var n=y.get(e.id);return n?(F.indexOf(e.stav)>F.indexOf(n.stav)&&(n.stav=e.stav),!1):(e.stav="error",!0)});else for(var E=0,w=i;E<w.length;E++){var S=w[E],x=v.get(S.ttitemid);(x.join_previd||x.join_nextid)&&(S.join_can=!0)}for(var T=0,C=l;T<C.length;T++)S=C[T],i.push(S);return i.sort(function(e,t){return e.starttime<t.starttime?-1:1}),i}catch(n){if(e.mock)return[];throw n}}function H(e){var t=e.stav;return!!t&&"movelesson_todo"!=t&&"addlesson_todo"!=t}function V(e){var n,i=this,c=l.client_req;o.useTTLang();var u=e.jsc,_=o.useStateValueRef(s.__assign(s.__assign({},U),{date:e.date||c.timezone_date()})),h=_.value,g=h.date,E=h.join_doubles,S=h.filter,x=h.selectedSubstId,I=c.getSchoolYear(g),R=r.useRef(),N=r.useRef(),B=C.useMainDBI(I,{vt_filter:{date:g},needed_part:d.DBITools.mergeNeededParts(V,{substonline_ttitems:["ol_is","eventids","changeeventids"]}),needed_combos:d.DBITools.mergeNeededCombos(A.substFilterMenu.needed_combos,{substitution_types:["default_for"]}),interactive:!0}),j=B.rowData("substonline_dates",g,{date:g,tt_num:null}),P=C.useTTDBI(j.tt_num,{needed_part:d.DBITools.mergeNeededParts(V.ttdbi)}),z=C.useSubscribedDBI("substdbi",j.subst_dbid,{needed_part:d.DBITools.mergeNeededParts(V.substdbi)}),F=r.useMemo(function(){return new d.MergeDBI(B,P,z)},[B,P,z]),L=r.useMemo(function(){return B.tableFilterData("substonline_absents",{date:g})},[B,g]),G=r.useMemo(function(){return B.tableFilterData("substonline_substitutions",{date:g})},[B,g]),J=r.useMemo(function(){return B.tableFilterData("events",{date:g})},[B,g]),Z=r.useMemo(function(){return B.tableFilterData("substonline_ttitems",{date:g})},[B,g]),$=r.useMemo(function(){return q(B,P,g,E)},[B,P,g,E]),X=$.find(function(e){return e.id==x}),Q={dbi:B,tt_dbi:P,naming_dbi:F,filter:h.filter,state:h,stateRef:_,jsc:u,ribbonMenu:R,showExtraInfo:!0,setState:function(e){_.set(function(t){return"function"==typeof e&&(e=e(t)),s.__assign(s.__assign({},t),e)})},goToDate:function(e){var t={prev:-1,next:1}[e];if(t){e=g;for(var n=0;n<3&&(e=T.date_delta(e,t),T.date_isWeekend(c,e));n++);}this.setState({date:e})},setMode:function(e){this.setState({mode:e,selectedOtherId:""})},getDate:function(){return g},getDateRow:function(){return j},getSubstsEx:function(){return $},getAbsents:function(){return L},getSubsts:function(){return G},getEvents:function(){return J},getTTItems:function(){return Z},getSelectedSubst:function(){return X},checkUploaded:function(e){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){return e=e||this.getDate(),[2,v.checkUploaded(this.dbi,e)]})})},timetableMenu:function(e,t){var n=this;return[{text:b.action_name("timetable")+" + "+b.action_name("substitution"),icon:b.action_icon("timetable"),onClick:function(){return n.showTimetableDlg(e,t)}},{text:c.ls(8735),icon:b.action_icon("timetable"),onClick:function(){return n.showPermanentTimetableDlg(e,t)}}]},clickSet_tcards_subst:function(e){var t,n;return void 0===e&&(e=void 0),s.__awaiter(this,void 0,void 0,function(){var i;return s.__generator(this,function(s){switch(s.label){case 0:return i=null===(n=null===(t=B.rowData("global_settings","1"))||void 0===t?void 0:t.subst_online)||void 0===n?void 0:n.tcards_subst,void 0===e&&(e=!i,j.uploaded_int||(e=!j.tcards_subst)),[4,o.RDialog.showConfirm(r.createElement(r.Fragment,null,b.action_name(e?"activate":"deactivate"),l.client_req.localize(": {6724} - {1003}"),r.createElement("br",null),b.action_name("date"),": ",T.date_format_date(l.client_req,g),r.createElement("br",null),r.createElement("br",null),l.client_req.ls(1054)))];case 1:return s.sent()?i==e?[3,3]:[4,ASC.blockUI(B.backend.updateRow("global_settings",{id:"1",subst_online:{tcards_subst:e}}))]:[2];case 2:s.sent(),s.label=3;case 3:return j.tcards_subst==e?[3,5]:[4,ASC.blockUI(y.setDateTcardsSubst(null,g,e))];case 4:s.sent(),s.label=5;case 5:return[2]}})})},purchase:function(){u.purchase_action()},importFile:function(e,t){return void 0===t&&(t=""),s.__awaiter(this,void 0,void 0,function(){var n,r,i,a;return s.__generator(this,function(s){switch(s.label){case 0:return r=["cmd=upload","date="+g,"mode="+t],i="data=",a=encodeURIComponent,[4,o.file2base64(e)];case 1:return n=r.concat([i+a.apply(void 0,[s.sent()])]).join("&"),u.ASC_action("import",n),[2]}})})},showAbsentEditDlg:function(e,t){return void 0===t&&(t={}),s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(n){switch(n.label){case 0:return[4,this.checkUploaded(e?e.split(":")[0]:"")];case 1:return n.sent()?[2]:[4,D.showSubstAbsentEditDlg(e,{date:this.getDate(),row:{period:t.period,durationperiods:t.durationperiods,groupname:t.groupname},teacherids:t.teacherids,classids:t.classids,classroomids:t.classroomids})];case 2:return n.sent(),[2]}})})},showAbsentDeleteDlg:function(e){return s.__awaiter(this,void 0,void 0,function(){var t,n;return s.__generator(this,function(s){switch(s.label){case 0:return[4,this.checkUploaded()];case 1:return s.sent()?[2]:(t=B.rowData("substonline_absents",e),n=c.ttls(2117),t&&"teachers"!=t.table&&(n=b.action_name("delete")+" - "+c.ls(1054)),[4,o.RDialog.showConfirm(n)]);case 2:return s.sent()?[4,y.removeAbsent(null,e)]:[3,4];case 3:s.sent(),s.label=4;case 4:return[2]}})})},showDayNoteDlg:function(){return s.__awaiter(this,void 0,void 0,function(){var e,t,n;return s.__generator(this,function(s){switch(s.label){case 0:return e="substonline_dates",t=B.rowData(e,g),[4,o.RDialog.showInput({id:this.getDate(),subst_note:t.subst_note},function(e){return r.createElement(o.RTextArea,{valueRef:e.stateRef.sub("subst_note"),style:{height:100,width:"100%"}})},{header:this.dbi.column(e,"subst_note").name()})];case 1:return(n=s.sent())?d.DBITools.rowChanges2write(t,n)?[4,ASC.blockUI(B.backend.updateRow(e,n,{log_module:O}))]:[3,3]:[2];case 2:s.sent(),s.label=3;case 3:return[2]}})})},showTimetableDlg:function(e,t,n){return void 0===n&&(n={}),s.__awaiter(this,void 0,void 0,function(){var r,i=this;return s.__generator(this,function(s){return t||(r=d.DBITools.splitItemsForCombo(this.dbi.tableData(e),this.getDate())[0],t=r&&r.id||""),f.showSubstTimetableDlg(this.getDate(),e,t,{join_doubles:E,move_substid:n.move_substid,onGoToDate:function(e){return i.goToDate(e)}}),[2]})})},showPermanentTimetableDlg:function(e,n){return void 0===e&&(e=""),void 0===n&&(n=""),s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(s){switch(s.label){case 0:return[4,ASC.loadBundle("ttviewer")];case 1:return s.sent(),[4,Promise.resolve().then(function(){return t("../timetable/ttviewer")})];case 2:return s.sent().showTTViewerDlg({num:j.tt_num,user:n&&d.DBITools.rowid2user(e,n)}),[2]}})})}};u.online=Q;var ee=null;if(j.uploaded_int)ee=r.createElement("div",{style:{flex:"0 0 auto",padding:"80px 20px"}},r.createElement("img",{src:"/substitution/pics/uploaded_32.png",style:{float:"left",margin:5}}),c.ls(2740),r.createElement("br",null),"(",r.createElement(o.DateTimeText,{datetime_int:j.uploaded_int}),","," ",r.createElement("span",{onClick:function(){return Q.jsc.ASC_action("showDB","date="+g)},style:{cursor:"pointer"}},c.ls(3027)),")",r.createElement("br",null),r.createElement("br",null),B.tableFilterData("substonline_substitutions",{date:g}).find(function(e){return e.ttmatchfail})&&r.createElement(r.Fragment,null,r.createElement("img",{src:"/substitution/pics/nomatch_32.png",style:{float:"left",margin:3}}),c.ls(2573)));else if(X){var te="",ne="",se="",re="",ae=Q.getSelectedSubst();if(ae&&(te=ae.ttitemid,ae.absent)){var le=a.absentGetTable(ae.absent);if("teachers"==le||"classrooms"==le){ne=le,se=a.absentGetId(ae.absent);var ce=ae.changes.find(function(e){return a.changeColumn2table(e.column)==ne&&e.old==se});ce&&(re=ce.new||"")}}var ue=d.DBITools.removeEs(ne)+(ae.classroomsupervision?"id":"ids");ee=r.createElement(m.TeachersView,{online:Q,dbi:B,tt_dbi:P,date:g,filter:S,ttitemid:te,table:ne,topid:re,join_doubles:h.join_doubles,onRowDoubleClick:function(e){ASC.hidePopups(),ae&&se&&v.showTTItemEditDlg(te,E,{dbi:B,filter:S,select_change:{column:ue,old:se,new:e}})},onRowPeriodClick:function(e,t){var n="new_"+d.DBITools.removeEs(ne)+"id";t.stopPropagation();var r=[];r.push({text:c.ls(2105),icon:"/substitution/pics/ok_16.png",onClick:function(){return s.__awaiter(i,void 0,void 0,function(){var t;return s.__generator(this,function(s){return[2,y.updateSubstSubstitution(null,ae.id,(t={},t[n]=e,t),1<ae.join_duration)]})})}}),r.push([]);for(var a=function(t){r.push({text:ASC.escapeHTML(t.name),icon:B.table("substitution_types").icon(),checked:t.id==ae.substitution_typeid,onClick:function(){var s;return y.updateSubstSubstitution(null,ae.id,((s={})[n]=e,s.substitution_typeid=t.id,s),1<ae.join_duration)}})},o=0,l=B.tableData("substitution_types");o<l.length;o++)a(l[o]);r.push([]),r.push({text:c.ttls(1034),icon:b.action_icon("edit"),onClick:function(){return v.showTTItemEditDlg(te,E,{dbi:B,filter:S,select_change:{column:ue,old:se,new:e}})}}),k.showMenu(r,t.target)}})}else ee=r.createElement(r.Fragment,null,!j.tt_num&&r.createElement("div",{style:{flex:"0",padding:"80px 20px"}},r.createElement("img",{src:"/static/pics/ui/item_warning_32.png",style:{marginRight:10,verticalAlign:"middle"}}),c.ls(2005)),0<Q.getAbsents().length&&r.createElement("div",{style:{flex:"0",padding:"80px 20px"}},c.ttls(2122)));var de=r.useRef();return r.useLayoutEffect(function(){wndResize()},[]),r.createElement("div",{ref:de,id:"fitheight",style:{display:"flex",flexDirection:"column"},className:o.classNames({subst_online_colorblind:null===(n=B.rowData("global_settings","1"))||void 0===n?void 0:n.colorblind})},r.createElement(o.RDropZone,{className:"ribbon_d",onFile:function(e){return Q.importFile(e,"multi")}},r.createElement(W,{online:Q,onClickSelecteNextSubst:function(){for(var e=N.current,t=h.selectedSubstId,n="",s=!1,r="",i=0,a=e.getSortedData();i<a.length;i++){var o=a[i],l=o.id;H(o.subst)||(n=n||l,s&&!r&&(r=l)),l==t&&(s=!0)}_.sub("selectedSubstId").set(r||n)}})),r.createElement("div",{style:{flex:"1 1 100px",height:100,minHeight:0},className:"content_d"},r.createElement(p.LeftPanel,{online:Q,style:{width:h.leftWidth}}),r.createElement(w.SplitLine,{sizeRef:_.sub("leftWidth"),axis:"x",min:50}),r.createElement(o.RDropZone,{className:"subst_d",style:{flex:"1 1 100px",minWidth:0,display:"flex",flexDirection:"column"},onFile:function(e){Q.importFile(e)}},r.createElement(M.LicenseExpiredBanner,{dbi:B}),r.createElement(K,{online:Q}),"substs"==h.mode?r.createElement(ie,{online:Q,controlRef:N}):r.createElement(oe,{online:Q,table:h.mode}),r.createElement(Y,{online:Q})),r.createElement(w.SplitLine,{sizeRef:_.sub("rightWidthPercent"),axis:"-x",unit:"%",min:5,max:50}),r.createElement("div",{className:"teachers_d",style:{display:"flex",flexDirection:"column",position:"relative",width:h.rightWidthPercent+"%"}},ee,r.createElement(m.MenuIcon,{style:{position:"absolute",right:1,top:3},fa_icon:b.action_fa_icon("help"),onClick:function(e){return window.open("https://help.edupage.org/text.php?id=1880","_blank")},title:b.action_name("help")}))))}function W(e){var n,i,c,u=this,d=e.online,m=d.state,p=d.dbi,f=d.stateRef,g=m.mode,w=m.join_doubles,S=l.client_req,x=d.getDate(),k=S.getSchoolYear(x),D=G.includes(g),I=d.getDateRow();o.useLockBodyScroll();var R=[];"officialtimetables"==m.mode&&S.hasRight("timetable")&&(R.length&&R.push([]),R.push({text:S.ls(1001),icon:d.dbi.table("officialtimetables").icon(),submenu:[{text:S.ls(1059),icon:"/static/pics/ui/verify_32.png",onClick:function(){d.jsc.ASC_action("tt_verify","date="+x+"&id="+m.selectedOtherId)}}]})),I.uploaded_int&&(R.length&&R.push([]),R.push({text:"PC "+S.ls(1003),icon:"/static/pics/subst_32.png",submenu:[{text:S.ls(3027),icon:"/customize/pics/gridedit.png",onClick:function(){d.jsc.ASC_action("showDB","date="+x)}}]})),"substs"==g&&!I.uploaded_int&&(I.is_online||d.getAbsents().length||d.getSubsts().length)&&(R.length&&R.push([]),R.push({text:S.ls(3988),onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.ui.Dialog.areYouSureDlg(ASC.ls(3988))];case 1:return e.sent()?[4,ASC.blockUI(y.unpublishDay(null,d.getDate()))]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}})),R.length&&R.push([]);var N=null===(i=null===(n=p.rowData("global_settings","1"))||void 0===n?void 0:n.subst_online)||void 0===i?void 0:i.tcards_subst;R.push({text:l.client_req.localize("{6724} - {1003} (beta)"),checked:N,onClick:function(){return d.clickSet_tcards_subst(!N)}}),R.length&&R.push([]);var P=null===(c=p.rowData("global_settings","1"))||void 0===c?void 0:c.colorblind;R.push({text:l.client_req.ls(3149),submenu:[{text:l.client_req.ls(3150),checked:P,onClick:function(){return p.backend.updateRow("global_settings",{id:"1",colorblind:!P},{log_module:O})}}]});var M=[];function z(e){j.showDashboardReport(e,{datefrom:x,dateto:x,subst_unpublished:!0})}"de"!=S.school_country&&!S.props.ascdevelop||(M.push({text:"NRW - UntStat",onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../exports/de_nrw/weekstats")})];case 1:return[2,e.sent().showNRW_WeekStatsDlg(T.date_week(l.client_req,x))]}})})}}),M.push({text:"NRW - GPC",onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../exports/de_nrw/gpc")})];case 1:return[2,e.sent().showNRW_GPCExport()]}})})}}),M.push({text:"Bayern - Statistik",onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../exports/de_by/bayern_weekstats")})];case 1:return[2,e.sent().showBayern_WeekStatsDlg(T.date_week(l.client_req,x))]}})})}}),M.push({text:"ThÃ¼ringen - Statistik zur UnterrichtserfÃ¼llung",onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../exports/de_th/weekstats")})];case 1:return[2,e.sent().showThuringen_WeekStatsDlg(T.date_week(l.client_req,x))]}})})}}));var F=[{text:S.ttls(2076)+" - "+S.ls(1929),onClick:function(){return z("substinfo_teachers")},icon:"/substitution/pics/subst_daily.png"},{text:S.ttls(2076)+" - "+S.ls(1930),onClick:function(){return z("substinfo_classes")},icon:"/static/pics/student_32.png"},{text:S.ttls(2114),onClick:function(){return z("substitutionsummary")},icon:"/substitution/pics/missing2_128.png"},{text:S.ttls(2079),onClick:function(){return z("absentsummary")},icon:"/substitution/pics/parameters_32.png"},[],{text:S.ls(1641),onClick:function(){return z(void 0)}},[],{text:"("+S.ls(1470)+") "+S.ttls(2076),onClick:function(){return z("substitution2teachers")},icon:"/substitution/pics/subst_daily.png"},{text:"("+S.ls(1470)+") "+S.ttls(2077),onClick:function(){return z("substitution2students")},icon:"/static/pics/student_32.png"}],U=[{text:S.ls(1337),onClick:function(){return d.jsc.ASC_action("send","msgType=email&date="+x)}}];["skullerud","gorazdnr","gymlipany","robotnik","zspovke","zssneznica"].includes(S.edupage)&&U.push({text:S.ls(1346),onClick:function(){return d.jsc.ASC_action("send","msgType=sms&date="+x)}});var q=d.getSubstsEx().filter(function(e){return!H(e)}).length;return r.createElement(E.RibbonMenu,{controlRef:d.ribbonMenu},r.createElement(E.Ribbon,{title:S.ttls(3222),key:"main",right:r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ls(1347),icon:ce("refresh_32"),onClick:function(){return C.refreshSubscribedDBI(p)}}))},r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:"",icon:ce(S.props.rtl?"next_32":"previous_32"),onClick:function(){d.goToDate("prev")}}),r.createElement(E.RibbonDiv,null,r.createElement(ue,{valueRef:le(d,"date").cast(function(e){return e},function(e,t){return d.goToDate(e),t}),style:{textAlign:"center"}}),r.createElement("br",null),r.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},ASC.ASC_date2str_day(d.getDate()))),r.createElement(E.RibbonButton,{label:"",icon:ce(S.props.rtl?"previous_32":"next_32"),onClick:function(){d.goToDate("next")}})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ttls(1995),icon:ce("patient_ok_32"),menu:[{text:S.ttls(3806),onClick:function(){d.showAbsentEditDlg("")}}]}),r.createElement(E.RibbonButton,{label:q?S.ttls(3800)+"\n("+q+")":S.ls(1341),icon:q?ce("next_subs_32"):"/static/pics/item_ok_32.svg",onClick:e.onClickSelecteNextSubst})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ttls(3798),icon:ce("tools_32"),menu:s.__spreadArrays([{text:S.ls(1783),onClick:function(){ASC.blockUI(B.generateSubstitution(null,x,{filter:d.filter,join_doubles:w}))},icon:ce("gener_32")},{text:S.ttls(3795),onClick:function(){d.showDayNoteDlg()},icon:"/substitution/pics/daily_remark_32.png"},{text:S.ttls(3794),onClick:function(){o.RDialog.show(r.createElement(h.ChangeOtherLessonDlg,{app:d}))},icon:"/static/pics/modified_32.svg"},{text:S.ttls(3793),onClick:function(){return s.__awaiter(u,void 0,void 0,function(){var e;return s.__generator(this,function(t){return(e=d.getSelectedSubst())&&v.showSubstDeleteDlg(d.dbi,e.id,w),[2]})})},icon:ce("del_32")},{text:S.ttls(3784),onClick:function(){return _.showSubstEditAddCardDlg(k,"",{date:x,join_doubles:w})},icon:a.ICON_subst_addlesson},{text:S.ttls(3111),icon:"/static/pics/link_32.svg",onClick:function(){return Promise.resolve().then(function(){return t("./online/joinclasses")}).then(function(e){return e.showSubstJoinClassesDlg({date:x})})}},{text:S.ls(12014)+" (beta)",icon:"/substitution/pics/subst_students_32.svg",onClick:function(){return j.showMainDbiItemDlg(k,"substonline_students","",{date:x})}},{text:S.ls(2741),onClick:function(){return v.showDayDeleteDlg(x)},icon:"/static/pics/delete2_32.png"}],["ascpalo","schillertest2","gsg-waldkirch","europaschule-bornheim","esg-filderstadt"].includes(S.edupage)||S.props.isAsc?[{text:"Review day (aSc)",onClick:function(){return Promise.resolve().then(function(){return t("./review")}).then(function(e){return e.showSubstReviewDlg(x)})}}]:[])}),r.createElement(E.RibbonButton,{icon:"/static/pics/filter_32.svg",label:A.substFilterText(p,m.filter)||S.ls(1838),menu:function(){return A.substFilterMenu(p,f.sub("filter"))},selected:A.isSubstFilterOn(m.filter)}),r.createElement(E.RibbonButton,{label:b.action_name("timetable"),icon:b.action_icon("timetable"),menu:s.__spreadArrays(["classes","teachers","classrooms","igroups"].filter(function(e){return 0<p.tableData(e).length}).map(function(e){var t=p.table(e);return{text:t.name(),icon:t.icon(),onClick:function(){return d.showTimetableDlg(e,"")}}}),[[],{text:S.ls(8735),onClick:function(){return d.showPermanentTimetableDlg()},icon:b.action_icon("timetable")}])})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ls(1638),icon:ce("print_preview_32"),menu:F}),r.createElement(E.RibbonButton,{label:S.ls(1590),icon:ce("email_32"),menu:U}),r.createElement(E.RibbonButton,{label:S.ls(4159),icon:"/static/pics/ui/notifications_32.svg",onClick:function(){return v.showNotifications()}}),0<M.length&&r.createElement(E.RibbonButton,{label:b.action_name("export"),icon:b.action_icon("export"),menu:M})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ls(1989),icon:ce("home_32"),onClick:function(){window.open("/substitution/?date="+d.getDate(),"_blank")}}),(["de","at"].includes(S.school_country)||"ascpalo"==S.edupage)&&r.createElement(E.RibbonButton,{label:S.ls(9067),icon:"/static/pics/infoscreen_32.svg",onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../infoscreen/admin")})];case 1:return[2,e.sent().showInfoscreensAdminDlg()]}})})}})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ls(1077),icon:ce("onlinehelp_32"),onClick:function(){window.open("https://help.edupage.org/text.php?id=1635&lang="+l.client_req.lang,"_blank")}}),r.createElement(E.RibbonButton,{label:S.ls(1593),icon:ce("help_32"),onClick:function(){v.showFeedbackDlg()}}))),r.createElement(E.Ribbon,{title:S.ls(1637),key:"settings"},r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ls(1748),icon:ce("back_32"),onClick:function(){d.ribbonMenu.current.select("main"),"substs"!=g&&d.setMode("substs")}})),r.createElement(E.RibbonGroup,null,L.map(function(e){var t=d.dbi.table(e);return r.createElement(E.RibbonButton,{key:e,label:t.name(),icon:t.icon(),selected:e==g,onClick:function(){d.setMode(e)}})})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ls(1257),icon:ce("add_32"),onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,j.showMainDbiItemDlg(k,g,"")];case 1:return e.sent(),[2]}})})},mini:!0,enabled:D}),r.createElement(E.RibbonButton,{label:S.ls(1053),icon:ce("edit_32"),onClick:function(){return s.__awaiter(u,void 0,void 0,function(){var e;return s.__generator(this,function(t){switch(t.label){case 0:return(e=m.selectedOtherId)?[4,j.showMainDbiItemDlg(k,g,e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},mini:!0,enabled:D}),r.createElement(E.RibbonButton,{label:S.ls(1047),icon:ce("del_32"),onClick:function(){return s.__awaiter(u,void 0,void 0,function(){var e;return s.__generator(this,function(t){switch(t.label){case 0:return(e=m.selectedOtherId)?[4,j.showMainDbiRemoveDlg(k,g,e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},mini:!0,enabled:D})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ttls(3796),icon:ce("dayintimetable_32"),onClick:function(){v.showSubstDaysDlg({date:x,onGoToDate:function(e){return d.goToDate(e)}})}}),r.createElement(E.RibbonButton,{label:l.client_req.ls(6737),icon:ce("settings_basic_32"),onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(Promise.resolve().then(function(){return t("./online/settings")}))];case 1:return[4,e.sent().showSubstSettingsCriteriaDlg()];case 2:return e.sent(),[2]}})})}}),r.createElement(E.RibbonButton,{label:S.ls(1989)+" / "+S.ls(6950),icon:ce("home_32"),onClick:function(){return s.__awaiter(u,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(Promise.resolve().then(function(){return t("./vieweradmin")}))];case 1:return e.sent().showSubstViewerAdminSettingsDlg(),[2]}})})}}),r.createElement(E.RibbonButton,{label:S.ls(1601),icon:ce("settings_adv_32"),menu:R}))),r.createElement(E.Ribbon,{title:S.ls(1077),key:"help"},r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ls(1748),icon:ce("back_32"),onClick:function(){d.ribbonMenu.current.select("main"),"substs"!=g&&d.setMode("substs")}})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ttls(2797),icon:ce("register_32"),onClick:function(){d.purchase()}})),r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:S.ls(1077),icon:ce("onlinehelp_32"),onClick:function(){window.open("https://help.edupage.org/#921","_blank")}}),r.createElement(E.RibbonButton,{label:S.ls(1593),icon:ce("help_32"),onClick:function(){d.jsc.ASC_action("feedback","")}})),S.props.isAsc&&r.createElement(E.RibbonGroup,null,r.createElement(E.RibbonButton,{label:"ASC tools",icon:"/static/pics/settings_adv_32.png",menu:[{text:S.ls(2790),onClick:function(){return d.jsc.ASC_action("regenerate","date="+x)}},{text:"Parse UPLOAD",onClick:function(){return d.jsc.ASC_action("refresh","parse=1&date="+x)}},{text:"Download UPLOAD",onClick:function(){return d.jsc.ASC_action("refresh","download=1&date="+x)}}]}))))}function K(e){var t,n=e.online,s=n.state,i=n.getDate(),a=n.dbi,l=a.req,c=n.getDateRow(),u=null===(t=a.rowData("globals","1"))||void 0===t?void 0:t.subst_onlinedays,d=null;if("substs"==s.mode)if(c.needsregenerate)d=r.createElement(v.SubstNeedsRegenerateBar,{date:i});else if(c.is_online||0<u){var m=c.is_online?l.ls(2744):l.lsf(2827,{n:u});d=r.createElement(r.Fragment,null,r.createElement("span",{style:{marginRight:"10px"}},m),r.createElement(o.RButton,{label:l.ls(1587),icon:"/static/pics/item_ok_16.svg",onClick:function(){return v.showSubstPublishDlg(i,{log_module:O})}}),c.is_online?r.createElement(o.RButton,{label:l.ls(1038),icon:"/static/pics/item_bad_16.svg",onClick:function(){n.jsc.ASC_action("revert","date="+i)}}):null)}return r.createElement(o.AnimatedCollapseDiv,{duration:.5,className:"info_top",style:{height:"32px"},collapsed:!d},d)}function Y(e){var t,n,s=e.online;if("substs"!=s.state.mode)return null;var i=s.dbi,a=s.tt_dbi,o=s.getDate(),l=i.req,c=[],d="",m=s.getDateRow();if(m.tt_num&&a){d=l.ls(1001)+": "+i.rowName("officialtimetables",""+m.tt_num);for(var p=0,b=[["tt_term","terms"],["tt_week","weeks"],["tt_day","days"]];p<b.length;p++){var f=b[p],_=f[0],h=f[1];a.tableData(h).length<2||(d+=", "+a.rowName(h,m[_]))}c=m.subst_problems||[]}var g=null,v=null===(n=null===(t=i.rowData("global_settings","1"))||void 0===t?void 0:t.subst_online)||void 0===n?void 0:n.tcards_subst;return m.tcards_subst!=v?g=r.createElement(r.Fragment,null,r.createElement("br",null),l.ls(6724),": ",m.tcards_subst?l.ls(1671):l.ls(1686)," (",r.createElement("a",{style:{cursor:"pointer"},onClick:function(){return s.clickSet_tcards_subst(v)}},v?l.ls(1669):l.ls(1670)),")"):m.tcards_subst&&(g=l.ls(6724)),m.published_int&&(d+="\n("+l.ls(3279)+": "+T.date_format_time(l,l.timezone_datetime(m.published_int),{ajDenSlovom:!1})+")"),r.createElement("div",{className:"info"},0<c.length&&r.createElement(r.Fragment,null,l.ls(2025)+": ",c.map(function(e,t){var n={},i=null,a=l.ls(6370);return"warning"!=e.level&&(n={color:"red",fontWeight:"bold",fontSize:"150%"}),"unlinked"==e.type&&(i=function(){s.jsc.ASC_action("tt_verify","date="+o)},a=l.ls(1001)+" - "+l.ls(1059)),r.createElement(u,{key:t},0<t&&", ",r.createElement("span",{style:n},e.text,i&&r.createElement("span",{style:{cursor:"pointer",marginLeft:"5px",whiteSpace:"nowrap",color:"#808080",textDecoration:"underline"},onClick:i},a)))}),r.createElement("br",null)),d,g&&r.createElement(r.Fragment,null,", ",g),r.createElement("br",null),m.subst_note&&r.createElement("span",{onClick:function(){return s.showDayNoteDlg()},style:{cursor:"pointer"}},l.ttls(3795),": ",(""+m.subst_note).replace(/\n/g,"â†² ").replace(/\r/g,"")))}(e.buildSubstExItems=q).npp=a.substOnlineNeededPartProvider(function(){return[g.TTItemTimeProvider,a.coreTTItemOfSubst,a.findTTItemFromSubstId,f.getSubstTTItemKolizie,a.buildSubstOnlineTTItemsEx,{substonline_substitutions:["date","absent","kolizie_ignored","addcard","addtcard","origid"],substonline_ttitems:["date","cancelled_absent"]}]}),q.ttdbi={npp:d.neededPartProvider(function(){return[f.getSubstTTItemKolizie.ttdbi]})},(e.SubstOnline=V).npp=a.substOnlineNeededPartProvider(function(){return[{globals:["subst_onlinedays"],global_settings:["colorblind","subst_online"],substonline_dates:["tt_num","subst_dbid","uploaded_int"],substonline_substitutions:["origofids"]},W,p.LeftPanel,m.TeachersView,ie,oe,K,Y,q,a.coreTTItemOfSubst,v.showTTItemEditDlg,D.AbsentEditDlg,A.substFilterRows,M.LicenseExpiredBanner]}),V.ttdbi={npp:d.neededPartProvider(function(){return[Y.ttdbi,m.TeachersView.ttdbi,c.MiniTimeoff.ttdbi,{classes:["__name"],teachers:["__name"],classrooms:["__name"],subjects:["__name"]}]})},V.substdbi={npp:d.neededPartProvider(function(){return[{classes:["__name"],teachers:["__name"],classrooms:["__name"],subjects:["__name"],absent_types:["__name"],substitution_types:["__name"]}]})},W.npp=d.neededPartProvider(function(){return[{buildings:["__name"]},A.substFilterMenu]}),K.needed_part=d.typed({globals:["subst_onlinedays"],substonline_dates:["is_online","needsregenerate"]}),Y.needed_part=d.typed({substonline_dates:["subst_problems","tt_term","tt_week","tt_day","tcards_subst","subst_note","published_int"]}),Y.ttdbi={needed_part:d.typed({terms:["__name"],weeks:["__name"],days:["__name"]})};var J,Z=(J=r.Component,s.__extends($,J),$.prototype.componentDidMount=function(){this.doUpdate()},$.prototype.componentDidUpdate=function(){this.doUpdate()},$.prototype.render=function(){return this.props.children},$.prototype.doUpdate=function(){var e=i.findDOMNode(this),t=e&&e.parentElement;t&&("TD"!=t.tagName&&ASC.dieError("7539815024",[t.tagName,t]),t.className=this.props.className)},$);function $(){return null!==J&&J.apply(this,arguments)||this}function X(e){return r.createElement(r.Fragment,null,r.Children.map(e.children,function(e,t){return r.createElement(u,{key:""+t},0<t&&", ",e)}))}function Q(e){var t=e.dbi,n=e.table,s=e.id,i=e.name_col,a="short"==i?"name":"short";return r.createElement("span",{style:e.style,title:t.rowName(n,s,a)},t.rowName(n,s,i))}function ee(e){var t=e.dbi,n=e.table,s=e.origid,i=e.changes,o=e.name_col,l=s?i.find(function(e){return a.changeColumn2table(e.column)==n&&e.old==s}):void 0;return l?r.createElement(r.Fragment,null,r.createElement(Q,{dbi:t,table:n,id:s,name_col:o})," âž”  ",l.new?r.createElement(Q,{dbi:t,table:n,id:l.new,name_col:o,style:{fontWeight:"bold"}}):r.createElement("span",null,"(X)")):r.createElement(Q,{dbi:t,table:n,id:s,name_col:o})}function te(e){var t=e.dbi,n=e.table,i=e.origids,l=e.changes,c=e.name_col;return r.createElement(Z,{className:l.some(function(e){return a.changeColumn2table(e.column)==n})?"change":""},r.createElement(o.HideSupportName,{table:n},r.createElement(X,null,s.__spreadArrays(i.map(function(e,s){return r.createElement(ee,{key:""+s,dbi:t,table:n,origid:e,changes:l,name_col:c})}),l.filter(function(e){return a.changeColumn2table(e.column)==n&&i.indexOf(e.old)<0}).map(function(e,s){return r.createElement(u,{key:"a"+s},"+",r.createElement(Q,{dbi:t,table:n,id:e.new,name_col:c,style:{fontWeight:"bold"}}))})))))}function ne(e){var t=e.online,n=e.table,s=e.subst,i=t.naming_dbi,o=i.req,l="short",c=a.subst_item_tableIds(s,n),u=s.card||s.tcard;if(u)return"classes"==n&&s.tcard&&s.tcard.igroupid?r.createElement(Q,{dbi:i,table:"igroups",id:s.tcard.igroupid,name_col:l}):r.createElement(r.Fragment,null,r.createElement(te,{dbi:i,table:n,origids:c,changes:s.cancelled?[]:s.changes,name_col:l}),"classes"==n&&u.groupnames&&0<u.groupnames.length&&!d.DBITools.groupnamesIsEntireClass(u.groupnames)&&" "+i.tools.groupnames_names(u.groupnames));if(s.classroomsupervision){if("classes"==n)return r.createElement(r.Fragment,null,"-");if("subjects"==n)return r.createElement(r.Fragment,null,o.ttls(3294));if("teachers"==n)return r.createElement(te,{dbi:i,table:n,origids:c,changes:s.changes,name_col:l});if("classrooms"==n)return r.createElement(Q,{dbi:i,table:n,id:s.classroomsupervision.classroomid,name_col:l})}return null}function se(e){var t=e.online,n=e.table,s=e.ttitem;if(!s)return r.createElement(r.Fragment,null,"Error1053608384");var i=t.naming_dbi,o=i.req,l="short",c=s.orig||s,u=a.substTTItem_tableIds(c,n);return"classroomsupervision"!=s.type?"classes"==n&&c.igroupid?r.createElement(Q,{dbi:i,table:"igroups",id:c.igroupid,name_col:l}):r.createElement(r.Fragment,null,r.createElement(te,{dbi:i,table:n,origids:u,changes:s.cancelled?[]:s.changes,name_col:l}),"classes"==n&&0<s.groupnames.length&&!d.DBITools.groupnamesIsEntireClass(s.groupnames)&&" "+i.tools.groupnames_names(s.groupnames)):"classes"==n?r.createElement(r.Fragment,null,"-"):"subjects"==n?r.createElement(r.Fragment,null,o.ttls(3294)):"teachers"==n?r.createElement(te,{dbi:i,table:n,origids:u,changes:s.changes,name_col:l}):"classrooms"==n?r.createElement(Q,{dbi:i,table:n,id:c.classroomids[0],name_col:l}):null}function re(e){var t=e.row,n=l.client_req,s=0,i=0,a=n.getSchoolYear(t.datefrom||t.dateto||"2000-01-01"),o=n.schoolYear_turnOver(a);return t.datefrom&&(s=T.date_diff(t.datefrom,o)/365*100),t.dateto&&(i=T.date_diff(t.dateto,o)/365*100),r.createElement(r.Fragment,null,r.createElement("div",{style:{backgroundColor:"rgba(0,0,0,0.2)",height:2,marginTop:-4,marginLeft:s+"%",marginRight:100-i+"%"}}),T.date_format_date(n,t.datefrom)+" - "+T.date_format_date(n,t.dateto))}function ie(e){var n,i=this,c=e.online,u=c.dbi,m=c.naming_dbi,p=c.state,f=p.join_doubles,_=p.filter,h=u.req;window.innerWidth,n=.7;var E=c.getDateRow(),w=c.getTTItems(),x=c.getSubstsEx(),T=(x=A.substFilterRows(u,c.state.filter,"substonline_substitutions",x)).map(function(e){var t=a.coreTTItemOfSubst(e),n=a.coreTTItemOfSubst(e,!0),s={id:e.id,stav:e.stav,subst:e,ttitem:a.findTTItemFromSubstId(w,e.id,e.cancelled),item_orig:a.coreTTItemOfSubst(e),item_new:a.coreTTItemOfSubst(e,!0),popis_orig:u.tools.ttitem_popis(t),popis_new:u.tools.ttitem_popis(n)};if(f&&e.join_duration){var r=e.join_duration-1;s.popis_orig.period+="-"+u.rowName("periods",d.DBITools.uniperiod_delta(t.uniperiod,r)),s.popis_new.period+="-"+u.rowName("periods",d.DBITools.uniperiod_delta(n.uniperiod,r))}return s});function C(e){return e.orig==e.new?r.createElement(r.Fragment,null,e.orig):r.createElement(r.Fragment,null,e.orig,"âž”â€‹",e.new)}var D=[{key:"stav",label:"",width:16,icons:z},{key:"periodorbreak",label:h.ttls(2096),width:34,sortable:!0,formatter:function(e){var t=e.row;return r.createElement(C,{orig:t.popis_orig.period,new:t.popis_new.period})}},{key:"absent",label:h.ttls(1995),width:64,sortable:!0,resizable:!0,formatter:function(e){var t=e.row.subst;return t.absent?r.createElement(o.HideSupportName,{table:t.absent.table},t.absent.name):null},sortFunction:function(e,t){return S.compareLocaleStrings(e.subst.absent&&e.subst.absent.name,t.subst.absent&&t.subst.absent.name)}},{key:"classids",label:h.ls(1263),width:64,sortable:!0,resizable:!0,formatter:function(e){return r.createElement(ne,{online:c,table:e.row.item_orig.igroupid?"igroups":"classes",subst:e.row.subst})},sortFunction:function(e,t){return g.sortTTItemClass(u,e.item_orig,t.item_orig)}},{key:"subjectid",label:h.ls(1299),width:170*n-6,resizable:!0,formatter:function(e){return r.createElement(ne,{online:c,table:"subjects",subst:e.row.subst})}},{key:"substitution_typeid",width:64,label:h.ttls(1997),resizable:!0,formatter:function(e){var t,n=e.row.subst;return n.cancelled?0<(null===(t=n.origofids)||void 0===t?void 0:t.length)?h.ls(11611):h.ttls(1476):c.naming_dbi.rowName("substitution_types",e.row.subst.substitution_typeid)}},{key:"substitute",label:h.ttls(2090),width:94,resizable:!0,formatter:function(e){var t=e.row.subst;if(t.absent){var n=a.absentGetTable(t.absent),i=a.absentGetId(t.absent);if("classrooms"==n)return r.createElement(r.Fragment,null,"âž”");for(var l=0,d=t.changes;l<d.length;l++){var p=d[l];if(a.changeColumn2table(p.column)==n&&p.old==i)return r.createElement(o.HideSupportName,{table:n},c.naming_dbi.rowName(n,p.new))}if("teachers"==n&&t.cancel_teacher)return r.createElement(r.Fragment,null,"-")}else if(t.changes.some(function(e){return"teachers"==a.changeColumn2table(e.column)}))return r.createElement(te,s.__assign({},{dbi:m,table:"teachers",origids:a.subst_item_tableIds(t,"teachers"),changes:t.changes,name_col:u.req.sort_name_col}));return null}},{key:"classroomids",label:h.ls(1197),width:64,resizable:!0,formatter:function(e){var t=e.row,n=t.subst,s=t.ttitem;if(n.absent){var i=a.absentGetTable(n.absent),o=a.absentGetId(n.absent);if("classrooms"==i&&s&&1==s.changes.filter(function(e){return a.changeColumn2table(e.column)==i}).length){var l=n.changes.find(function(e){return a.changeColumn2table(e.column)==i&&e.old==o});if(l)return r.createElement(Q,{dbi:m,table:"classrooms",id:l.new,name_col:"short"})}}return r.createElement(se,{online:c,table:"classrooms",ttitem:s})}},{key:"note",label:h.ls(1579),width:60.5,resizable:!0,formatter:function(e){var t=e.row,n=t.subst,s=t.ttitem;return r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(ae,{ttitem:s,online:c}),n.note),n.inote&&r.createElement("div",null,r.createElement("img",{src:"/substitution/pics/inote_32.svg",style:P.EventIcon.style}),n.inote))}}];if(T.find(function(e){return!(!e.subst.join_duration&&!e.subst.join_can)})){var I=c.state.join_doubles;D.splice(1,0,{key:"zgrc",width:0,label:" ",resizable:!1,align:"center",formatter:function(e){var t=e.row.subst,n="";return I?t.join_duration&&(n="/static/pics/tree_plus.png"):t.join_can&&(n="/static/pics/tree_minus.png"),n?r.createElement("img",{src:n,style:{cursor:"pointer",marginLeft:-4,marginRight:-4},onClick:function(){c.setState({join_doubles:!I}),barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstOnline."+(I?"join_doubles_off":"join_doubles"),eventLabel:""})},title:l.client_req.ls(9339)+" (beta)"}):null}})}function R(e){var t,n=null===(t=e.ttitem)||void 0===t?void 0:t.id;n&&!E.uploaded_int&&v.showTTItemEditDlg(n,f,{dbi:u,filter:_})}return r.createElement(S.RDatatable,{columns:D,data:T,selectedIdRef:le(c,"selectedSubstId"),dbi:u,fitWidth:!0,style:{width:"100%",height:"100%"},controlRef:e.controlRef,rowClassNames:function(e){var t=e.subst,n=t.absent,s=[];return n&&"classrooms"==n.table&&s.push("absent_classroom"),n||s.push("changecard"),t.cancelled&&s.push("cancelled"),s},onRowClick:function(e){return s.__awaiter(i,void 0,void 0,function(){return s.__generator(this,function(n){switch(n.label){case 0:return E.uploaded_int?"nomatch"!=e.stav?[3,2]:[4,Promise.resolve().then(function(){return t("./pc_subst")})]:[3,2];case 1:n.sent().showSubstNoMatchDlg(c,e.subst),n.label=2;case 2:return[2]}})})},onRowDoubleClick:function(e){return R(e)},onRowContextMenu:function(e,n){if(n.preventDefault(),!c.getDateRow().uploaded_int){var r=e.subst,o=e.ttitem,l=c.state.join_doubles,u=[];a.substIsMovedDate(r)?(u.push({text:h.ttls(3194)+" - "+h.ls(1090),icon:a.ICON_subst_movelesson,onClick:function(){return v.showMoveSubstDlg(r.id,l)}}),u.push({text:h.ttls(3194)+" - "+h.ls(1038),icon:a.ICON_subst_movelesson,onClick:function(){return s.__awaiter(i,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.ui.Dialog.areYouSureDlg(h.ttls(3194)+" - "+h.ls(1038))];case 1:return e.sent()?[4,ASC.blockUI(y.cancelSubstMove(null,r.id,l))]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}})):(u.push({text:h.ttls(1054),icon:b.action_icon("edit"),onClick:function(){return R(e)}}),r.cancelled?u.push({text:h.ls(1859)+": "+h.ttls(1476),icon:b.action_icon("add"),onClick:function(){return ASC.blockUI(y.uncancelSubstOnlineTTItem(null,o.id,l))}}):a.isSubstAdd(r)||u.push({text:h.ttls(1476),icon:b.action_icon("delete"),onClick:function(){return ASC.blockUI(y.removeSubstOnlineTTItem(null,o.id,1<r.join_duration))}}),r.absent||(u.push([]),u.push({text:h.ttls(3793),icon:ce("del_32"),onClick:function(){return v.showSubstDeleteDlg(c.dbi,r.id,l)}})),!r.card&&!r.tcard||r.cancelled||r.addcard||r.join_duration||(u.push([]),u.push({text:h.ls(6201),icon:b.action_icon("blank"),onClick:function(){Promise.resolve().then(function(){return t("./online/splitlesson")}).then(function(e){return e.showSplitTTitemDlg(o.id,l)})}})),r.card&&!r.cancelled&&(u.push([]),u.push({text:h.ls(7441),icon:a.ICON_subst_movelesson,onClick:function(){return v.showMoveSubstDlg(r.id,l)}}))),r.kolizie_ignored.length?(u.push([]),u.push({text:h.ls(1038)+": "+h.ls(6675)+" ("+r.kolizie_ignored.length+")",icon:b.action_icon("blank"),onClick:function(){return y.updateSubstIgnoreKolizie(null,r.id,!1)}})):r.kolizie&&(u.push([]),u.push({text:h.ls(6675)+" ("+r.kolizie.length+")",icon:b.action_icon("blank"),onClick:function(){return y.updateSubstIgnoreKolizie(null,r.id,!0)}})),k.showMenu(u,n)}}})}function ae(e){var t=e.ttitem,n=e.online;if(!n.showExtraInfo||!t)return null;var i=l.client_req,a=n.dbi,c=t.wds,u=t.ol_is,d=s.__spreadArrays(t.eventids||[],t.changeeventids||[]);return r.createElement(r.Fragment,null,0<(null==c?void 0:c.length)&&r.createElement(r.Fragment,null,u?r.createElement(I.TTView_IconOL,null):r.createElement("img",{src:"/exam/pics/hw/ucivo_c1.png",style:P.EventIcon.style,title:i.ls(10435)})),a.rowDatas("events",d).map(function(e,t){return r.createElement(o.RCatchError,{key:t},r.createElement(P.EventIcon,{dbi:a,eventid:e.id,where:"subst"}))}))}function oe(e){var n=this,i=e.online,a=e.table,o=a,l=i.dbi,u=l.req,d=parseInt(l.dbid),m=i.getDateRow(),p=[];function b(e){return s.__awaiter(n,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return[4,ASC.blockUI(i.dbi.backend.updateRow(a,e,{log_module:O}))];case 1:return t.sent(),[2]}})})}switch(p.push({key:"icon",label:"",width:16,singleIcon:l.table(o).icon()}),a){case"officialtimetables":p.push({key:"name",width:200}),p.push({key:"daterange",label:u.ls(1581),width:140,formatter:re}),p.push({key:"tools",label:"",width:80,formatter:function(e){return r.createElement("a",{style:{display:"inline-block"},onClick:function(r){var i=e.row.id,a=[];a.push({text:u.ls(6391)+": "+u.ttls(1501),onClick:function(){return s.__awaiter(n,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(Promise.resolve().then(function(){return t("./online/copyduties")}))];case 1:return e.sent().showCopySubstDuties({year:d,target_tt_num:i}),[2]}})})}}),k.showMenu(a,r.currentTarget),r.preventDefault()}},u.ls(1768))}});break;case"teachers":p.push({key:"firstname",width:110}),p.push({key:"lastname",width:110}),p.push({key:"short",width:80}),p.push({key:"subst_hidden",label:u.ls(1003),width:50,align:"center",formatter:function(e){var t=!!e.row.subst_hidden;return r.createElement("img",{src:t?"/substitution/pics/subst_hidden.png":"/substitution/pics/subst_allowed.png",style:{cursor:"pointer"},onClick:function(){return b({id:e.row.id,subst_hidden:!t})}})}}),p.push({key:"subst_timeoff",label:u.ttls(1471),width:80,align:"center",formatter:function(e){var t,n=e.row,s=i.getDateRow().tt_num;if(!s)return null;var a=null===(t=n.subst_tt_timeoff)||void 0===t?void 0:t[s];return a&&c.timeoff_isEmpty(a," .")&&(a=null),r.createElement("span",{style:{cursor:"pointer",display:"inline-block"},onClick:function(){return N.showSubstTimeoffDlg({teacherid:n.id,date:i.getDate()})}},a?r.createElement(c.MiniTimeoff,{dbi:i.tt_dbi,timeoff:a,joiner:N.substVolnoJoiner}):r.createElement("img",{src:"/substitution/pics/sluzba.png",style:{margin:0}}))}}),p.push({key:"approbationids",width:150,formatter:function(e){var a=e.row,o=a.approbationids||[];return r.createElement("span",{style:{cursor:"pointer",paddingRight:5},onClick:function(){return s.__awaiter(n,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../rpr/vyber.js")})];case 1:return[4,e.sent().showDBIVyberDlg(i.dbi,"approbations",o)];case 2:return(o=e.sent())&&b({id:a.id,approbationids:o}),[2]}})})}},i.dbi.rowNames("approbations",o,"short")||"-")}});for(var f=0,_=["contract","de_contract_verfugung"];f<_.length;f++){var h=_[f];l.column("teachers",h)&&p.push({key:h,width:40,align:"center"})}break;case"subjects":p.push({key:"name",width:200}),p.push({key:"short",width:100}),p.push({key:"subst_join_forbidden",label:u.ttls(2107),width:50,align:"center",formatter:function(e){var t=e.row,n=!!t.subst_join_forbidden;return r.createElement("img",{src:n?"/substitution/pics/join_forbidden_16.png":"/substitution/pics/join_allowed_16.png",style:{cursor:"pointer",margin:0},onClick:function(){return b({id:t.id,subst_join_forbidden:!n})}})}});break;case"substitution_types":p.push({key:"name",width:200}),p.push({key:"short",width:100}),p.push({key:"default_for",width:200});break;case"approbations":p.push({key:"name",width:200}),p.push({key:"short",width:80}),p.push({key:"subjectids",width:200}),p.push({key:"teacherids",width:300});break;default:p.push({key:"name",width:200}),p.push({key:"short",width:100})}return r.createElement(S.RDatatable,{columns:p,data:l.tableData(o),selectedIdRef:le(i,"selectedOtherId"),dbi:l,dbi_table:a,onRowDoubleClick:function(e){return s.__awaiter(n,void 0,void 0,function(){var t;return s.__generator(this,function(n){switch(n.label){case 0:return G.includes(a)?(t=e.id,[4,j.showMainDbiItemDlg(d,a,t)]):[2];case 1:return n.sent(),[2]}})})},rowClassNames:function(e){return"officialtimetables"==a?{"row-green":m.tt_num==e.id}:{}},style:{width:"100%",height:"100%"}})}function le(e,t){return o.makeSimpleValueRef(function(){return e.state[t]},function(n){var s;e.state[t]!==n&&e.setState(((s={})[t]=n,s))})}function ce(e){return "/static/pics/"+e+".png"}function ue(e){var t=l.client_req,n=e.valueRef,s=n.value,i=t.getSchoolYear(s),a=o.useAsyncMemo(function(){return y.getSubstDateFieldData(null,i)},[i],{absent_dates:[],online_dates:[]}),c=a.absent_dates,u=a.online_dates,d=r.useMemo(function(){for(var e={},t=0,n=c;t<n.length;t++)e[n[t]]="#fff97d";for(var s=0,r=u;s<r.length;s++)e[r[s]]="#ff648b";return e},[c,u]);return r.createElement(x.default,{valueRef:n,date2color:d,style:e.style,blank:!1})}ie.npp=a.substOnlineNeededPartProvider(function(){return[a.findTTItemFromSubstId,R.eventIcon,R.eventName,ae,a.isSubstAdd,{substonline_dates:["uploaded_int"],substonline_substitutions:["cancelled","changes","note","inote"],substonline_ttitems:["changes"],teachers:["__name","classroomid"],classes:["__name","classroomid"],igroups:["__name","classroomid"],classrooms:["__name","buildingid"],subjects:["__name"],periods:["__name"],dayparts:["__name"]}]}),ae.npp=d.neededPartProvider(function(){return[P.EventIcon,{substonline_ttitems:["eventids","changeeventids","ol_is"]}]}),oe.needed_part=d.typed({officialtimetables:["name","datefrom","dateto"],teachers:["firstname","lastname","short","subst_hidden","subst_tt_timeoff","approbationids","contract","de_contract_verfugung"],subjects:["name","short","subst_join_forbidden"],absent_types:["name","short"],substitution_types:["name","short","default_for"],approbations:["name","short","subjectids","teacherids"]}),e._hotswap=[W,K,Y,ue]},"/substitution/subst.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../rpr/dbi");function i(e){return"types"==e.substring(e.length-5)?e.substring(0,e.length-1):"es"==e.substring(e.length-2)?e.substring(0,e.length-2):e.substring(0,e.length-1)}function a(e,t){void 0===t&&(t=!1);var n=u(e),i=e[n];if(t){i=s.__assign({},i);for(var a=function(e){var t=e.column,n=i[t];Array.isArray(n)?(n=n.filter(function(t){return t!=e.old}),e.new&&n.push(e.new)):n=e.new||"",i[t]=n},o=0,l=e.changes||[];o<l.length;o++)a(l[o])}var c=r.DBITools.getUniPeriod(i);return{type:n,uniperiod:c,endtime:"starttime"==r.DBITools.typeOfUniPeriod(c)&&i.endtime||"",subjectid:i.subjectid||"",classids:i.classids||[],teacherids:i.teacherids||(i.teacherid?[i.teacherid]:[]),classroomids:i.classroomids||(i.classroomid?[i.classroomid]:[]),igroupid:i.igroupid||"",groupnames:i.groupnames||[]}}function o(e,t){switch(t){case"classes":return e.classids||[];case"teachers":return e.teacherids||[];case"classrooms":return e.classroomids||[];case"subjects":return e.subjectid?[e.subjectid]:[];case"igroups":return e.igroupid?[e.igroupid]:[]}return[]}function l(e,t){if(t.period){var n=parseInt(t.period),s=n+(t.durationperiods||1)-1;switch(r.DBITools.typeOfUniPeriod(e.uniperiod)){case"period":var i=parseInt(e.uniperiod);if(i+(e.durationperiods||1)-1<n)return!1;if(s<i)return!1;break;case"break":var a=parseInt(e.uniperiod.substr(1)),o=t.exclude_breaks||"",l=o.includes("b")?1:0,c=o.includes("i"),u=o.includes("a")?1:0;if(a<n+l)return!1;if(1+s-u<a)return!1;if(n<a&&a<=s&&c)return!1;break;default:return!1}}return!0}function c(e,t,n){for(var s=null,i=function(i){if(!t.classids.includes(i))return"continue";var a=!1;if(r.groupnamesIsOverlap(r.DBITools.groupnames2ssg(e.groupnames,e.subjectid),r.DBITools.groupnames2ssg(t.groupnames,t.subjectid))&&(a=!0),!a&&n){var o=n.tableData("groups"),l=o.find(function(t){return t.classid==i&&e.groupnames.includes(t.name)}),c=o.find(function(e){return e.classid==i&&t.groupnames.includes(e.name)});l&&c&&l.ascttdivision!=c.ascttdivision&&(a=!0)}a&&(s?s.includes(i)||s.push(i):s=[i])},a=0,o=e.classids;a<o.length;a++)i(o[a]);return s}function u(e){return ASC.boolVal(e.card)?"card":ASC.boolVal(e.tcard)?"tcard":ASC.boolVal(e.classroomsupervision)?"classroomsupervision":void ASC.dieError("7424907584")}function d(e){if(!e)return"";var t=e.table;return"groups"==t&&(t="classes"),t}function m(e){switch(d(e)){case"classes":return e.classid;case"teachers":return e.teacherid;case"classrooms":return e.classroomid}return""}function p(e){if(!e)return-1;var t=60*parseInt(e.substr(0,2))+parseInt(e.substr(3,2));return 8<=e.length&&(t+=parseInt(e.substr(6,2))/60),t}function b(e){if(e<0)return"";var t=e%60,n=(e-t)/60;return(n<10?"0":"")+n+":"+(t<10?"0":"")+t}function f(e,t){if(0==e.length)return t;for(var n=e,r=0,i=t;r<i.length;r++){for(var a=i[r],o=!1,l=0,c=n;l<c.length;l++){var u=c[l];if(u.column===a.column&&u.old===a.old&&u.new===a.new){o=!0;break}}o||(n==e&&(n=s.__spreadArrays(n)),n.push(a))}return n}function _(e,t,n,s){var i="subst_ttitems"==t?"subst_substitutions":"substonline_substitutions";if("classroomsupervision"==n.type)return!1;if(n.subjectid!=s.subjectid)return!1;if(!r.idsArrayMatch(n.classids,s.classids))return!1;if(!r.idsArrayMatch(n.groupnames,s.groupnames))return!1;if(n.igroupid!=s.igroupid)return!1;if(!r.idsArrayMatch(n.teacherids,s.teacherids))return!1;if(!r.idsArrayMatch(n.classroomids,s.classroomids))return!1;if(n.type!=s.type)return!1;if(n.cancelled!=s.cancelled)return!1;if(n.added!=s.added)return!1;if("period"!=r.DBITools.typeOfUniPeriod(n.uniperiod))return!1;if(s.uniperiod!=""+(parseInt(n.uniperiod)+1))return!1;var a=n.orig,o=s.orig;if(a){if(!o)return!1;if(a.subjectid!=o.subjectid)return!1;if(!r.idsArrayMatch(a.teacherids,o.teacherids))return!1;if(a.igroupid!=o.igroupid)return!1;if(!r.idsArrayMatch(a.classids,o.classids))return!1;if(!r.idsArrayMatch(a.groupnames,o.groupnames))return!1;if(!r.idsArrayMatch(a.classroomids,o.classroomids))return!1;if(o.uniperiod!=""+(parseInt(a.uniperiod)+1))return!1}else if(o)return!1;if(n.origsubstid){if(!s.origsubstid)return!1;if(n.origsubstid.split(":")[0]!=s.origsubstid.split(":")[0])return!1}if(n.origofids.length!=s.origofids.length)return!1;var l=n.origofids.length;if(1<l)return!1;if(1==l&&n.origofids[0].split(":")[0]!=s.origofids[0].split(":")[0])return!1;if(n.substids.length!=s.substids.length)return!1;for(var c=0;c<n.substids.length;c++){var u=e.rowData(i,n.substids[c]),d=e.rowData(i,s.substids[c]);if(u.note!=d.note)return!1;if(u.inote!=d.inote)return!1;if(u.substitution_typeid!=d.substitution_typeid)return!1}return n.wds.length==s.wds.length&&n.ol_is==s.ol_is&&n.eventid==s.eventid&&!!r.idsArrayMatch(n.eventids,s.eventids)&&!!r.idsArrayMatch(n.changeeventids,s.changeeventids)}e.ICON_subst_ok="/static/pics/item_ok_16.svg",e.ICON_subst_kolizia="/static/pics/item_bad_16.svg",e.ICON_subst_spojenie="/substitution/pics/plus_32.svg",e.ICON_subst_kolizia_ignored="/substitution/pics/no_ignored_32.svg",e.ICON_subst_changelesson="/static/pics/modified_32.svg",e.ICON_subst_addlesson="/substitution/pics/subst_add_32.svg",e.ICON_subst_movelesson="/substitution/pics/subst_move_32.svg",e.ICON_subst_moved="/substitution/pics/subst_moved_32.svg",e.ICON_subst_cancelled="/substitution/pics/subst_remove_32.svg",e.ICON_subst_todo="/static/pics/help_16.svg",e.subst_period=function(e){return e?""!=(t=ASC.strVal(e.period))?t:""!=(t=ASC.strVal(e.break))?"b"+t:""!=(t=ASC.strVal(e.daypart))?t:5==(t=ASC.strVal(e.starttime)).length?t.substr(0,2)+"-"+t.substr(3):"":"";var t},e.subst_item=function(e){return e.card||e.classroomsupervision||e.tcard},e.subst_item_tableIds=function(e,t,n){return void 0===n&&(n=!1),o(a(e,n),t)},e.removeEs=i,e.blankSubstTTItem_Core=function(){return{type:"",uniperiod:"",endtime:"",subjectid:"",classids:[],teacherids:[],classroomids:[],igroupid:"",groupnames:[]}},(e.coreTTItemOfSubst=a).needed_part=r.typed({subst_substitutions:["card","tcard","classroomsupervision","changes"]}),e.substTTItem_tableIds=o,e.substTTItem_filter_match=function(e,t,n){switch(t){case"teachers":return e.teacherids.includes(n);case"classes":return e.classids.includes(n);case"classrooms":return e.classroomids.includes(n);case"igroups":return e.igroupid==n}return!1},e.substTTItem_absent_match_time=l,(e.substTTItem_absent_match=function(e,t){switch(t.table){case"teachers":if(!e.teacherids.includes(t.teacherid))return!1;break;case"classrooms":if(!e.classroomids.includes(t.classroomid))return!1;break;case"classes":if(!e.classids.includes(t.classid))return!1;break;case"groups":if(!e.classids.includes(t.classid))return!1;if(e.groupnames.includes(t.groupname));else if(!e.groupnames.includes("")||!t.split_entireclass)return!1}return!!l(e,t)}).needed_part=r.typed({subst_absents:["table","teacherid","classroomid","classid","groupname","period","durationperiods","exclude_breaks"]}),e.susbtTTItemPopis=function(e,t,n){var s=t.req;if("classroomsupervision"==e.type)return s.ls(1723)+" "+t.rowNames("classrooms",e.classroomids,n)+" "+t.rowNames("teachers",e.teacherids,n);var i=t.rowName("subjects",e.subjectid,n);i+=" ",i+=t.rowNames("classes",e.classids,n);var a=e.groupnames;return a&&a.length&&!r.DBITools.groupnamesIsEntireClass(a)&&(i+=" ("+t.tools.groupnames_names(a)+")"),i+=" ",i+=t.rowNames("teachers",e.teacherids,n),(i+=" ")+t.rowNames("classrooms",e.classroomids,n)},e.substTTItemMovable=function(e){return"classroomsupervision"!=e.type&&"period"==r.DBITools.typeOfUniPeriod(e.uniperiod)},(e.isSubstAdd=function(e){return!(!e.addcard&&!e.addtcard)}).needed_part=r.typed({substonline_substitutions:["addcard","addtcard"]}),e.idsArrayMatch=r.idsArrayMatch,e.idsArrayMatchI=r.idsArrayMatchI,e.idsArrayDiff=r.idsArrayDiff,e.idsArrayIntersect=r.idsArrayIntersect,e.idsIsOverlap=r.idsIsOverlap,e.idsIsSubArray=r.idsIsSubArray,e.groupnamesIsOverlap=r.groupnamesIsOverlap,(e.ttitem_isClassColision=c).needed_part=r.typed({substonline_ttitems:["classids","groupnames"]}),c.ttdbi={needed_part:r.typed({groups:["classid","name","ascttdivision"]})},e.subst_item_type=u,e.subst_isTargetAbsent=function(e){if(!e.absent)return!1;var t=d(e.absent);return e.classroomsupervision?"classrooms"==t:"classes"==t||"igroups"==t},e.absentGetTable=d,e.absentGetId=m,(e.findAbsent=function(e,t,n,s){void 0===s&&(s={});for(var i=0,a=e;i<a.length;i++){var o=a[i];if(d(o)==t&&m(o)==n){if("groups"==o.table&&s.groupnames)if(s.groupnames.includes(o.groupname));else if(!r.DBITools.groupnamesIsEntireClass(s.groupnames)||!o.split_entireclass)continue;if(o.period){var l=parseInt(o.period),c=l+(o.durationperiods||1)-1;if(s.period){if(parseInt(s.period)<l)continue;if(parseInt(s.period)>c)continue}if(s.break){if(parseInt(s.break)<l)continue;if(parseInt(s.break)>1+c)continue}if(s.daypart)continue;if(s.starttime)continue}return o}}return null}).needed_part=r.typed({subst_absents:["table","teacherid","classid","classroomid","groupname","period","durationperiods"]}),(e.findTTItemFromSubstId=function(e,t,n){void 0===n&&(n=!1);for(var s=0,r=e;s<r.length;s++){var i=r[s];if((!i.cancelled||n)&&i.substids.includes(t))return i}return null}).needed_part=r.typed({subst_ttitems:["cancelled","substids"]}),e.findCollisions=function(e,t,n,s,r){void 0===r&&(r={});for(var i=[],a=0,c=["teachers","classrooms","classes","igroups"];a<c.length;a++)for(var u=c[a],p=0,b=o(t,u);p<b.length;p++){for(var f=b[p],_=0,h=n;_<h.length;_++){var g=h[_];g.date==e&&o(g,u).includes(f)&&(r.ignore_substid&&g.substids.includes(r.ignore_substid)||g.uniperiod==t.uniperiod&&i.push({table:u,id:f,ttitem:g}))}for(var v=0,y=s;v<y.length;v++){var E=y[v];d(E)==u&&m(E)==f&&l(t,E)&&i.push({table:u,id:f,absent:E})}}return i},e.getDefault_substitution_typeid=function(e,t){void 0===t&&(t="normal");for(var n=0,s=e.tableData("substitution_types");n<s.length;n++){var r=s[n];if(r.default_for==t)return r.id}return""},e.changeColumn2table=function(e){switch(e){case"period":return"periods";case"subjectid":return"subjects";case"teacherids":case"teacherid":return"teachers";case"classids":return"classes";case"classroomids":case"classroomid":return"classrooms";case"igroupid":return"igroups"}return""},e.coreOfTTItem=function(e){return{type:e.type,uniperiod:e.uniperiod,endtime:"starttime"==r.DBITools.typeOfUniPeriod(e.uniperiod)?e.endtime:"",subjectid:e.subjectid,classids:e.classids,teacherids:e.teacherids,classroomids:e.classroomids,igroupid:e.igroupid,groupnames:e.groupnames}},e.time2int=p,e.int2time=b,e.dp_fixTime=function(e,t,n,s){for(var i=new Map,a=function(e){var t=i.get(e);return t||(t={starttime:"",endtime:"",cbs:[]},i.set(e,t)),t},o=null!=e.tt_day?""+e.tt_day:"",l=0,c=n.tableData("periods");l<c.length;l++){var u=(g=c[l]).id;(I=a(u)).starttime=g.starttime,I.endtime=g.endtime}for(var d=0,m=n.tableData("dayparts");d<m.length;d++){var f=m[d];u=f.id,(I=a(u)).starttime=f.starttime,I.endtime=f.endtime}if(s){for(var _=0,h=s.tableData("periods");_<h.length;_++){var g;u=(g=h[_]).id,(I=a(u)).starttime=g.starttime,I.endtime=g.endtime}for(var v=0,y=s.tableData("breaks");v<y.length;v++){var E=y[v];u="b"+E.id,(I=a(u)).starttime=E.starttime,I.endtime=E.endtime}for(var w=0,S=s.tableData("custombells");w<S.length;w++){var x=S[w];u=x.period,x.break&&(u="b"+x.break),(I=i.get(u))&&I.cbs.push(x)}}function T(e,t){if(u=i.get(e)){if(0<u.cbs.length)for(var n=0<=t.classids.length?t.classids[0]:"",s=0,l=u.cbs;s<l.length;s++){var c=l[s];if(!c.day||c.day==o){if(0<c.classids.length){if(!n)continue;if(!c.classids.includes(n))continue}return r.unpartial(c)}}return u}var u=a(e);if("b"==e[0]){var d=i.get(""+(parseInt(e.substr(1))-1)),m=i.get(e.substr(1));m&&(u.endtime=m.starttime,u.starttime=d?d.endtime:b(p(u.endtime)-5))}return u}for(var C=0,k=t;C<k.length;C++){var D=k[C];if(!D.starttime||!D.endtime)if(u=D.uniperiod||r.DBITools.getUniPeriod(D),"starttime"!=r.DBITools.typeOfUniPeriod(u)){var I=T(u,D);D.starttime=I.starttime,D.durationperiods&&1<D.durationperiods&&(I=T(""+(parseInt(u)+D.durationperiods),D)),D.endtime=I.endtime}else D.starttime=u.replace("-",":")}},(e.substIsAddCard=function(e){return e.addcard||e.addtcard}).needed_part=r.typed({subst_substitutions:["addcard","addtcard"]}),e.substIsIgnored=function(e){return!(!e.absent||"classes"!=d(e.absent))},e.substIsMovedDate=function(e){for(var t=s.__spreadArrays([e.origid],e.origofids||[]),n=e.id.split(":")[0],r=0,i=t;r<i.length;r++){var a=i[r];if(a&&a.split(":")[0]!=n)return!0}return!1},e.mergeSubstChanges=f,e.substChangesEquals=function(e,t){return e.length==t.length&&f(e,t).length==e.length},e.substBasicChanges=function(e){var t=[],n=e.absent;return n&&t.push({column:i(d(n))+"ids",old:m(n)}),t},_.needed_part=r.typed({subst_ttitems:["date","uniperiod","orig","subjectid","teacherids","classids","groupnames","igroupid","substids","classroomids","origsubstid","origofids","ol_is","wds","eventid","eventids","changeeventids"],subst_substitutions:["note","inote","substitution_typeid"]});var h=[null,"",[]];(e.buildSubstOnlineTTItemsEx=function(e,t,n,r){void 0===r&&(r={});try{var i=r.table||"substonline_ttitems",a="substonline_ttitems"==i?"substonline_substitutions":"subst_substitutions",o=[t,!!n,i].join(),l=h;if(l[0]==e&&l[1]==o)return l[2];for(var c=[],u=e.tableFilterData(i,{date:t}),d=new Map,m=0,p=e.tableIds("periods");m<p.length;m++){var b=p[m];d.set(parseInt(b),[])}for(var f=function(t){if(t.length<=1)return t;function n(t){var n=e.rowData(a,t);return JSON.stringify(n.changes)}return(t=s.__spreadArrays(t)).sort(function(e,t){return n(e)<n(t)?-1:1}),t},g=0,v=u;g<v.length;g++){var y=v[g],E=s.__assign(s.__assign({},y),{substids:f(y.substids)});c.push(E),b=parseInt(E.uniperiod),d.has(b)&&d.get(b).push(E)}d.forEach(function(t,n){var s=d.get(n+1);if(s)for(var r=0,a=t;r<a.length;r++)for(var o=a[r],l=0,c=s;l<c.length;l++){var u=c[l];if(_(e,i,o,u)){o.join_nextid=u.id,u.join_previd=o.id,u.join_substid2prev=new Map;for(var m=0;m<u.substids.length;m++)u.join_substid2prev.set(u.substids[m],o.substids[m]);break}}});var w=new Map;return d.forEach(function(e){for(var t=0,s=e;t<s.length;t++){var r=s[t];if(n||r.eventid)if(r.join_previd){var i=w.get(r.join_previd);i.durationperiods++,i.join_ttitemids.push(r.id),w.set(r.id,i);for(var a=0;a<r.substids.length;a++)i.join_substid2first.set(r.substids[a],i.substids[a])}else r.join_nextid&&(r.durationperiods=1,r.join_ttitemids=[],r.join_substid2first=new Map,w.set(r.id,r))}}),c=c.filter(function(e){return!(e.join_previd&&w.get(e.id))}),h=[e,o,c],c}catch(t){if(e.mock)return[];throw t}}).npp=r.neededPartProvider(function(){return[_,{subst_ttitems:["date","substids"]}]}),e.substOnlineNeededPartProvider=function(e){return function(){var t,n=r.neededPartProvider(e)(),s=[],i={subst_dates:"substonline_dates",subst_absents:"substonline_absents",subst_substitutions:"substonline_substitutions",subst_ttitems:"substonline_ttitems",subst_students:"substonline_students"};for(var a in n)s.push(((t={})[i[a]||a]=n[a],t));return r.DBITools.mergeNeededParts.apply(r.DBITools,s)}}},"/timetable/timeoff_r.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("../rpr/dbi"),a=t("../asc/asc_react"),o=r.Fragment,l=t("../asc/edurequest"),c=t("../react/combobox"),u=[[["."]]];function d(e,t){return"0"==e||"0"==t?"0":"?"==e||"?"==t?"?":e}function m(e,t,n,s,r,i){void 0===i&&(i=d);var a=e;if(t<0){var o=m(e,0,n,s,r,i);for(t=1;t<a.length;t++)o=i(o,m(e,t,n,s,r,i));return o}var l=a[t<a.length?t:a.length-1];if(n<0){for(o=m(e,t,0,s,r,i),n=1;n<l.length;n++)o=i(o,m(e,t,n,s,r,i));return o}var c=l[n<l.length?n:l.length-1];if(s<0){for(o=m(e,t,n,0,r,i),s=1;s<c.length;s++)o=i(o,m(e,t,n,s,r,i));return o}var u=c[s<c.length?s:c.length-1];if(r<0){for(o=m(e,t,n,s,0,i),r=1;r<u.length;r++)o=i(o,m(e,t,n,s,r,i));return o}return u.charAt(r<u.length?r:u.length-1)}function p(e,t,n,s,r,i,a){return g(e=b(e=h(e,t),n,s,r,i,a))}function b(e,t,n,s,r,i){if(a=e.length,t<0){if(1<a){for(t=0;t<a;t++)e=b(e,t,n,s,r,i);return e}t=0}if(a=e[t].length,n<0){if(1<(a=e[t].length)){for(n=0;n<a;n++)e=b(e,t,n,s,r,i);return e}n=0}if(a=e[t][n].length,s<0){if(1<(a=e[t][n].length)){for(s=0;s<a;s++)e=b(e,t,n,s,r,i);return e}s=0}if(r<0){var a=e[t][n][s].length;for(r=0;r<a;r++)e=b(e,t,n,s,r,i);return e}var o=(e=ASC.clone(e))[t][n][s],l=o.substr(0,r)+i+o.substring(r+1);return e[t][n][s]=l,e}function f(e,t){for(;e.length<t;)e.push(ASC.clone(e[e.length-1]))}function _(e){for(var t=e.tools.tableIntIdRange("periods"),n={nTerms:e.tableIds("terms").length||1,nWeeks:e.tableIds("weeks").length||1,nDays:e.tableIds("days").length||1,nPeriods:t[1]+1,hodinyOd:t[0],hodinyDo:t[1]},s=0,r=["terms","weeks","days"];s<r.length;s++){var i=r[s],a=e.tableIds(i),o=1;if(0<a.length)o=a.length;else{var l=e.tableData(i+"defs")[0],c=void 0;l&&(c=l.vals||l[i])&&(o=c[0].length)}n["n"+i[0].toUpperCase()+i.substr(1)]=o}return n}function h(e,t){e=ASC.clone(e);var n=_(t);f(e,n.nTerms);for(var s=0;s<e.length;s++){f(e[s],n.nWeeks);for(var r=0;r<e[s].length;r++){f(e[s][r],n.nDays);for(var i=0;i<e[s][r].length;i++){var a=".";for(0<e[s][r][i].length&&(a=e[s][r][i].substr(e[s][r][i].length-1));e[s][r][i].length<n.nPeriods;)e[s][r][i]+=a}}}return ASC.clone(e)}function g(e){return function e(t){for(var n=0;n<t.length;n++)Array.isArray(t[n])&&e(t[n]);for(;1<t.length&&JSON.stringify(t[t.length-1])==JSON.stringify(t[t.length-2]);)t.splice(t.length-1)}(e=ASC.clone(e)),e}function v(e){for(var t,n=Math.min(24,null!==(t=e.rowHeight)&&void 0!==t?t:24),s=0,i=e.icons;s<i.length;s++){var a=i[s];if(a.d==e.value)return a.img?r.createElement("img",{style:{width:n,height:n,verticalAlign:"middle"},src:a.img}):null}return null}function y(e){return r.createElement("td",{style:{border:"1px solid #e0e0e0",textAlign:"center",verticalAlign:"middle",backgroundColor:e.obsadene?"#8a8a9e":"",position:"relative",cursor:"pointer"},onMouseDown:function(t){t.preventDefault(),e.onToggle(2==t.button)},onContextMenu:function(e){return e.preventDefault()}},r.createElement(v,{value:e.value,icons:e.icons,rowHeight:e.rowHeight}),e.overlay)}function E(e){function t(t,n,s){void 0===s&&(s=!1);for(var r=m(_,Math.max(l,0),Math.max(c,0),Math.max(t,0),Math.max(n,0)),a=e.icons,o=0,u=0;u<a.length;u++)a[u].d==r&&(o=u);var d=s?o-1:o+1;d>=a.length&&(d=0),d<0&&(d=a.length-1),e.timeoffRef.set(p(_,i,l,c,t,n,a[d].d))}var n,i=e.tt_dbi,a=i.tableData("periods"),o=i.tableData("days"),l=e.term,c=e.week,u=e.overlay,d=100/(a.length+1)+"%",b=null!==(n=e.rowHeight)&&void 0!==n?n:35,f={width:d,textAlign:"center",verticalAlign:"middle",height:b,fontWeight:"normal",cursor:"pointer"},_=e.timeoffRef.value;return r.createElement("table",{style:{width:"100%",backgroundColor:"#ffffff",borderCollapse:"collapse"}},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null),a.map(function(e){return r.createElement("th",{key:e.id,style:s.__assign(s.__assign({},f),{fontSize:"15px"}),onMouseDown:function(n){n.preventDefault(),t(-1,parseInt(e.id),2==n.button)},onContextMenu:function(e){return e.preventDefault()},title:e.name},e.short)}))),r.createElement("tbody",{style:{fontSize:Math.min(20,b)}},o.map(function(n,i){return r.createElement("tr",{key:n.id},r.createElement("th",{style:s.__assign(s.__assign({},f),{whiteSpace:"pre"}),onMouseDown:function(e){e.preventDefault(),t(parseInt(n.id),-1,2==e.button)},onContextMenu:function(e){return e.preventDefault()},title:n.name},n.short),a.map(function(s,i){var a=parseInt(n.id),o=parseInt(s.id);return r.createElement(y,{key:s.id,value:m(_,Math.max(l,0),Math.max(c,0),a,o),icons:e.icons,rowHeight:b,onToggle:function(e){return t(a,o,e)},obsadene:e.obsadene&&"1"==m(e.obsadene,Math.max(l,0),Math.max(c,0),a,o),overlay:u?u({term:l,week:c,day:a,period:o}):void 0})}))})))}function w(e){var t=l.client_req;return r.createElement("div",{style:{marginTop:20}},r.createElement("span",{style:{marginRight:10}},t.ttls(1119)),e.icons.filter(function(e){return!!e.name}).map(function(e){return r.createElement(o,{key:e.d},r.createElement("img",{src:e.img,style:{marginRight:10,verticalAlign:"middle",width:24,height:24}}),r.createElement("span",{style:{marginRight:30}},t.localize(e.name)))}),r.createElement("div",{style:{marginTop:6}},t.ttls(1123)),r.createElement("div",{style:{marginTop:6}},t.ttls(3548)))}function S(e){var t=e.tt_dbi,n=e.table,s=e.valueRef,i=e.timeoffRef;if(t.tableData(e.table).length<=1)return null;var o=s.value,l=i.value,u=r.useMemo(function(){var e=!0,t=g(i.value);if("terms"==n)1<t.length&&(e=!1);else for(var s=0;s<t.length;s++)1<t[s].length&&(e=!1);return e},[l]);return r.useLayoutEffect(function(){o<0&&!u&&s.set(0)},[u,o]),r.createElement("div",{style:{display:"inline-block",width:180,marginLeft:15,verticalAlign:"top"}},r.createElement("label",null,r.createElement("input",{type:"checkbox",disabled:!u,checked:o<0,onChange:function(){o<0?s.set(0):u&&s.set(-1)}}),e.text_rovnako),r.createElement("br",null),r.createElement(a.AnimatedCollapseDiv,{collapsed:o<0},r.createElement(c.default,{valueRef:s.cast(function(e){return""+e},function(e){return parseInt(e)}),items:t.tableIds(n).map(function(n){return{value:n,name:t.rowName(e.table,n)}}),style:{width:"100%"}})))}function x(e){var t=0,n=e.tt_dbi.tableData("terms").length-1,s=e.termRef.value;s<0&&(t=n=s);var i=0,o=e.tt_dbi.tableData("weeks").length-1,l=e.weekRef.value;return l<0&&(i=o=l),r.createElement("div",null,a.rangeFromTo(t,n).map(function(t){return a.rangeFromTo(i,o).map(function(n){return r.createElement("span",{key:t+":"+n,style:{display:"inline-block",borderWidth:1,borderStyle:"solid",borderColor:t==s&&n==l?"black":"transparent",padding:2,marginRight:5,cursor:"pointer"},onClick:function(){e.termRef.set(t),e.weekRef.set(n)}},r.createElement(I,{dbi:e.tt_dbi,timeoff:e.timeoff,t:t,w:n}))})}))}e.defaultVolnoJoiner=d,e.timeoff_isEmpty=function(e,t){for(var n=0,s=e;n<s.length;n++)for(var r=0,i=s[n];r<i.length;r++)for(var a=0,o=i[r];a<o.length;a++)for(var l=o[a],c=0;c<l.length;c++)if(!t.includes(l[c]))return!1;return!0},e.timeoff_get=m,e.timeoff_getByBits=function(e,t,n,s,r,i,a){void 0===a&&(a=d),"string"==typeof r&&(r=parseInt(r)),1<=i||ASC.dieError("7623249487");var o="";function l(e,t){return e.length<=t?e:e.substr(0,t-1)+(0<=e.indexOf("1",t-1)?"1":"0")}for(var c=l(t,e.length),u=0;u<c.length;u++)if("1"==c[u])for(var m=e[u],p=l(n,m.length),b=0;b<p.length;b++)if("1"==p[b])for(var f=m[b],_=l(s,f.length),h=0;h<s.length;h++)if("1"==_[h]){var g=f[h];r>=g.length?o+=g[g.length-1]:o+=g.substr(r,i)}if(!(1<o.length))return o;for(var v=o[0],y=1;y<o.length;y++)return a(v,o[y])},e.timeoff_set=p,e.timeoff_setUncompressed=b,e.timeoffStructure_needed_part={periods:[],days:[],weeks:[],terms:[]},e.timeoff_uncompress=h,e.timeoff_compress=g,e.timeoff2str=function(e){e=g(e);for(var t="",n=0;n<e.length;n++){0<n&&(t+="|");for(var s=0;s<e[n].length;s++){0<s&&(t+=";");for(var r=0;r<e[n][s].length;r++)0<r&&(t+=","),t+=e[n][s][r]}}return t},e.TOC_Grid=E,(e.TimeoffInput=function(e){var t=e.tt_dbi,n=e.icons,i=e.table,o=e.id,c=l.client_req,u=e.valueRef.cast(function(e){return h(e,t)},function(e){return g(e)}),d=a.useStateValueRef(-1),m=a.useStateValueRef(-1),b=[d.value,m.value],f=b[0],_=b[1],v=h([[["0"]]],t);if(i&&o&&!t.mock)for(var y=0,T=t.tableData("cards");y<T.length;y++){var C=T[y];if(C.period){var k=t.rowData("lessons",C.lessonid);if(("subjects"!=i||k.subjectid==o)&&("teachers"!=i||k.teacherids.includes(o))&&("classes"!=i||k.classids.includes(o))&&("classrooms"!=i||C.classroomids.includes(o)))for(var D=parseInt(C.period),I=D+((k.durationperiods||1)-1),R=0;R<C.days.length;R++)if("1"==C.days[R])for(var A=0;A<C.weeks.length;A++)if("1"==C.weeks[A]&&!(0<=_&&A!=_))for(var N=0;N<k.terms.length;N++)if("1"==k.terms[N]&&!(0<=f&&N!=f))for(var B=D;B<=I;B++)v=p(v,t,N,A,R,B,"1")}}return r.createElement("div",null,r.createElement(E,{timeoffRef:u,tt_dbi:t,icons:n,term:f,week:_,obsadene:v,overlay:e.overlay}),r.createElement(a.AnimatedCollapseDiv,{collapsed:!(0<=f||0<=_)},r.createElement("div",{style:{marginTop:3,textAlign:"right"}},r.createElement(x,s.__assign({},{timeoff:u.value,tt_dbi:t,termRef:d,weekRef:m})))),r.createElement(w,{icons:n}),r.createElement("div",{style:{display:"inline-block",width:150}}),r.createElement(S,{valueRef:d,timeoffRef:u,table:"terms",tt_dbi:t,text_rovnako:c.ttls(3675)}),r.createElement(S,{valueRef:m,timeoffRef:u,table:"weeks",tt_dbi:t,text_rovnako:c.ttls(3674)}))}).tt_dbi={needed_part:i.typed({terms:["__name"],weeks:["__name"],days:["__name"],periods:["__name"],cards:["lessonid","period","days","weeks","classroomids"],lessons:["subjectid","teacherids","classids","terms","durationperiods"]})};var T=8,C=3;function k(e){var t="#ffffff";switch(m(e.timeoff,e.t,e.w,e.d,e.h,e.joiner)){case"1":t="#00ff00";break;case"?":t="#0000ff";break;case"0":t="pos"==e.type?"#ffffff":"#ff0000";break;case"O":t="#8080ff";break;case"D":t="#0000ff"}return r.createElement("div",{style:{backgroundColor:t}})}function D(e){var t=e.struct;return r.createElement("div",{className:"row"},a.rangeFromTo(t.hodinyOd,t.hodinyDo).map(function(n){return r.createElement(k,s.__assign({key:n},s.__assign(s.__assign({},e),{h:n,firstCell:n==t.hodinyOd})))}))}function I(e){var t=e.dbi,n=e.maxHeight,s=h(e.timeoff||u,t),i=_(t),o=T,l=C;n&&i.nDays*l+1>n&&(l=2);var c=i.hodinyDo-i.hodinyOd+1;return r.createElement(a.RScopedStyle,{style:e.style,rules:{"div.row":{display:"flex",flexFlow:"row",alignItems:"stretch",maxWidth:o*c-1,height:l,boxSizing:"border-box",borderBottom:"1px solid black"},"div.row:first-of-type":{height:l+1,borderTop:"1px solid black"},"div.row > div":{flexShrink:1,width:o-1,borderRight:"1px solid black"},"div.row > div:first-of-type":{borderLeft:"1px solid black"}}},a.rangeFromTo(0,i.nDays-1).map(function(t){var n,a;return r.createElement(D,{key:t,timeoff:s,struct:i,t:null!==(n=e.t)&&void 0!==n?n:-1,w:null!==(a=e.w)&&void 0!==a?a:-1,d:t,type:e.type,joiner:e.joiner||d})}))}(e.MiniTimeoff=I).ttdbi={needed_part:i.typed({terms:[],weeks:[],days:[],periods:[]})}},"/substitution/online/rightpanel.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=r.Fragment,a=t("../../asc/asc_react"),o=t("../subst"),l=t("../server/commands"),c=t("../../rpr/dbi"),u=t("../../asc/actions"),d=t("./timetable"),m=t("./combo"),p=t("../../asc/edurequest"),b=t("../server/settings"),f=t("../../timetable/ttitem"),_=t("../../asc/asc_react2"),h=t("../../rpr/dbi_react"),g=t("../../react/menu"),v=t("../../asc/lib_date"),y=t("../commands"),E=t("../../dashboard/dbi_events"),w=t("../../react/popuppanel"),S=t("../../calendar/event_popup"),x=t("./subst_popup"),T=[{id:"date",name:"{1465}"},{id:"week",name:"{tt:3855}"},{id:"month",name:"{tt:3854}"},{id:"year",name:"{1578}"}];function C(e){var t=e.tv,n=t.ttitem,i=t.naming_dbi,l=t.join_doubles,c=a.useReq(),u=a.useColors();if(!n)return null;var d=s.__assign(s.__assign({},n),n.orig||{}),m="",p=i.tools.ttitem_popis(d,"short");"."!=(m=p.period).substr(m.length-1)&&(m+="."),m+=" ",m+=p.subject,m+=" ",m+=i.rowNames("teachers",d.teacherids,1<d.teacherids.length?"short":""),m+=" ",m+=p.class,"classroomsupervision"==n.type&&(m=p.period,m+=" ",m+=p.classroom,m+=" ",m+=" "+i.rowNames("teachers",d.teacherids));var b="";if(n.changes)for(var f=0,_=n.changes;f<_.length;f++){var h=_[f];if(h.new){""!=b&&(b+=" ");var g="groupnames"==h.column?"groupnames":o.changeColumn2table(h.column);g||ASC.dieError("9589868469"),b+=i.tools.rowName(g,h.new,"teachers"==g?c.sort_name_col:"short")}}return""!=b&&(m+=" -> "+b),r.createElement("div",{style:{textAlign:"center",color:u.darkMode?u.fgBlack:"#00156e",paddingTop:4,fontSize:11,fontWeight:"bold",cursor:"default",flex:"0 0 auto",position:"relative"},title:"",onClick:function(){y.showTTItemEditDlg(n.id,l)}},m)}function k(e){var t=e.tv,n=t.ttitem,s=t.combo_items,i=t.table,a=t.sel_item;return n&&i?r.createElement(r.Fragment,null,s.map(function(e){return r.createElement(I,{key:e.id,tv:t,table:i,id:e.id,item:e,sel:!!a&&e.id==a.id})})):null}function D(e){var t=e.tv,n=t.dbi,i=t.ttitem,o=t.table,l=a.useColors();if(!i)return null;var u=s.__assign(s.__assign({},i),i.orig||{}),d=[i.uniperiod];if(1<i.durationperiods)for(var m=1;m<i.durationperiods;m++)d.push(c.DBITools.uniperiod_delta(i.uniperiod,m));var p=t.tlr;p.clear();for(var b=0,f=n.tableIds("periods");b<f.length;b++){var _=f[b];p.addItem("main",{uniperiod:_})}return n.rowData("periods",i.uniperiod)||p.addItem("main",{uniperiod:i.uniperiod,endtime:i.endtime}),p.render(),r.createElement(r.Fragment,null,r.createElement("div",{style:{height:p.qSize,position:"relative"}},t.kriteriaCols.map(function(e,n){return r.createElement(a.RTextBox,{x1:t.nameWidth+n*M,y1:0,x2:t.nameWidth+(n+1)*M,y2:p.qSize,key:""+n,text:"teachers"==o?e.name[0]:"",title:e.name,hAlign:"center",vAlign:"center"})}),p.renderOrderItems().map(function(e,i){var o=e.data.uniperiod,c=p.item2box(e,t.ttOffset);if(o){var u=["period"];return 0<=d.indexOf(o)&&u.push("sel"),r.createElement(a.RTextBox,s.__assign({},c,{key:o,style:{position:"absolute",textAlign:"center",color:l.fgBlack,fontSize:10,fontWeight:"bold",paddingTop:2,paddingBottom:2,backgroundColor:d.includes(o)?"#ffff00":void 0},className:u.join(" "),text:n.tools.uniperiodName(o,"short"),hAlign:"center",vAlign:"center"}))}return null})),0<u.classids.length&&r.createElement(r.Fragment,null,r.createElement("div",{className:"row",style:{height:0,borderBottom:"1px solid #c5bdc5"}}),u.classids.map(function(e,n){return r.createElement(I,{key:""+n,tv:t,table:"classes",id:e,isHeader:!0})})))}function I(e){var t=e.tv,n=e.isHeader,l=e.table,u=e.id,d=e.item,m=e.sel,p=t.ttitems,b=t.absents,_=t.online,h=t.dbi,v=t.date,y=t.ttitem,E=t.onRowDoubleClick,w=t.onRowPeriodClick,S=t.colorblind,x=a.useReq(),T=a.useColors(),C=t.stats_mode,k=t.stats_dbi,D=[y.uniperiod];if(1<y.durationperiods)for(var I=1;I<y.durationperiods;I++)D.push(c.DBITools.uniperiod_delta(y.uniperiod,I));var P=["row"],O=[];e.sel&&P.push("sel"),d&&(d.ft||d.frh?O.push("#0000ff"):d.fu&&O.push("#00ff00"),d.fp&&O.push("#f5ca70"));var z=!1,F=T.fgBlack;return d&&(z=d.cb_hidden||d.subst_hidden||d.filter_out,d.fd&&(F="#00ffff"),z&&(F=T.fgGrey),d.fx&&(F="#ff0000")),r.createElement("div",{className:P.join(" "),style:{height:t.rowHeight,position:"relative",borderBottom:"1px solid #c5bdc5",backgroundColor:m?"#33ae66":void 0,backgroundImage:m&&S?"url(/static/pics/w_h.png)":void 0},onClick:d?function(){return t.setSel_item(d)}:null,onDoubleClick:function(){!n&&E&&E(d.id)}},r.createElement("div",{title:h.rowName(l,u,x.sort_name_col),style:a.rtlCss({position:"absolute",left:0,top:0,bottom:0,paddingLeft:2,paddingRight:2,display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontSize:10,fontWeight:z?"normal":"bold",overflow:"hidden",whiteSpace:"nowrap",cursor:"default",width:t.nameWidth,boxSizing:"border-box",color:F,textDecoration:z?"line-through":void 0}),onContextMenu:function(e){if(e.preventDefault(),_){var t=s.__spreadArrays(_.timetableMenu(l,u));g.showMenu(t,e,{header:h.rowName(l,u,x.sort_name_col)})}}},h.rowName(e.table,e.id,"short"),r.createElement(B,{farby:O}),n&&r.createElement(j,{nameWidth:t.nameWidth,setNameWidth:t.setNameWidth})),t.kriteriaCols.map(function(e,n){return r.createElement("div",{key:e.id,style:a.rtlCss({position:"absolute",boxSizing:"border-box",top:0,bottom:0,left:t.nameWidth+n*M,width:M,borderLeft:"1px solid #c5bdc5",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",color:"#808080"})},"teachers"==l&&e.render({stats_dbi:k,date:v,teacherid:u,stats_mode:C}))}),function(){var e=t.tlr;e.clear();for(var m=new Set,_=0,g=p;_<g.length;_++){var v=g[_];if(f.ttitemFilterMatch(c.unpartial(v),l,u)||v.orig&&f.ttitemFilterMatch(c.unpartial(v.orig),l,u)){for(var E=v.uniperiod,S=v.durationperiods,x=0;x<(S||1);x++){var T=c.DBITools.uniperiod_delta(E,x);D.includes(T)&&m.add(T)}var C="classroomsupervision"==v.type,k={uniperiod:E,ttitem:v,endtime:v.endtime,durationperiods:v.durationperiods,type:C?"classroomsupervision":"",classids:v.orig?v.orig.classids:v.classids};e.addItem(C?"supervision":"main",k)}}if(y.uniperiod)if(0==m.size)k={uniperiod:y.uniperiod,endtime:y.endtime,durationperiods:y.durationperiods},e.addItem("b"==y.uniperiod[0]?"supervision":"main",k);else for(var I=0,B=D;I<B.length;I++)E=B[I],m.has(E)||(k={uniperiod:E,endtime:y.endtime},e.addItem("b"==y.uniperiod[0]?"supervision":"main",k));for(var j=0,P=b;j<P.length;j++){var M=P[j];o.absentGetTable(M)==l&&o.absentGetId(M)==u&&e.addItem("autobottom",{uniperiod:c.DBITools.getUniPeriod(M)||"ad",durationperiods:M.durationperiods,absent:M,classids:"classes"==l?[u]:[]})}return e.items.sort(function(e,t){var n=e.data.ttitem,s=t.data.ttitem;return n?s?n.added?-1:s.added?1:n.cancelled?1:s.cancelled?-1:s.changes.length-n.changes.length:-1:1}),e.render(),r.createElement("div",{style:a.rtlCss({position:"absolute",left:t.ttOffset,top:0,bottom:0})},h.tableIds("periods").map(function(t){var n=e.data2t({uniperiod:t}),s=e.t2p(n.t1),o=e.t2p(n.t2);return r.createElement(i,{key:t},r.createElement(a.RBox,{x1:s,y1:0,x2:s+1,y2:e.qSize,style:{backgroundColor:"#c5bdc5"}}),r.createElement(a.RBox,{x1:o,y1:0,x2:o+1,y2:e.qSize,style:{backgroundColor:"#c5bdc5"}}))}),e.renderOrderItems().map(function(i,a){var o=i.data,m=o.ttitem,p=o.absent,b=o.uniperiod,f=e.item2box(i,0,-1);if(p)return r.createElement(R,s.__assign({key:a},f,{tv:t,absent:p}));if(null==m?void 0:m.eventid){var _=h.rowData("events",m.eventid);return _&&r.createElement(A,s.__assign({key:a},f,{tv:t,event:_}))}return r.createElement(N,s.__assign({key:a},f,{tv:t,table:l,id:u,item_uniperiod:y.uniperiod,ttitem:m,je_sel_subst:m?m.id==y.id||c.idsIsOverlap(m.substids,y.substids):D.includes(b),selFn:i&&i.data.uniperiod==y.uniperiod&&!n&&w?function(e){t.setSel_item(d),w(u,e)}:null}))}))}())}function R(e){var t=e.absent,n=p.client_req.ls(1622),s=w.useSimplePopup(),i=s[0],o=s[1],l=s[2];return r.createElement(r.Fragment,null,r.createElement(a.RBox,{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,className:"cell chyba_cast",title:n||void 0,style:{borderBottomWidth:1,overflow:"visible"},onContextMenu:function(e){return o(e)}}),l&&r.createElement(i,null,r.createElement(x.AbsentPopup,{absentid:t.id,where:"subst"})))}function A(e){var t=e.event,n=e.tv.dbi,s=w.useSimplePopup(),i=s[0],o=s[1],l=s[2],c=E.eventName(n,t);return r.createElement(r.Fragment,null,r.createElement(a.RBox,{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,className:"cell event",title:c||void 0,style:{borderBottomWidth:1,overflow:"visible"},onContextMenu:function(e){return o(e)}}),l&&r.createElement(i,null,r.createElement(S.EventPopup,{eventid:t.id,where:"subst"})))}function N(e){var t=this,n=e.tv,i=e.ttitem,m=e.table,p=e.id,b=e.item_uniperiod,h=n.date,g=n.absents,y=n.ttitem,E=n.join_doubles,S=n.dbi,T=n.tt_dbi,C=S.req,k=w.useSimplePopup(),D=k[0],I=k[1],R=k[2],A=["cell"],N="",B=null,j="",P=s.__assign(s.__assign({},y),y.orig||{});if(e.je_sel_subst&&A.push("sel"),i){var M=!1,O=!1,z=!1;if("classes"==m){for(var F=0,L=i.changes;F<L.length;F++){var G=L[F],U=o.changeColumn2table(G.column);"teachers"!=U&&"classes"!=U||(O=!0)}if(y&&0==i.changes.length&&"period"==c.DBITools.typeOfUniPeriod(i.uniperiod)&&"period"==c.DBITools.typeOfUniPeriod(b)&&parseInt(i.uniperiod)>parseInt(b)&&(y.durationperiods||1)==(i.durationperiods||1)){var q=s.__assign(s.__assign({},i),{uniperiod:b});0==d.getSubstTTItemKolizie(S,T,q,s.__spreadArrays([y.id],y.join_ttitemids||[])).length&&(B={text:ASC.ttls(3195),onClick:function(){return s.__awaiter(t,void 0,void 0,function(){var e,t,n;return s.__generator(this,function(s){switch(s.label){case 0:return e=S.tools.ttitem_popis(y.cancelled?y.orig:y),(t=S.tools.ttitem_popis(i)).period+=" -> "+S.tools.ttitem_popis(q).period,n=function(e){return[e.period,e.subject,e.class,e.teacher].join(", ")},barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstOnline.suggested_move_view",eventLabel:""}),[4,a.RDialog.showConfirm(r.createElement(r.Fragment,null,r.createElement(_.DlgHeader,{title:C.ttls(3195),icon:"/substitution/pics/subst_move_64.png",small:!0}),r.createElement("div",null,r.createElement("h2",null,C.ttls(1476)+":"),n(e),r.createElement(a.VGap,{height:20}),r.createElement("h2",null,C.ttls(3194)+":"),n(t),r.createElement(a.VGap,{height:20}))),{buttons:[{label:C.ttls(3194),type:"green",action:"move"},"cancel"],footer:r.createElement(a.RButton,{label:u.action_name("help"),fa_icon:u.action_fa_icon("help"),onClick:function(){return window.open("https://help.asctimetables.com/text.php?id=638","_blank")}}),width:500})];case 1:return s.sent()?(barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstOnline.suggested_move_op",eventLabel:""}),y.cancelled?[3,3]:[4,ASC.blockUI(l.removeSubstOnlineTTItem(null,y.id,1<y.durationperiods))]):[3,5];case 2:s.sent(),s.label=3;case 3:return[4,ASC.blockUI(l.updateSubstTTItem(null,i.id,{uniperiod:b},{},1<i.durationperiods))];case 4:s.sent(),s.label=5;case 5:return[2]}})})}})}}else{for(var H=0,V=i.substids;H<V.length;H++)for(var W=V[H],K=0,Y=S.rowData("substonline_substitutions",W).changes;K<Y.length;K++)if(G=Y[K],o.changeColumn2table(G.column)==m&&G.new==p&&G.old!=p){O=!0;break}for(var J=0,Z=g;J<Z.length;J++){var $=Z[J];o.absentGetTable($)==m&&o.absentGetId($)==p&&o.substTTItem_absent_match_time(i,$)&&(M=!0)}if(f.ttitemUniperiodMatchSimple(c.unpartial(i),b)&&c.idsIsOverlap(P.classids,i.classids)){z=!0;for(var X=0,Q=[P.subjectid,i.subjectid];X<Q.length;X++){var ee=Q[X],te=S.rowData("subjects",ee);te&&te.subst_join_forbidden&&(z=!1)}}}if(f.ttitemFilterMatch(c.unpartial(i),m,p))A.push("uci"),O||i.added?A.push("subst"):z&&A.push("spoj");else if(i.orig&&f.ttitemFilterMatch(c.unpartial(i.orig),m,p))if(i.cancelled&&0<i.origofids.length){A.push("class_cancelled");var ne=i.origofids[0],se=ne.split(":")[0],re=void 0;if(se!=h)re=v.date_format_date(C,se,!1),j=h<se?"down":"up";else{var ie=S.rowData("substonline_ttitems",ne);re=S.tools.uniperiodName(ie.uniperiod),ie&&(j=parseInt(ie.uniperiod)<parseInt(i.uniperiod)?"left":"right")}N=C.lsf(7442,{date:re})}else"classes"==m||M||i.cancelled&&!i.cancelled_absent?A.push("cancelled"):A.push("mal_ucit");1<c.idsArrayUnique(i.teacherids).length&&A.push("teamteaching"),B&&A.push("move_sipocka");var ae=function(e){var t=S.rowName("subjects",e.subjectid,"short");return t+=" ",t+=S.rowNames("classes",e.classids,"short"),0<e.groupnames.length&&!c.DBITools.groupnamesIsEntireClass(e.groupnames)&&(t+=" ("+S.tools.groupnames_names(e.groupnames)+")"),t+=" ",t+=S.rowNames("teachers",e.teacherids,"short"),(t+=" ")+S.rowNames("classrooms",e.classroomids,"short")};i.cancelled?i.orig&&(N=C.ttls(1476)+": "+ae(i.orig)):N=ae(c.unpartial(i))}var oe=null,le=null;return i&&(le=function(e){return I(e)},B&&(oe=le)),e.selFn&&(oe=e.selFn,le=le||oe),r.createElement(r.Fragment,null,r.createElement(a.RBox,{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,className:A.join(" "),title:N||void 0,style:{cursor:e.selFn?"pointer":"",borderBottomWidth:1,overflow:"visible",backgroundImage:j?"none":void 0},onClick:function(e){ASC.hidePopups(e),oe&&oe(e)},onContextMenu:function(e){ASC.hidePopups(e),le&&le(e)}},j&&r.createElement("i",{className:"fa fa-arrow-"+a.rtlStr(j),style:a.rtlCss({position:"absolute",left:1,top:1,fontSize:12,color:"red",textShadow:"rgba(0,0,0,0.5) 0px 1px"})})),R&&r.createElement(D,null,r.createElement(x.SubstTTItemPopup,{ttitem:i,where:"subst",join_doubles:E,footer:B&&r.createElement(a.RButton,{content:B.text,onClick:B.onClick})})))}function B(e){var t=e.farby;if(0==t.length)return null;var n={position:"absolute",right:0,top:0,bottom:0,width:2};if(1==t.length)return r.createElement("div",{className:"pruzok",style:s.__assign(s.__assign({},n),{backgroundColor:t[0]})});function i(e){return e/t.length*100+"%"}return r.createElement("div",{style:a.rtlCss(s.__assign(s.__assign({},n),{background:"linear-gradient(to bottom,"+t.map(function(e,t){return e+" "+i(t)+","+e+" "+i(t+1)}).join(",")+")"}))})}function j(e){var t=a.useStateAsValueRef([e.nameWidth,e.setNameWidth]),n=a.useMouseResize(t,{axis:"x",min:20,max:150});return r.createElement("div",{style:{position:"absolute",top:0,right:0,bottom:0,width:3,cursor:"ew-resize"},onMouseDown:n})}function P(e,t,n,s){var r=e.req;return"date"==t?e.rowData("substonline_teacher_date",n+":"+s):"week"==t?e.rowData("substonline_teacher_week",v.date_week(r,n)+":"+s):"month"==t?e.rowData("substonline_teacher_month",n.substr(0,7)+":"+s):e.rowData("substonline_teacher_year",r.getSchoolYear(n)+":"+s)}e.TeachersPanelHeader=C,I.needed_part=c.typed({substonline_ttitems:["type","endtime","added"]});var M=25;function O(e){var t=[],n=e.table("substonline_teacher_month");if(n)for(var s=function(e){var s=n.column(e);if("int"!=s.type())return"continue";t.push({id:"sc_"+e,name:s.name(),render:function(t){var n=t.stats_dbi,s=t.date,i=t.teacherid,a=P(n,t.stats_mode,s,i),o=a?a[e]:0;if("de_plusminus"!=e)return o;var l="#00b050",c="normal";return 3==o&&(l="#c55a11",c="bold"),3<o&&(l="red",c="bold"),r.createElement("span",{style:{color:l,fontWeight:c}},o)}})},i=0,a=n.columns();i<a.length;i++)s(a[i]);return t}function z(e){var t,n,i=e.online,l=e.dbi,f=e.tt_dbi,_=e.date,v=e.filter,y=e.table,E=e.topid,w=e.ttitemid,S=e.onRowSelect,x=e.onRowDoubleClick,I=e.onRowPeriodClick,R=e.join_doubles,A=l.req,N=a.useColors(),B=(null===(n=l.rowData("global_settings","1"))||void 0===n?void 0:n.subst_online_ui)||{grid_mode:"periods",kriteria_cols:[]},j=!!l.rowData("substonline_dates",_).uploaded_int,P=r.useMemo(function(){return o.buildSubstOnlineTTItemsEx(l,_,R)},[l,_,R]),z=w?P.find(function(e){return e.id==w}):null,G=r.useMemo(function(){return y&&z?m.substTTItemComboItems({table:y,ttitem:z,dbi:l,tt_dbi:f,filter:v,remove_ttitemids:s.__spreadArrays([z.id],z.join_ttitemids||[]),topid:E}):[]},[y,z,l,f,v,E]),U=a.useLocalState("SubstOnline.TeachersView.stats_mode","month"),q=U[0],H=U[1],V=r.useState(null),W=V[0],K=V[1],Y=W?W.id:"";r.useEffect(function(){S&&S(Y)},[Y]),r.useEffect(function(){K(G[0]||null)},[_,w,E]);for(var J=a.useClientWidth(),Z=J[0],$=J[1],X=A.isApp()?30:19,Q=a.useLocalState("SubstOnline.TeachersView.nameWidth",33,{where:"localStorage"}),ee=Q[0],te=Q[1],ne=B.kriteria_cols,se=ee,re=[],ie=0,ae=O(l);ie<ae.length;ie++){var oe=ae[ie];ne.indexOf(oe.id)<0||(re.push(oe),se+=M)}var le=d.TTLR_TProvider_uni(B.grid_mode,l,{tt_dbi:f}),ce=new d.TimetableLayoutRenderer(Z-se-25,2+X,le.minT,le.maxT);ce.data2t=function(e){return le.t(e)},ce.qSide=7,ce.gap=-1;var ue=h.useMainDBI("month"!=q?A.getSchoolYear(_):null,{needed_part:(t={},t["substonline_teacher_"+q]=["absent","cancelled","substing","sv_substing","duty","de_plusminus"],t),vt_filter:{date:_}})||l,de=i?i.naming_dbi:new c.MergeDBI(l,f),me=(l.rowData("global_settings","1")||{}).colorblind,pe={online:i,date:_,req:A,dbi:l,stats_dbi:ue,tt_dbi:f,naming_dbi:de,table:y,ttitem:z,combo_items:G,onRowDoubleClick:x,onRowPeriodClick:I,uiSettings:B,join_doubles:R,ttitems:P,absents:l.tableFilterData("substonline_absents",{date:_}),stats_mode:q,setStats_mode:H,sel_item:W,setSel_item:K,rowHeight:X,nameWidth:ee,setNameWidth:te,ttOffset:se,tlr:ce,kriteriaCols:re,colorblind:me};return r.createElement(a.RScopedStyle,{ref:$,style:{display:"flex",flexDirection:"column",flex:"1 1 0px",position:"relative"},rules:{".cell":{position:"absolute",border:"1px solid #c5bdc5",borderBottomWidth:0,top:-1,bottom:0},".cell.sel":{backgroundColor:"#ffff00",backgroundImage:me?"url(/static/pics/textures/b_v.png)":void 0},".header .cell.sel:before":{position:"absolute",left:-2,top:-2,right:-2,bottom:-1,content:'" "',border:"2px solid black",zIndex:2},".cell.teamteaching":{backgroundImage:"url(/substitution/pics/teamteaching.png)",backgroundRepeat:"no-repeat",backgroundPosition:"top 1px right 1px"},".cell.move_sipocka":{backgroundImage:"url(/substitution/pics/move_sipocka.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center"},".cell.uci, .cell.uci.mal_ucit":{backgroundColor:"#fec2c2"},".cell.mal_ucit":{backgroundColor:"#00ffff",backgroundImage:me?"url(/static/pics/b_d1.png)":void 0},".cell.spoj":{backgroundColor:"#bffc07",backgroundImage:me?"url(/static/pics/b_dots.png)":void 0},".cell.chyba_cast":{backgroundColor:"#7b7b7b",backgroundImage:me?"url(/static/pics/w_d2.png)":void 0},".cell.event":{backgroundColor:"#d0ffd0"},".cell.class_cancelled, .cell.cancelled":{backgroundColor:"#c0c0c0"},".cell.subst":{backgroundColor:"#ff0000",backgroundImage:me?"url(/static/pics/w_chess.png)":void 0},".cell.subst.mal_ucit":{boxShadow:"0px 0px 0px 2px #00ffff inset"}}},!j&&z&&r.createElement(r.Fragment,null,r.createElement(C,{tv:pe}),r.createElement("div",{className:"tt",style:{flex:"1",display:"flex",flexDirection:"column",paddingLeft:4,paddingRight:4,backgroundColor:N.bgWhite}},r.createElement("div",{className:"header",style:{flex:"0 0 auto",overflow:"hidden"}},r.createElement(D,{tv:pe})),r.createElement("div",{style:{borderTop:"1px solid #000000",flex:"1 1 0px",overflowX:"hidden",overflowY:"auto"}},r.createElement(k,{tv:pe})),r.createElement(F,{tv:pe,stats_mode:q}))),0<G.length&&!A.isApp()&&r.createElement(L,{style:{position:"absolute",left:1,top:3},fa_icon:"caret-down",title:u.action_name("customize"),onClick:function(e){for(var t=[],n=function(e){t.push({text:e.name,checked:e.id==B.grid_mode,onClick:function(){return b.updateSubstOnlineUISettings(null,{grid_mode:e.id})}})},r=0,i=d.gridModes;r<i.length;r++)n(i[r]);t.push([]);for(var a=B.kriteria_cols,o=function(e){var n=0<=a.indexOf(e.id);t.push({text:e.name,checked:n,onClick:function(){return b.updateSubstOnlineUISettings(null,{kriteria_cols:n?a.filter(function(t){return t!=e.id}):s.__spreadArrays(a,[e.id])})}})},c=0,u=O(l);c<u.length;c++)o(u[c]);t.push([]);for(var m=function(e){t.push({text:p.client_req.localize(e.name),checked:e.id==pe.stats_mode,onClick:function(){return pe.setStats_mode(e.id)}})},f=0,_=T;f<_.length;f++)m(_[f]);g.showMenu(t,e.currentTarget),e.preventDefault(),e.stopPropagation()}}))}function F(e){var t=e.tv,n=e.stats_mode,o=t.date,l=t.dbi,c=t.stats_dbi,u=t.naming_dbi,d=t.sel_item,m=t.ttitem,b=t.table||"teachers",f=d&&d.id,_=l.req,h=null;if(m&&d){var g={display:"inline-block",width:"110px",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},v=function(e){var t=e.b;return r.createElement("span",{style:s.__assign(s.__assign({},g),{color:t<0?"#800000":t?"#000080":"#808080"}),title:e.name},e.name)},y=function(e){var t=l.column("global_settings","subst_online_criteria",e);return t?t.name():e},E=null;"teachers"==b&&(E=l.rowData("teacher_beeps",o+":"+f));var w="teachers"==b?P(c,n,o,f):null,S=function(e){var t=l.column("substonline_teacher_month",e);return t?r.createElement(r.Fragment,null,r.createElement(v,{name:t.name()+":",b:1}),w&&w[e]||0):null};h=r.createElement(r.Fragment,null,r.createElement("div",{style:{height:"20px"}}),r.createElement("div",null,r.createElement("span",{style:s.__assign(s.__assign({},g),{fontWeight:"bold"})},ASC.ttls(2071)),r.createElement("span",{style:s.__assign(s.__assign({},g),{fontWeight:"bold"})},u.rowName(b,f,_.sort_name_col))),r.createElement("div",{style:{height:"5px"}}),"teachers"==b&&r.createElement(r.Fragment,null,r.createElement("div",{style:{flex:"1 1 50px"}},r.createElement(v,{name:y("assign"),b:d.fa}),r.createElement(v,{name:y("teachesclass"),b:d.fu}),r.createElement(v,{name:y("classteacher"),b:d.ft}),r.createElement(v,{name:y("approbation"),b:d.fp}),r.createElement(v,{name:y("join"),b:d.fj}),r.createElement(v,{name:ASC.ttls(2153),b:-d.fx}),r.createElement(v,{name:y("duty"),b:d.fd}),d.filter_out&&r.createElement(v,{name:_.ls(1838),b:-1}),E&&r.createElement("span",{style:{display:"block",marginTop:"5px"}},E.text),_.isAscDevelop()&&r.createElement("span",{style:{color:"#a0a0a0",marginTop:5}},"p=",d.priorita," fa=",d.fa," fq=",d.fq)),r.createElement("div",{style:{height:50}},r.createElement("div",{style:{borderBottom:"1px solid #282873"}},"month"==n?ASC.ttls(2197):p.client_req.localize("{1011} - "+p.client_req.localize(T.find(function(e){return e.id==n}).name))),S("substing"),r.createElement(i,null,r.createElement(a.HGap,{width:20}),S("sv_substing")),r.createElement("br",null),S("absent"),r.createElement(a.HGap,{width:20}),S("cancelled"),r.createElement("br",null),S("duty"),r.createElement(a.HGap,{width:20}),S("de_plusminus"))))}return r.createElement("div",{className:"info",style:{flex:"0 0 200px",height:"200px",display:"flex",flexDirection:"column"}},h)}function L(e){var t=a.useHover(),n=t[0],i=t[1];return r.createElement("i",s.__assign({},i,{className:"fa fa-"+e.fa_icon,style:a.rtlCss(s.__assign({fontSize:12,color:"#c0c0c0",backgroundColor:n?"#e0e0e0":void 0,padding:"3px 7px",cursor:"pointer"},e.style)),title:e.title,onClick:e.onClick}))}O.needed_part=c.typed({substonline_teacher_month:["absent","cancelled","substing","sv_substing","duty","de_plusminus"]}),(e.TeachersView=z).npp=c.neededPartProvider(function(){return[m.substTTItemComboItems,o.buildSubstOnlineTTItemsEx,d.TTLR_TProvider_uni,I,F,O,{global_settings:["colorblind","subst_online_ui"]}]}),z.ttdbi={npp:c.neededPartProvider(function(){return[m.substTTItemComboItems.ttdbi]})},F.needed_part=c.typed({teacher_beeps:["text"],substonline_teacher_month:["absent","cancelled","substing","sv_substing","duty","de_plusminus"]}),e.MenuIcon=L},"/substitution/server/commands.js":function(e,t,n){n.implementRpc(["getSubstPublishData","updateSubstPublishData","publishDay","unpublishDay","removeSubstOnlineTTItem","uncancelSubstOnlineTTItem","updateSubstTTItem","updateSubstSubstitution","updateSubstSubstitutionAddCard","addSubstSubstitution","removeSubstSubstitution","absentEditWrite","removeAbsent","cancelSubstMove","deleteSubstDay","getAbsentLessons","getSubstDateFieldData","setDateTcardsSubst","updateSubstIgnoreKolizie","substStudentsEditWrite"])},"/substitution/online/timetable.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("../../rpr/dbi"),a=t("../../asc/edurequest"),o=t("../../asc/svg"),l=t("../subst"),c=t("../server/commands"),u=t("../../asc/asc_react"),d=t("../../asc/actions"),m=t("../../timetable/ttitem"),p=t("../../asc/asc_react2"),b=t("../../dashboard/dbi_events"),f=t("../../timetable/timeoff_r"),_=t("../../asc/lib_date"),h=t("../../rpr/dbi_react"),g=t("./combo"),v=t("../../timetable/ttview_components"),y=t("../../react/combobox"),E=t("../../react/menu"),w=t("../../react/prevnextarrows"),S=t("./editduties"),x=t("../../react/popuppanel"),T=t("./subst_popup"),C=t("../../calendar/event_popup"),k=t("../../react/anchor"),D="substonline_absents",I="substonline_substitutions",R="substonline_ttitems",A="substonline_dates",N="#fec2c2",B="#00ffff",j="#ff0000",P="#C0C0C0",M="#c0c0c0",O="#ff0000",z="#8080ff",F="#40ff40",L="#0000FF",G="#00FFFF",U="{tt:3194}",q="{7856}",H="{3894}";function V(e){var n=this,o=r.useRef(),c=u.useReq(),d=c.isApp(),m=e.onGoToDate,b=u.useStateRef(e.join_doubles),f=b[0],g=b[1],v=r.useState({table:e.table,id:e.id}),E=v[0],S=E.table,x=E.id,T=v[1],C=c.getSchoolYear(e.date),D=c.schoolYear_turnOver(C),I=c.schoolYear_turnOver_end(C),A=_.date_week(c,e.date),N=r.useState(i.strMax(_.week_start(c,A),D)),B=N[0],j=N[1],P=r.useState(i.strMin(_.week_end(c,A),I)),M=P[0],O=P[1],z=r.useState(""),F=z[0],L=z[1],G=u.useStateValueRef(!0),U=G.value,q=u.useStateValueRef("periods"),H=q.value;r.useEffect(function(){return barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstTimetableDlg.open",eventLabel:""})},[]);for(var K=h.useMainDBI(C,{needed_part:i.DBITools.mergeNeededParts(V),vt_filter:{datefrom:B,dateto:M}}),Y="",X=0,Q=K.tableData("substonline_dates");X<Q.length;X++){var ee=Q[X];if(ee.date>=B&&ee.date<=M&&ee.tt_num){Y=ee.tt_num;break}}var te=h.useTTDBI(Y,{needed_part:i.DBITools.mergeNeededParts(V.ttdbi,{teachers:[],classes:[],classrooms:[]})}),ne=r.useRef(!0);if(ne.current&&!K.mock&&(ne.current=!1,e.move_substid))for(var se=0,re=K.tableData(R);se<re.length;se++){var ie=re[se];if(0<=ie.substids.indexOf(e.move_substid)&&!ie.cancelled){L(ie.id);break}}var ae=null;if(F)if(f){var oe=F.split(":")[0],le=l.buildSubstOnlineTTItemsEx(K,oe,f,{table:"substonline_ttitems"});ae=le.find(function(e){return e.id==F})}else ae=K.rowData(R,F);ae&&W(s.__assign({},ae),{});var ce={close:function(){return o.current.confirmClose()},onGoToDate:m,table:S,id:x,setItem:function(e,t){return T({table:e,id:t})},moveTTItem:ae,setMoveTTItemid:L,cancelMove:function(){L(""),O(_.date_delta(B,6))}},ue=r.createElement(u.Fragment,null,r.createElement(w.default,{onDelta:function(e){return function(e){void 0===e&&(e=!1);var t=i.DBITools.splitItemsForCombo(K.tableData(S),B).map(function(e){return e.id});if(t.length){var n=t.indexOf(x)+(e?t.length-1:1);n%=t.length,T({table:S,id:t[n]})}}(e<0)}}),r.createElement(u.HGap,null),r.createElement(k.RAnchor,{label:r.createElement(r.Fragment,null,K.table(S).itemName()+" "+K.rowName(S,x),r.createElement(u.HGap,null),r.createElement("i",{className:"fa fa-caret-down"})),style:{color:"inherit"},menu:i.DBITools.splitItemsForCombo(K.tableData(S),B).map(function(e){var t=e.cb_hidden,n=e.dateto;return n&&n<B&&(t=!0),{text:K.rowName(S,e.id,a.client_req.sort_name_col),checked:x==e.id,onClick:function(){return T({table:S,id:e.id})},className:t?"cb_hidden":""}})}));return r.createElement(u.RDialog,{controlRef:o,header:c.ls(1001)+" + "+c.ls(1003),width:920,height:600,buttons:d?[]:["close"],backgroundColor:"#ffffff",footer:r.createElement(u.Fragment,null,[-7,7].map(function(e){var t=!0;return e<0&&B<=D&&(t=!1),0<e&&I<=M&&(t=!1),r.createElement(u.RButton,{key:e,label:e<0?"<< "+c.ls(1729):c.ls(1729)+" >>",onClick:t?function(){ae?e<0?j(_.date_delta(B,e)):O(_.date_delta(M,e)):(j(_.date_delta(B,e)),O(_.date_delta(M,e)))}:void 0})}),d||r.createElement(r.Fragment,null,r.createElement(u.HGap,{width:10}),r.createElement("span",null,c.ls(1691),": "),r.createElement(y.default,{valueRef:q,items:[{value:"periods",name:c.ls(6399)},{value:"time",name:c.ls(1345)}]}),r.createElement(u.HGap,{width:10}),r.createElement("span",null,c.ls(1489),": "),r.createElement(u.RCheckBox,{label:c.ls(1844),valueRef:G}),r.createElement(u.HGap,null),r.createElement(u.RCheckBox,{label:c.ls(9339),valueRef:g}))),allowMaximizeBtn:!0},r.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"column"}},ae?r.createElement(J,{dlg:ce,dbi:K,move_ttitem:ae}):r.createElement(p.DlgHeader,{title:ue,icon:"/static/pics/timetables_48.svg",right:te&&te.rowData(S,x)&&r.createElement(k.RAnchor,{label:c.ls(8735),style:{alignSelf:"start"},onClick:function(){return s.__awaiter(n,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../../timetable/ttviewer")})];case 1:return[2,e.sent().showTTViewerDlg({num:Y,user:i.DBITools.rowid2user(S,x)})]}})})}})}),r.createElement($,{where:"timetable",style:{flex:"1"},datefrom:B,dateto:M,dbi:K,tt_dbi:te,table:S,id:x,show_moves:!0,show_events:U,move_ttitem:ae,grid_mode:H,join_doubles:f,dlg:ce}),ae&&!d&&r.createElement(Z,null)))}function W(e,t){if(0==e.teacherids.length&&e.orig&&1==e.orig.teacherids.length){var n=e.orig.teacherids;t.teacherids=n,e.teacherids=n}e.starttime&&(e.starttime=void 0,e.endtime=void 0)}function K(e,t,n,r,a,o,c){void 0===c&&(c={});var u=0,d=1,p=function(e,t){return t?d:u},b=new m.TTItemTimeProvider(e),f=c.periods||e.tableData("periods"),_=new Map;function h(a){var o={t1:u,t2:d,wasAligned:!1};if(a.starttime&&a.endtime||!a.date||((a=s.__assign({},a)).uniperiod||(a.uniperiod=i.DBITools.getUniPeriod(a)),a.classids||(a.classids=a.classid?[a.classid]:[]),b.setDate(e.rowData(n,a.date),t),b.fill(i.unpartial(a),i.unpartial(a))),r)a.starttime&&(o.t1=l.time2int(a.starttime)),a.endtime&&(o.t2=l.time2int(a.endtime));else{var c,m=a.period,f="";if(a.uniperiod){var h=i.DBITools.typeOfUniPeriod(a.uniperiod);"period"==h&&(m=a.uniperiod),"break"==h&&(f=a.uniperiod.substr(1))}if(m)o.t1=parseInt(m),o.t2=o.t1+(a.durationperiods||1),a.starttime&&(c=_.get(m))&&c.starttime!=a.starttime&&(o.wasAligned=!0),a.endtime&&(c=_.get(i.DBITools.uniperiod_delta(m,(a.durationperiods||1)-1)))&&c.endtime!=a.endtime&&(o.wasAligned=!0);else f?(o.t1=parseInt(f)-.25,o.t2=parseInt(f)+.25):(a.starttime&&(o.t1=p(a.starttime,!1)),a.endtime&&(o.t2=p(a.endtime,!0)))}return isNaN(o.t1)||isNaN(o.t2),o}f.forEach(function(e){return _.set(e.id,e)});var g={starttime:"08:00",endtime:"12:00"};if(u=h(f[0]||g).t1,d=h(f[f.length-1]||g).t2,r)u-=15,d+=15,e.req.jeZUS()&&(u=420,d=1200);else{var v=f.map(function(e){return{t1:l.time2int(e.starttime),t2:l.time2int(e.endtime)}}),y=parseInt((f[0]||{id:"0"}).id);p=function(e,t){for(var n=0;n<f.length;n++){var s=f[n];if(e<s.starttime)return y+n;if(!(e>s.endtime)){var r=v[n],i=l.time2int(e)-r.t1;return y+n+i/Math.max(r.t2-r.t1,1)}}return y+f.length}}var E=new pe(a,o,u,d);return E.data2t=function(e){return h(e.ttitem||e.absent||e.event||e)},E}function Y(e){var t=e.dlg,n=e.dbi,s=e.table,i=e.id,a=t.table==s&&t.id==i;return r.createElement("a",{title:n.rowName(s,i),onClick:function(){return t.setItem(s,i)},style:{color:"#000000",textDecoration:a?"underline":"",cursor:a?"inherit":"pointer"}},n.rowName(s,i,"short"))}function J(e){var t=e.dlg,n=e.dbi,s=e.move_ttitem,i=n.req;return r.createElement(p.DlgHeader,{title:r.createElement(r.Fragment,null,i.ls(7441),": ",n.tools.ttitem_popis(s,"short").subject," ",s.classids.map(function(e,s){return r.createElement(u.Fragment,{key:""+s},r.createElement(Y,{dlg:t,dbi:n,table:"classes",id:e})," ")})," ",s.teacherids.map(function(e,s){return r.createElement(u.Fragment,{key:""+s},r.createElement(Y,{dlg:t,dbi:n,table:"teachers",id:e})," ")})," ",s.classroomids.map(function(e,s){return r.createElement(u.Fragment,{key:""+s},r.createElement(Y,{dlg:t,dbi:n,table:"classrooms",id:e})," ")})," ",r.createElement("span",{style:{fontSize:12}},"(",r.createElement("a",{style:{cursor:"pointer"},onClick:function(){return t.cancelMove()}},i.ls(1038)),")")),icon:l.ICON_subst_movelesson,right:i.isApp()||r.createElement(u.RButton,{type:"",label:i.ls(1333),fa_icon:"question-circle",onClick:function(){return window.open("http://help.edupage.org/text.php?id=1870","_blank")}})})}function Z(e){var t=u.useReq();return r.createElement("div",{style:{marginTop:5}},t.ls(6698)+": ",[[F,U],[L,q],[G,H],["#808080",t.ls(1895)]].map(function(e,t){return r.createElement(u.Fragment,{key:""+t},r.createElement("span",{style:{display:"inline-block",height:"10px",width:"10px",border:["2px",3==t?"dotted":"solid",e[0]].join(" "),verticalAlign:"middle",marginLeft:20}})," - "+a.client_req.localize(e[1]))}))}function $(e){for(var t,n=u.useClientSize(),i=n[0],a=n[1],o=n[2],l=r.useState(null),c=l[0],d=l[1],m=e.dbi,p=e.tt_dbi,b=e.move_ttitem,f=e.grid_mode,h=e.dlg,g=e.join_doubles,y=m.req,w=i-55-1,S=a-50-1,x=new Map,T=[],C=e.datefrom;C<=e.dateto;C=_.date_delta(C,1))(!_.date_isWeekend(y,C)||0<=(null!==(t=m.rowData("substonline_dates",C,{}).tt_day)&&void 0!==t?t:-1))&&T.push(C);function k(e){return{y1:Math.round(e*S/T.length),y2:Math.round((e+1)*S/T.length)}}var D=K(m,p,"substonline_dates","time"==f,w,50),I=T.map(function(e,t){return s.__assign(s.__assign({date:e},k(t)),{row:m.rowData("substonline_dates",e)})}),R={where:e.where,dbi:m,tt_dbi:p,date:T[0],table:e.table,id:e.id,tlr:D,width:i,height:a,gap:2,gap_row:6,dayWidth:55,periodHeight:50,row2y:k,nRows:T.length,show_events:e.show_events,join_doubles:g,dlg:e.dlg,setHoverMove:d},A={x1:55,x2:55+w,y1:50,y2:50+S},N={x1:A.x1,x2:A.x2+1,y1:A.y1,y2:A.y2+1},B={x1:A.x1,x2:A.x2,y1:0,y2:50};return r.createElement("div",{ref:o,style:s.__assign({position:"relative",backgroundColor:"#ffffff"},e.style)},r.createElement(v.TTView_Periods,{dbi:m,periodsBox:B,tlr:D,showTime:"time"==f}),r.createElement(v.TTView_OuterLines,{outerBox:N}),r.createElement(u.RBox,{x1:0,x2:55,y1:50,y2:a},I.map(function(e){if(!e.row)return null;var t={x1:0,x2:55,y1:e.y1,y2:e.y2},n=[];h&&h.onGoToDate&&n.push({text:y.ttls(3812),onClick:function(){h.close(),h.onGoToDate(e.date)}});var s="",i="";return e.row.is_online?(s="/static/pics/item_warning_16.png",i=y.ls(1645)):e.row.uploaded_int&&(s="/substitution/pics/uploaded_32.png",i=y.ls(2740)),r.createElement(v.TTView_Header,{key:e.date,box:t,text:r.createElement(r.Fragment,null,_.date_day_name(y,e.date,!0),r.createElement("span",{style:{fontSize:10}},_.date_format_date(y,e.date,!1))),icon:s,icon_tooltip:i,onClick:function(e){n.length&&(E.showMenu(n,e),e.preventDefault())},style:e.date<y.timezone_date()?{color:"#c0c0c0"}:void 0,splitLineTop:0<e.y1})})),r.createElement(u.RBox,s.__assign({},A,{style:{overflow:"visible"}}),I.map(function(e){return e.row?r.createElement(se,s.__assign({},{key:e.date,tvs:s.__assign(s.__assign({},R),{date:e.date}),je_upload:!!e.row.uploaded_int,ttWidth:w,y1:e.y1,y2:e.y2,ttitems_center:x,gap_row:6})):null}),r.createElement(X,{dbi:m,ttWidth:w,ttHeight:S,move_ttitem:b,hoverMove:c,ttitems_center:x,show_moves:e.show_moves})))}function X(e){var t=e.ttWidth,n=e.ttHeight,s=e.move_ttitem,i=e.hoverMove,a=e.ttitems_center,l=e.dbi,c="url(#tien)",u=[];if(e.show_moves)for(var d=0,m=l.tableData(R);d<m.length;d++){var p=m[d];if(p.origofids.length){var b=a.get(p.id);if(b)for(var f=0,_=p.origofids;f<_.length;f++){var h=_[f],g=l.rowData(R,h);if(g){var v=a.get(g.id);v&&u.push(r.createElement("g",{stroke:s?"rgba(255,255,255,0.5)":"#ffffff",filter:c,strokeWidth:"3",strokeLinecap:"round",key:""+u.length},r.createElement(o.RSvgArrow,{p1:b,p2:v,head_size:20,typ:"forward"}))),console.log("bundle_subst.min.js forward on 5353")}}}}if(s&&i){var y=a.get(s.id);y&&u.push(r.createElement("g",{stroke:i.color,filter:c,strokeWidth:"3",strokeLinecap:"round",key:""+u.length},r.createElement(o.RSvgArrow,{p1:y,p2:i.center,head_size:20,typ:i.typ})))}return r.createElement("svg",{width:t+40+10,height:n+40+20,style:{pointerEvents:"none",position:"absolute",left:-40,top:-40,zIndex:10}},r.createElement("defs",null,r.createElement("filter",{id:"tien"},r.createElement("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"3"}),r.createElement("feOffset",{dx:"2",dy:"2",result:"offsetblur"}),r.createElement("feMerge",null,r.createElement("feMergeNode",null),r.createElement("feMergeNode",{in:"SourceGraphic"})))),r.createElement("g",{transform:"translate(40 40)"},u))}function Q(e,t,n,s,r){void 0===s&&(s=[]),void 0===r&&(r=!1);var a=[],o=n.date,c=e.rowData("substonline_dates",o,{});if(0<e.tableData("periods").length&&"period"==i.DBITools.typeOfUniPeriod(n.uniperiod)){var u=!1;e.rowData("periods",n.uniperiod)||(u=!0),1<n.durationperiods&&!e.rowData("periods",i.DBITools.uniperiod_delta(n.uniperiod,n.durationperiods-1))&&(u=!0),u&&a.push({out:u})}if(c.is_holiday&&a.push({out:!0}),c.tt_num&&"period"==i.DBITools.typeOfUniPeriod(n.uniperiod))for(var d=parseInt(n.uniperiod),p=d+(n.durationperiods||1)-1,b=0,_=n.teacherids;b<_.length;b++){var h=_[b],g=e.rowData("teachers",h);if(g){var v=(g.subst_tt_timeoff||g.subst_tt_timeoff_vt||{})[c.tt_num];if(v)for(var y=d;y<=p;y++)"0"==f.timeoff_get(v,c.tt_term,c.tt_week,c.tt_day,y)&&a.push({table:"teachers",id:h,subst_timeoff:!0})}}for(var E=function(e){return!!i.idsIsOverlap(e.classids,n.classids)&&!!m.ttitemUniperiodMatchSimple(i.unpartial(n),e.uniperiod)},w=0,S=l.buildSubstOnlineTTItemsEx(e,n.date,r);w<S.length;w++){var x=S[w];if(!s.includes(x.id)){if("event"==x.type&&"ad"==x.uniperiod){var T=e.rowData("events",x.eventid,{});if("distant"==T.typ)continue;if(T.elearn_superid)continue}if(m.ttitemUniperiodMatchSimple(i.unpartial(n),x.uniperiod)||m.ttitemUniperiodMatchSimple(i.unpartial(x),n.uniperiod)){for(var C=0,k=l.ttitem_isClassColision(x,n,t)||[];C<k.length;C++){var D=k[C];a.push({item:x,table:"classes",id:D})}for(var I=0,R=i.idsArrayIntersect(x.teacherids,n.teacherids);I<R.length;I++)h=R[I],a.push({item:x,table:"teachers",id:h,join:E(x),subjectid:x.subjectid});if("classroomsupervision"!==n.type)for(var A=0,N=i.idsArrayIntersect(x.classroomids,n.classroomids);A<N.length;A++){var B=N[A];a.push({item:x,table:"classrooms",id:B,join:i.idsIsOverlap(x.teacherids,n.teacherids)&&E(x)})}}}}for(var j=0,P=e.tableFilterData("substonline_absents",{date:n.date});j<P.length;j++){var M=P[j];l.substTTItem_absent_match(n,M)&&a.push({absent:M,table:l.absentGetTable(M),id:l.absentGetId(M)})}return a}function ee(e,t,n,s){void 0===s&&(s=!1);for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a.table==t&&a.id==n){if(s&&a.join)continue;return!0}}return!1}function te(e,t,n,s){for(var r=[],i=0,a=Q(e,t,n,[],s);i<a.length;i++){for(var o=a[i],l=!1,c=0,u=r;c<u.length;c++){var d=u[c];o.absent&&d.absent==o.absent&&(l=!0),o.item&&d.item==o.item&&(l=!0)}l||r.push(o)}return r}function ne(e,t){var n=i.DBITools.getUniPeriod(e)||"ad";if(n!=(i.DBITools.getUniPeriod(t)||"ad"))return!1;switch(i.DBITools.typeOfUniPeriod(n)){case"period":if((e.durationperiods||1)!=(t.durationperiods||1))return!1;break;case"starttime":if(e.endtime!=t.endtime)return!1}return!0}function se(e){var t=e.tvs,n=e.ttWidth,c=e.y1,d=e.y2,m=e.gap_row,p=e.ttitems_center,_=e.remove_ttitemids,h=e.editing_ttitems,g=t.date,y=t.dbi,E=t.tt_dbi,w=t.table,S=t.id,x=t.dlg,T=t.show_events,C=t.join_doubles,k=(x||{}).moveTTItem,I=d-c,R=t.tlr;R.clear(),R.qSize=I-m;for(var N=l.buildSubstOnlineTTItemsEx(y,g,C),B=[],j=new Set,P=0,M=N;P<M.length;P++){var O=M[P];if(!_||!_.includes(O.id))if(O.eventid){var z=y.rowData("events",O.eventid);T&&z&&(l.substTTItem_filter_match(O,w,S)||b.isEventCancelDay(y,z))&&B.push(z)}else{var V=!1;if(l.substTTItem_filter_match(O,w,S)&&(V=!0),O.orig&&!O.added&&l.substTTItem_filter_match(O.orig,w,S)&&(V=!0),V){var K="main";"classroomsupervision"==O.type?K="supervision":O.cancelled&&(K="autobottom"),R.addItem(K,{ttitem:O});for(var Y=0,J=O.eventids||[];Y<J.length;Y++){var Z=J[Y];j.add(Z)}}}}if(h)for(var $=0,X=h;$<X.length;$++)O=X[$],R.addItem("classroomsupervision"==O.type?"supervision":"main",{ttitem:O,editing:!0});for(var Q=0,ee=y.tableFilterData(D,{date:g});Q<ee.length;Q++){var se=ee[Q];if(l.absentGetTable(se)==w&&l.absentGetId(se)==S){for(var ie=null,ce=0,ue=B;ce<ue.length;ce++){var pe=ue[ce];if(ne(pe,se)){ie=pe,j.add(ie.id);break}}R.addItem("bottom",{absent:se,event:ie})}}for(var be=0,fe=B;be<fe.length;be++){var _e=fe[be];j.has(_e.id)||R.addItem(b.isEventCancelDay(y,_e)?"autotop":"top",{event:_e})}if("teachers"==w){var he=y.rowData("teachers",S),ge=y.rowData(A,g);if(he&&ge&&null!=ge.tt_day&&0<=ge.tt_day&&!ge.is_holiday){var ve=(he.subst_tt_timeoff||he.subst_tt_timeoff_vt)[ge.tt_num];if(ve)for(var ye=0,Ee=y.tableIds("periods");ye<Ee.length;ye++){var we=Ee[ye],Se=f.timeoff_get(ve,ge.tt_term,ge.tt_week,ge.tt_day,parseInt(we))||" ";"."==(Se=Se.trim())&&(Se=""),Se&&R.addItem("autobottom",{uniperiod:we,teacher_timeoff:Se})}}}var xe=new Map;if(k&&"period"==i.DBITools.typeOfUniPeriod(k.uniperiod))for(var Te=function(e){if(g==k.date&&e==k.uniperiod)return"continue";var t=s.__assign(s.__assign({},k),{date:g,uniperiod:e}),n={date:g,uniperiod:e};function r(e){if("classrooms"==w)return e;for(var t=e.filter(function(e){return"classrooms"!=e.table}),n=0,s=e;n<s.length;n++){var r=s[n];if("classrooms"==r.table){for(var a=!1,o=0,l=t;o<l.length;o++){var c=l[o];r.item&&c.item==r.item&&(a=!0)}a||(i=!0)}}return t}W(t,n);var i=!1,o=r(te(y,E,t,C));if(0==o.length){var c=R.data2t(s.__assign(s.__assign({},t),n));R.addItem("overlay",{move:{typ:"forward",color:F,name:a.client_req.localize(U),moves:[{orig:k,moved:t}],changeClassroom:i}},{t1:c.t1,t2:c.t2}),console.log("bundle_subst.min.js forward on 5655")}else for(var u=0,d=o;u<d.length;u++){var m=d[u].item;if(m&&m.uniperiod==e&&l.substTTItem_filter_match(m,w,S)&&l.substTTItemMovable(m)){var p=i;i=!1;var b={date:k.date,uniperiod:k.uniperiod},f=s.__assign(s.__assign({},m),b);W(f,b);var _=r(te(y,E,f,C));1==_.length&&_[0].item&&_[0].item.id==k.id&&(1==o.length&&o[0].item.id==m.id?(p&&(i=!0),xe.set(m.id,{color:L,typ:"bidi",name:a.client_req.localize(q),moves:[{orig:k,moved:t},{orig:m,moved:s.__assign(s.__assign({},m),b)}],changeClassroom:i})):xe.set(m.id,{color:G,typ:"back",name:a.client_req.localize(H),moves:[{orig:k,cancel:!0},{orig:m,moved:s.__assign(s.__assign({},m),b)}],changeClassroom:i}))}}},Ce=0,ke=y.tableIds("periods");Ce<ke.length;Ce++)Te(we=ke[Ce]);R.render();var De=R.renderOrderItems(),Ie=De.filter(function(e){return e.data.move});return r.createElement(u.RBox,{x1:0,x2:n,y1:c,y2:d,style:{overflow:"visible"}},r.createElement(v.TTView_Lines,{dbi:y,rowHeight:I,tlr:R}),De.map(function(n,i){var a=R.item2box(n);if(n.data.ttitem){p&&p.set(n.data.ttitem.id,new o.CPoint((n.p1+n.p2)/2,c+(n.q1+n.q2)/2));var l=xe.get(n.data.ttitem.id);return r.createElement(u.Fragment,{key:""+i},r.createElement(de,{box:a,ttitem:n.data.ttitem,je_upload:e.je_upload,tvs:t,side:"bottom"==n.part,editing:n.data.editing}),l&&r.createElement(ae,{box:a,move:s.__assign(s.__assign({},l),{center:re(a,c)}),tvs:t}))}if(n.data.move){for(var d=1e5,m=0,b=Ie;m<b.length;m++){var f=b[m];f.p1<=n.p1||f.q1>=n.q2||f.q2<=n.q1||(d=Math.min(d,R.item2box(f).x1))}return r.createElement(ae,{key:""+i,box:a,move:s.__assign(s.__assign({},n.data.move),{center:re(a,c,d)}),tvs:t,cut_x:d})}return n.data.absent?r.createElement(oe,{key:""+i,box:a,absent:n.data.absent,tvs:t,event:n.data.event}):n.data.event?r.createElement(le,{key:""+i,box:a,event:n.data.event,tvs:t}):n.data.teacher_timeoff?r.createElement(me,{key:""+i,box:a,teacher_timeoff:n.data.teacher_timeoff}):null}))}function re(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1e5),new o.CPoint((e.x1+Math.min(e.x2,n))/2,(e.y1+e.y2)/2+t)}function ie(e){var t=e.dbi,n=e.tt_dbi,i=e.move,a=e.classroomRef,o=e.ignore_ttitemids,l=e.join_doubles,c=t.req,m=i.orig,p=i.moved,b=i.cancel,f=m;function h(e){var n=e.date,s=e.uniperiod,r=t.tools.uniperiodName(s,"short",f);return f.date==m.date&&!b||(r=_.date_format_day(c,n,!1,!0)+" "+r),r}return p&&(f=s.__assign(s.__assign({},f),p)),r.createElement("div",null,r.createElement("b",null,t.rowName("subjects",f.subjectid)),r.createElement(u.VGap,{height:10}),h(m),b||r.createElement(r.Fragment,null,r.createElement("img",{src:"/static/pics/replace_32.svg",style:{verticalAlign:"middle",height:16,padding:"0px 5px"}}),h(f)),b&&r.createElement(r.Fragment,null,r.createElement(u.VGap,{height:10}),r.createElement("img",{src:d.action_icon("delete"),style:{height:16,verticalAlign:"middle",marginRight:5}}),c.ttls(1476)),!b&&a&&function(){var e=a.value,i=Q(t,n,s.__assign(s.__assign({},f),{classroomids:e?[e]:[]}),o,l),d=g.substTTItemComboItems({table:"classrooms",dbi:t,tt_dbi:n,ttitem:f,topid:f.classroomids[0],remove_ttitemids:o});e&&!d.find(function(t){return t.id==e})&&a.set("");var p=ee(i,"classrooms",e);return!e&&0<m.classroomids.length&&(p=!0),r.createElement(r.Fragment,null,r.createElement(u.VGap,{height:10}),r.createElement(u.RLabel,{text:t.tools.itemName("classrooms")+":"}),r.createElement(y.default,{valueRef:a,items:d.map(function(e){return{value:e.id,name:t.rowName("classrooms",e.id),classname:e.className}})}),p&&r.createElement("img",{src:"/static/pics/item_bad_32.svg",style:{height:16,verticalAlign:"middle",marginLeft:5},title:c.ttls(3447)}))}())}function ae(e){var t=this,n=e.move,i=e.tvs,a=e.box,o=e.cut_x,l=n.color,d=n.changeClassroom,m=i.dbi,b=i.tt_dbi,f=i.join_doubles,_="SubstTimetableDlg",h=r.useState(!1),g=h[0],v=h[1],y=void 0!==o&&a.x2>o;return y&&(a=s.__assign(s.__assign({},a),{x2:o-4})),r.createElement(u.RBox,s.__assign({},a,{onClick:function(){return s.__awaiter(t,void 0,void 0,function(){var e,t,a,o,l,h,g=this;return s.__generator(this,function(y){switch(y.label){case 0:v(!0),i.setHoverMove(n),y.label=1;case 1:for(y.trys.push([1,,3,4]),e={moves_classroomid:n.moves.map(function(e){return e.orig.classroomids[0]||""})},t=[],a=0,o=n.moves;a<o.length;a++)l=o[a],t.push(l.orig.id);return[4,u.RDialog.showInput(e,function(e){e.state;var s=e.stateRef;return i.setHoverMove(n),r.createElement(r.Fragment,null,r.createElement(p.DlgHeader,{title:n.name,icon:"/substitution/pics/subst_move_64.png",small:!0}),r.createElement(p.RJoin,{children:n.moves.map(function(e,n){return r.createElement(ie,{dbi:m,tt_dbi:b,move:e,classroomRef:d?s.sub("moves_classroomid").index(n):null,ignore_ttitemids:t,join_doubles:f})}),glue:r.createElement(p.SeparatorLine,null)}))},{width:400,buttons:[{label:n.name,action:"ok",type:"default"},"cancel"]})];case 2:return(h=y.sent())&&ASC.blockUI(function(){return s.__awaiter(g,void 0,void 0,function(){var e,t,r,a;return s.__generator(this,function(s){switch(s.label){case 0:e=0,s.label=1;case 1:return e<n.moves.length?(t=n.moves[e],r=h.moves_classroomid[e],t.cancel?[4,c.removeSubstOnlineTTItem(null,t.orig.id,f,{log_module:_})]:[3,3]):[3,6];case 2:return s.sent(),[3,5];case 3:return[4,c.updateSubstTTItem(null,t.orig.id,{date:t.moved.date,uniperiod:t.moved.uniperiod,teacherids:t.moved.teacherids,classroomids:d?r?[r]:[]:void 0},{},f,{log_module:_})];case 4:a=s.sent(),0==e&&i.dlg.setMoveTTItemid(a),s.label=5;case 5:return e++,[3,1];case 6:return[2]}})})}),[3,4];case 3:return v(!1),i.setHoverMove(null),[7];case 4:return[2]}})})},onMouseEnter:function(){return i.setHoverMove(n)},onMouseLeave:function(){g||i.setHoverMove(null)},style:{borderWidth:3,borderStyle:d?"dashed":"solid",borderColor:l,borderRightWidth:y?0:void 0}}))}function oe(t){var n=t.absent,s=t.tvs,i=t.event,a=s.dbi,o=a.req,c=x.useSimplePopup(),u=c[0],d=c[1],m=c[2],p=a.rowName("absent_types",n.absent_typeid);return p=p||o.ls(1846),"classes"==l.absentGetTable(n)&&n.groupname&&(p+=" ("+n.groupname+")"),i&&(p+=", "+b.eventName(a,i,{brief:!0})),r.createElement(r.Fragment,null,r.createElement(ue,{box:t.box,text_center:p,tooltip:p,side:!0,background:i?e.BACKGROUND_event_absent:e.BACKGROUND_absent,style_center:{color:"#ffffff",textShadow:"0px 0px 1px #000000"},onClick:function(e){return d(e)}}),m&&r.createElement(u,null,i&&r.createElement(r.Fragment,null,r.createElement(C.EventPopup,{eventid:i.id,where:"timetable"})),r.createElement(T.AbsentPopup,{absentid:n.id,where:"timetable"})))}function le(t){var n=t.event,s=t.tvs.dbi,i=x.useSimplePopup(),a=i[0],o=i[1],l=i[2],c=b.eventName(s,n,{brief:!0});return r.createElement(r.Fragment,null,r.createElement(ue,{box:t.box,text_center:c,tooltip:c,side:!0,background:e.BACKGROUND_event,onClick:function(e){return o(e)}}),l&&r.createElement(a,null,r.createElement(C.EventPopup,{where:"subst",eventid:n.id})))}function ce(e){return r.createElement("img",{src:e,style:{verticalAlign:"middle",height:16,width:16,filter:"drop-shadow(0px 0px 3px rgb(255,255,255,0.8))",display:"inline-block"}})}function ue(e){var t=e.box,n=e.side,i=e.je_odpadlo,a=e.je_sel,o=e.text_center,l=e.text_tl,c=e.text_tr,d=e.text_bl,m=e.text_br,b=e.tooltip,f=e.icons_tl||[],_=e.icons_tr||[],h=e.background||"#c0c0c0",g=i?"#808080":"#000000";function y(e){return(e=e.filter(function(e){return e})).length<2?e[0]:r.createElement("div",null,r.createElement(p.RJoin,{children:e,glue:" "}))}return r.createElement(r.Fragment,null,r.createElement(u.RTextBox,s.__assign({},t,{text:o,hAlign:"center",vAlign:"center",style:s.__assign({background:h,color:g,padding:1,fontSize:n?void 0:18,borderRadius:3,cursor:"pointer",border:e.border,whiteSpace:n?"pre":void 0},e.style_center||{}),title:b,onClick:e.onClick})),!n&&r.createElement(r.Fragment,null,(l||0<f.length)&&r.createElement(u.RTextBox,s.__assign({},e.box,{text:y(s.__spreadArrays(f.map(ce),[l])),hAlign:"left",vAlign:"top",style:{color:g,paddingLeft:3,paddingTop:1,fontSize:10,pointerEvents:"none"}})),(c||0<_.length)&&r.createElement(u.RTextBox,s.__assign({},e.box,{text:y(s.__spreadArrays([c],_.map(ce))),hAlign:"right",vAlign:"top",style:{color:g,paddingRight:3,paddingTop:1,fontSize:10,pointerEvents:"none"}})),d&&r.createElement(u.RTextBox,s.__assign({},e.box,{text:d,hAlign:"left",vAlign:"bottom",style:{color:g,paddingLeft:3,paddingBottom:1,fontSize:10,pointerEvents:"none"}})),m&&r.createElement(u.RTextBox,s.__assign({},e.box,{text:m,hAlign:"right",vAlign:"bottom",style:{color:g,paddingLeft:3,paddingBottom:1,fontSize:10,pointerEvents:"none"}}))),a&&r.createElement(v.TTView_CellSelect,{box:t}))}function de(e){var t,n,s,o,c,u=a.client_req,d=e.ttitem,m=e.tvs,p=e.box,f=m.dbi,h=m.table,g=m.id,v=m.dlg,y=m.join_doubles,E=m.show_events,w=m.where,S=m.ti2kolizie,C=(v||{}).moveTTItem,k=x.useSimplePopup(),D=k[0],R=k[1],A=k[2],F=d,L="#c0c0c0",G="classroomsupervision"==F.type?"1px solid black":void 0,U="",q=!1,H=!1,V=e.editing||!1;U=l.susbtTTItemPopis(F,f,"short"),C&&F.id==C.id&&(q=!0),o=l.substTTItem_filter_match(F,h,g),c=!(!F.added&&F.orig)||l.substTTItem_filter_match(F.orig,h,g);var W=null==S?void 0:S.get(d.id);if(o?(L=c?N:j,"classes"==h&&F.orig&&!i.idsArrayMatch(F.teacherids,F.orig.teacherids)&&(L=j)):c&&("teachers"!=h||V?(L=M,H=!0):L=B),F.cancelled)if(F.origofids&&F.origofids.length){L=P;var K=f.rowData("substonline_ttitems",F.origofids[0]);U=u.ttls(3194),K&&(U=K.date!=F.date?u.ttls(3194)+": "+_.date_format_date(u,F.date,!1)+" -> "+_.date_format_date(u,K.date,!1):u.ttls(3194)+": "+f.rowName("periods",F.uniperiod,"short")+" -> "+f.rowName("periods",K.uniperiod,"short"))}else L=M,H=!0,U=u.ls(2322)+": "+l.susbtTTItemPopis(F.orig,f,"short");q&&(L=O),V&&(L=H?M:z),"review"==w&&(L=o?N:M,o&&(0<F.changes.length||0<F.changeeventids.length)&&(G="2px dashed #000"),W&&(W.find(function(e){return e.todo})&&(G="3px dashed #4E7AB5"),o&&W.find(function(e){return!e.todo})&&(G="3px dashed #f00")));var Y="",J="",Z="",$="",X=null;o?X=F:F&&F.orig&&(X=F.orig),o||c||!q||(L="#ff8080"),X&&(Y="classroomsupervision"==X.type?u.ls(1723):f.rowName("subjects",X.subjectid,"short"),"classes"==h?$=f.rowNames("teachers",X.teacherids,"short"):F.classids&&($=f.rowNames("classes",X.classids,"short")),F.groupnames&&!i.DBITools.groupnamesIsEntireClass(X.groupnames)&&(J=f.tools.groupnames_names(X.groupnames)),"classroomsupervision"==X.type&&("classrooms"!=h&&(Z=f.rowNames("classrooms",X.classroomids,"short")),"teachers"!=h&&($=f.rowNames("teachers",X.teacherids,"short"))));var Q=[],ee=[],te="";0<(null===(t=d.changes)||void 0===t?void 0:t.length)&&(te=l.ICON_subst_changelesson),d.cancelled&&(te=l.ICON_subst_cancelled),0<(null===(n=d.origofids)||void 0===n?void 0:n.length)&&(te=l.ICON_subst_moved),d.added&&(te=l.ICON_subst_addlesson),d.origsubstid&&(te=l.ICON_subst_movelesson),te&&Q.push(te),d.ol_is&&ee.push("/static/pics/videocall_16.svg");for(var ne=0,se=d.substids||[];ne<se.length;ne++){var re=se[ne],ie=f.rowData(I,re,{});ie.inote&&(Q.push("/substitution/pics/inote_32.svg"),U+="\n"+f.tools.columnName(I,"inote")+": "+ie.inote)}if(E)for(var ae=0,oe=d.eventids||[];ae<oe.length;ae++){var le=oe[ae];ee.push(b.eventIcon(f,f.rowData("events",le)))}return(null===(s=d.studentsinfo)||void 0===s?void 0:s.subst)&&Q.push("/substitution/pics/subst_students_32.svg"),r.createElement(r.Fragment,null,r.createElement(ue,{box:p,text_center:Y,text_tl:J,text_tr:Z,text_bl:$,icons_tl:Q,icons_tr:ee,tooltip:U,background:L,side:e.side,border:G,je_odpadlo:H,je_sel:q||V,onClick:function(e){e.preventDefault(),V||R(e)}}),A&&r.createElement(D,null,r.createElement(T.SubstTTItemPopup,{where:m.where,closeParent:m.closeParent,ttitem:F,dlg:v,join_doubles:y,kolizie:W})))}function me(e){for(var t=e.box,n=e.teacher_timeoff,i="",o="",l=0,c=S.timeoff_Icons_subst;l<c.length;l++){var d=c[l];d.d==n&&(i=d.img,o=a.client_req.localize(d.name))}return r.createElement(u.RBox,s.__assign({},t,{style:{backgroundColor:"#e0e0e0",borderRadius:3,display:"flex",justifyContent:"center",alignItems:"center"},title:o}),r.createElement("img",{src:i,style:{height:Math.min(t.y2-t.y1-2,16)}}))}e.gridModes=[{id:"periods",name:ASC.ls(6399)},{id:"time",name:ASC.ls(1345)}],e.showSubstTimetableDlg=function(e,t,n,s){return void 0===s&&(s={}),u.RDialog.show(r.createElement(V,{table:t,id:n,date:e,move_substid:s.move_substid,onGoToDate:s.onGoToDate,join_doubles:s.join_doubles}))},(e.SubstTimetableDlg=V).npp=i.neededPartProvider(function(){return[Q,$,{subjects:["name","short","cb_hidden"],teachers:["short","firstname","lastname","approbationids","cb_hidden","classroomid","subst_tt_timeoff_vt"],classes:["changes","name","short","teacherid","classroomid"],classrooms:["name","short","cb_hidden","classids"],igroups:["changes","name","short","teacherid","classroomid"],approbations:["name","short","subjectids","teacherids"],periods:["name","short","period","starttime","endtime"],dayparts:["name","short","daypart","starttime","endtime"],timetables:["changes","name"],tcards:["subjectid","teacherids","classids","classroomids","igroupid","groupnames","period","durationperiods","daypart","starttime","endtime"],events:["date","subId","name","typ","subjectid","teacherids","classids","classroomids","groupnames","period","durationperiods","daypart","starttime","endtime","allday","ctevent","ttcancel"],absent_types:["name","short"],event_types:["name","allday","ctevent","d_ctevent","noclassallclasses","ttcancel"],substonline_dates:["date","tt_num","tt_day","tt_week","tt_term","tcards_subst","is_online","uploaded_int"],substonline_absents:["date","subId","name","absent_typeid","teacherid","classid","classroomid","groupname","table","period","durationperiods","allday","split_entireclass"],substonline_substitutions:["date","subId","absent","card","tcard","classroomsupervision","changes","addcard","addtcard","origid","origofids","cancelled"],substonline_ttitems:["date","subId","type","changes","subjectid","teacherids","classids","classroomids","igroupid","groupnames","endtime","uniperiod","origofids","orig","origsubstid","added","cancelled","substids"]}]}),V.ttdbi={npp:i.neededPartProvider(function(){return[Q.ttdbi,{groups:["classid","name","ascttdivision"],periods:["name","period","starttime","endtime"],breaks:["name","break","starttime","endtime"],custombells:["period","break","day","classids","starttime","endtime"]}]})},e.makeTLR=K,$.npp=i.neededPartProvider(function(){return[se,{substonline_dates:["tt_day"]}]}),(e.getSubstTTItemKolizie=Q).npp=l.substOnlineNeededPartProvider(function(){return[l.substTTItem_absent_match,l.buildSubstOnlineTTItemsEx,{periods:[],teachers:["subst_tt_timeoff"],substonline_dates:["tt_num","tt_term","tt_week","tt_day","is_holiday"],substonline_ttitems:["uniperiod","teacherids","classids","groupnames","classroomids","eventid"],substonline_absents:[],events:["typ","elearn_superid"]}]}),Q.ttdbi={npp:i.neededPartProvider(function(){return[l.ttitem_isClassColision.ttdbi]})},e.jeSubstKoliziaRow=ee,e.jeSubstKolizaAbsent=function(e,t,n){for(var s=0,r=e;s<r.length;s++){var i=r[s];if(i.table==t&&i.id==n&&i.absent)return!0}return!1},se.npp=l.substOnlineNeededPartProvider(function(){return[l.buildSubstOnlineTTItemsEx,b.isEventCancelDay,b.event_tableIds,de,oe,{substonline_ttitems:["eventid"],substonline_dates:["tt_num","tt_day","tt_week","tt_term","is_holiday"]}]}),e.BACKGROUND_absent="#7b7b7b",e.BACKGROUND_event="#d0ffd0",e.BACKGROUND_event_absent="repeating-linear-gradient(-45deg, #87A587, #87A587 5px, #7b7b7b 5px, #7b7b7b 10px)",oe.needed_part=i.typed({absent_types:["__name"],substonline_absents:["date","table","classid","teacherid","classroomid","groupname"]}),de.npp=l.substOnlineNeededPartProvider(function(){return[T.SubstTTItemPopup,b.eventIcon,{substonline_ttitems:["__ttitem","wds","ol_is","studentsinfo"],subjects:["__name"],teachers:["__name"]}]});var pe=(be.prototype.clear=function(){this.items.length=0},be.prototype.addItem=function(e,t,n){void 0===n&&(n={});var s=n.t1,r=n.t2,i=n.wasAligned;if(void 0===s||void 0===r){var a=this.data2t(t);s=a.t1,r=a.t2,i=a.wasAligned}(isNaN(s)||isNaN(r))&&ASC.dieError("0685305852"),this.items.push({data:t,part:e,t1:s,t2:r,wasAligned:i,slices:n.slices||"",order:n.order,r1:0,r2:0,autoside:!1,p1:0,p2:0,q1:0,q2:0})},be.prototype.t2p=function(e){var t=(e-this.tMin)/(this.tMax-this.tMin)*(this.pSize+this.gap);return(t=Math.round(t))<0&&(t=0),t>this.pSize&&(t=this.pSize),"number"==typeof t&&!isNaN(t)||ASC.dieError("5985426422"),t},be.prototype.p2t=function(e){return this.tMin+e/this.pSize*(this.tMax-this.tMin)},be.prototype.item2box=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),{x1:e.p1+t,x2:e.p2+t,y1:e.q1+n,y2:e.q2+n}},be.prototype.initSpan=function(e,t){if(void 0===t&&(t=!0),t){this.rSpan=[];for(var n=0;n<this.rSize;n++)this.rSpan.push(!1)}for(var s=0,r=e;s<r.length;s++){var i=r[s];for(n=i.r1;n+1<i.r2;n++)this.rSpan[n]=!0}},be.prototype.partItems=function(e){return this.items.filter(function(t){return t.part==e})},be.prototype.renderPart=function(e){var t=this.partItems(e);this.initSpan(t),this.rMulti=[],"main"==e&&(this.rMulti.length=this.rSize);for(var n,s=this.gap,r=[],i=0;i<this.rSize;i++)r.push([]);for(var a=function(i){for(n=i;o.rSpan[n];)n++;n++;var a=t.filter(function(e){return e.r1>=i&&e.r1<n});if(0==a.length)return"continue";var l=0,c=o.qSize;if("main"==e||"supervision"==e)for(var u=i;u<n;u++)l=Math.max(l,o.r2qSideTop[u]),c=Math.min(c,o.r2qSideBottom[u]);if("supervision"==e||"supervisionside"==e){var d=c-l;c=Math.round(l+.75*d),l=Math.round(l+.25*d)}if("main"==e&&!a.find(function(e){return!e.slices})){for(var m=!0,p=a[0].slices.length,b=function(e){var t=e.slices;if(t.length!=p&&(m=!1),a.find(function(n){return n!=e&&function(e,t){for(var n=0;n<e.length;n++)if("1"==e[n]&&"1"==t[n])return!0;return!1}(n.slices,t)})&&(m=!1),!m)return"break";for(var n=0;n<t.length;){var r=t.indexOf("1",n);if(r<0)break;(n=t.indexOf("0",r))<0&&(n=t.length),e.q1=Math.round(l+r*(c-l+s)/p),e.q2=Math.round(l+n*(c-l+s)/p-s)}},f=0,_=a;f<_.length&&"break"!==b(v=_[f]);f++);if(m)return"continue"}"top"!=e&&"bottom"!=e||a.sort(function(e,t){return t.t2-t.t1-(e.t2-e.t1)}),"main"==e&&a.sort(function(e,t){return e.order-t.order});for(var h=0,g=a;h<g.length;h++){for(var v=g[h],y=0;;){var E=!1;for(u=v.r1;u<v.r2;u++)r[u][y]&&(E=!0);if(!E)break;y++}for(u=v.r1;u<v.r2;u++)r[u][y]=v}var w=1;for(u=i;u<n;u++)w=Math.max(w,r[u].length);if("top"==e&&(c=w*(o.qSide+s)-s),"bottom"==e){for(var S=!1,x=0,T=o.items;x<T.length;x++)if("main"==(v=T[x]).part&&v.r1<n&&v.r2>i){S=!0;break}l=o.qSize-Math.min(w*(o.qSide+s)-s,Math.round(o.qSize*(S?.5:.8)))}for(u=i;u<n;u++)for(var C=r[u].length,k=0;k<C;k++)if((v=r[u][k])&&v.r1==u){"main"!=e||v.autoside||(o.rMulti[u]=!0);var D=k;"bottom"==e&&(D=w-k-1),v.q1=Math.round(l+D*(c-l+s)/w),v.q2=Math.round(l+(D+1)*(c-l+s)/w-s)}},o=this,l=0;l<this.rSize;l=n)a(l);if("top"==e)for(var c=0,u=t;c<u.length;c++)for(i=(p=u[c]).r1;i<p.r2;i++)this.r2qSideTop[i]=Math.max(this.r2qSideTop[i],p.q2+s);if("bottom"==e)for(var d=0,m=t;d<m.length;d++){var p;for(i=(p=m[d]).r1;i<p.r2;i++)this.r2qSideBottom[i]=Math.min(this.r2qSideBottom[i],p.q1-s)}},be.prototype.render=function(){for(var e=this,t=new Set,n=0,r=this.items;n<r.length;n++){var i=r[n];t.add(i.t1),t.add(i.t2)}this.r2t=[],t.forEach(function(t){return e.r2t.push(t)}),this.r2t.sort(function(e,t){return e-t}),this.rSize=this.r2t.length,this.t2r=new Map,this.r2qSideTop=[],this.r2qSideBottom=[];for(var a=0;a<this.rSize;a++)this.t2r.set(this.r2t[a],a);for(var o=0,l=this.items;o<l.length;o++)(i=l[o]).r1=this.t2r.get(i.t1),i.r2=this.t2r.get(i.t2),"supervisionside"==i.part&&(i.r2=i.r1+1,this.rSize=Math.max(this.rSize,i.r2));for(var c=new Map,u=0,d=s.__spreadArrays(this.partItems("autotop"),this.partItems("autobottom"));u<d.length;u++)i=d[u],c.set(i,"autotop"==i.part?"top":"bottom"),i.part="main",i.autoside=!0;for(var m=function(t){for(var n=0;n<p.rSize;n++)p.r2qSideTop[n]=0,p.r2qSideBottom[n]=p.qSize;if(p.renderPart("top"),p.renderPart("bottom"),p.renderPart("main"),1==t){var s=!1;if(c.forEach(function(t,n){for(var r=n.r1;r<n.r2;r++)if(e.rMulti[r]){n.part=t,s=!0;break}}),!s)return"break"}},p=this,b=1;b<=2&&"break"!==m(b);b++);this.renderPart("supervision"),this.renderPart("supervisionside");for(var f=0,_=this.partItems("overlay");f<_.length;f++)(i=_[f]).q1=0,i.q2=this.qSize;for(var h=0,g=this.items;h<g.length;h++){if((i=g[h]).p1=this.t2p(i.t1),i.p2=this.t2p(i.t2)-this.gap,"supervisionside"==i.part){var v=this.t2p((i.t1+i.t2)/2),y=this.qSide,E=this.pSize,w=v-y/2;w=Math.max(w,0),w=Math.min(w,E-y),i.p1=w,i.p2=w+y}i.p2<i.p1&&(i.p2=i.p1)}},be.prototype.renderOrderItems=function(){return s.__spreadArrays(this.partItems("top"),this.partItems("bottom"),this.partItems("main"),this.partItems("supervision"),this.partItems("supervisionside"),this.partItems("overlay"))},be);function be(e,t,n,s){this.pSize=e,this.qSize=t,this.tMin=n,this.tMax=s,this.items=[],this.gap=1,this.qSide=14,this.data2t=null,this.rSize=0,this.t2r=null,this.r2t=null,this.r2qSideTop=null,this.r2qSideBottom=null,this.rSpan=null,this.rMulti=null}function fe(e,t){for(var n=_e(e,t),s=1,r=1,a=[0],o=[0],c=0,u=e.tableData("periods");c<u.length;c++){var d=u[c],m=parseInt(d.id);s=Math.min(s,m),r=Math.max(r,m+1);var p=l.time2int(d.starttime),b=l.time2int(d.endtime);a[m]=p,o[m]=b}function f(e,t){for(var n=0;n<a.length;n++)if(!(e>o[n])){if(e<a[n])return n;var i=o[n]-a[n];return 0<i?(e-a[n])/i+n:n}return t?r:s}return n.maxT>o[o.length-1]&&(m=o.length,a[m]=o[o.length-1],o[m]=n.maxT,r=Math.max(r,m+1)),{minT:s,maxT:r,t:function(e){var t=e.uniperiod;if(t)switch(i.DBITools.typeOfUniPeriod(t)){case"period":var s=parseInt(t);return"classroomsupervision"==e.type?{t1:s+.25,t2:s+.75}:{t1:s,t2:s+(e.durationperiods||1)};case"break":var r=parseInt(t.substr(1));return{t1:r-.25,t2:r+.25}}var a=n.t(e);return{t1:f(a.t1,!1),t2:f(a.t2,!0)}}}}function _e(e,t){var n=e.table("periods"),s=e.table("breaks"),r=e.table("dayparts");return{minT:420,maxT:1080,t:function(e){var t=e.uniperiod;if(t)switch(i.DBITools.typeOfUniPeriod(t)){case"period":var a=null;if(u=n.rowData(t))return 2<=e.durationperiods&&(a=n.rowData(parseInt(t)+e.durationperiods-1+"")),{t1:l.time2int(u.starttime),t2:l.time2int((a||u).endtime)};break;case"break":var o=t.substr(1),c=s.rowData(o);if(c)return{t1:l.time2int(c.starttime),t2:l.time2int(c.endtime)};var u=n.rowData(o),d=n.rowData(""+(parseInt(o)-1));if(u&&d)return{t1:l.time2int(d.endtime),t2:l.time2int(u.starttime)};break;case"daypart":var m=r.rowData(t);if(m)return{t1:l.time2int(m.starttime),t2:l.time2int(m.endtime)};break;case"starttime":var p=l.time2int(t);return{t1:p,t2:e.endtime?l.time2int(e.endtime):p+5}}return{t1:0,t2:0}}}}e.TimetableLayoutRenderer=pe,e.TTLR_TProvider_periods=fe,e.TTLR_TProvider_time=_e,(e.TTLR_TProvider_uni=function(e,t,n){return"time"==e?_e(t):fe(t,n)}).needed_part=i.typed({periods:["starttime","endtime"],breaks:[],dayparts:["starttime","endtime"]}),(e.SubstDlgTimetableView=function(e){var t=e.dbi,n=e.tt_dbi,i=e.date,a=e.items,o=e.onPeriodClick,c=e.kolizie,d=e.join_doubles,m=e.small,p=e.ti2kolizie,b=e.remove_ttitemids||[],f=e.editing_ttitems||[],_=t.req,h=u.useClientSize(),g=h[0],y=h[1],E=h[2],w=u.useColors(),S=m?50:80,x=g-S-1,T=y-40-1,C=K(t,n,"substonline_dates",!1,x,40);function k(e){return{y1:Math.round(e*T/a.length),y2:Math.round((e+1)*T/a.length)}}C.gap=1,C.pSize=x;var D={where:e.where,closeParent:e.closeParent,dbi:t,tt_dbi:n,date:i,table:"",id:"",tlr:C,width:g,height:y,gap:1,gap_row:4,dayWidth:S,periodHeight:40,row2y:k,nRows:a.length,ti2kolizie:e.ti2kolizie,show_events:!0,join_doubles:d},I=r.useMemo(function(){var e=new Set;return p&&p.forEach(function(t){for(var n=0,s=t;n<s.length;n++){var r=s[n],i=r.table+":"+r.id;e.add(i)}}),[e]},[p])[0],R={x1:S,x2:S+x,y1:40,y2:40+T},A={x1:R.x1,x2:R.x2+1,y1:R.y1,y2:R.y2+1},N={x1:R.x1,x2:R.x2,y1:0,y2:40};return r.createElement("div",{ref:E,style:s.__assign({position:"relative",backgroundColor:w.bgWhite},e.style||{})},r.createElement(v.TTView_OuterLines,{outerBox:A}),r.createElement(v.TTView_Periods,{periodsBox:N,dbi:t,tlr:C,onPeriodClick:o}),r.createElement(u.RBox,{x1:0,x2:S,y1:40,y2:y},a.map(function(e,n){var s=e.table,i=e.id,a=k(n),o=a.y1,u=a.y2,d="",m="";if(c&&ee(c,s,i)&&(m=ee(c,s,i,!0)?(d=l.ICON_subst_kolizia,_.ttls(3447)):(d=l.ICON_subst_spojenie,_.ttls(1535))),p){var b=s+":"+i;I.has(b)&&(d=l.ICON_subst_kolizia,m=_.ttls(3447))}return r.createElement(v.TTView_Object,{key:s+":"+i,box:{x1:0,x2:S,y1:o,y2:u},dbi:t,table:s,id:i,splitLineTop:0<n,showTable:!0,icon:d,icon_tooltip:m})})),r.createElement(u.RBox,s.__assign({},R,{style:{overflow:"visible"}}),a.map(function(e,t){var n=e.table,i=e.id,a=k(t),o=a.y1,l=a.y2;return r.createElement(se,s.__assign({},{key:n+":"+i,tvs:s.__assign(s.__assign({},D),{table:n,id:i}),ttWidth:x,y1:o,y2:l,gap_row:4,remove_ttitemids:b,editing_ttitems:f}))})))}).npp=i.neededPartProvider(function(){return[se,m.TTItemTimeProvider,{periods:["__name","period","starttime","endtime"]}]}),e._hotswap=[ie]},"/asc/svg.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("./asc_react");function a(e,t){return void 0===t&&(t=null),$j(function(e,t){return void 0===t&&(t=null),(t=t||document).createElementNS("http://www.w3.org/2000/svg",e)}(e,t))}function o(e){return e.get(0).getBBox()}var l=1,c=(u.prototype.Padded=function(e){var t=a("g",this.page_document).appendTo(this.$page);t.attr("transform","translate("+e+" "+e+")");var n=new u(t);return n.width=this.width-2*e,n.height=this.height-2*e,n},u.prototype.SvgEl=function(e,t){var n=a(e,this.page_document);return t&&n.appendTo(t),n},u.prototype.Line=function(e,t,n,s,r){return this.SvgEl("line",this.$page).attr({x1:e,y1:t,x2:n,y2:s,"stroke-width":r*this.extraScale})},u.prototype.LineP=function(e,t,n){return this.Line(e.x,e.y,t.x,t.y,n)},u.prototype.CurvedLine=function(e,t,n){var s=t.sub(e).rotate(Math.PI/2).mul(.1),r=e.midPointTo(t,.2).add(s),i=e.midPointTo(t,.8).add(s);return this.SvgEl("path",this.$page).attr({d:"M"+e.svgStr()+" C "+r.svgStr()+","+i.svgStr()+","+t.svgStr(),"stroke-width":n*this.extraScale,fill:"none"})},u.prototype.Arrow=function(e,t,n,s,r){var i=this;void 0===r&&(r="forward");var a,o,l=Math.PI/6,c=l,u=-l;a=function(e,t){return i.CurvedLine(e,t,s)},o=-.4;var d=t.sub(e).normalized().mul(n),m=a(e,t);return"forward"!=r&&"bidi"!=r||(m=m.add(a(t.sub(d.rotate(c+o)),t)).add(a(t,t.sub(d.rotate(u+o)))).attr("stroke-linecap","round")),"back"!=r&&"bidi"!=r||(m=m.add(a(e.add(d.rotate(c-o)),e)).add(a(e,e.add(d.rotate(u-o)))).attr("stroke-linecap","round")),m.css({"pointer-events":"none"}),this.Group(m)},u.prototype.Group=function(e){return this.SvgEl("g",this.$page).append(e)},u.prototype.Line_swap=function(e,t,n,s,r,i){return e?this.Line(n,t,r,s,i):this.Line(t,n,s,r,i)},u.prototype.FixFont=function(e){return 0<=["arial","courier","times new roman"].indexOf(e.toLowerCase())?e:e+",Arial"},u.prototype.Rect=function(e,t,n){var s=a("rect",this.page_document).attr({x:e.x1,y:e.y1,width:e.width(),height:e.height(),style:"fill:"+t}).appendTo(this.$page);return 0<n?s.attr("stroke-width",n*this.extraScale):s.attr("stroke","none"),s},u.prototype.TextBox=function(e,t,n,s,r,i){void 0===s&&(s=0),void 0===r&&(r=0),void 0===i&&(i={}),t=Math.min(t,e.height());var c=a("text",this.page_document).attr({"font-size":t,"text-rendering":"geometricPrecision","text-anchor":s<0?"start":0<s?"end":"middle","dominant-baseline":r<0?"text-before-edge":0<r?"text-after-edge":"central"}).appendTo(this.$page).css("pointer-events","none").css("white-space","pre").text(n);i.bold&&c.css("font-weight","bold"),i.italic&&c.css("font-style","italic"),i.underline&&c.css("text-decoration","underline"),i.font&&c.css("font-family",this.FixFont(i.font));var u=c[0];t>e.height()&&(t=e.height(),c.attr("font-size",t));var d=e.width(),m=e.height(),p=1,b=u.getComputedTextLength();if(d<b)if(i.wrap){for(var f=[],_=0;_<n.length;){for(var h=_,g=!1;h<n.length;){var v=h+1;if(g||(v=n.indexOf(" ",v))<0&&(v=n.length),u.getSubStringLength(_,v-_)>d){if(_<h)break;if(g){h=n.length;break}g=!0,h=_}else h=v}for(f.push(n.substring(_,h).trim()),_=h;" "==n.charAt(_);)_++}c.empty();for(var y=0,E=f;y<E.length;y++){var w=E[y],S=a("tspan",this.page_document).appendTo(c).text(w);w!=f[0]&&S.attr({dy:t})}p=f.length}else i.shrink&&(t=t*d/b,c.attr("font-size",t));if((1<p?c.find("tspan"):c).attr("x",e.x1+(1+s)*d/2),c.attr("y",e.y1+(1+r)*(m-(p-1)*t)/2),0<=["edge","ie11","ie10"].indexOf(ASC.browser)){var x=o(c);c.attr("y",parseFloat(c.attr("y"))+e.y1-x.y+(e.height()-x.height)*(1+r)/2)}if(i.clip&&((x=o(c)).width>d||x.height>m)){var T="CP_"+l++,C=a("clipPath",this.page_document).appendTo(this.$page).attr("id",T);a("rect",this.page_document).appendTo(C).attr({x:e.x1,y:e.y1,width:d,height:m}),c.attr("clip-path","url(#"+T+")")}return this.rtl&&(x=o(c),c.attr({transform:"scale(-1 1) translate("+(-2*x.x-x.width)+")"})),c},u.prototype.Image=function(e,t,n,s){void 0===n&&(n=0),void 0===s&&(s=0);var r=a("image",this.page_document),i=document.createAttributeNS("http://www.w3.org/1999/xlink","href");i.nodeValue=t,r[0].attributes.setNamedItemNS(i),r.appendTo(this.$page).attr({x:e.x1,y:e.y1});var l=e.width(),c=e.height();if(n||s){var u=o(r),d=function(){var t=Math.min(l/u.width,c/u.height);l=u.width*t,c=u.height*t,0==n?r.attr("width",e.width()):0<n&&r.attr({x:e.x2-l,width:l}),0==s?r.attr("height",e.height()):0<n&&r.attr({y:e.y2-c,width:c})};u.width?d():r.load(function(){u=o(r),d()})}else r.attr({width:l,height:c});if(this.rtl){var m=o(r);r.attr({transform:"scale(-1 1) translate("+(-2*m.x-m.width)+")"})}return r},u.prototype.Tootlip=function(e,t){a("title",this.page_document).text(t).prependTo(e)},u.prototype.ShadowFilter=function(e,t,n){void 0===e&&(e=3),void 0===t&&(t=2),void 0===n&&(n=2);var s="filter_"+l++;return this.SvgEl("filter",this.$defs).attr({id:s}).html('<feGaussianBlur in="SourceAlpha" stdDeviation="'+e+'"/><feOffset dx="'+t+'" dy="'+n+'" result="offsetblur"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>'),"url(#"+s+")"},u.drawToDiv=function(e){e.empty();var t=e.width(),n=e.height(),s=new u($j("<svg style=''>").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("width",t).attr("height",n).attr("stroke","#000000").attr("stroke-width","0").attr("fill","#000000").appendTo(e));return s.width=t,s.height=n,s},u);function u(e){this.$page=e,this.extraScale=1,this.width=0,this.height=0,this.rtl=!1,this.$defs=null,this.page_document=e[0].ownerDocument,this.$defs=a("defs",this.page_document).appendTo(this.$page)}e.SvgDC=c;var d=(m.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},m.prototype.add=function(e){return new m(this.x+e.x,this.y+e.y)},m.prototype.sub=function(e){return new m(this.x-e.x,this.y-e.y)},m.prototype.mul=function(e){return new m(this.x*e,this.y*e)},m.prototype.normalized=function(){return this.mul(1/this.length())},m.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e);return new m(this.x*t-this.y*n,this.y*t+this.x*n)},m.prototype.midPointTo=function(e,t){void 0===t&&(t=.5);var n=1-t;return new m(this.x*n+e.x*t,this.y*n+e.y*t)},m.prototype.svgStr=function(){return this.x+" "+this.y},m);function m(e,t){this.x=e,this.y=t}e.CPoint=d;var p=(b.prototype.swap=function(e){return void 0===e&&(e=!0),b.swap(e,this.x1,this.y1,this.x2,this.y2)},b.swap=function(e,t,n,s,r){return e?new b(n,t,r,s):new b(t,n,s,r)},b.prototype.width=function(){return this.x2-this.x1},b.prototype.height=function(){return this.y2-this.y1},b.prototype.center=function(){return new d((this.x1+this.x2)/2,(this.y1+this.y2)/2)},b.prototype.move=function(e,t){return new b(this.x1+e,this.y1+t,this.x2+e,this.y2+t)},b.prototype.pad_rel=function(e,t){return void 0===t&&(t=e),this.pad_abs(this.width()*e,this.height()*t)},b.prototype.pad_abs=function(e,t){return void 0===t&&(t=e),new b(this.x1+e,this.y1+t,this.x2-e,this.y2-t)},b.prototype.sliceY=function(e,t){var n=this.height();return new b(this.x1,this.y1+e*n/t,this.x2,this.y1+(e+1)*n/t)},b.prototype.contains=function(e){return e.x>=this.x1&&e.x<=this.x2&&e.y>=this.y1&&e.y<=this.y2},b);function b(e,t,n,s){this.x1=e,this.y1=t,this.x2=n,this.y2=s}function f(e){return r.createElement("line",{x1:e.p1.x,y1:e.p1.y,x2:e.p2.x,y2:e.p2.y,stroke:e.stroke})}function _(e){var t=e.p1,n=e.p2,s=n.sub(t).rotate(Math.PI/2).mul(.1),i=t.midPointTo(n,.2).add(s),a=t.midPointTo(n,.8).add(s);return r.createElement("path",{d:"M"+t.svgStr()+" C "+i.svgStr()+","+a.svgStr()+","+n.svgStr(),fill:"none"})}e.CRect=p,e.RSvgLine=f,e.RSvgCircle=function(e){var t=e.center,n=e.radius;return r.createElement("circle",s.__assign({cx:t.x,cy:t.y,r:n},{stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill}))},e.RSvgCurvedLine=_,e.RSvgArrow=function(e){var t,n,s=e.p1,a=e.p2,o=e.head_size,l=e.typ||"forward",c=Math.PI/6,u=c,d=-c;t=_,n=-.4,"forward"!=l&&"bidi"!=l||console.log("bundle_subst.min.js forward on 7055",l);var m=a.sub(s).normalized().mul(o);return r.createElement(i.Fragment,null,r.createElement(t,{p1:s,p2:a}),("forward"==l||"bidi"==l)&&r.createElement(i.Fragment,null,r.createElement(t,{p1:a.sub(m.rotate(u+n)),p2:a}),r.createElement(t,{p1:a,p2:a.sub(m.rotate(d+n))})),("back"==l||"bidi"==l)&&r.createElement(i.Fragment,null,r.createElement(t,{p1:s.add(m.rotate(u-n)),p2:s}),r.createElement(t,{p1:s,p2:s.add(m.rotate(d-n))})))}},"/timetable/ttitem.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../rpr/dbi"),i=(a.prototype.setDate=function(e,t){var n=e&&null!=e.tt_day?""+e.tt_day:"";n==this.day&&t==this.tt_dbi&&0<this.up_data.size||(this.day=n,this.tt_dbi=t,this.initDate())},a.prototype.setDateAsync=function(e){return s.__awaiter(this,void 0,void 0,function(){var t,n,r;return s.__generator(this,function(s){switch(s.label){case 0:return e==this.date?[3,4]:(this.date=e,t=this.dbi.rowData("dates",e),this.day=null!=t.tt_day?""+t.tt_day:"",n=this,t.tt_num?[4,this.dbi.timetabledbi(t.tt_num)]:[3,2]);case 1:return r=s.sent(),[3,3];case 2:r=null,s.label=3;case 3:n.tt_dbi=r,this.initDate(),s.label=4;case 4:return[2]}})})},a.prototype.ensure_up=function(e){var t=this.up_data,n=t.get(e);return n||(n={starttime:"",endtime:"",cbs:[]},t.set(e,n)),n},a.prototype.initDate=function(){var e=this.up_data,t=this.dbi,n=this.tt_dbi;e.clear();for(var s=0,r=t.tableData("periods");s<r.length;s++){var i=(d=r[s]).id;(m=this.ensure_up(i)).starttime=d.starttime,m.endtime=d.endtime}for(var a=0,o=t.tableData("dayparts");a<o.length;a++){var l=o[a];i=l.id,(m=this.ensure_up(i)).starttime=l.starttime,m.endtime=l.endtime}if(n){for(var c=0,u=n.tableData("periods");c<u.length;c++){i=(d=u[c]).id;var d,m=this.ensure_up(i);d.starttime&&(m.starttime=d.starttime,m.endtime=d.endtime)}for(var p=0,b=n.tableData("breaks");p<b.length;p++){var f=b[p];i="b"+f.id,m=this.ensure_up(i),f.starttime&&(m.starttime=f.starttime,m.endtime=f.endtime)}for(var _=0,h=n.tableData("custombells");_<h.length;_++){var g=h[_];i=g.period,g.break&&(i="b"+g.break),(m=e.get(i))&&m.cbs.push(g)}}},a.prototype.provide=function(e){var t=this.up_data,n=this.day,i=e.uniperiod;if("ad"==i)return{starttime:"00:00",endtime:"24:00"};function a(e){return{starttime:e.starttime,endtime:e.endtime}}if(e.durationperiods&&1<e.durationperiods&&"period"==r.DBITools.typeOfUniPeriod(i)){var o=s.__assign(s.__assign({},e),{durationperiods:null}),l=this.provide(o);o.uniperiod=""+(parseInt(e.uniperiod)+e.durationperiods-1);var c=this.provide(o);return{starttime:l.starttime,endtime:c.endtime}}if(g=t.get(i)){if(0<g.cbs.length){for(var u=e.lessonid,d=0<=e.classids.length?e.classids[0]:"",m=null,p=-1,b=0,f=g.cbs;b<f.length;b++){var _=f[b],h=0;if(_.day){if(_.day!=n)continue;h+=1}if(u&&0<=_.lessonids.indexOf(u))h+=100;else if(0<_.classids.length){if(!d)continue;if(_.classids.indexOf(d)<0)continue;h+=10}p<h&&(m=_,p=h)}if(m)return a(m)}return a(g)}if(5==i.length&&"-"==i[2])return{starttime:i.substr(0,2)+":"+i.substr(3,2),endtime:e.endtime||""};var g=this.ensure_up(i);if("b"==i[0]){var v=t.get(""+(parseInt(i.substr(1))-1)),y=t.get(i.substr(1));y&&(g.endtime=y.starttime,g.starttime=v?v.endtime:function(e){if(e<0)return"";var t=e%60,n=(e-t)/60;return(n<10?"0":"")+n+":"+(t<10?"0":"")+t}(function(e){return e?60*parseInt(e.substr(0,2))+parseInt(e.substr(3,2)):-1}(g.endtime)-5))}return a(g)},a.prototype.fill=function(e,t){var n=this.provide(t);e.starttime=n.starttime,e.endtime=n.endtime},a.ttitem_needed_columns=["subjectid","classids","teacherids","groupnames","igroupid","studentids","groupsubjectids"],a.needed_part={periods:["period","starttime","endtime"],dayparts:["daypart","starttime","endtime"],dates:["tt_day","tt_num"]},a.tt_dbi_needed_part={periods:["starttime","endtime"],breaks:["starttime","endtime"],custombells:["day","period","break","classids","lessonids","starttime","endtime"]},a);function a(e){this.dbi=e,this.date="",this.tt_dbi=null,this.day="",this.up_data=new Map}function o(e,t){if(!t)return!1;if(t==e.uniperiod)return!0;if("ad"==e.uniperiod)return!0;if("ad"==t)return!0;if("period"!=r.DBITools.typeOfUniPeriod(t)||"period"!=r.DBITools.typeOfUniPeriod(e.uniperiod))return!1;var n=parseInt(t),s=parseInt(e.uniperiod),i=s+(e.durationperiods||1)-1;return s<=n&&n<=i}function l(e,t){return"ad"==e.uniperiod||"ad"!=t&&o(e,t)}e.TTItemTimeProvider=i,e.ttitemFromData=function(e){for(var t={uniperiod:e.uniperiod||r.DBITools.getUniPeriod(e),subjectid:e.subjectid||"",classids:e.classids||[],groupnames:e.groupnames||[],teacherids:e.teacherids||[]},n=0,s=["date","classroomids","groupsubjectids","starttime","endtime","durationperiods","studentids","igroupid","eventid"];n<s.length;n++){var i=s[n];void 0!==e[i]&&(t[i]=e[i])}return t},e.ttitemTableIds=function(e,t){switch(t){case"classes":return e.classids;case"teachers":return e.teacherids;case"classrooms":return e.classroomids;case"igroups":return e.igroupid?[e.igroupid]:[];case"subjects":return e.subjectid?[e.subjectid]:[]}return[]},e.ttitemFilterMatch=function(e,t,n){if(!n)return!1;switch(t){case"classes":return 0<=e.classids.indexOf(n);case"teachers":return 0<=e.teacherids.indexOf(n);case"classrooms":return 0<=e.classroomids.indexOf(n);case"igroups":return e.igroupid==n;case"subjects":return e.subjectid==n;case"students":return e.studentids&&0<=e.studentids.indexOf(n)}return!1},e.ttitemUniperiodMatchSimple=o,e.ttitemUniperiods=function(e){var t=e.uniperiod,n=e.durationperiods;if("period"==r.DBITools.typeOfUniPeriod(t)&&1<e.durationperiods){for(var s=parseInt(t),i=s+n-1,a=[],o=s;o<=i;o++)a.push(""+o);return a}return[t]},e.ssUniperiodMatch=l,e.ssTTItemMatch=function(e,t){return!!l(e,t.uniperiod)&&!!e.moveto.find(function(e){return e.subjectid==t.subjectid&&t.classids.includes(e.classid)&&t.groupnames.includes(e.groupname)})},e.sortTTItemClass=function(e,t,n){function s(t){var n=t.classids[0];if(n)return e.rowIndex("classes",n);var s=t.igroupid;return s?1e3+e.rowIndex("igroups",s):2e3}return s(t)-s(n)},(e.ttitemFromTCard=function(e,t){var n={uniperiod:r.DBITools.getUniPeriod(t),durationperiods:t.durationperiods,endtime:t.endtime,subjectid:t.subjectid,classids:t.classids,groupnames:t.groupnames,igroupid:t.igroupid,teacherids:t.teacherids,classroomids:t.classroomids,groupsubjectids:t.groupsubjectid?[t.groupsubjectid]:[]};if(t.groupsubjectid){var s=e.rowData("groupsubjects",t.groupsubjectid);s&&(n.subjectid=s.subjectid,n.classids=s.classids,n.groupnames=[s.groupname],n.igroupid=s.igroupid,s.entireclass||(n.studentids=s.studentids))}return n}).needed_part=r.typed({tcards:["period","durationperiods","starttime","daypart","subjectid","classids","groupnames","igroupid","teacherids","classroomids"],groupsubjects:["classids","groupname","igroupid","studentids","entireclass"]})},"/dashboard/dbi_events.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../rpr/dbi");function i(e,t){if("boolean"==typeof t.ctevent)return t.ctevent;var n=e.rowData("event_types",t.typ);return!(!n||!n.ctevent&&!n.d_ctevent)}function a(e,t){for(var n=[],i=0,a=t.classids;i<a.length;i++){var o=a[i],l=e.rowData("classes",o),c=(l=l&&r.DBITools.rowApplyChanges(l,t.date))?l.teacherid:"";c?n.push(s.__assign(s.__assign({},t),{classids:[o],teacherids:[c]})):n.push(s.__assign(s.__assign({},t),{classids:[o],teacherids:[]}))}return n}function o(e,t){if("boolean"==typeof t.ttcancel)return t.ttcancel;var n=e.rowData("event_types",t.typ);return!(!n||!n.ttcancel&&!n.d_ttcancel)}function l(e,t){var n;if(0<t.classids.length||0<(null===(n=t.igroupids)||void 0===n?void 0:n.length))return!1;var s=e.rowData("event_types",t.typ);return!!s&&s.noclassallclasses}e.TABLE_events="events",e.eventMainColumns=["date","subId","typ","name","subjectid","classids","groupnames","teacherids","classroomids","period","durationperiods","starttime","endtime","allday"],e.TABLE_event_types="event_types",e.eventTypeMainColumns=["name","color","ctevent","d_ctevent"],(e.event_tableIds=function(e,t,n){switch(void 0===n&&(n={}),t){case"classes":return e.classids;case"teachers":if(n.expand_ctevent){var s=n.dbi;if(i(s,e)){for(var a=[],o=0,l=e.classids;o<l.length;o++){var c=l[o],u=s.rowData("classes",c);if(u){var d=n.date||e.date;d&&(u=r.DBITools.rowApplyChanges(u,d)),u.teacherid&&!a.includes(u.teacherid)&&a.push(u.teacherid)}}return a}}return e.teacherids;case"classrooms":return e.classroomids;case"subjects":return e.subjectid?[e.subjectid]:[]}return[]}).npp=r.neededPartProvider(function(){return[i,{events:["classids","teacherids","classids","subjectid"],classes:["teacherid","changes"]}]}),(e.isClassTeacherEvent=i).needed_part=r.typed({events:["ctevent"],event_types:["ctevent","d_ctevent"]}),(e.eventTeacherids=function(e,t){if(i(e,t)){for(var n=s.__spreadArrays(t.teacherids),a=0,o=t.classids;a<o.length;a++){var l=o[a],c=e.rowData("classes",l),u=(c=c&&r.DBITools.rowApplyChanges(c,t.date))?c.teacherid:"";u&&n.indexOf(u)<0&&n.push(u)}return n}return t.teacherids}).npp=r.neededPartProvider(function(){return[i,{events:["teacherids","classids"],classes:["teacherid","changes"]}]}),(e.splitClassTeacherEvent=a).needed_part=r.typed({classes:["teacherid","changes"],events:["classids"]}),(e.splitClassTeacherEvents=function(e,t){for(var n=[],s=0,r=t;s<r.length;s++){var o=r[s];if(i(e,o))for(var l=0,c=a(e,o);l<c.length;l++){var u=c[l];n.push(u)}else n.push(o)}return n}).needed_part=r.DBITools.mergeNeededParts(i,a),(e.isTTCancelEvent=o).needed_part=r.typed({events:["typ","ttcancel"],event_types:["ttcancel","d_ttcancel"]}),(e.isEntireSchoolEvent=l).needed_part=r.typed({events:["typ","classids","igroupids"],event_types:["noclassallclasses"]}),e.isAllClassesEvent=l,(e.isEventCancelDay=function(e,t){var n=e.rowData("event_types",t.typ);return!!n&&n.ttcancel&&n.noclassallclasses&&0==t.classids.length&&0==t.igroupids.length&&(n.allday||t.allday)}).needed_part=r.typed({events:["typ","classids","igroupids","allday"],event_types:["ttcancel","noclassallclasses","allday"]}),(e.isAttachEvent=function(e,t){var n=e.rowData("event_types",t.typ);return!(!n||!n.attachevent&&"testing"!=n.id&&"testing"!=n.categoryid||o(e,t))}).npp=r.neededPartProvider(function(){return[{events:["typ"],event_types:["attachevent","categoryid"]},o]}),(e.attachEventMatch=function(e,t){return!(t.subjectid!=e.subjectid||!r.idsIsOverlap(t.classids,e.classids)||!r.DBITools.groupnamesIsEntireClass(e.groupnames)&&!r.idsIsOverlap(t.groupnames,e.groupnames)||e.period&&t.uniperiod!=e.period)}).needed_part=r.typed({dailyplan:["subjectid","classids","groupnames","uniperiod"],events:["subjectid","classids","groupnames","period"]}),(e.eventCanAddStudentsAbsents=function(e,t){if(t.allday&&!o(e,t))return!1;var n=e.rowData("event_types",t.typ);return n?n.attendance||n.lesson||!1:(ASC.logProblem("0667782150"),!1)}).needed_part=r.DBITools.mergeNeededParts(o,{event_types:["attendance","lesson"]}),(e.eventHasSaConfirm=function(e,t){var n=e.rowData("event_types",t.typ);return n||console.log("event typ error",t),n&&n.attendance&&t.date>new Date(e.req.isAscDevelop()?"2020-02-01":"2020-03-01").toISOString()}).needed_part=r.typed({event_types:["attendance"]}),(e.eventPrivacy=function(e,t){if(t.privacy)return t.privacy;var n=e.rowData("event_types",t.typ);return n?n.privacy:""}).needed_part=r.typed({events:["privacy"],event_types:["privacy"]}),(e.eventName=function(e,t,n){void 0===n&&(n={});var s=t.name,r=e.rowName("event_types",t.typ);return n.brief?s||r:r+(s?": "+s:"")}).needed_part=r.typed({events:["name","typ"],event_types:["name"]}),(e.eventIcon=function(e,t,n){var s;void 0===n&&(n={});var r=t.typ;return r=(null===(s=e.rowData("event_types",r))||void 0===s?void 0:s.templateid)||r,["testing","bexam","exam","sexam","oexam","rexam","pexam"].includes(r)?"/exam/pics/hw/"+r+"_c1.png":["ttcancel","holiday","sholiday","freeday","distant","parentsevening","meeting","bmeeting","bookroom","changeroom","trip","culture","excursion","other_safety"].includes(r)?"/calendar/pics/event_types/"+r+"_32.svg":["lesson","plesson","rlesson","ctlesson"].includes(r)?"/static/pics/ui/subject_32.svg":e.table("events").icon()}).npp=r.neededPartProvider(function(){return[{events:["typ"],event_types:["templateid"]}]}),e.eventTypeOrCategory=function(e,t){return 0<=t.indexOf(e.id)||0<=t.indexOf(e.categoryid)||0<=t.indexOf(e.templateid)}},"/substitution/online/combo.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../../rpr/dbi"),i=t("./timetable"),a=t("../../timetable/timeoff_r"),o=t("./settings"),l=t("../subst"),c=t("../../asc/lib_date"),u=t("../filter");function d(e){var t,n=e.table,l=e.ttitem,d=e.dbi,m=e.tt_dbi,p=e.remove_ttitemids,b=e.filter,f=l.date,_=c.date_month(f),h=[],g="?",v=l;if(l.cancelled&&(v=s.__assign(s.__assign(s.__assign({},l),{cancelled:!1}),l.orig)),"teachers"==n){for(var y=0,E=d.tableData(n);y<E.length;y++)(_e=E[y]).dateto&&_e.dateto<f||h.push({id:_e.id,debug_name:d.rowName(n,_e.id),cb_hidden:_e.cb_hidden,subst_hidden:_e.subst_hidden});g="teacherids"}if("classrooms"==n){for(var w=0,S=d.tableData(n);w<S.length;w++){var x=S[w];h.push({id:x.id,cb_hidden:x.cb_hidden})}g="classroomids"}if(b&&u.isSubstFilterOn(b)){for(var T=new Set,C=0,k=u.substFilterRows(d,b,n,d.tableData(n));C<k.length;C++){var D=k[C];T.add(D.id)}for(var I=0,R=h;I<R.length;I++){var A=R[I];T.has(A.id)||(A.filter_out=!0)}}for(var N=function(e){var t=d.rowData("subjects",e);return!t||!t.subst_join_forbidden},B=0,j=h;B<j.length;B++){A=j[B];var P=i.getSubstTTItemKolizie(d,m,s.__assign(s.__assign({},v),((t={})[g]=[A.id],t)),p);if(A.fb=i.jeSubstKolizaAbsent(P,n,A.id),i.jeSubstKoliziaRow(P,n,A.id)){var M=!1;if("teachers"==n&&N(l.subjectid))for(var O=0,z=P;O<z.length;O++){var F=z[O];if(F.table==n&&F.id==A.id){if(!F.join||!N(F.subjectid)){M=!1;break}M=!0}}M?A.fj=!0:A.fo=!0}}if(h=h.filter(function(e){return!e.fb}),"teachers"==n){var L=new Set;if(m)for(var G=0,U=m.tableData("lessons");G<U.length;G++){var q=U[G];if(r.idsIsOverlap(q.classids,v.classids))for(var H=0,V=q.teacherids;H<V.length;H++){var W=V[H];L.add(W)}}for(var K=0,Y=h;K<Y.length;K++)A=Y[K],L.has(A.id)&&(A.fu=!0);for(var J=new Set,Z=(He=d.rowData("classes",v.classids[0]))&&He.grade||"",$=0,X=d.tableData("approbations");$<X.length;$++){var Q=X[$];if(!(Q.subjectids.indexOf(v.subjectid)<0)){if(Z){if(Q.gradefrom&&parseInt(Q.gradefrom)>parseInt(Z))continue;if(Q.gradeto&&parseInt(Q.gradeto)<parseInt(Z))continue}J.add(Q.id)}}for(var ee=0,te=h;ee<te.length;ee++){A=te[ee];for(var ne=0,se=d.rowData("teachers",A.id).approbationids;ne<se.length;ne++){var re=se[ne];J.has(re)&&(A.fp=!0)}}for(var ie=0,ae=v.classids;ie<ae.length;ie++){var oe=ae[ie],le=d.rowData("classes",oe);if(le)for(var ce=0,ue=h;ce<ue.length;ce++)(A=ue[ce]).id!=le.teacherid&&A.id!=le.teacher2id||(A.ft=!0)}if("period"==r.DBITools.typeOfUniPeriod(l.uniperiod)){var de=parseInt(l.uniperiod),me=d.rowData("substonline_dates",l.date),pe=me.tt_num;if(pe)for(var be=0,fe=h;be<fe.length;be++){var _e;if(A=fe[be],_e=d.rowData("teachers",A.id)){var he=(_e.subst_tt_timeoff||_e.subst_tt_timeoff_vt)[pe];if(he){var ge=a.timeoff_get(he,me.tt_term,me.tt_week,me.tt_day,de);"0"==ge&&(A.fx=!0),"D"==ge&&(A.fd=!0)}}}}if("period"==r.DBITools.typeOfUniPeriod(l.uniperiod)){for(var ve=parseInt(l.uniperiod),ye=ve+(l.durationperiods||1)-1,Ee=d.tableFilterData("substonline_ttitems",{date:l.date}).filter(function(e){return p.indexOf(e.id)<0}),we=new Set,Se=0,xe=Ee;Se<xe.length;Se++)for(var Te=xe[Se],Ce=0,ke=Te.teacherids;Ce<ke.length;Ce++)W=ke[Ce],we.add(W+":"+Te.uniperiod);for(var De=d.tableIds("periods"),Ie=0,Re=h;Ie<Re.length;Ie++)if(!(A=Re[Ie]).fj&&!A.fo){W=A.id;for(var Ae=null,Ne=null,Be=0,je=De;Be<je.length;Be++){var Pe=je[Be];we.has(W+":"+Pe)&&((de=parseInt(Pe))<ve&&(Ae=de),ye<de&&null===Ne&&(Ne=de))}var Me;(Me=null==Ae?null==Ne?-5:-(Ne-ye-1):null==Ne?-(ve-Ae-1):1)&&(A.fa=Me)}}for(var Oe=0,ze=h;Oe<ze.length;Oe++){A=ze[Oe];var Fe=d.rowData("substonline_teacher_month",_+":"+A.id);if(Fe){var Le=void 0;"classroomsupervision"==l.type?Le=Fe.sv_substing:null==(Le=Fe.de_plusminus)&&(Le=Fe.substing-Fe.absent),Le&&(A.fq=-Le)}}}if("classrooms"==n){for(var Ge=new Set,Ue=0,qe=v.classids;Ue<qe.length;Ue++){var He;oe=qe[Ue],(He=d.rowData("classes",oe))&&Ge.add(He.classroomid)}if(v.igroupid){var Ve=d.rowData("igroups",v.igroupid);Ve&&Ge.add(Ve.classroomid)}for(var We=0,Ke=h;We<Ke.length;We++)A=Ke[We],Ge.has(A.id)&&(A.frh=!0)}var Ye=d.rowData("global_settings","1"),Je=o.default_subst_online_criteria;Ye&&Ye.subst_online_criteria&&(Je=Ye.subst_online_criteria);for(var Ze=0,$e=h;Ze<$e.length;Ze++){A=$e[Ze];var Xe=0;e.topid&&A.id==e.topid&&(Xe+=1e6),(A.cb_hidden||A.subst_hidden)&&(Xe-=1e5),A.filter_out&&(Xe-=5e5),A.fo&&(Xe+=-5e4),A.fa&&(Xe+=Je.assign*A.fa),A.fu&&(Xe+=Je.teachesclass),A.fp&&(Xe+=Je.approbation),A.fj&&(Xe+=Je.join),A.fx&&(Xe+=-5e4),A.fd&&(Xe+=Je.duty),A.ft&&(Xe+=Je.classteacher),A.fq&&(Xe+=Je.equable*A.fq),A.priorita=Xe}h.sort(function(e,t){return t.priorita-e.priorita});for(var Qe=0,et=h;Qe<et.length;Qe++){var tt=[];(A=et[Qe]).fo&&tt.push("subst-obsadeny"),(A.cb_hidden||A.subst_hidden||A.filter_out)&&tt.push("cb_hidden"),A.className=tt.join(" ")}return h}e.substComboTables=["teachers","classrooms"],(e.substTTItemComboItems=d).npp=l.substOnlineNeededPartProvider(function(){return[u.substFilterRows,i.getSubstTTItemKolizie,{global_settings:["subst_online_criteria"],substonline_dates:["tt_num","tt_day","tt_week","tt_term"],classrooms:["cb_hidden"],teachers:["approbationids","cb_hidden","subst_hidden","subst_tt_timeoff","dateto"],classes:["teacherid","teacher2id"],substonline_teacher_month:["de_plusminus","substing","absent","sv_substing"]}]}),d.ttdbi={npp:r.neededPartProvider(function(){return[i.getSubstTTItemKolizie.ttdbi,{lessons:["classids","teacherids"]}]})}},"/substitution/online/settings.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../../asc/asc_react"),i=t("react"),a=t("../../asc/edurequest"),o=t("../../rpr/itemdlg"),l=t("../../asc/asc_react2"),c=i.lazy(function(){return Promise.resolve().then(function(){return t("../../react/slider")})});e.default_subst_online_criteria={assign:10,teachesclass:3,classteacher:10,approbation:70,join:100,duty:1e4,equable:1};var u=[[0,1],[50,10],[300,100],[5e3,1e3]];function d(e){return e.cast(function(e){for(var t=0,n=u.length-1;0<=n;n--){var s=u[n];s[0]>e||(t+=(e-s[0])/s[1],e=s[0])}return t},function(e){for(var t=0,n=1,s=0,r=u;s<r.length;s++){var i=r[s],a=(i[0]-t)/n;if(e<a)break;e-=a,t=i[0],n=i[1]}return t+e*n})}var m=d(r.makeSimpleValueRef(function(){return 5e4},function(){})).value;function p(){var t=a.client_req;r.useTTLang();var n=t.getSchoolYear(),u=o.useMainDBIItemDlgState(n,"global_settings","1",{needed_part:{global_settings:["subst_online_criteria"]},blank:{subst_online_criteria:e.default_subst_online_criteria},trackEvent:function(e){return barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstSettingsCriteriaDlg."+e,eventLabel:""})}}),p=u.dbi,b=u.rowRef,f=u.rdlgProps,_=b.sub("subst_online_criteria"),h=_.value,g=p.column("global_settings","subst_online_criteria"),v=g.subcolumns||[];return i.createElement(r.RDialog,s.__assign({},f,{header:t.ls(1003),width:620,footer:i.createElement(i.Fragment,null,i.createElement(r.RButton,{label:t.ttls(1540),onClick:function(){var e={margin:20,marginTop:10};r.RDialog.showConfirm(i.createElement("div",null,i.createElement(r.VGap,{height:15}),i.createElement("div",null,["classteacher","teachesclass","approbation","join","duty"].map(function(e){return g.subcolumn(e).name()}).join(", ")),i.createElement("div",{style:e},t.ttls(1564),i.createElement(r.VGap,{height:10}),t.ttls(2191)),i.createElement("div",null,g.subcolumn("assign").name()),i.createElement("div",{style:e},t.ttls(1567)),i.createElement("div",{style:e},t.ttls(2192)),i.createElement("div",null,g.subcolumn("equable").name()),i.createElement("div",{style:e},t.ttls(1569))),{width:520,buttons:["close"],header:t.ttls(1540)})}}),i.createElement(r.RButton,{label:t.ttls(1539),onClick:function(){return b.set(function(t){return s.__assign(s.__assign({},t),{subst_online_criteria:s.__assign(s.__assign({},t.subst_online_criteria),e.default_subst_online_criteria)})})}}))}),i.createElement("div",{style:{minHeight:350}},i.createElement(l.DlgHeader,{icon:"/static/pics/settings_basic_32.png",title:t.localize("{6737}"),small:!0}),i.createElement(i.Suspense,{fallback:i.createElement(r.Loading,null)},i.createElement(r.RLabel,{text:t.ttls(1530)}),i.createElement("i",{className:"fa fa-arrow-down"}),i.createElement(r.HGap,{width:298}),i.createElement("i",{className:"fa fa-arrow-up"}),i.createElement(r.VGap,{height:10}),v.map(function(e){var n=_.sub(e.id);return i.createElement(i.Fragment,{key:e.id},i.createElement(r.RLabel,{text:e.name()}),i.createElement(c,{valueRef:d(n),min:0,max:m,style:{width:320}}),i.createElement("span",{style:{display:"inline-block",width:110,overflow:"hidden",textAlign:"center",verticalAlign:"middle",whiteSpace:"pre",textOverflow:"ellipsis"}},h[e.id]||t.ttls(2173)),i.createElement(r.VGap,{height:4}))}),i.createElement(r.VGap,{height:20}),i.createElement("div",null,t.ttls(2196)),i.createElement(r.VGap,{height:10}),i.createElement("div",null,t.ttls(2195)))))}e.showSubstSettingsCriteriaDlg=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,r.RDialog.show(i.createElement(p,null))];case 1:return e.sent(),[2]}})})},e._hotswap=[p]},"/rpr/itemdlg.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("./dbi"),a=t("../asc/asc_react"),o=t("./dbi_react"),l=t("../asc/edurequest"),c=t("../asc/actions"),u=t("../asc/asc_react2");function d(e,t,n,d,p){var b,f,_,h,g=this,v=l.client_req,y=p.trackEvent,E=p.log_module,w=p.allowNavigation,S=p.suspense;r.useEffect(function(){y&&y("open")},[]);var x=o.useSubscribedDBI(e,t,{needed_part:i.DBITools.mergeNeededParts(p.needed_part,(b={},b[n]=["_uial"],b)),client_filter:p.client_filter||(w?{}:(f={},f[n]=[{id:d}],f)),vt_filter:p.vt_filter,needed_combos:p.needed_combos,date:p.date,suspense:S}),T=x.table(n),C=a.useStateValueRef(function(){var e={id:d,changes:d?{}:p.blank_add||{},otherChange:!1,initialized:!1};return!e.id&&p.onAddingRow&&S&&(e.changes=s.__assign(s.__assign({},e.changes),p.onAddingRow({dbi:x}))),e}),k=C.value,D=k.id,I=k.initialized,R=k.changes,A=k.otherChange,N=!D,B=!i.deepStrictEqual(R,{})||A,j=r.useMemo(function(){var e={};return Object.assign(e,T.blankRow(),p.blank,x.rowData(n,D),{id:D}),e},[T,D]);r.useEffect(function(){I||x.mock||x.old||C.set(function(e){var t=e.changes;return N?p.onAddingRow&&!S&&(t=s.__assign(s.__assign({},t),p.onAddingRow({dbi:x}))):p.onEditingRow&&p.onEditingRow({dbi:x,origrow:j}),s.__assign(s.__assign({},e),{changes:t,initialized:!0})})},[I,x]);var P=null!==(_=p.readonly)&&void 0!==_?_:1==(null!==(h=j._uial)&&void 0!==h?h:T._uial),M=r.useMemo(function(){var e=new a.ValueRef(s.__assign(s.__assign({},j),R),function(e){return C.sub("changes").set(function(t){"function"==typeof e&&(e=e(s.__assign(s.__assign({},j),t)));var n=i.DBITools.rowChanges2write(j,e)||{};return delete n.id,n})});if(P)e.set=null;else for(var t=0,n=T.columns();t<n.length;t++){var r=n[t];T.column(r).def.readonly&&(e.sub(r).set=null)}return e},[j,R,T,P]),O=M.value,z=r.useRef();r.useEffect(function(){p.onChange&&p.onChange({row:O})},[O,p.onChange]);var F=a.useWorkIndicator();r.useEffect(function(){if(N&&T.column("short")){var e=function(e,t,n){var s=n.name||"";switch(t){case"classes":case"classrooms":return s;case"teachers":var r=(n.firstname||"").substr(0,1),i=(n.firstname||"").substr(0,1);return e.sort_name_col.indexOf("F")<e.sort_name_col.indexOf("L")?r+i:i+r;case"subjects":for(var a="",o=0,l=s.split(" ");o<l.length;o++){a+=l[o].substr(0,1)}return a;default:return s.substr(0,1)}}(v,n,O);e&&M.sub("short").set(e)}},[O.name,O.lastname,O.firstname]);var L=O.name||O.lastname&&(O.firstname+" "+O.lastname).trim()||"",G=r.useRef();G.current=function(e){return void 0===e&&(e={}),s.__awaiter(this,void 0,void 0,function(){var t,r,o,l,c,u,d,m,b,f,_,h=this;return s.__generator(this,function(g){switch(g.label){case 0:return"boolean"==typeof e&&(e={confirm:e}),t=z.current,r=O,p.onValidate?[4,p.onValidate({dbi:x,table:n,origrow:j,row:r,adding:N,changed:B})]:[3,2];case 1:if(!(o=g.sent()))return[2,null];"object"==typeof o&&(r=o),g.label=2;case 2:return l=i.DBITools.rowChanges2write(j,r),c="",e.confirm&&(l||A)?[4,a.RDialog.showConfirm(v.ls(1037)+"?",{buttons:["yes","no","cancel"]})]:[3,4];case 3:if(!(u=g.sent()))return[2,null];if("no"==u)return C.sub("changes").set({}),e.close&&t.close(),[2,{cop:""}];g.label=4;case 4:if(d=D,!l)return[3,9];m=p.doWrite||function(e){var t=e.dbi,r=e.urow,i=e.adding;return s.__awaiter(h,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return i?[4,t.backend.addRow(n,r,{log_module:E})]:[3,2];case 1:return[2,e.sent()];case 2:return[4,t.backend.updateRow(n,r,{log_module:E})];case 3:return e.sent(),[2,""]}})})},b=void 0,g.label=5;case 5:return g.trys.push([5,7,,8]),[4,F(m({dbi:x,origrow:j,urow:l,adding:N}))];case 6:return b=g.sent(),[3,8];case 7:throw f=g.sent(),ASC.showError(f),f;case 8:N?(r=s.__assign(s.__assign({},r),{id:b}),c="add="+b,d=b):c="ok",y&&y("save"),g.label=9;case 9:if(!p.onAfterOk)return[3,13];g.label=10;case 10:return g.trys.push([10,12,,13]),[4,p.onAfterOk({row:r,changed:B})];case 11:return g.sent(),[3,13];case 12:return _=g.sent(),ASC.showError(_),[3,13];case 13:return e.close?t.confirmClose(c):C.set({id:d,changes:{},initialized:!1,otherChange:!1}),[2,{cop:c}]}})})};var U=r.useCallback(function(e){return G.current(e)},[]),q=r.useCallback(function(e){return s.__awaiter(g,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return D==e||N?[2]:[4,U({confirm:!0})];case 1:return t.sent()&&C.set({id:e,changes:{},otherChange:!1,initialized:!1}),[2]}})})},[U,D]),H=T.itemName();return N&&(H+=" - "+c.action_name("add")),{dbi:x,table:n,id:D,origrow:j,loaded:I&&!x.mock,adding:N,readonly:P,changed:B,rowRef:M,row:O,dlgRow:{dbi:x,table:n,rowRef:M},doApply:U,ensureSaved:function(){return s.__awaiter(g,void 0,void 0,function(){var e,t,n;return s.__generator(this,function(s){switch(s.label){case 0:return!N||B?[3,2]:[4,a.RDialog.showMessage(v.ls(8132),{msgType:"fail"})];case 1:return s.sent(),[2,""];case 2:return[4,U({confirm:!0})];case 3:return(e=s.sent())?(t=D,(n=e.cop).startsWith("add=")&&(t=n.substr(4)),[2,t]):[2,""]}})})},navigate:q,setHasOtherChange:function(){return C.set(function(e){return e.id!=D||e.otherChange?e:s.__assign(s.__assign({},e),{otherChange:!0})})},rdlg:z.current,rdlgProps:{controlRef:z,header:H,buttons:P&&!B?["close"]:["ok","cancel"],width:400,onConfirm:function(e){return s.__awaiter(g,void 0,void 0,function(){var t;return s.__generator(this,function(n){switch(n.label){case 0:return[4,U()];case 1:return(t=n.sent())&&e.confirmClose(t.cop),[2]}})})},footer:w&&!N&&r.createElement(m,{dbi:x,table:n,id:D,navigate:q,navigateids:p.navigateids}),asc_info:D},header:r.createElement(u.DlgHeader,{icon:O.icon||T.icon(),title:L||T.itemName(),subtitle:O.short||(T.column("short")?String.fromCharCode(160):void 0),small:!0})}}function m(e){var t=l.client_req,n=e.dbi,s=e.table,i=e.id,o=e.navigate,c=e.navigateids,u=r.useMemo(function(){return(0<(null==c?void 0:c.length)?c:n.tableIds(s)).filter(function(e){var t=n.rowData(s,e);return t&&0!==t._uial})},[n,s,c]),d=u.indexOf(i);return d<0?null:r.createElement(r.Fragment,null,[[u[d-1],"<",t.ls(1170)],[u[d+1],">",t.ls(1171)]].map(function(e,t){var n=e[0],s=e[1],i=e[2];return r.createElement(a.RButton,{key:t,content:r.createElement("span",{style:{display:"inline-block",transform:"scale(1.5)"}},s),title:i,onClick:void 0!==n?function(){return o(n)}:void 0})}),r.createElement(a.HGap,null))}e.useMainDBIItemDlgState=function(e,t,n,i){var a=l.client_req,o=d("maindbi",""+e,t,n,i);return r.useMemo(function(){var t=o;return e!=a.getSchoolYear()&&(t=s.__assign(s.__assign({},t),{rdlgProps:s.__assign(s.__assign({},t.rdlgProps),{header:r.createElement(r.Fragment,null,t.rdlgProps.header," ("+a.getSchoolYearName(e)+")")})})),t},[o])},e.useItemDlgState0=d,e.ItemDlgNavigation=m},"/substitution/filter.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../rpr/dbi"),i=t("./subst"),a=["cz_zs_stupen","sk_zs_stupen","grade"];function o(e){return!!(e.buildingid||e.schoolid||a.find(function(t){return e[t]}))}function l(e,t){var n=e.req,s=[],r=t.value;0<e.tableData("buildings").length&&s.push({text:e.table("buildings").itemName(),checked:!!r.buildingid,submenu:e.tableIds("buildings").map(function(n){var s=r.buildingid==n;return{text:e.rowName("buildings",n),checked:s,onClick:function(){return t.sub("buildingid").set(s?"":n)}}})}),1<e.tableData("ourschools").length&&s.push({text:n.ls(1949),checked:!!r.schoolid,submenu:e.tableIds("ourschools").map(function(n){var s=r.schoolid==n;return{text:e.rowName("ourschools",n),checked:s,onClick:function(){return t.sub("schoolid").set(s?"":n)}}})});for(var i=function(n){var i=[],a=e.column("classes",n);if(!a)return"continue";for(var o=function(e){if(Array.isArray(e)||!e.value)return"continue";var s=r[n]==e.value;i.push({text:e.name,checked:s,onClick:function(){return t.sub(n).set(s?"":e.value)}})},l=0,c=a.combo();l<c.length;l++)o(c[l]);s.push({text:e.column("classes",n).name(),checked:!!r[n],submenu:i})},l=0,c=a;l<c.length;l++)i(c[l]);return o(r)&&(s.push([]),s.push({text:n.ls(1859),onClick:function(){return t.set({})}})),s}e.isSubstFilterOn=o,e.substFilterText=function(e,t){var n=[];t.buildingid&&n.push(e.rowName("buildings",t.buildingid)),t.schoolid&&n.push(e.rowName("ourschools",t.schoolid));for(var s=0,r=a;s<r.length;s++){var i=r[s],o=t[i];if(o){var l=e.column("classes",i);n.push(l?l.textValue(o):i+": "+o)}}return n.join(", ")},(e.substFilterMenu=l).needed_part=r.typed({buildings:["__name"],ourschools:["__name"],classes:a}),l.needed_combos=r.typed({classes:a}),(e.substFilterRows=function(e,t,n,s,r){void 0===r&&(r={});var o=s,l=r.onlyDirect,c=t.buildingid,u=t.schoolid,d="subst_substitutions"==n||"substonline_substitutions"==n,m="subst_absents"==n||"substonline_absents"==n,p="subst_ttitems"==n||"substonline_ttitems"==n;function b(){return{classrooms:new Set,classes:new Set,igroups:new Set,teachers:new Set}}function f(e){function t(t,n){if(!n)return!1;for(var s=e[t],r=0,i=n;r<i.length;r++){var a=i[r];if(s.has(a))return!0}return!1}if(d&&(o=o.filter(function(n){for(var s=0,r=[i.coreTTItemOfSubst(n),i.coreTTItemOfSubst(n,!0)];s<r.length;s++){var a=r[s];if(t("classrooms",a.classroomids))return!0;if(t("classes",a.classids))return!0;if(a.igroupid&&e.igroups.has(a.igroupid))return!0;if(t("teachers",a.teacherids))return!0}return!1})),p&&(o=o.filter(function(n){for(var s=0,r=[n,n.orig];s<r.length;s++){var i=r[s];if(i){if(t("classrooms",i.classroomids))return!0;if(t("classes",i.classids))return!0;if(i.igroupid&&e.igroups.has(i.igroupid))return!0;if(t("teachers",i.teacherids))return!0}}return!1})),m&&(o=o.filter(function(t){var n=e[i.absentGetTable(t)];return!n||0==n.size||n.has(i.absentGetId(t))})),"events"==n&&(o=o.filter(function(e){return!!(t("classes",e.classids)||t("classrooms",e.classroomids)||t("teachers",e.teacherids)||t("igroups",e.igroupids))})),"classes"==n||"teachers"==n||"classrooms"==n||"igroups"==n){var s=e[n];0<s.size&&(o=o.filter(function(e){return s.has(e.id)}))}}if(l&&"classrooms"!=n&&"classes"!=n&&"igroups"!=n&&ASC.dieError("9339160101",[n,t]),c&&(!l||"classrooms"==n)){for(var _=b(),h=0,g=e.tableData("classrooms");h<g.length;h++)(E=g[h]).buildingid==c&&_.classrooms.add(E.id);for(var v=0,y=e.tableData("classes");v<y.length;v++){var E=y[v];_.classrooms.has(E.classroomid)&&_.classes.add(E.id)}for(var w=0,S=e.tableData("igroups");w<S.length;w++)E=S[w],_.classrooms.has(E.classroomid)&&_.igroups.add(E.id);for(var x=0,T=e.tableData("teachers");x<T.length;x++)(E=T[x]).buildingid==c&&_.teachers.add(E.id);f(_)}if(u&&(!l||"classes"==n||"igroups"==n)){_=b();for(var C=0,k=e.tableData("classes");C<k.length;C++)(E=k[C]).schoolid==u&&_.classes.add(E.id);for(var D=0,I=e.tableData("igroups");D<I.length;D++)(E=I[D]).schoolid==u&&_.igroups.add(E.id);f(_)}for(var R=0,A=a;R<A.length;R++){var N=A[R],B=t[N];if(B){if("igroups"==n)return[];_=b();for(var j=0,P=e.tableData("classes");j<P.length;j++)(E=P[j])[N]==B&&_.classes.add(E.id);f(_)}}return o}).needed_part=r.typed({classrooms:["buildingid"],teachers:["buildingid"],classes:s.__spreadArrays(["schoolid"],a),igroups:["schoolid"]})},"/timetable/ttview_components.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("../asc/asc_react"),a=t("../asc/edurequest"),o=t("../rpr/dbi"),l=t("./app/ttdoc"),c=t("../asc/lib_date"),u=t("../react/sticky"),d=t("../calendar/event_popup"),m=t("../asc/asc_react2");function p(e){var t=e.box,n=e.text,a=e.swap,o=e.splitLineTop,l=e.bgIcon,c=e.icon,u=e.icon_tooltip,d=e.onClick,m=i.useColors();return r.createElement(r.Fragment,null,l&&r.createElement("img",{src:l,style:{position:"absolute",left:t.x1,top:t.y1,height:t.y2-t.y1,width:t.x2-t.x1,opacity:.3}}),r.createElement(i.RTextBox,s.__assign({},i.swapBox(t,a),{text:n,hAlign:"center",vAlign:"center",style:s.__assign({fontSize:18,textShadow:l?"0px 0px 2px #ffffff":void 0,cursor:d?"pointer":void 0},e.style||{}),onClick:d})),c&&r.createElement("img",{src:c,title:u,style:{position:"absolute",left:t.x2-16,top:t.y1+1,width:16}}),o&&r.createElement(i.RBox,s.__assign({},i.swapBox({x1:t.x2-.25*(t.x2-t.x1),x2:t.x2,y1:t.y1,y2:t.y1+1},a),{style:{backgroundColor:m.faintLine}})))}function b(e){for(var t=[],n=1;n<=23;n++){var s=("0"+n).substr(-2)+":00",r=e.data2t({starttime:s,endtime:s}),i=e.t2p(r.t1);i<=0||i>=e.pSize||t.push({time:s,x:i})}return t}function f(e){var t,n=e.tlr,a=e.dbi,o=e.rowHeight,l=e.swapAxis,c=null!==(t=e.gridMode)&&void 0!==t?t:"periods",u=i.useColors(),d="px solid "+u.faintLine,m={x1:0,x2:n.pSize,y1:0,y2:o},p=null;if("hours"==c){var f={position:"absolute",pointerEvents:"none"};p=b(n).map(function(e,t){e.time;var n=e.x;return l?r.createElement("div",{key:t,style:s.__assign(s.__assign({},f),{top:n,left:0,right:0,height:1,borderTop:1+d})}):r.createElement("div",{key:t,style:s.__assign(s.__assign({},f),{left:n,top:0,bottom:0,width:1,borderLeft:1+d})})})}else p=a.tableData("periods").map(function(e){var t=n.data2t(e),a={x1:n.t2p(t.t1),x2:n.t2p(t.t2)+1,y1:0,y2:o};return r.createElement(i.RBox,s.__assign({key:e.id},i.swapBox(a,l),{style:s.__assign({background:"none",pointerEvents:"none"},l?{borderTop:1+d,borderBottom:1+d}:{borderLeft:1+d,borderRight:1+d})}))});return r.createElement(r.Fragment,null,r.createElement(i.RBox,s.__assign({},i.swapBox(m,l),{style:{borderTop:"1px solid "+u.faintLine,borderLeft:"1px solid "+u.faintLine}})),p)}function _(e,t){void 0===t&&(t=!1);var n=0;e=e||"";for(var s=0;s<e.length;s++){var r=e.charCodeAt(s);n=(9273780287*(n+=r+r<<12)>>8)+n}for(var i="",a=t?20:110,o=t?128:250,l=0;l<3;l++){var c=n>>8*l&255;i+=(c=c%(o-a)+a).toString(16).substr(-2)}return"#"+i}function h(e){var t=e.box,n=e.side,a=e.text_center,o=e.text_tl,l=e.text_tr,c=e.text_bl,u=e.text_br,d=e.onClick,p=e.tooltip,b=e.small,f=e.status||"",h=e.icons_tl||[],g=e.icons_tr||[],v=.9*Math.max(t.y2-t.y1,8),y=Math.min(b?14:18,v),w=Math.min(b?9:10,v/2),S=e.background||"#c0c0c0";"auto"==S&&(S=_(a));var x="#000000";switch(f){case"out":x="#808080",S="#c0c0c0";break;case"out2":x="#a0a0a0",S="#e0e0e0"}function T(e){return(e=e.filter(function(e){return e})).length<2?e[0]:r.createElement("div",null,r.createElement(m.RJoin,{children:e,glue:" "}))}function C(e){return r.createElement("img",{src:e,style:{verticalAlign:"middle",height:16,width:16,filter:"drop-shadow(0px 0px 3px rgb(255,255,255,0.8))",display:"inline-block"}})}return r.createElement(r.Fragment,null,r.createElement(i.RTextBox,s.__assign({},t,{text:a,hAlign:"center",vAlign:"center",style:s.__assign({background:S,color:x,padding:1,fontSize:n?void 0:y,borderRadius:3,cursor:d?"pointer":"default",border:e.border,whiteSpace:n?"pre":void 0},e.style_center||{}),title:p,onClick:d})),!n&&r.createElement(r.Fragment,null,(o||0<h.length)&&r.createElement(i.RTextBox,s.__assign({},e.box,{text:T(s.__spreadArrays(h.map(C),[o])),hAlign:"left",vAlign:"top",style:{color:x,paddingLeft:3,paddingTop:1,fontSize:w,pointerEvents:"none"}})),(l||0<g.length)&&r.createElement(i.RTextBox,s.__assign({},e.box,{text:T(s.__spreadArrays([l],g.map(C))),hAlign:"right",vAlign:"top",style:{color:x,paddingRight:3,paddingTop:1,fontSize:w,pointerEvents:"none"}})),c&&r.createElement(i.RTextBox,s.__assign({},e.box,{text:c,hAlign:"left",vAlign:"bottom",style:{color:x,paddingLeft:3,paddingBottom:1,fontSize:w,pointerEvents:"none"}})),u&&r.createElement(i.RTextBox,s.__assign({},e.box,{text:u,hAlign:"right",vAlign:"bottom",style:{color:x,paddingLeft:3,paddingBottom:1,fontSize:w,pointerEvents:"none"}}))),"selected"==f&&r.createElement(E,{box:t}))}function g(e,t,n,s){var r=e.req;return"classes"==t&&1<n.length&&o.idsArrayMatchI(n,e.tableIds(t))?r.ls(3100):n.length<5?e.rowNames(t,n,s):n.length+" "+e.tools.itemName(t,n.length)}function v(e){var t,n=e.dbi,a=e.ttitem,u=e.table,m=e.id,p=e.tlr_part,b=e.showTime,f=e.swapAxis,_=e.small,h=e.grayed,v=e.onClick,E=n.req,w=e.box,S=e.colors,x=i.useColors(),T=x.darkMode,C="",k="";"classes"==u&&(k=m),"students"==u&&(k=null===(t=n.rowData("students",m))||void 0===t?void 0:t.classid);var D="";"top"!=p&&"bottom"!=p||(C="ellipsis",f&&(D="bottom"==p?"right":"left")),"supervisionside"!=p||f||(D="left",C="clip");var I=a.eventids,R=D?w.x2-w.x1:w.y2-w.y1,A=D?w.y2-w.y1:w.x2-w.x1,N=.9*R,B=Math.min(_?14:18,N),j=Math.min(_?9:10,N/2),P=a.name||"",M="",O="",z="",F="",L=a.ol_url,G=x.fgBlack,U=T?"#444":"#d0d0d0",q=void 0,H=!1,V=T?"#666":"#909090",W=T?"#353":"#d0ffd0",K=T?"repeating-linear-gradient(-45deg,#353,#353 5px,#666 5px,#666 10px)":"repeating-linear-gradient(-45deg,#d0ffd0,#d0ffd0 5px,#d0d0d0 5px,#d0d0d0 10px)";switch(a.type){case"absent":U=a.eventid?K:V,H=!0;break;case"event":U=a.absentid?K:W,H=!0;break;case"classroomsupervision":q="inset 0px 0px 0px 1px #b0b0b0",P="classrooms"==u?n.rowNames("teachers",a.teacherids,"short"):n.rowNames("classrooms",a.classroomids,"short");break;case"subst_duty":P=r.createElement("img",{src:"/substitution/pics/must_be_32.svg",height:Math.min(32,R)});break;case"out":G=T?"#888":"#a0a0a0",U=T?"#444":"#e0e0e0";break;case"other":G=T?"#666":"#c0c0c0",U=x.bgBox}P=P||(a.igroupid?n.rowName("igroups",a.igroupid):n.rowName("subjects",a.subjectid,"short"));var Y=E.isApp();if(!C&&"classroomsupervision"!=a.type){if(!a.groupnames||o.DBITools.groupnamesIsEntireClass(a.groupnames)||Y||(M=n.tools.groupnames_names(a.groupnames)),"classrooms"!=u){var J=a.classroomids,Z=!1;k&&1==J.length&&n.rowData("classes",k).classroomid==J[0]&&(Z=!0),Z||(O=g(n,"classrooms",J,"short"))}"classes"==u||"igroups"==u||"students"==u?(z=g(n,"teachers",a.teacherids,"short"),b&&a.starttime&&a.endtime&&(F=c.date_format_2times(E,a.starttime,a.endtime,{short:!0,ajSekundy:!1}))):(z=g(n,"classes",a.classids),"teachers"==u?b&&a.starttime&&a.endtime&&(F=c.date_format_2times(E,a.starttime,a.endtime,{short:!0,ajSekundy:!1})):F=g(n,"teachers",a.teacherids,"short"))}a.removed&&(U=T?"#444":"#c0c0c0",G=T?"#000":"#e0e0e0");var $=S&&0<S.length;if($){var X=l.colorsLuma(S);"#000000"==G&&X<=.25&&(G="#ffffff")}q="0 0.5px 1px 0.5px rgba(0,0,0,0.25)";var Q=i.swapBox(w,f),ee=R<25?1:2,te=$?S[0]:U;$&&1<S.length&&(te=void 0);var ne=void 0;h&&(ne=.3,te=void 0);var se=P;return C?se=r.createElement("span",{style:{textOverflow:C,whiteSpace:"nowrap",overflow:"hidden",backgroundColor:te}},P):te&&(se=r.createElement("span",{style:{backgroundColor:te}},P)),r.createElement(r.Fragment,null,r.createElement(i.RBox,s.__assign({},Q,{className:"tt-cell",style:s.__assign({padding:1,background:$?l.strippedBackground(S,Q.x2-Q.x1,Q.y2-Q.y1):U,boxShadow:q,borderRadius:H?4:3,cursor:v?"pointer":void 0,opacity:ne},e.style||{}),onClick:v})),r.createElement(r.Fragment,null,r.createElement(i.RBox,s.__assign({},Q,{style:{padding:ee+"px 3px",color:G,fontSize:j,pointerEvents:"none",opacity:ne}}),M,(O||L||I)&&r.createElement("div",{style:{float:"right",maxWidth:A-6}},O,L&&r.createElement(y,{style:{marginLeft:3,height:_?12:void 0}}),I&&I.map(function(e){return r.createElement(d.EventIcon,{key:e,dbi:n,eventid:e,where:"timetable",style:{verticalAlign:"middle",marginLeft:3}})}))),z&&r.createElement(i.RTextBox,s.__assign({},Q,{text:z,hAlign:"left",vAlign:"bottom",style:{color:G,paddingLeft:3,paddingBottom:ee,fontSize:j,pointerEvents:"none",opacity:ne}})),F&&r.createElement(i.RTextBox,s.__assign({},Q,{text:F,hAlign:"right",vAlign:"bottom",style:{color:G,paddingRight:3,paddingBottom:ee,fontSize:j,pointerEvents:"none",opacity:ne}}))),r.createElement(i.RTextBox,s.__assign({},Q,{hAlign:"center",vAlign:"center",rotate:D,style:s.__assign({color:G,fontSize:B,pointerEvents:"none",alignItems:"center",opacity:ne},e.style||{}),text:se})))}function y(e){var t=i.useReq();return r.createElement("img",{src:"/static/pics/videocall_16.svg",style:s.__assign({verticalAlign:"middle",filter:"drop-shadow(0px 0px 3px rgb(255,255,255,0.8))"},e.style||{}),title:t.ls(9794)})}function E(e){var t=e.box,n=e.swapAxis;return r.createElement(r.Fragment,null,r.createElement(i.RBox,s.__assign({},i.swapBox(t,n),{style:{boxShadow:"0px 0px 10px 2px #000000",zIndex:1,pointerEvents:"none",borderRadius:3}})),r.createElement(i.RBox,s.__assign({},i.swapBox(t,n),{style:{border:"1px solid #ffffff",zIndex:2,pointerEvents:"none",borderRadius:3}})))}e.COLOR_lines="#f5f5f5",e.TTView_OuterLines=function(t){return r.createElement(i.RBox,s.__assign({},t.outerBox,{style:{pointerEvents:"none",borderRight:"1px solid "+e.COLOR_lines,borderBottom:"1px solid "+e.COLOR_lines}}))},e.TTView_Header=p,e.TTView_Day=function(e){var t=e.box,n=e.date,s=e.splitLineTop,i=e.swap,o=a.client_req;return r.createElement(p,{box:t,swap:i,splitLineTop:s,text:r.createElement(r.Fragment,null,c.date_day_name(o,n,!0),r.createElement("span",{style:{fontSize:10}},ASC.ASC_date2str(n,!1)))})},e.TTView_Object=function(e){var t=e.dbi,n=e.table,i=e.id,a=e.showTable;return r.createElement(p,s.__assign({},s.__assign(s.__assign({},e),{text:t.rowName(n,i,"short"),bgIcon:a?t.table(n).icon():e.bgIcon})))},e.TTView_Periods=function(e){var t,n,o=a.client_req,l=e.tlr,u=e.dbi,d=e.onPeriodClick,m=e.periodsBox,p=e.swapAxis,f=e.showTime,_=i.useColors(),h=null!==(t=e.periodHeight)&&void 0!==t?t:m.y2-m.y1,g=null;if("hours"==(null!==(n=e.gridMode)&&void 0!==n?n:"periods"))g=b(l).map(function(e){var t=e.time,n=e.x,a={x1:n-20,x2:n+20,y1:0,y2:h-2};return r.createElement(i.RTextBox,s.__assign({key:t},i.swapBox(a,p),{hAlign:p?"right":"center",vAlign:p?"center":"bottom",style:{color:"#c0c0c0",fontSize:12},text:c.date_format_time0(o,t,{short:!0,ajSekundy:!1})}))});else{var v=e.periods||u.tableData("periods"),y=(p?h:l.pSize/v.length)<100;l.clear(),l.qSize=h;for(var E=l,w=0,S=v;w<S.length;w++){var x=S[w];E.addItem("main",x)}E.render(),g=E.items.map(function(e){var t=e.data,n=i.swapBox(E.item2box(e),p),a=Math.min(1,(n.y2-n.y1)/40);return r.createElement(i.Fragment,{key:t.id},r.createElement(i.RTextBox,s.__assign({},n,{text:r.createElement(r.Fragment,null,r.createElement("span",{style:{whiteSpace:"pre"}},t.short),f&&r.createElement("span",{style:{fontSize:10*Math.min(a,(n.x2-n.x1)/65),whiteSpace:"pre"}},c.date_format_2times(o,t.starttime,t.endtime,{ajSekundy:!1,short:y}))),hAlign:"center",vAlign:"center",style:{fontSize:18*a,cursor:d?"pointer":void 0},onClick:d?function(){return d(t.id)}:void 0})))})}return m?r.createElement(i.RBox,s.__assign({},i.swapBox(m,p),{style:{background:_.bgWhite}}),g):r.createElement(r.Fragment,null,g)},e.TTView_Lines=f,e.nameColor=_,e.TTView_Cell=h,e.TTView_CellTTItem=v,e.TTView_CellDP=function(e){var t=a.client_req,n=e.dbi,s=e.table,l=e.dp,c=i.useColors().darkMode,u=t.isApp(),d="",m="",p="",b="",f="",_=e.autoColor?"auto":"";if(l.eventid){var v=n.rowData("events",l.eventid,{});0!==v._uial&&(d=v.name||n.rowData("event_types",v.typ,{}).name||"",_=c?"#353":"#d0ffd0")}else d=l.igroupid?n.rowName("igroups",l.igroupid):n.rowName("subjects",l.subjectid,"short"),!l.groupnames||o.DBITools.groupnamesIsEntireClass(l.groupnames)||u||(p=n.tools.groupnames_names(l.groupnames)),"classrooms"!=s&&(m=g(n,"classrooms",l.classroomids,"short")),"classes"==s||"igroups"==s||"students"==s?b=g(n,"teachers",l.teacherids,"short"):(b=g(n,"classes",l.classids),"teachers"==s||(f=g(n,"teachers",l.teacherids,"short")));return r.createElement(h,{box:e.box,text_center:d,text_tl:p,text_tr:m,text_bl:b,text_br:f,style_center:e.style,background:_,small:e.small})},e.TTView_IconOL=y,e.TTView_TTDay=function(e){var t=e.dbi,n=e.box,a=e.gap_day,l=e.table,c=e.id,u=e.tlr,d=e.ttitems,m=e.onTTItemClick,p=e.selectedTTItem,b=e.highlightTTItem,_=e.swapAxis,h=e.showTime,g=n.y2-n.y1;u.clear(),u.qSize=g-a;for(var y=0,w=d;y<w.length;y++){var S=w[y],x="main";"event"==S.type&&(x="autotop"),"classroomsupervision"==S.type&&(x="supervision","break"==o.DBITools.typeOfUniPeriod(S.uniperiod)&&(x="supervisionside")),"absent"!=S.type&&"subst_duty"!=S.type||(x="autobottom"),S.removed&&"main"==x&&(x="autobottom"),S.main&&(x="main"),u.addItem(x,S,{slices:S.cellSlices,order:S.cellOrder})}u.render();var T=null;if(h){var C=u.t2p(u.data2t({starttime:h}).t1),k=Math.round(C-.5),D=Math.min(5,u.pSize-k),I={x1:k-5,y1:-5,x2:k+1+D,y2:g-a+5-0},R="#ff0000",A="rgba(0,0,0,0)";T=r.createElement(i.RBox,s.__assign({},i.swapBox(I,_),{style:{background:R,borderLeftWidth:5,borderTopWidth:5,borderRightWidth:_?5:D,borderBottomWidth:_?D:5,borderStyle:"solid",backgroundClip:"content-box",borderColor:_?A+" "+R:R+" "+A,pointerEvents:"none",zIndex:1}}))}return r.createElement(r.Fragment,null,r.createElement(i.RBox,s.__assign({},i.swapBox(n,_),{style:{overflow:"visible"}}),r.createElement(f,{dbi:t,tlr:u,rowHeight:g,swapAxis:_,gridMode:e.gridMode}),u.renderOrderItems().map(function(e,n){var a=u.item2box(e,1,1),o=e.data,d=p==o;return r.createElement(i.Fragment,{key:n},r.createElement(v,s.__assign({},{dbi:t,table:l,id:c,box:a,swapAxis:_,ttitem:o,style:{border:o.removed?"1px dashed #808080":o.changed?"2px dashed #000":void 0},colors:o.colors,showTime:e.wasAligned,grayed:b?!b(o):void 0,tlr_part:e.part,onClick:m?function(){return m(o)}:void 0})),d&&r.createElement(E,{box:a,swapAxis:_}))}),T),r.createElement(i.RBox,s.__assign({},i.swapBox(n,_),{style:{pointerEvents:"none"}})))},e.TTView_CellSelect=E,e.calcTTViewBoxes=function(e){var t,n=e.clientWidth,s=e.clientHeight,r=e.fit,i=e.swapAxis,a=e.time_mode,o=e.nDays,l=e.nPeriods,c=6,u=void 0;e.showHeader&&(u=37);var d=45;a&&0==l&&!i&&(d=18);var m=80,p=e.small?60:110,b=n-m-0-1;if(i){m=(t=[d,m])[0],d=t[1],p=150,b=a?800:Math.max(52*l,400),c=6;var f=(n-d-1)/o;r&&(p="shrink"==r?Math.min(p,f):f,b=s-(u||0)-m-0-1),print&&(p=Math.min(p,f))}else{a||(m=Math.min(m,Math.max(n/(l+1),35))),b=n-m-0-1;var _=a?600:35*(l+1),h=Math.round(1.2*_);b<_&&(b=h),r&&(f=Math.floor((s-(u||0)-d-0-1)/o),p="shrink"==r?Math.min(p,f):f)}var g={x1:0,x2:m,y1:0,y2:d},v={x1:m+0,x2:m+0+b,y1:d+0,y2:d+0+p*o};return{gap:3,gap_day:c,ttWidth:b,periodHeight:d,rowHeight:p,dayWidth:m,headerWidth:Math.min(n,i?v.y2:v.x2),headerHeight:u,ttBox:v,weekBox:g,ttRowBox:function(e){var t=e*p;return{x1:0,x2:b,y1:t,y2:t+p}},dayBox:function(e){var t=p*e;return{x1:0,x2:m,y1:t,y2:t+p}}}},e.TTView_Boxes=function(e){var t,n=e.periods,s=e.days,a=e.corner,o=e.tt,l=e.ttBox;e.swapAxis&&(l=i.swapBox(l,!0),s=(t=[n,s])[0],n=t[1]);var c=i.useColors();return r.createElement(u.Sticky,{style:{width:l.x2+1,height:l.y2+1,backgroundColor:c.bgWhite},backgroundColor:c.bgWhite,headerSize:l.y1,header:r.createElement(u.Sticky,{side:"left",style:{height:l.y1},headerSize:l.x1,backgroundColor:c.bgWhite,header:a},n)},r.createElement(u.Sticky,{side:"left",style:{height:l.y2-l.y1},backgroundColor:c.bgWhite,headerSize:l.x1,header:s,style_content:{borderRight:"1px solid "+c.faintLine,borderBottom:"1px solid "+c.faintLine}},o))},e.TTView_PageHeader=function(e){var t,n=e.dbi,s=e.table,i=e.id,a=e.headerHeight,o=e.headerWidth,l=n.rowName(s,i);return"students"==s&&(l=n.rowName("classes",null===(t=n.rowData("students",i))||void 0===t?void 0:t.classid)+" - "+l),a?r.createElement("div",{style:{fontSize:32,whiteSpace:"pre",textAlign:"center",width:o,height:a,position:"sticky",left:0}},r.createElement("span",{className:"print-font-resizable"},l)):null},e.ttview_div_style={overflow:"auto",color:"#000",backgroundColor:"#fff",fontFamily:"sans-serif"}},"/timetable/app/ttdoc.js":function(e,t,n){e.__esModule=!0;var s,r,i,a,o=t("tslib"),l=t("../../asc/asc_react"),c=t("../../asc/edurequest"),u=t("../../rpr/dbi"),d=t("react"),m=t("./server/ttdoc");function p(t){return!!e.metaclassrooms_priorita_def.find(function(e){return e.id==t})}function b(n,s,r){return o.__awaiter(this,void 0,void 0,function(){var i,a,u,m,b,f,_,h,g,v;return o.__generator(this,function(y){switch(y.label){case 0:return[4,ASC.loadTTLang()];case 1:return y.sent(),[4,Promise.resolve().then(function(){return t("../../rpr/vyber")})];case 2:if(i=y.sent().DBIVyberDlg,a={current:null},"metaclassrooms"!=s)return[3,4];for(u=[],m="*optimal",b=0,f=r;b<f.length;b++)p(_=f[b])?m=_:u.push({id:_,select:m});return[4,l.RDialog.show(d.createElement(i,o.__assign({},{dbi:n,table:s,selected:u,filter:function(e){return!p(e)},selectTypes:e.metaclassrooms_priorita_def.map(function(e){return{id:e.id,icon:e.icon,name:c.client_req.localize(e.short)}}),selectedRef:a})))];case 3:if(!y.sent())return[2,null];for(r=[],m="*optimal",h=0,g=a.current;h<g.length;h++)(v=g[h]).select!=m&&(m=v.select,r.push(m)),r.push(v.id);return[2,r];case 4:return[4,l.RDialog.show(d.createElement(i,o.__assign({},{dbi:n,table:s,ids:r,selectedRef:a})))];case 5:return y.sent()?[2,a.current.map(function(e){return e.id})]:[2,null]}})})}function f(e,t,n){for(var s=0,r=e.tableData(t+"defs");s<r.length;s++){var i=r[s];if(!(1<i.vals.length)&&i.vals[0]==n)return i}return null}function _(e,t,n){var s=f(e,t,n);return s?e.rowName(t+"defs",s.id):n}function h(e,t,n){if(void 0===n&&(n="short"),!t.days)return"";for(var s=e.rowData("lessons",t.lessonid),r=o.__assign(o.__assign({},s),t),i="",a=0,l=["terms","weeks","days"];a<l.length;a++){var c=l[a],u=r[c];u.indexOf("0")<0||(i&&(i+=", "),i+=_(e,c,u))}return(i+" "+e.tools.uniperiodName(t.period,n,s)).trim()}function g(e,t,n){return void 0===n&&(n="short_name"),v(e,t,null,n)}function v(e,t,n,s){void 0===s&&(s="BHSN");var r=e.req;if(!t)return"";if(n)return"BHSN"==s&&"classes"==t.table&&"subjects"==n.id?"("+g(e,t,"short")+":"+g(e,n,"short")+") "+g(e,t,"name")+": "+g(e,n,"name"):g(e,t,s)+" : "+g(e,n,s);switch(t.table){case"cards":var i=e.rowData("cards",t.id),a=g(e,{table:"lessons",id:i.lessonid})+" - ";return i.days?a+=h(e,i,"short"):a+=r.ttls(1765),a;case"lessons":var o=e.rowData("lessons",t.id);return a=e.rowName("subjects",o.subjectid),o.seminargroup&&(a+=" "+o.seminargroup),a+=" (",0==o.classids.length?a+=r.ttls(2825):a+=e.rowNames("classes",o.classids,"short"),a+=")",0<o.groupnames.length&&!o.groupnames.includes("")&&(a+=" "+e.tools.groupnames_names(o.groupnames)),a;case"globals":return r.ttls(3756)}return e.rowName(t.table,t.id,s)}function y(e,t){if(t<=1)return"";var n=Math.round(255*e/(t-1));return"rgb("+n+","+n+","+n+")"}function E(e){return e&&7==e.length?{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}:null}(s=e.TypCoGenerovat||(e.TypCoGenerovat={}))[s.TCG_VSETKO=0]="TCG_VSETKO",s[s.TCG_STUDENTI=1]="TCG_STUDENTI",s[s.TCG_STUDENTI_BEZKARIET=2]="TCG_STUDENTI_BEZKARIET",s[s.TCG_MASTER=3]="TCG_MASTER",s[s.TCG_MASTER_LOCKSTUDENTI=4]="TCG_MASTER_LOCKSTUDENTI",s[s.TCG_MASTER_HIDDENSTUDENTI=5]="TCG_MASTER_HIDDENSTUDENTI",s[s.TCG_UCEBNE=6]="TCG_UCEBNE",s[s.TCG_UCEBNE_LOCKPRIRADENE=7]="TCG_UCEBNE_LOCKPRIRADENE",s[s.TCG_VSETKO_BEZUCEBNI=8]="TCG_VSETKO_BEZUCEBNI",s[s.TCG_REARRANGESTUDENTSINSEMINARGROUPS=9]="TCG_REARRANGESTUDENTSINSEMINARGROUPS",s[s.TCG_ASSIGNSTUDENTS=10]="TCG_ASSIGNSTUDENTS",s[s.TCG_VSETKO_WEEK1=11]="TCG_VSETKO_WEEK1",s[s.TCG_VSETKO_WEEK2=12]="TCG_VSETKO_WEEK2",s[s.TCG_ANALYZE=13]="TCG_ANALYZE",s[s.TCG_MAX=14]="TCG_MAX",s[s.TCG_MASK_TCG=255]="TCG_MASK_TCG",s[s.TCG_FLAG_IMPROVE=256]="TCG_FLAG_IMPROVE",s[s.TCG_FLAG_USE_HIGHSCHOOL=512]="TCG_FLAG_USE_HIGHSCHOOL",s[s.TCG_FLAG_OBMEDZENYHIGHSCHOOL=1024]="TCG_FLAG_OBMEDZENYHIGHSCHOOL",s[s.TCG_FLAG_IBAOPTIMIZE=2048]="TCG_FLAG_IBAOPTIMIZE",(r=e.PRINTAREA||(e.PRINTAREA={}))[r.TRIEDA=0]="TRIEDA",r[r.UCITEL=1]="UCITEL",r[r.ZIAK=2]="ZIAK",r[r.UCEBNA=3]="UCEBNA",r[r.PREDMET=4]="PREDMET",r[r.SUHRN_TRIEDA=5]="SUHRN_TRIEDA",r[r.SUHRN_UCITEL=6]="SUHRN_UCITEL",r[r.SUHRN_UCEBNA=7]="SUHRN_UCEBNA",r[r.SUHRN_POSTER_TRIEDA=8]="SUHRN_POSTER_TRIEDA",r[r.SUHRN_POSTER_UCITEL=9]="SUHRN_POSTER_UCITEL",r[r.SUHRN_POSTER_UCEBNA=10]="SUHRN_POSTER_UCEBNA",r[r.SUHRN_TRIEDA_PO_DNOCH=11]="SUHRN_TRIEDA_PO_DNOCH",r[r.SUHRN_UCITEL_PO_DNOCH=12]="SUHRN_UCITEL_PO_DNOCH",r[r.SUHRN_UCEBNA_PO_DNOCH=13]="SUHRN_UCEBNA_PO_DNOCH",r[r.VOLNE_UCEBNE=14]="VOLNE_UCEBNE",r[r.LESSONGRID=15]="LESSONGRID",r[r.MASTER=16]="MASTER",r[r.SUHRN_ZIAK=17]="SUHRN_ZIAK",r[r.SUHRN_PREDMET=18]="SUHRN_PREDMET",r[r.CUSTOM1=19]="CUSTOM1",r[r.CUSTOM2=20]="CUSTOM2",r[r.CUSTOM3=21]="CUSTOM3",r[r.INSPEKCIA=22]="INSPEKCIA",r[r.INSPEKCIA_UCITEL=23]="INSPEKCIA_UCITEL",r[r.INSPEKCIA_UCITEL_EXTRA=24]="INSPEKCIA_UCITEL_EXTRA",r[r.CONTRACT_OVERVIEW=25]="CONTRACT_OVERVIEW",r[r.DAILYATTENDANCE=26]="DAILYATTENDANCE",r[r.TEACHERLIST=27]="TEACHERLIST",r[r.CLASSLIST=28]="CLASSLIST",r[r.NUMBER_OF=29]="NUMBER_OF",(i=e.TLACDEF_STRED||(e.TLACDEF_STRED={}))[i.HODINA=0]="HODINA",i[i.POCET=1]="POCET",i[i.POCETHODIN=2]="POCETHODIN",i[i.ZOZNAMHODIN_PODLATRIEDY=3]="ZOZNAMHODIN_PODLATRIEDY",(a=e.SCHOOLTYPE||(e.SCHOOLTYPE={}))[a.GENERIC=0]="GENERIC",a[a.USHIGH=1]="USHIGH",a[a.USHIGH_CLASSES=2]="USHIGH_CLASSES",e.metaclassrooms_linka_def=[{id:"*home",name:"{tt:1067}",icon:"/static/pics/homeroom.png"},{id:"*teacher",name:"{tt:3773}",icon:"/static/pics/teacher_32.svg"},{id:"*shared",name:"{tt:1068}",icon:"/static/pics/sharedroom.png"},{id:"*subject",name:"{tt:3774}",icon:"/static/pics/subject_32.svg"}],e.metaclassrooms_priorita_def=[{id:"*optimal",name:"{tt:4358}",short:"{tt:4359}",color:"#22B14C",icon:"/static/pics/vyber_optimal_16.png"},{id:"*normal",name:"{tt:4360}",short:"{tt:4361}",color:"#B5E61D",icon:"/static/pics/vyber_normal_16.png"},{id:"*bad",name:"{tt:4362}",short:"{tt:4363}",color:"#f1c40f",icon:"/static/pics/vyber_bad_16.png"},{id:"*emergency",name:"{tt:4364}",short:"{tt:4365}",color:"#FF311D",icon:"/static/pics/vyber_emergency_16.png"}],e.isMetaclassroomPriorita=p,e.metaclassrooms_def=o.__spreadArrays(e.metaclassrooms_linka_def,e.metaclassrooms_priorita_def),e.showTTDocVyberDlg=b,e.phpShowVyberDlg=function(e,t,n){return o.__awaiter(this,void 0,void 0,function(){var s;return o.__generator(this,function(r){switch(r.label){case 0:return[4,ASC.blockUI(c.client_req.ttuidocdbi(e,{tables:[t],columns:["name","short","firstname","lastname","color"]}))];case 1:return[4,b(r.sent(),t,n)];case 2:return(s=r.sent())?[2,"sel:"+s.join(",")]:[2,""]}})})},e.allItemsName=function(e,t){var n={classes:"{tt:1868}",subjects:"{tt:3056}",teachers:"{tt:3055}",students:"{tt:3329}"}[t]||"{tt:1297}";return e.localize(n)},e.entireClassGroupid=function(e,t){for(var n=0,s=e.tableData("groups");n<s.length;n++){var r=s[n];if(r.classid==t&&r.entireclass)return r.id}return""},e.findClassGroup=function(e,t,n){for(var s=0,r=e.tableData("groups");s<r.length;s++){var i=r[s];if(i.classid==t&&!i.entireclass&&i.name==n)return i.id}return""},e.ids2colors=function(e,t,n){for(var s=[],r=0,i=n;r<i.length;r++){var a=i[r],o=e.rowData(t,a);s.push(o&&o.color||"#ffffff")}return s},e.strippedBackground=function(e,t,n){var s=e.length;if(0==s)return"#fff";if(1==s)return e[0];var r=45;return 3<=t&&3<=n&&(r=Math.atan2(n,t/(s-1))/Math.PI*180),0===t&&(r=0),"linear-gradient("+(180-r)+"deg,"+e.map(function(e,t){return e+" "+100*t/s+"%,"+e+" "+100*(t+1)/s+"%"}).join()+")"},(e.lessonSeminarClasses=function(e,t){return t.seminargroup&&t.groupids&&t.classids?0<t.groupids.length?t.classids.filter(function(n){for(var s=0,r=t.groupids;s<r.length;s++){var i=r[s];if(e.rowData("groups",i,{}).classid==n)return!1}return!0}):t.classids:[]}).needed_part=u.typed({lessons:["seminargroup","groupids","classids"],groups:["classid"]}),e.trackTTOEvent=function(e,t,n){void 0===n&&(n="")},e.defaultShort=function(e,t,n){var s=n.name||"";switch(t){case"classes":case"classrooms":return s;case"teachers":case"students":var r=(n.firstname||"").substr(0,1),i=(n.lastname||"").substr(0,1);return e.sort_name_col.indexOf("F")<e.sort_name_col.indexOf("L")?r+i:i+r;case"subjects":for(var a="",o=0,l=s.split(" ");o<l.length;o++)a+=l[o].substr(0,1);return a;default:return s.substr(0,1)}},e.obdobieBitsToRow=f,e.obdobieName=_,e.cardPositionName=h,e.idssArrayMatch=function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!u.idsArrayMatch(e[n],t[n]))return!1;return!0},e.getUINazov=g,e.getUINazov2=v,(e.getTTDocStructure=function(e){var t={periodfrom:void 0,periodto:void 0,days:void 0,weeks:void 0,terms:void 0},n=e.tableData("periods");0<n.length&&(t.periodfrom=parseInt(n[0].id),t.periodto=parseInt(n[n.length-1].id));for(var s=0,r=["days","weeks","terms"];s<r.length;s++){var i=r[s],a=e.tableData(i);if(0<a.length)t[i]=a.length;else{var o=e.tableData(i+"defs");if(0<o.length){var l=o[0],c=l.vals||l[i];c&&(t[i]=c[0].length)}}}return t}).needed_part=u.typed({periods:[],days:[],weeks:[],terms:[]}),e.bitfieldOr=function(e,t){for(var n="",s=0;s<e.length;s++)n+="1"==e[s]||"1"==t[s]?"1":"0";return n},e.bitfieldAnd=function(e,t){for(var n="",s=0;s<e.length;s++)n+="1"==e[s]&&"1"==t[s]?"1":"0";return n},e.bitfieldIsOverlap=function(e,t){for(var n=0;n<e.length;n++)if("1"==e[n]&&"1"==t[n])return!0;return!1},e.getFarbaFazy=y,e.fazyColors=function(e){if(e.find(function(e){return!e}))return null;if(!e.find(function(e){return e.includes("0")}))return null;for(var t=1,n=0,s=e;n<s.length;n++){var r=s[n];t*=r.length}var i=[],a=0;return function n(s,r){for(var o=e[s],l=0;l<o.length;l++)s+1<e.length?n(s+1,r||"1"!=o[l]):("1"!=o[l]||r||i.push(y(a,t)),a++)}(0,!1),a!=t&&ASC.dieError("8206886914",e),i},e.colorsLuma=function(e){if(0==e.length)return.5;for(var t,n=0,s=0,r=e;s<r.length;s++){n+=(t=E(r[s]))?(299*t.r+587*t.g+114*t.b)/1e3/255:0}return n/e.length},e.fixTTColor=function(e,t){void 0===t&&(t=!1);var n=E(e);if(!n)return"";function s(e){return Math.round(i-(i-r)/255*(255-e))}var r=t?0:128,i=t?127:255;return function(e){if(!e)return"";function t(e){var t=e.toString(16);return 1==t.length?"0"+t:t}return"#"+t(e.r)+t(e.g)+t(e.b)}({r:s(n.r),g:s(n.g),b:s(n.b)})},e.cloudgenEnabled=function(e){return void 0===e&&(e=c.client_req),!0},e.timetabledbiAsUIDoc=function(e,t){return o.__awaiter(this,void 0,void 0,function(){var n,s;return o.__generator(this,function(r){switch(r.label){case 0:return e?(n=t.req||c.client_req,[4,m.timetabledbiAsUIDocDBIAccessor(n,e,{op:"fetch",needed_part:t.needed_part})]):[2,null];case 1:return s=r.sent(),[2,u.DBI.fromAccessorResult(n,s)]}})})}},"/timetable/app/server/ttdoc.js":function(e,t,n){n.implementRpc(["ttuidocDBIAccessor","ttuidocAddRows","ttuidocUpdateRows","ttuidocRemoveRows","ttuidocUndo","ttuidocAddDivision","ttuidocAddDivisionMulti","ttuidocMoveGroup","ttuidocSeparateGroup","ttuidocSetTableOrder","ttuidocUpdateStructure","ttuidocAddBreak","showBellsInLessonDlg","getDefaultDozoryKriteria","ttuidocResetPrintSettings","ttuidocInfo","ttsnapshotDBIAccessor","timetabledbiAsUIDocDBIAccessor"])},"/react/sticky.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("../asc/asc_react");e.Sticky=function(e){var t,n,a=e.backgroundColor,o=null!==(n=e.side)&&void 0!==n?n:"top",l="top"!=o,c=r.useRef(),u=r.useRef(),d=r.useState(!1),m=d[0],p=d[1];return i.useDomReader(function(){var e,t;p((null===(e=c.current)||void 0===e?void 0:e.getBoundingClientRect()[l?"right":"bottom"])>(null===(t=u.current)||void 0===t?void 0:t.getBoundingClientRect()[o]))}),r.createElement("div",{style:s.__assign({display:"flex",flexDirection:"left"==o?"row":"column",alignItems:"stretch"},e.style)},r.createElement("div",{ref:c,style:(t={position:"sticky"},t[o]=0,t["left"==o?"width":"height"]=e.headerSize,t.flex="0 0 auto",t.zIndex=2,t.backgroundColor=a,t.boxShadow=m?(l?"2px 0px":"0px 2px")+" 0px 0px #00000040":void 0,t)},e.header),r.createElement("div",{ref:u,style:s.__assign({flex:"1 1 0px",zIndex:1,backgroundColor:a,position:"relative"},e.style_content||{})},e.children))}},"/calendar/event_popup.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../asc/asc_react2"),i=t("react"),a=t("../asc/edurequest"),o=t("../rpr/dbi"),l=t("../rpr/dbi_react"),c=t("../asc/asc_react"),u=t("../asc/actions"),d=t("./event_delete"),m=t("../rpr/maindbi_ui"),p=t("../react/popuppanel"),b=t("../asc/lib_date"),f=t("../dashboard/dbi_events");function _(e){var t=a.client_req,n=e.eventid,o=e.where,f=n.split(":")[0],h=l.useMainDBI(t.getSchoolYear(f),{needed_part:_.needed_part,needed_combos:_.needed_combos,vt_filter:{date:f}}),g=h.rowData("events",n,{}),v=g.typ,y=g._uial,E=h.rowData("event_types",v,{}),w=h.tools.ttitem_popis(g),S=g.studentids;S&&0<S.length&&(w.class+=": ",1<S.length&&(w.class+="("+S.length+") "),w.class+=h.rowNames("students",S,t.sort_name_col));var x="";if(g.repeat_datefrom&&g.repeat_dateto){x=b.date_format_2dates(t,g.repeat_datefrom,g.repeat_dateto);var T=g.repeat;T&&"day"!=T&&(x+=", "+h.column("events","repeat").textValue(T))}return i.createElement("div",{style:{minWidth:350,maxWidth:"50vw"}},i.createElement(r.DlgHeader,{title:E.name,icon:E.icon,small:!0,inDlg:!1,right:g.elearn_superid&&i.createElement(i.Fragment,null,i.createElement("img",{src:"/elearning/pics/icons/exams3.svg",style:{cursor:"pointer"},onClick:function(){return c.openUrl("/elearning/?cmd=EtestCreator&superid="+g.elearn_superid)},title:t.ls(2083)}),i.createElement(c.HGap,null))}),i.createElement("div",{style:{padding:"0px 10px 10px 10px"}},[[t.ls(1196),g.name],[t.ls(1579),g.note],[t.ls(2684),x],[h.tools.uniperiodLabel(g.uniperiod),w.period],[t.ls(1263),w.class],[t.ls(1299),w.subject],[t.ls(1300),w.teacher],[t.ls(1197),w.classroom]].map(function(e,t){var n=e[0],s=e[1];return s?i.createElement(p.PopupDetail,{key:t,label:n},s):null}),(t.isAdmin()||t.isUcitel())&&i.createElement(i.Fragment,null,i.createElement(r.SeparatorLine,null),i.createElement("div",{style:{display:"flex",flexDirection:"row"}},e.footer,"calendar"==o&&i.createElement(i.Fragment,null,i.createElement(c.RButton,{label:t.ls(2465),onClick:function(){var e;void 0===(e={date:g.date,subId:n.split(":")[1]})&&(e={}),ASC.ASC_action("/gcall",s.__assign(s.__assign({action:"duplicate"},e),{gadget:"EventsDiv",gsh:ASC.gsechash,jscid:"Calendar_dummyJSC"}))}}),i.createElement(c.RButton,{label:u.action_name("delete"),onClick:2<=y?function(){return d.showDeleteEventDlg(n)}:void 0})),i.createElement("div",{style:{flex:1}}),i.createElement(c.RButton,{label:u.action_name("edit"),type:"calendar"==o?"green":void 0,onClick:2<=y?function(){return m.showEventEditDlg(n)}:void 0})))))}function h(e){var t=e.eventid,n=e.dbi,r=e.where,a=p.useSimplePopup(),o=a[0],l=a[1],u=a[2],d=n.rowData("events",t);return d?i.createElement(i.Fragment,null,i.createElement("img",{src:n.rowData("event_types",d.typ,{}).icon,style:c.rtlCss(s.__assign(s.__assign(s.__assign({},h.style),{cursor:"pointer"}),e.style||{})),onClick:l}),u&&i.createElement(o,null,i.createElement(_,{eventid:t,where:r}))):null}(e.EventPopup=_).needed_part=o.typed({events:["__ttitem","name","note","typ","studentids","repeat","repeat_datefrom","repeat_dateto","elearn_superid","_uial"],event_types:["name","icon"],subjects:["__name"],classes:["__name"],igroups:["__name"],teachers:["__name"],classrooms:["__name"],students:["__name"]}),_.needed_combos=o.typed({events:["repeat"]}),(e.EventIcon=h).needed_part=o.typed({events:["typ"],event_types:["icon"]}),h.style=o.typed({height:16,filter:"drop-shadow(rgba(0, 0, 0, 0.4) 0px 0px 3px)"}),(e.EventBar=function e(t){var n=a.client_req,r=t.eventid,o=t.where,u=r.split(":")[0],d=p.useSimplePopup(),m=d[0],b=d[1],g=d[2],v=l.useMainDBI(n.getSchoolYear(u),{needed_part:e.npp(),vt_filter:{date:u}}),y=v.rowData("events",r);return y?i.createElement("div",{style:s.__assign({cursor:"pointer"},t.style||{}),onClick:b},i.createElement("img",{src:v.rowData("event_types",y.typ,{}).icon,style:c.rtlCss(s.__assign(s.__assign({},h.style),{marginRight:3,verticalAlign:"middle"}))}),f.eventName(v,y),g&&i.createElement(m,null,i.createElement(_,{eventid:r,where:o}))):null}).npp=o.neededPartProvider(function(){return[f.eventName,{events:["typ","name"],event_types:["icon"]}]})},"/calendar/event_delete.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../asc/asc_react"),i=t("react"),a=t("../rpr/dbi_react"),o=t("../asc/edurequest"),l=t("../asc/actions"),c=t("../asc/lib_date"),u=t("../react/datefield"),d=t("../dashboard/server/events");function m(e){var t,n=o.client_req,m=e.eventid,p=m.split(":"),b=p[0],f=p[1],_=n.getSchoolYear(b),h=a.useMainDBI(_,{needed_part:{events:["repeat_datefrom","repeat_dateto","repeat_dates","_uial"]},vt_filter:{date:b}}).rowData("events",m,{}),g=i.useMemo(function(){for(var e={},t=0,n=h.repeat_dates||[];t<n.length;t++)e[n[t]]="#fff97d";return e},[h]),v=i.useRef(),y=r.useStateRef(b),E=y[0],w=y[1],S=null,x=null,T=["cancel"],C=void 0;function k(e){return s.__awaiter(this,void 0,void 0,function(){var t;return s.__generator(this,function(n){switch(n.label){case 0:return[4,ASC.blockUI(d.events_delete(null,E+":"+f,e))];case 1:return t=n.sent(),r.showUniResponse(t),v.current.confirmClose("delete"),[2]}})})}if((null!==(t=h._uial)&&void 0!==t?t:2)<2)S=n.ls(4788),C="fail";else if(h.repeat_datefrom){var D={width:200,textAlign:"center"};S=i.createElement(i.Fragment,null,n.ls(1883),i.createElement(r.VGap,{height:20}),i.createElement(r.RButton,{label:n.ls(1880),style:D,onClick:function(){return k()}}),i.createElement(r.HGap,null),c.date_format_2dates(n,h.repeat_datefrom,h.repeat_dateto),i.createElement(r.VGap,null),E>h.repeat_datefrom&&E<h.repeat_dateto&&i.createElement(i.Fragment,null,i.createElement(r.RButton,{label:n.ls(1881),style:D,onClick:function(){return k("next")}}),i.createElement(r.HGap,null),c.date_format_2dates(n,E,h.repeat_dateto),i.createElement(r.VGap,null)),i.createElement(r.RButton,{label:n.ls(1882),style:D,onClick:function(){return k("this")}}),i.createElement(r.HGap,null),c.date_format_date(n,E)),x=i.createElement(i.Fragment,null,n.ls(1251)+": ",i.createElement(u.default,{valueRef:w.onSet(function(e){return h.repeat_dates.includes(e)}),date2color:g}))}else S=n.ls(1157),T=[{label:l.action_name("delete"),type:"red",onClick:function(){return k()}},"cancel"];return i.createElement(r.RDialog,{controlRef:v,buttons:T,footer:x,msgType:C,width:400},i.createElement("div",null,S))}e.showDeleteEventDlg=function(e){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return[4,r.RDialog.show(i.createElement(m,{eventid:e}))];case 1:return[2,"deleted"==t.sent()]}})})},e._hotswap=[m]},"/dashboard/server/events.js":function(e,t,n){n.implementRpc(["events_get","events_save","events_delete"])},"/react/prevnextarrows.js":function(e,t,n){e.__esModule=!0;var s=t("react"),r=t("../asc/asc_react");e.default=function(e){var t=e.onPrev||e.onDelta&&function(){return e.onDelta(-1)},n=e.onNext||e.onDelta&&function(){return e.onDelta(1)};return s.createElement(s.Fragment,null,s.createElement("i",{className:r.rtlStr("fa fa-arrow-circle-left"),style:{cursor:"pointer",marginLeft:0},onClick:t,onMouseDown:function(e){return e.preventDefault()}}),s.createElement("i",{className:r.rtlStr("fa fa-arrow-circle-right"),style:r.rtlCss({cursor:"pointer",marginLeft:5}),onClick:n,onMouseDown:function(e){return e.preventDefault()}}))}},"/substitution/online/editduties.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../../timetable/server/timeoff"),i=t("../../timetable/timeoff_r"),a=t("../../asc/edurequest"),o=t("../../asc/asc_react"),l=t("react"),c=[[["."]]];e.timeoff_Icons_subst=[{d:"D",img:"/substitution/pics/must_be_32.svg",name:"{tt:1471}"},{d:"O",img:"/static/pics/time_32.svg",name:"{tt:2529}"},{d:"0",img:"/static/pics/item_bad_32.svg",name:"{tt:1472}"}],e.substVolnoJoiner=function(e,t){return"."==e||" "==e?t:e},e.showSubstTimeoffDlg=function t(n){return s.__awaiter(this,void 0,void 0,function(){var u,d,m,p,b,f,_,h,g,v,y,E,w;return s.__generator(this,function(S){switch(S.label){case 0:return u=a.client_req,d=n.teacherid,m=n.year||u.getSchoolYear(n.date),[4,ASC.blockUI(u.maindbi(m,{needed_part:{teachers:["__name","subst_tt_timeoff"],substonline_dates:["tt_num"]},vt_filter:{date:n.date||void 0}}))];case 1:return p=S.sent(),(b=(b=n.tt_num)||p.rowData("substonline_dates",n.date).tt_num)?[3,3]:[4,o.RDialog.showMessage(l.createElement(l.Fragment,null,u.ls(7244)),{srcFunction:t})];case 2:return S.sent(),[2,!1];case 3:return[4,ASC.blockUI(u.timetabledbi(b,i.TimeoffInput.tt_dbi))];case 4:return f=S.sent(),[4,ASC.loadTTLang()];case 5:for(S.sent(),_=p.rowData("teachers",d).subst_tt_timeoff[b]||c,_=i.timeoff_uncompress(_,f),(h=[]).push({d:"."}),g=0,v=e.timeoff_Icons_subst;g<v.length;g++)y=v[g],h.push(s.__assign(s.__assign({},y),{name:u.localize(y.name)}));return E={timeoff:_},[4,o.RDialog.showInput(E,function(e){var t=e.state,n=e.stateRef;return l.createElement(l.Fragment,null,l.createElement(i.TimeoffInput,{valueRef:n.sub("timeoff"),tt_dbi:f,icons:h,table:"teachers",id:d,overlay:function(e){for(var n=e.term,s=e.week,r=e.day,a=e.period,o=[],m=!1,f=0,_=p.tableData("teachers");f<_.length;f++){var h=_[f],g=h.id==d?t.timeoff:h.subst_tt_timeoff[b]||c,v=i.timeoff_get(g,n,s,r,a,function(e,t){return e==t?e:"D"==e||"D"==t?"*":"*"==e||"*"==t?"*":""});"*"!=v&&"D"!=v||(o.push(p.rowName("teachers",h.id)),"*"==v&&(m=!0))}return 0==o.length?null:l.createElement("div",{style:{position:"absolute",right:3,bottom:3,color:"#000",fontSize:10},title:u.ttls(1471)+":\n"+o.join("\n")},o.length,m&&"*")}}))},{header:u.ttls(1471)+" - "+p.rowName("teachers",d),width:600})];case 6:return(w=S.sent())?(_=i.timeoff_compress(w.timeoff),[4,ASC.blockUI(r.setTeacherSubstTimeoff(null,m,d,b,_))]):[2,!1];case 7:return S.sent(),[2,!0]}})})}},"/timetable/server/timeoff.js":function(e,t,n){n.implementRpc(["setTeacherSubstTimeoff"])},"/substitution/online/subst_popup.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../../asc/edurequest"),i=t("../../rpr/dbi_react"),a=t("../../rpr/dbi"),o=t("react"),l=t("../../asc/asc_react2"),c=t("../../asc/asc_react"),u=t("../../asc/actions"),d=t("../commands"),m=t("../subst"),p=t("./timetable"),b=t("../server/commands"),f=t("../../react/popuppanel"),_=t("../dlg/absent"),h=t("../../calendar/event_popup"),g=t("../subststudents_popup"),v="name";function y(){return o.createElement(o.Fragment,null," ",o.createElement("i",{className:"fa fa-arrow-right"})," ")}function E(e){if(e.hidden)return null;var t=e.text,n=e.orig_text;if(!t&&!n)return null;var s=t;return void 0!==n&&n!==t&&(s=n?o.createElement(o.Fragment,null,n,o.createElement(y,null),t||"(X)"):"+"+t),o.createElement(f.PopupDetail,{label:e.label},s)}function w(e){var t,n=e.dbi,s=e.ttitem,r=e.column,i=s[r],c=null===(t=s.orig)||void 0===t?void 0:t[r];void 0===c&&(c=i);var u=n.column("substonline_ttitems",r);if(!u)return null;var d=u.linkedTable();if(d){var m,p=void 0;m="tableid"==u.type()?(p=[c],[i]):(p=c,i);var b=a.idsArrayMergeUnique(p,m).filter(function(e){return e}).length;if(0==b)return null;for(var _=(s.changes||[]).filter(function(e){return function(e){switch(e){case"subjectid":return"subjects";case"teacherid":case"teacherids":return"teachers";case"classids":return"classes";case"classroomid":case"classroomids":return"classrooms";case"period":return"periods";case"groupnames":return"groupnames";case"igroupid":case"igroupids":return"igroups";default:ASC.dieError("9616420779",e)}}(e.column)==d}),h=function(t){var s,r;if(!t)return"";r=n.rowName(d,t);var i=null===(s=e.item2onClick)||void 0===s?void 0:s.call(e,d,t);return i?o.createElement("span",{style:{color:"inherit",textDecoration:"underline",cursor:"pointer"},onClick:i},r):r},g=[],v=0,y=new Set,w=function(e){var t=e&&_.find(function(t){return t.old==e});y.add(t?t.new:e),t?g.push(o.createElement(o.Fragment,{key:v++},h(e)," âž” ",t.new?h(t.new):"(X)")):g.push(h(e))},S=0,x=p;S<x.length;S++)w(k=x[S]);for(var T=0,C=m;T<C.length;T++){var k;(k=C[T])&&!y.has(k)&&g.push(o.createElement(o.Fragment,{key:v++},"+",h(k)))}return o.createElement(f.PopupDetail,{label:n.tools.itemName(d,b)},o.createElement(l.RJoin,{children:g,glue:", "}))}function D(e){return"groupnames"==r?n.tools.groupnames_names(e):u.textValue(e)}return o.createElement(E,{label:u.name(),text:D(i),orig_text:D(c)})}function S(e){var t=e.dbi,n=e.eventids;return(null==n?void 0:n.length)?o.createElement(f.PopupDetail,{label:e.label||t.tools.itemName("events",n.length)},o.createElement(c.VGap,{height:3}),n.map(function(t){return o.createElement(h.EventBar,{key:t,eventid:t,where:e.where})})):null}function x(e,t,n){var s=e.rowName(t,n);return"classrooms"==t&&(s+=" ("+e.table(t).itemName()+")"),s}function T(e){var t=r.client_req,n=e.absentid,s=n.split(":")[0],l=i.useMainDBI(t.getSchoolYear(s),{needed_part:a.DBITools.mergeNeededParts(T),vt_filter:{date:s}}),u=l.rowData("substonline_absents",n),d=f.useSimplePopup(),p=d[0],b=d[1],_=d[2];if(!u)return null;var h=m.absentGetTable(u),g=m.absentGetId(u);return o.createElement(o.Fragment,null,o.createElement("div",{style:{cursor:"pointer"},onClick:b},o.createElement("img",{src:l.table("substonline_absents").icon(),style:{height:16,verticalAlign:"middle"}}),o.createElement(c.HGap,{width:5}),x(l,h,g)),_&&o.createElement(p,null,o.createElement(k,{absentid:n,where:e.where})))}function C(e){var t=e.dbi,n=e.kolizia,s="?";return n.table&&n.id&&(s=x(t,n.table,n.id)),n.todo&&(s="Unfinished"),o.createElement("div",{style:{}},o.createElement("img",{src:n.todo?m.ICON_subst_todo:m.ICON_subst_kolizia,style:{height:16,verticalAlign:"middle"}}),o.createElement(c.HGap,{width:5}),s)}function k(e){var n=this,b=r.client_req,h=e.absentid,g=e.where,v=e.eventids,y=h.split(":")[0],E=i.useMainDBI(b.getSchoolYear(y),{needed_part:a.DBITools.mergeNeededParts(d.showAbsentDeleteDlg,{substonline_absents:["period","durationperiods","allday","table","teacherid","classid","classroomid","groupname","absent_typeid"],absent_types:["__name"],teachers:["__name"],classes:["__name"],classrooms:["__name"],events:[]}),vt_filter:{date:y}}),w=E.table("substonline_absents"),x=E.rowData("substonline_absents",h,{}),T=m.absentGetTable(x),C=m.absentGetId(x),k=a.DBITools.getUniPeriod(x);return o.createElement(f.PopupWithHeader,{title:w.itemName(),icon:w.icon()},o.createElement(f.PopupDetail,{label:E.tools.itemName(T)},E.rowName(T,C)+("classes"==T&&x.groupname?" "+x.groupname:"")),o.createElement(f.PopupDetail,{label:E.tools.uniperiodLabel(k,x)},E.tools.uniperiodName(k,void 0,x)),x.absent_typeid&&o.createElement(f.PopupDetail,{label:E.tools.itemName("absent_types")},E.rowName("absent_types",x.absent_typeid)),o.createElement(S,{dbi:E,eventids:v,where:"subst"}),o.createElement(l.SeparatorLine,null),o.createElement("div",{style:{display:"flex",flexDirection:"row"}},"subst"==g&&o.createElement(o.Fragment,null,o.createElement(c.RButton,{label:b.ls(1001),onClick:function(){ASC.hidePopups(),p.showSubstTimetableDlg(y,T,C)}}),o.createElement(c.RButton,{label:u.action_name("lessons"),onClick:function(){return s.__awaiter(n,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../online/absentlessons")})];case 1:return e.sent().showAbsentLessonsDlg(x.id),[2]}})})}}),o.createElement(c.HGap,null),o.createElement(c.RButton,{label:u.action_name("delete"),onClick:function(){return d.showAbsentDeleteDlg(E,h)}})),o.createElement("div",{style:{flex:1,width:10}}),o.createElement(c.RButton,{label:u.action_name("edit"),type:"green",onClick:function(){ASC.hidePopups(),_.showSubstAbsentEditDlg(h)}})))}S.npp=a.neededPartProvider(function(){return[h.EventBar]}),(e.SubstTTItemPopup=function e(n){var p,_=this,y=r.client_req,x=n.ttitem,k=n.where,D=n.closeParent,I=n.join_doubles,R=n.dlg,A=n.kolizie,N=x.id.split(":")[0],B=i.useMainDBI(y.getSchoolYear(N),{needed_part:a.DBITools.mergeNeededParts(e),vt_filter:{date:N},suspense:!0}),j=B.rowData("substonline_dates",N,{}),P=!1;function M(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return D?[4,D()]:[3,2];case 1:if(!e.sent())return[2,!1];e.label=2;case 2:return ASC.hidePopups(),[2,!0]}})})}d.isSubstTTItemEditable(B,x)&&!j.uploaded_int&&(P="ttitem"!=k&&"addcard"!=k||!!D);var O=s.__assign(s.__assign({},x),x.orig||{}),z=x.cancelled?s.__assign(s.__assign({},O),{changes:[]}):x,F=y.ls(1301);"classroomsupervision"==x.type&&(F=y.ls(1723));var L="";x.added?L=y.ls(6270):x.cancelled?(L=y.ls(2322),0<x.origofids.length&&(L=y.ls(11611))):0<(null===(p=x.changes)||void 0===p?void 0:p.length)&&(L=y.ls(1826));var G=null;R&&(G=function(e,t){return function(){ASC.hidePopups(),R.setItem(e,t)}});var U=[];P&&(x.cancelled||(U.push({text:y.ttls(1476),onClick:function(){return s.__awaiter(_,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,M()];case 1:return e.sent()?[4,c.RDialog.showConfirm(y.ttls(1476),{msgType:"areyousure"})]:[2];case 2:return e.sent()?[4,ASC.blockUI(b.removeSubstOnlineTTItem(null,x.id,I))]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}}),0<x.classids.length&&U.push({text:y.ls(6201),onClick:function(){return s.__awaiter(_,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,M()];case 1:return e.sent()&&Promise.resolve().then(function(){return t("./splitlesson")}).then(function(e){return e.showSplitTTitemDlg(x.id,I)}),[2]}})})}})));for(var q=B.rowDatas("substonline_substitutions",x.substids||[]),H=q.map(function(e){return e.absentid}).filter(function(e){return e}),V=[],W=0,K=x.changeeventids;W<K.length;W++){var Y=K[W];V.push(o.createElement(h.EventBar,{key:V.length,eventid:Y,where:k}))}return x.studentsinfo.subst&&V.push(o.createElement(g.StudentsinfoSubstBar,{key:V.length,subst:x.studentsinfo.subst,online:!0})),o.createElement(f.PopupWithHeader,{title:F,subtitle:L,icon:x.cancelled?m.ICON_subst_cancelled:"/static/pics/timetables_32.svg"},o.createElement(E,{label:B.tools.uniperiodLabel(x.uniperiod,x),text:B.tools.uniperiodName(x.uniperiod,v,x),orig_text:B.tools.uniperiodName(O.uniperiod,v,x)}),o.createElement(w,{dbi:B,ttitem:z,column:"igroupid",item2onClick:G}),o.createElement(w,{dbi:B,ttitem:z,column:"classids",item2onClick:G}),o.createElement(w,{dbi:B,ttitem:z,column:"groupnames"}),o.createElement(w,{dbi:B,ttitem:z,column:"subjectid"}),o.createElement(w,{dbi:B,ttitem:z,column:"teacherids",item2onClick:G}),o.createElement(w,{dbi:B,ttitem:z,column:"classroomids",item2onClick:G}),q.map(function(e,t){return o.createElement(o.Fragment,{key:t},["substitution_typeid","note","inote"].map(function(t){var n=e[t];if(!n)return null;var s=B.column("substonline_substitutions",t);return o.createElement(E,{key:t,label:s.name(),text:s.textValue(n)})}))}),o.createElement(f.PopupDetail,{label:y.ls(1622),hidden:0==H.length},H.map(function(e){return o.createElement(T,{key:e,absentid:e,where:k})})),o.createElement(S,{dbi:B,eventids:x.eventids,where:k}),o.createElement(f.PopupDetail,{label:y.ls(2060),hidden:0==V.length},o.createElement(c.VGap,{height:3}),V),A&&o.createElement(f.PopupDetail,{label:"Collision"},A.map(function(e,t){return o.createElement("div",{key:t},o.createElement(C,{key:t,dbi:B,kolizia:e}))})),P&&o.createElement(o.Fragment,null,o.createElement(l.SeparatorLine,null),o.createElement("div",{style:{display:"flex",flexDirection:"row"}},n.footer,!x.cancelled&&o.createElement(o.Fragment,null,R&&m.substTTItemMovable(x)&&o.createElement(c.RButton,{label:y.ls(7441),onClick:function(){ASC.hidePopups(),R.setMoveTTItemid(x.id)}})),0<U.length&&o.createElement(c.RButton,{label:y.ls(1768),menu:U}),o.createElement("div",{style:{flex:1,width:10}}),o.createElement(c.RButton,{label:u.action_name("edit"),type:"green",onClick:function(){return s.__awaiter(_,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,M()];case 1:return e.sent()&&d.showTTItemEditDlg(x.id,I),[2]}})})}}))))}).npp=m.substOnlineNeededPartProvider(function(){return[S,T,d.isSubstTTItemEditable,{substonline_ttitems:["__ttitem","type","orig","added","cancelled","changes","substids","origofids","eventids","changeeventids","studentsinfo"],substonline_substitutions:["substitution_typeid","note","inote","absentid"],substonline_dates:["uploaded_int"],subjects:["__name"],classes:["__name"],igroups:["__name"],teachers:["__name"],classrooms:["__name"],substitution_types:["__name"],periods:["__name"],dayparts:["__name"]}]}),T.needed_part=a.typed({substonline_absents:["table","teacherid","classid","classroomid","groupname"],teachers:["__name"],classes:["__name"],classrooms:["__name"]}),e.AbsentPopup=k},"/substitution/commands.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../rpr/dbi"),i=t("react"),a=t("../asc/asc_react"),o=t("../asc/actions"),l=t("./server/commands"),c=t("../asc/edurequest"),u=t("../asc/lib_date"),d=t("./server/generator"),m=t("./subst"),p=t("./dlg/ttitem"),b=t("./dlg/addcard"),f=t("./online/timetable"),_=t("../rpr/dbi_react"),h=t("../asc/asc_react2"),g=c.client_req&&c.client_req.isApp()?"SubstApp":"SubstOnline";function v(e,t){return s.__awaiter(this,void 0,void 0,function(){var n,r;return s.__generator(this,function(s){return e.mock||e.old?[2,!0]:((n=e.rowData("substonline_dates",t))||ASC.dieError("3637166007"),n.uploaded_int?(r=i.createRef(),a.RDialog.showMessage(ASC.ls(2740),{footer:i.createElement(i.Fragment,null,i.createElement(a.RButton,{label:ASC.ls(2741),onClick:function(){r.current.close(),y(t)}})),width:350,controlRef:r}),[2,!0]):[2,!1])})})}function y(e){return s.__awaiter(this,void 0,void 0,function(){var t,n;return s.__generator(this,function(s){switch(s.label){case 0:return t=c.client_req,n=t.ls(2741)+" ("+u.date_format_date(t,e)+") - "+t.ls(1054),[4,a.RDialog.showConfirm(n)];case 1:return s.sent()?[4,l.deleteSubstDay(null,e,{log_module:g})]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}})})}function E(e,t,n){return void 0===n&&(n={}),s.__awaiter(this,void 0,void 0,function(){function n(){return s.__awaiter(this,void 0,void 0,function(){var t,n;return s.__generator(this,function(s){switch(s.label){case 0:return t=e.split(":")[0],[4,ASC.blockUI(r.maindbi(r.getSchoolYear(t),{needed_part:{substonline_substitutions:["origofids","card","tcard"]},vt_filter:{date:t}}))];case 1:return n=s.sent(),o=n.rowData("substonline_substitutions",e),[2]}})})}var r,o,l,u,d,p;return s.__generator(this,function(s){switch(s.label){case 0:return r=c.client_req,[4,n()];case 1:return s.sent(),0<o.origofids.length?(e=o.origofids[0],[4,n()]):[3,3];case 2:s.sent(),s.label=3;case 3:return l=e.split(":")[0],o?(d=u="",0<(p=m.subst_item_tableIds(o,"classes")).length&&(u="classes",d=p[0]),u&&d?[4,a.RDialog.show(i.createElement(f.SubstTimetableDlg,{table:u,id:d,date:l,move_substid:e,join_doubles:t}))]:[3,5]):[3,5];case 4:s.sent(),s.label=5;case 5:return[2]}})})}(e.checkUploaded=v).npp=r.neededPartProvider(function(){return[y,{substonline_dates:["uploaded_int"]}]}),(e.showDayDeleteDlg=y).needed_part=r.typed({}),(e.showAbsentDeleteDlg=function(e,t){return s.__awaiter(this,void 0,void 0,function(){var n,r,c,u,d,p;return s.__generator(this,function(s){switch(s.label){case 0:return n=e.req,r=t.split(":")[0],[4,v(e,r)];case 1:return s.sent()?[2,!1]:(c=e.rowData("substonline_absents",t),u=m.absentGetTable(c),d=m.absentGetId(c),p=n.ttls(2117),c&&"teachers"!=c.table&&(p=o.action_name("delete")+" - "+n.ls(1054)),[4,a.RDialog.showConfirm(i.createElement(i.Fragment,null,n.ls(1622)+": "+e.rowName(u,d),i.createElement(a.VGap,null),p))]);case 2:return s.sent()?[4,l.removeAbsent(null,t)]:[2,!1];case 3:return s.sent(),[2,!0]}})})}).npp=r.neededPartProvider(function(){return[v,{substonline_absents:["table"]}]}),(e.showSubstDeleteDlg=function(e,t,n){return s.__awaiter(this,void 0,void 0,function(){var r,o;return s.__generator(this,function(s){switch(s.label){case 0:return r=e.req,(o=e.rowData("substonline_substitutions",t))||ASC.dieError("5944750757"),o.absent?[4,a.RDialog.show(r.ttlsf(3198,{s:o.absent.name}))]:[3,2];case 1:return s.sent(),[2,!1];case 2:return[4,a.RDialog.showConfirm(i.createElement(i.Fragment,null,r.ls(1054)))];case 3:return s.sent()?[4,l.removeSubstSubstitution(null,t,n)]:[2,!1];case 4:return s.sent(),[2,!0]}})})}).needed_part=r.typed({substonline_substitutions:["absent"]}),e.SubstNeedsRegenerateBar=function(e){var n=c.client_req,r="Substitution needs to be regenerated. (There was probably some change in the timetable, Edupage database, etc.)";return"de"==ASC.lang&&(r="Die Vertretung muss neu aufgebaut werden. (Scheinbar gab es im Stundenplan oder in der Edupage Datenbank VerÃ¤nderungen o.Ã¤.)"),"sk"!=ASC.lang&&"cz"!=ASC.lang||(r="Suplovanie je potrebnÃ© pregenerovaÅ¥. (Pravdepodobne doÅ¡lo ku zmene rozvrhu, Edupage databÃ¡zy a podobne...)"),i.createElement(i.Fragment,null,i.createElement(a.RButton,{label:n.ls(2790),icon:"/static/pics/reload_32.png",onClick:function(){return function(e){var n;return s.__awaiter(this,void 0,void 0,function(){function r(e){var t=e.subst,n=e.dbi,s=m.subst_item(t),r=n.tools.ttitem_popis(s);return i.createElement("div",null,i.createElement("span",null,r.period)," - ",r.subject,", ",r.class,", ",r.teacher," (",r.classroom,")")}var l,u,p,b,f,_;return s.__generator(this,function(m){switch(m.label){case 0:return l=c.client_req,[4,ASC.blockUI(d.getRegenerateInfo(null,e))];case 1:return u=m.sent(),[4,ASC.blockUI(l.maindbi(l.getSchoolYear(e),{vt_filter:{date:e},needed_part:{substonline_substitutions:["card","tcard","classroomsupervision"],subjects:["__name"],classes:["__name"],teachers:["__name"],classrooms:["__name"],igroups:["__name"],periods:["__name"],dayparts:["__name"]}}))];case 2:return p=m.sent(),b={marginBottom:20},[4,a.RDialog.showMessage(i.createElement("div",{style:{overflow:"auto",flex:"1 1",minHeight:100}},i.createElement("h1",null,ASC.ls(2790)),i.createElement("div",null,i.createElement("b",null,ASC.ls(1920),":")),i.createElement("div",{style:{paddingLeft:15,maxHeight:600,overflow:"auto"}},0<u.remove_substids.length&&i.createElement("div",{style:b},i.createElement("div",null,o.action_name("delete"),":"),u.remove_substids.map(function(e){return i.createElement(r,{key:e,subst:p.rowData("substonline_substitutions",e)||{},dbi:p})})),0<u.update_substs.length&&i.createElement("div",{style:b},i.createElement("div",null,ASC.ls(7722),":"),u.update_substs.map(function(e,t){return i.createElement(r,{key:""+t,subst:s.__assign(s.__assign({},p.rowData("substonline_substitutions",e.id)||{}),e),dbi:p})})),0<u.add_substs.length&&i.createElement("div",{style:b},i.createElement("div",null,o.action_name("add"),":"),u.add_substs.map(function(e,t){return i.createElement(r,{key:""+t,subst:e,dbi:p})})),(null===(n=u.update_date)||void 0===n?void 0:n.subst_problems)&&i.createElement("div",{style:b},i.createElement("div",null,l.ls(2025)),u.update_date.subst_problems.map(function(e,t){return i.createElement("div",{key:t},e.text)})))),{buttons:["ok","cancel"],width:500})];case 3:return m.sent()?(_=(f=ASC).blockUI,[4,Promise.resolve().then(function(){return t("./server/generator")})]):[3,6];case 4:return[4,_.apply(f,[m.sent().regenerateDay(null,e)])];case 5:return m.sent(),[2,!0];case 6:return[2,!1]}})})}(e.date)}}),r)},e.showFeedbackDlg=function(){barNewDialog({source:"/znamky/?jwgc=ZnamkyFeedbackDialog"})},e.showNotifications=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return t("../timeline/notifications")})];case 1:return e.sent().showGenericNotifications("substitution",ASC.ls(1003)),[2]}})})},(e.isSubstTTItemEditable=function(e,t){try{var n=t.type;return("card"==n||"tcard"==n||"classroomsupervision"==n)&&!t.cancelled_absent}catch(t){if(e.mock)return!1;throw t}}).needed_part=r.typed({substonline_ttitems:["type","cancelled_absent"]}),(e.showTTItemEditDlg=function e(t,n,i){return void 0===i&&(i={}),s.__awaiter(this,void 0,void 0,function(){var a,o,l,u,d,f,h,g;return s.__generator(this,function(s){switch(s.label){case 0:return a=c.client_req,o=i.filter,l=t.split(":")[0],u=a.getSchoolYear(l),(f=i.dbi)?[3,2]:[4,ASC.blockUI(a.maindbi(u,{needed_part:r.DBITools.mergeNeededParts(e),vt_filter:{date:l}}))];case 1:f=s.sent(),s.label=2;case 2:return(h=(d=f).rowData("substonline_ttitems",t)).cancelled&&1==h.origofids.length?(g=h.origofids[0]).split(":")[0]!=l?[3,3]:(t=g,h=d.rowData("substonline_ttitems",t),[3,5]):[3,5];case 3:return[4,E(h.substids[0],n)];case 4:return s.sent(),[2];case 5:return 1==h.substids.length&&m.substIsAddCard(d.rowData("substonline_substitutions",h.substids[0]))?[4,b.showSubstEditAddCardDlg(u,h.substids[0],{join_doubles:n})]:[3,7];case 6:return s.sent(),[2];case 7:return 0<h.origofids.length&&ASC.dieError("8792878433"),h.origsubstid&&!h.substids.includes(h.origsubstid)?(alert("TODO origsubstid presun"),[2]):[4,_.showRDialogWithDbi({dlg:p.SubstEditTTItemDlg,date:t.split(":")[0],ttitemid:t,select_change:i.select_change,join_doubles:n,filter:o})];case 8:return s.sent(),[2]}})})}).npp=m.substOnlineNeededPartProvider(function(){return[m.substIsAddCard,{substonline_ttitems:["cancelled","origofids","substids"]},p.SubstEditTTItemDlg,b.SubstEditAddCardDlg]}),e.showMoveSubstDlg=E,e.showSubstDaysDlg=function(e){return s.__awaiter(this,void 0,void 0,function(){var n;return s.__generator(this,function(s){switch(s.label){case 0:return[4,Promise.resolve().then(function(){return t("./online/days")})];case 1:return n=s.sent().SubstDaysDlg,a.RDialog.show(i.createElement(n,{date:e.date,onGoToDate:e.onGoToDate})),[2]}})})},e.showSubstPublishDlg=function(e,t){return void 0===t&&(t={}),s.__awaiter(this,void 0,void 0,function(){var t,n,o,d,m,p,b,f,_,v,y,E,w,S;return s.__generator(this,function(x){switch(x.label){case 0:return t=c.client_req,[4,l.getSubstPublishData(null,e)];case 1:return n=x.sent(),o=n.dates,"???",d=r.idsArrayMatch(o,[e])?t.ls(2744):t.lsf(2827,{n:o.length})+"\n\n("+u.date_format_dates(t,o)+")",m=null,p=i.createRef(),f=!(b=[]),o.includes(e)&&(b.push({label:t.ls(1727)+" ("+u.date_format_date(t,e)+")",type:"green",onClick:function(){m="day",p.current.confirmClose()}}),f=!0),(1<o.length||!f)&&b.push({label:(f?t.ls(1349):t.ls(1587))+" ("+t.lsf(10514,{n:o.length})+")",type:f?"blue":"green",onClick:function(){m="all",p.current.confirmClose()}}),b.push("cancel"),_="tr"==t.school_country||"ascpalo"==t.edupage,[4,a.RDialog.showInput(n,function(e){var n=e.stateRef;return i.createElement(i.Fragment,null,i.createElement(h.DlgHeader,{title:t.ls(1587),icon:"/static/pics/item_ok_32.svg",inDlg:!0,small:!0}),i.createElement("div",{style:{whiteSpace:"pre-wrap"}},d,i.createElement(a.VGap,null),t.ls(1587)+"?",_&&i.createElement(i.Fragment,null,i.createElement(h.SeparatorLine,null),i.createElement(a.RCheckBox,{valueRef:n.sub("skipTeachers").not(),label:t.ls(7373)}),i.createElement("br",null),i.createElement(a.RCheckBox,{valueRef:n.sub("skipStudents").not(),label:t.ls(7374)}),i.createElement("br",null))))},{width:500,buttons:b,controlRef:p})];case 2:return v=x.sent(),m&&v?_?[4,ASC.blockUI(l.updateSubstPublishData(null,e,{skipTeachers:v.skipTeachers,skipStudents:v.skipStudents}))]:[3,4]:[2];case 3:x.sent(),x.label=4;case 4:y=[],"day"==m&&(y=[e]),"all"==m&&(y=o),E=0,w=y,x.label=5;case 5:return E<w.length?(S=w[E],[4,ASC.blockUI(l.publishDay(null,S,s.__assign({log_module:g},_?{skipTeachers:v.skipTeachers,skipStudents:v.skipStudents}:{})))]):[3,8];case 6:x.sent(),x.label=7;case 7:return E++,[3,5];case 8:return[2]}})})}},"/substitution/server/generator.js":function(e,t,n){n.implementRpc(["getRegenerateInfo","regenerateDay","generateSubstitution"])},"/substitution/dlg/ttitem.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("../../rpr/dbi"),a=t("../../asc/asc_react"),o=t("../subst"),l=t("../../asc/edurequest"),c=t("../../asc/asc_react2"),u=t("../online/timetable"),d=t("../../asc/actions"),m=t("../server/commands"),p=t("../online/combo"),b=t("../online/rightpanel"),f=t("../../react/pickfromhistory"),_=t("../../react/datatable"),h=t("../../react/combobox"),g=t("../../asc/lib_date"),v=t("../commands"),y=t("../../rpr/maindbi_ui"),E="substonline_substitutions",w="substonline_ttitems",S="_no_teacher_",x={display:"flex",flexDirection:"row",minHeight:23,alignItems:"center"},T={flex:"0.7 1 0px",minWidth:0},C={flex:"1 1 0px",minWidth:0,textAlign:"right"};function k(e){var t=e.dbi,n=e.table,s=e.valueRef,c=e.orig_value,u=e.disable_change,d=e.should_change,m=e.kolizie,b=e.cancelled,f=e.absents,_=e.join_duration,g=e.filter,v=e.ttdbi,y=e.editing_ttitem,E=e.remove_ttitemids,w=e.onCombo,k=l.client_req,D=k.isApp(),I=e.new_value||"";s&&(I=s.value);var R=!1,A=r.useState(!(!s||u||!d&&I==c)),N=A[0],B=A[1];u||I==c||N||B(!0);var j=e.orig_text;j||c&&(j=t.tools.rowName(n,c),"groupnames"==n||t.rowData(n,c)||(R=!0));var P=e.new_text||"";!P&&I&&(P=t.tools.rowName(n,I)),"periods"==n&&1<_&&(j+="-"+t.rowName("periods",i.DBITools.uniperiod_delta(c,_-1)),P+="-"+t.rowName("periods",i.DBITools.uniperiod_delta(I,_-1)));var M=r.useMemo(function(){if(!N)return[];var e;if("teachers"==n||"classrooms"==n){e=[{value:"",name:"-"},[]];for(var s=0,r=p.substTTItemComboItems({table:n,dbi:t,tt_dbi:v,ttitem:y,remove_ttitemids:E,topid:I,filter:g});s<r.length;s++){var a=r[s];e.push({value:a.id,name:t.rowName(n,a.id,"teachers"==n?l.client_req.sort_name_col+"u":void 0),classname:a.className})}"teachers"==n&&(e.push([]),e.push({value:S,name:ASC.ttls(3118)}))}else if("periods"==n&&1<_){e=[];for(var o=0,c=t.tableIds("periods");o<c.length;o++){var u=c[o],d=i.DBITools.uniperiod_delta(u,_-1);t.rowData("periods",d)&&e.push({value:u,name:t.rowName("periods",u)+"-"+t.rowName("periods",d)})}}else e=t.tools.tableCombo(n,void 0,0<=["subjects","periods"].indexOf(n)?null:void 0);return e},[N,t,n,v,y,E,g,I]),O=null;if(m)for(var z=!1,F=!1,L=0,G=m;L<G.length;L++){var U=G[L];U.table==n&&U.id==I&&(U.join?F=!0:z=!0),(z||F)&&(O=r.createElement("img",{src:z?o.ICON_subst_kolizia:o.ICON_subst_spojenie,style:{height:16,verticalAlign:"middle",paddingTop:-3,display:"inline-block",marginLeft:7},title:z?ASC.ttls(3447):ASC.ttls(1535)}))}var q=!1;if(c&&f)for(var H=0,V=f;H<V.length;H++){var W=V[H];o.absentGetTable(W)==n&&o.absentGetId(W)==c&&(q=!0)}var K=R&&r.createElement("img",{src:"/static/pics/unlink_32.svg",style:{height:24,verticalAlign:"middle",marginLeft:5},title:k.ls(3109)}),Y=r.createElement("span",{style:D?{color:"#c0c0c0"}:{textAlign:"right",verticalAlign:"middle",fontWeight:q?"bold":"normal"}},q?"("+j+")":j),J=null,Z=null,$=null;return J=D?r.createElement("span",{style:{color:"#c0c0c0",marginLeft:4}},j?"âž”":"+"):r.createElement("img",{src:"/static/pics/replace_32.svg",style:{verticalAlign:"middle",height:16,padding:"0px 5px"}}),b?Z=r.createElement(r.Fragment,null):u?Z=r.createElement(r.Fragment,null,P||(q?ASC.ls(1846):"-")):N?Z=r.createElement(h.default,{valueRef:s,items:M,style:"periods"==n?{}:{minWidth:150,width:D?"100%":void 0},onClick:w?function(){return w(),!1}:void 0}):(Z=r.createElement(r.Fragment,null,P),u||R||($=r.createElement("a",{style:{marginLeft:7,fontSize:"80%",color:"#a0a0a0",cursor:"pointer"},onClick:function(){B(!0)}},ASC.ls(1090)))),j!=P||q||N||(Y=j,Z=J=null),D?r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},r.createElement("div",{style:{flex:"1 1 0px",position:"relative"}},Y,J),K,$),r.createElement(a.VGap,{height:3}),r.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},r.createElement("div",{style:{flex:"1 1 0px",position:"relative"}},Z),O)):r.createElement("div",{style:x},r.createElement("div",{style:T},Y,K),J,r.createElement("div",{style:C},Z,O,$))}function D(e){var t=e.align,n=e.children;return l.client_req.isApp()?r.createElement("div",{style:{textAlign:t}},n):r.createElement("div",{style:x},r.createElement("div",{style:T},"left"==t&&n),r.createElement("div",{style:C},"right"==t&&n))}function I(e){return r.createElement(D,{align:"right"},r.createElement("a",{style:{marginLeft:7,fontSize:"80%",color:"#a0a0a0",cursor:"pointer"},onClick:e.onClick},ASC.ls(1257)))}function R(e){var t=this,n=l.client_req,p=e.dbi,b=e.ttdbi,_=e.select_change,v=e.ttitemid,y=e.join_doubles,x=e.filter,T=v.split(":")[0];a.useTTLang();var C=a.useStateValueRef(function(){var e=p.rowData(w,v),t=s.__assign({},e.orig||o.coreOfTTItem(e));t.teacherids=s.__spreadArrays(t.teacherids),t.classroomids=s.__spreadArrays(t.classroomids);for(var n=s.__assign(s.__assign({},t),{teacherids:s.__spreadArrays(t.teacherids),classroomids:s.__spreadArrays(t.classroomids),classids:s.__spreadArrays(t.classids)}),r={absents:[],orig_row:t,row:n,cancelled:e.cancelled,teacherids_cancelled:[],substs:[]},a=[],l=0,c=e.substids;l<c.length;l++){var u=c[l],d=p.rowData(E,u);if(d.absent&&r.absents.push(d.absent),!o.subst_isTargetAbsent(d)&&(r.substs.push(d),a=o.mergeSubstChanges(a,o.substBasicChanges(d)),d.cancel_teacher))for(var m=0,b=d.changes;m<b.length;m++){var f=b[m];if("teachers"==o.changeColumn2table(f.column)&&f.old)for(var h=0;h<t.teacherids.length;h++)t.teacherids[h]==f.old&&(r.teacherids_cancelled[h]=!0)}}for(var g=0,y=e.cancelled?a:e.changes;g<y.length;g++)switch(T=(f=y[g]).column){case"subjectid":case"igroupid":n.subjectid=f.new||"";break;case"period":n.uniperiod=f.new||"";break;default:"teacherid"==T&&(T="teacherids");var S=t[T],x=n[T];if(f.old){for(h=0;h<S.length;h++)if(S[h]==(f.old||"")){x[h]=f.new||"";break}}else S.push(""),x.push(f.new)}if(_){var T,C=!1,k=n[T=i.DBITools.removeEs(o.changeColumn2table(_.column))+"ids"],D=t[T];for(h=0;h<D.length;h++)if(D[h]==_.old){C=!0,k[h]=_.new;break}C||(_.old&&ASC.dieError("2580200144"),D.push(_.old||""),k.push(_.new||""))}return 0==r.substs.length&&r.substs.push({id:"",substitution_typeid:"",note:"",inote:"",changes:[]}),r}),R=C.value,B=R.row,j=R.orig_row,P=R.cancelled,M=R.absents,O=R.substs,z=R.teacherids_cancelled,F=n.isApp(),L=!1;function G(e,t,n){e:for(var s=0;s<n.length;s++){var r=n[s];if(r=r||t[s]){for(var i=0,a=Q;i<a.length;i++){var o=a[i];if(o.table==e&&o.id==r)continue e}Q.push({table:e,id:r})}}}(["ascpalo","schillertest2","esg-filderstadt","goethe-schule"].includes(n.edupage)||["de","at","ch"].includes(n.school_country))&&(L=!0);var U=r.useMemo(function(){return o.buildSubstOnlineTTItemsEx(p,T,y)},[p,T,y]).find(function(e){return e.id==v}),q=U.durationperiods,H=C.sub("row"),V={verticalAlign:"top"},W=s.__assign({},V),K=s.__assign({},V),Y={display:"none"},J={},Z={},$="period"==i.DBITools.typeOfUniPeriod(B.uniperiod)&&!P,X="classroomsupervision"!=B.type,Q=[];"classroomsupervision"==B.type?(G("classrooms",j.classroomids,B.classroomids),G("teachers",j.teacherids,B.teacherids)):(j.igroupid&&Q.push({table:"igroups",id:j.igroupid}),G("classes",j.classids,B.classids),P||(G("teachers",j.teacherids,B.teacherids),G("classrooms",j.classroomids,B.classroomids))),Q=a.useMemoStructure(Q);var ee=s.__assign(s.__assign({},B),{id:"_editing_",date:T,subId:"",type:"classroomsupervision"==B.type?"classroomsupervision":"tcard",durationperiods:q});function te(){var t={remove:[],update:[],add:[]};try{for(var n=p.rowData(w,e.ttitemid),s=A({dbi:p,ttitem:n,orig_row:j,row:B,teacherids_cancelled:z,cancelled:P,prev_substs:O,final:!0}),r=new Set,a=0,l=s;a<l.length;a++){var c={note:(f=l[a]).note,inote:f.inote,changes:f.changes,substitution_typeid:f.substitution_typeid,cancelled:f.cancelled,cancel_teacher:f.cancel_teacher};if(f.id){r.add(f.id);var u=p.rowData(E,f.id);o.substChangesEquals(c.changes,u.changes)&&(c.changes=u.changes),P&&(c.changes=void 0);var d=i.DBITools.rowChanges2write(u,c);d&&t.update.push(i.unpartial(d))}else t.add.push(c)}for(var m=0,b=n.substids;m<b.length;m++){var f,_=b[m];(f=p.rowData(E,_)).absent||r.has(f.id)||t.remove.push(f.id)}}catch(t){if(!p.old&&!p.mock)throw t}return t}function ne(){var e=te();return 0!=e.add.length||0!=e.update.length||0!=e.remove.length}function se(){return s.__awaiter(t,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return ne()?[4,ASC.blockUI(s.__awaiter(t,void 0,void 0,function(){var e,t,n,r,i,a,o,l,c;return s.__generator(this,function(s){switch(s.label){case 0:e=te(),t=0,n=e.update,s.label=1;case 1:return t<n.length?(a=n[t],[4,m.updateSubstSubstitution(null,a.id,a,y)]):[3,4];case 2:s.sent(),s.label=3;case 3:return t++,[3,1];case 4:r=0,i=e.add,s.label=5;case 5:return r<i.length?(a=i[r],[4,m.addSubstSubstitution(null,v,a,y)]):[3,8];case 6:s.sent(),s.label=7;case 7:return r++,[3,5];case 8:o=0,l=e.remove,s.label=9;case 9:return o<l.length?(c=l[o],[4,m.removeSubstSubstitution(null,c,y)]):[3,12];case 10:s.sent(),s.label=11;case 11:return o++,[3,9];case 12:return[2]}})}))]:(oe.current.close(),[2]);case 1:return e.sent(),oe.current.confirmClose(),[2]}})})}P&&(ee.orig=o.coreOfTTItem(ee),ee.cancelled=!0,ee.subjectid="",ee.classids=[],ee.igroupid="",ee.teacherids=[],ee.classroomids=[]),ee=a.useMemoStructure(ee);var re=a.useMemoStructure(s.__spreadArrays([U.id],U.join_ttitemids||[])),ie=r.useMemo(function(){return u.getSubstTTItemKolizie(p,b,ee,re)},[p,b,ee,re]),ae="classroomsupervision"!=U.type&&!P,oe=r.useRef(),le=!i.idsArrayMatch(B.groupnames,B.groupnames)||!i.DBITools.groupnamesIsEntireClass(B.groupnames),ce=a.useHandler(function(e){return H.set(s.__assign(s.__assign({},B),{uniperiod:e,endtime:""}))}),ue=a.useMemoStructure({where:"ttitem",closeParent:a.useHandler(function(){return s.__awaiter(t,void 0,void 0,function(){var e;return s.__generator(this,function(t){switch(t.label){case 0:return ne()?[4,a.RDialog.showMessage(n.ls(1037)+"?",{msgType:"question",buttons:["yes","no","cancel"]})]:[3,2];case 1:if(!(e=t.sent()))return[2,!1];if("no"==e)return oe.current.close(),[2,!0];t.label=2;case 2:return[4,se()];case 3:return t.sent(),[2,!0]}})})}),date:T,dbi:p,tt_dbi:b,items:Q,style:a.useMemoStructure({height:Math.min(50+60*Q.length,300)}),small:!0,remove_ttitemids:re,editing_ttitems:a.useMemoStructure([ee]),join_doubles:y,onPeriodClick:$?ce:null,kolizie:ie}),de=r.useMemo(function(){return r.createElement(u.SubstDlgTimetableView,s.__assign({},ue))},[ue]);return r.createElement(a.RDialog,{header:ASC.ls(1003)+" - "+g.date_format_day(l.client_req,T)+(ne()?"*":""),width:970,controlRef:oe,onConfirm:function(){return se()},buttons:F?["ok"]:["ok","cancel"],footer:r.createElement(a.RButton,{label:d.action_name("help"),fa_icon:d.action_fa_icon("help"),onClick:function(){return window.open("https://help.edupage.org/text.php?id=1639","_blank")}})},r.createElement(a.VGap,{height:6}),"classroomsupervision"!=B.type&&r.createElement(r.Fragment,null,r.createElement(c.HorizontalSplit,null,r.createElement(c.SectionWithIcon,{icon:p.table("subjects").icon(),small:!0,verticalCenter:F,style:W},r.createElement(a.RLabel,{text:p.table("subjects").itemName()+":",style:Y}),r.createElement(k,{dbi:p,table:"subjects",orig_value:j.subjectid,valueRef:H.sub("subjectid"),cancelled:P})),j.igroupid?r.createElement(c.SectionWithIcon,{icon:p.table("igroups").icon(),small:!0,style:K},r.createElement(k,{dbi:p,table:"igroups",orig_value:j.igroupid,new_value:B.igroupid,disable_change:!0,kolizie:ie,cancelled:P,absents:M})):r.createElement(c.SectionWithIcon,{icon:p.table("classes").icon(),small:!0,verticalCenter:F,style:K},r.createElement(a.RLabel,{text:p.table("classes").itemName()+":",style:Y}),j.classids.map(function(e,t){return r.createElement(k,{key:""+t,dbi:p,table:"classes",orig_value:e,new_value:B.classids[t],disable_change:!0,kolizie:ie,cancelled:P,absents:M})}),le&&r.createElement(r.Fragment,null,r.createElement(a.VGap,{height:5}),r.createElement(k,{dbi:p,table:"groupnames",orig_text:p.tools.groupnames_names(j.groupnames),new_text:p.tools.groupnames_names(B.groupnames),disable_change:!0,cancelled:P})))),r.createElement(c.SeparatorLine,{style:J})),r.createElement(c.HorizontalSplit,null,r.createElement(c.SectionWithIcon,{icon:p.table("teachers").icon(),small:!0,verticalCenter:F,style:W},r.createElement(a.RLabel,{text:p.table("teachers").itemName()+":",style:Y}),B.teacherids.map(function(e,t){var i=C.cast(function(e){return e.row.teacherids[t]||(e.teacherids_cancelled[t]?S:"")},function(e,n){return n=s.__assign(s.__assign({},n),{row:s.__assign(s.__assign({},n.row),{teacherids:s.__spreadArrays(n.row.teacherids)}),teacherids_cancelled:s.__spreadArrays(n.teacherids_cancelled)}),e==S?(n.row.teacherids[t]="",n.teacherids_cancelled[t]=!0):(n.row.teacherids[t]=e,n.teacherids_cancelled[t]=!1),n});return r.createElement(k,{key:""+t,dbi:p,table:"teachers",filter:x,ttdbi:b,editing_ttitem:ee,remove_ttitemids:re,orig_value:j.teacherids[t]||"",valueRef:i,kolizie:ie,cancelled:P,should_change:!j.teacherids[t],absents:M,onCombo:n.isApp()?function(){return a.RDialog.show(r.createElement(N,{table:"teachers",valueRef:i,ttitemid:v,dbi:p,tt_dbi:b,join_doubles:y}))}:void 0})}),ae&&(0==B.teacherids.length||B.teacherids[B.teacherids.length-1])&&r.createElement(I,{onClick:function(){C.sub("row").set(s.__assign(s.__assign({},B),{teacherids:s.__spreadArrays(B.teacherids,[""])})),C.sub("orig_row").set(s.__assign(s.__assign({},j),{teacherids:s.__spreadArrays(j.teacherids,[""])}))}})),r.createElement(c.SectionWithIcon,{icon:p.table("classrooms").icon(),small:!0,verticalCenter:F,style:K},r.createElement(a.RLabel,{text:p.table("classrooms").itemName()+":",style:Y}),B.classroomids.map(function(e,t){return r.createElement(k,{key:""+t,dbi:p,table:"classrooms",filter:x,ttdbi:b,editing_ttitem:ee,remove_ttitemids:re,orig_value:j.classroomids[t]||"",valueRef:H.sub("classroomids").index(t),disable_change:!X,kolizie:ie,cancelled:P,should_change:!j.classroomids[t],absents:M})}),ae&&(0==B.classroomids.length||B.classroomids[B.classroomids.length-1])&&r.createElement(I,{onClick:function(){C.sub("row").set(s.__assign(s.__assign({},B),{classroomids:s.__spreadArrays(B.classroomids,[""])})),C.sub("orig_row").set(s.__assign(s.__assign({},j),{classroomids:s.__spreadArrays(j.classroomids,[""])}))}}))),r.createElement(c.SeparatorLine,{style:J}),r.createElement(c.HorizontalSplit,null,r.createElement(c.SectionWithIcon,{icon:"/static/pics/alarm_48.png",small:!0,verticalCenter:F,style:s.__assign(s.__assign({},W),{minHeight:70})},r.createElement(a.RLabel,{text:ASC.ls(1345)+":",style:Y}),$?r.createElement(k,{dbi:p,table:"periods",orig_value:j.uniperiod,valueRef:H.sub("uniperiod"),cancelled:P,join_duration:q}):r.createElement(k,{dbi:p,table:"periods",orig_text:p.tools.uniperiodName(j.uniperiod,void 0,j)||"-",new_text:p.tools.uniperiodName(B.uniperiod,void 0,B)||"-",disable_change:!0,cancelled:P}),r.createElement("br",null),r.createElement(D,{align:F?"left":"right"},r.createElement(a.RCheckBox,{valueRef:C.sub("cancelled"),label:ASC.ls(2322)}))),r.createElement("div",null,r.createElement(c.SectionWithIcon,{icon:p.table("substitution_types").icon(),small:!0,style:K},O.map(function(e,n){var i=C.sub("substs").index(n);return 1==O.length?r.createElement(a.Fragment,{key:""+n},P||r.createElement(r.Fragment,null,r.createElement(a.RLabel,{text:p.column(E,"substitution_typeid").name()+":",style:Z}),r.createElement(h.default,{valueRef:i.sub("substitution_typeid"),items:p.tools.tableCombo("substitution_types"),style:{width:F?"100%":200}}),r.createElement(a.VGap,{height:3})),r.createElement(a.RLabel,{text:p.column(E,"note").name(),style:s.__assign(s.__assign({},Z),{verticalAlign:"top"})}),r.createElement(a.RTextArea,{valueRef:i.sub("note"),style:{width:F?"100%":200}}),r.createElement(f.PickFromHistory,{valueRef:i.sub("note"),table:"substonline_substitutions",column:"note",date:T})):r.createElement("div",{key:""+n},r.createElement("div",{style:{fontSize:"80%",color:"#808080"}},function(e,t){for(var n=t.absent?o.absentGetTable(t.absent):"teachers",s=null,r=null,i=0,a=t.changes;i<a.length;i++){var l=a[i],c=o.changeColumn2table(l.column);"teachers"==c?s=l:c==n&&(r=l)}var u=[];return s&&u.push(s),r&&u.push(r),0!=u.length?u.map(function(t){var n=o.changeColumn2table(t.column);return e.tools.rowName(n,t.old)+" -> "+e.tools.rowName(n,t.new)}).join(", "):t.absent?"("+e.rowName(o.absentGetTable(t.absent),o.absentGetId(t.absent))+")":""}(p,e)),P||r.createElement(h.default,{valueRef:i.sub("substitution_typeid"),items:p.tools.tableCombo("substitution_types"),style:{width:200}}),r.createElement(a.HGap,{width:4}),r.createElement("a",{style:{cursor:"pointer",display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis"},onClick:function(){return s.__awaiter(t,void 0,void 0,function(){var t;return s.__generator(this,function(n){switch(n.label){case 0:return[4,a.RDialog.showInput({note:e.note},function(e){return r.createElement("div",null,r.createElement(a.RTextArea,{valueRef:e.stateRef.sub("note"),style:{height:50}}),r.createElement(f.PickFromHistory,{valueRef:e.stateRef.sub("note"),table:"substonline_substitutions",column:"note",date:T}))},{header:p.column(E,"note").name()})];case 1:return(t=n.sent())&&i.sub("note").set(t.note),[2]}})})}},p.column(E,"note").name()+(e.note?": "+e.note:"")),r.createElement(a.VGap,{height:5}))})),L&&r.createElement(c.SectionWithIcon,{icon:"/substitution/pics/inote_32.svg",small:!0,style:K},r.createElement(a.RLabel,{text:p.column(E,"inote").name(),style:s.__assign(s.__assign({},Z),{verticalAlign:"top"})}),r.createElement(a.RTextArea,{valueRef:C.sub("substs").index(0).sub("inote"),style:{width:F?"100%":200}})))),r.createElement(c.SeparatorLine,{style:J}),r.createElement("div",{style:{minHeight:200,overflow:"auto"}},de),r.createElement(a.RUpdateListener,{updateTriggers:[B,P],onUpdate:function(){var e=A({dbi:p,ttitem:U,orig_row:j,row:B,teacherids_cancelled:z,cancelled:P,prev_substs:O,final:!1});C.sub("substs").set(e)},onMount:function(){return oe.current.center()}}))}function A(e){var t=e.dbi,n=e.ttitem,r=e.orig_row,a=e.row,l=e.teacherids_cancelled,c=e.prev_substs,u=e.cancelled,d=e.final,m=[],p=function(e,t){void 0===t&&(t="normal");for(var n=0,s=e.tableData("substitution_types");n<s.length;n++){var r=s[n];if(r.default_for==t)return r.id}return""}(t,"classroomsupervision"==n.type?"classroomsupervision":"normal"),b=[],f=new Set,_=[],h=[],g="classroomsupervision"==n.type?"teacherid":"teacherids";if(!u){for(var v=c.filter(function(e){return!o.subst_isTargetAbsent(e)}).filter(function(e){return e.absent}).filter(function(e){return"classrooms"==o.absentGetTable(e.absent)}).map(function(e){return o.absentGetId(e.absent)}),y=0;y<a.teacherids.length;y++){var E=r.teacherids[y]||"";!(w=a.teacherids[y]||"")&&l[y]&&E&&f.add(E),w!=E&&b.push({column:g,old:E||void 0,new:w||void 0})}for(y=0;y<a.classroomids.length;y++){var w,S={column:"classroomids",old:(E=r.classroomids[y]||"")||void 0,new:(w=a.classroomids[y]||"")||void 0};0<=v.indexOf(E)?_.push(S):w!=E&&h.push(S)}a.subjectid!=r.subjectid&&h.push({column:"subjectid",old:r.subjectid,new:a.subjectid}),a.uniperiod!=r.uniperiod&&("period"!=i.DBITools.typeOfUniPeriod(a.uniperiod)&&ASC.dieError("1066666158"),h.push({column:"period",old:r.uniperiod,new:a.uniperiod}))}for(var x=[],T=[],C=[],k=0,D=c;k<D.length;k++){var I=(O=D[k]).absent?o.absentGetTable(O.absent):"";"teachers"==I?x.push(O):"classrooms"==I?T.push(O):C.push(O)}for(var R=new Set,A=function(e){for(var t=0,n=e.changes;t<n.length;t++){var s=n[t];if("teachers"==o.changeColumn2table(s.column))return}for(var r=0,i=b;r<i.length;r++)if(s=i[r],!R.has(s)){e.changes.push(s),R.add(s),e.cancel_teacher=f.has(s.old);break}},N=function(e){if(!(e.cancelled=u))for(var t=0,n=h;t<n.length;t++){var s=n[t];e.changes.push(s)}},B=function(){if(R.size<b.length)return!1;if((0<h.length||u)&&0==m.length)return!1;if(0==m.length){if(!d)return!1;var e=c[0];if(e&&(e.substitution_typeid||e.note||e.inote))return!1}return!0},j=0,P=x;j<P.length;j++){var M=P[j],O=s.__assign(s.__assign({},M),{changes:[],cancelled:u});if(!u){for(var z=o.absentGetId(O.absent),F=!1,L=0,G=b;L<G.length;L++)(K=G[L]).old==z&&(R.add(K),O.changes.push(K),O.cancel_teacher=f.has(K.old),F=!0);F||(ASC.logProblem("0897145113"),O.changes.push({column:g,old:z,new:z}))}N(O),m.push(O)}for(var U=0,q=T;U<q.length;U++){if(M=q[U],O=s.__assign(s.__assign({},M),{changes:[],cancelled:u}),!u){for(var H=o.absentGetId(O.absent),V=(F=!1,0),W=_;V<W.length;V++){var K;(K=W[V]).old==H&&(O.changes.push(K),F=!0)}F||(ASC.logProblem("9288323371"),O.changes.push({column:"classroomids",old:H,new:H})),A(O)}N(O),m.push(O)}for(var Y=0,J=C;Y<J.length&&(M=J[Y],!B());Y++)A(O=s.__assign(s.__assign({},M),{changes:[],cancelled:u})),N(O),m.push(O);for(;!B();)A(O={id:"",date:n.date,substitution_typeid:p,note:"",changes:[],cancelled:u}),N(O),m.push(O);return m}function N(e){var t=e.table,n=e.valueRef,s=e.ttitemid,i=e.dbi,o=e.tt_dbi,l=e.join_doubles,c=i.req,u=s.split(":")[0],d=r.useState(n.value)[0],m=r.useState(""),p=m[0],f=m[1],_=r.useRef(),h=[{text:"-",onClick:function(){n.set(""),_.current.confirmClose()}}];return"teachers"==t&&h.push({text:c.ttls(3118),onClick:function(){n.set(S),_.current.confirmClose()}}),r.createElement(a.RDialog,{controlRef:_,width:400,height:600,buttons:[{action:"ok",type:"green",label:c.ls(2105)}],onConfirm:function(e){n.set(p),e.confirmClose()},footer:r.createElement(r.Fragment,null,r.createElement(a.RButton,{label:c.ls(1239),menu:h}))},r.createElement(b.TeachersView,{dbi:i,tt_dbi:o,date:u,join_doubles:l,ttitemid:s,table:t,topid:d,onRowSelect:function(e){return f(e)}}))}(e.SubstEditTTItemDlg=R).npp=o.substOnlineNeededPartProvider(function(){return[o.buildSubstOnlineTTItemsEx,p.substTTItemComboItems,A,N,u.SubstDlgTimetableView,{substonline_ttitems:["subjectid","classids","teacherids","classroomids","igroupid","uniperiod","endtime","type","orig","changes","cancelled","substids"],substonline_substitutions:["changes","cancelled","cancel_teacher","note","inote","substitution_typeid"],substonline_dates:["tt_num"],periods:["period","starttime","endtime"],subjects:["__name"],classes:["__name"],igroups:["__name"],teachers:["__name"],classrooms:["__name"],substitution_types:["__name"]}]}),R.ttdbi={npp:i.neededPartProvider(function(){return[p.substTTItemComboItems.ttdbi]})},A.needed_part=i.typed({substonline_substitutions:["absent","changes"],substitution_types:["default_for"]}),e.ChangeOtherLessonDlg=function(e){var t=e.app,n=t.naming_dbi,i=t.getDate(),c=t.state.join_doubles;r.useEffect(function(){return y.maindbiActionStat("ChangeOtherLessonDlg","substonline_ttitems","show")}),a.useTTLang();var u=a.useStateValueRef(""),d=o.buildSubstOnlineTTItemsEx(t.dbi,i,c).filter(function(e){return"event"!=e.type&&!(e.cancelled||e.added)}).map(function(e){var t=e.orig||e,r=n.tools.ttitem_popis(t);return r.teacher=n.tools.ttitem_popis(t,l.client_req.sort_name_col).teacher,s.__assign(s.__assign({},r),{uniperiod:t.uniperiod,id:e.id})});function m(){var e=u.value;e?(p.current.confirmClose(),v.showTTItemEditDlg(e,c)):a.RDialog.showConfirm(ASC.ls(1574))}d.sort(function(e,t){return parseInt(e.uniperiod)-parseInt(t.uniperiod)});var p=r.useRef();return r.createElement(a.RDialog,{header:ASC.ttls(3794),width:700,height:600,controlRef:p,buttons:[{label:ASC.ttls(1054),type:"green",onClick:m},"cancel"]},r.createElement(_.RDatatable,{columns:[{key:"period",label:ASC.ls(1466),width:70,sortable:!0},{key:"teacher",label:ASC.ls(1300),width:130,sortable:!0},{key:"class",label:ASC.ls(1263),width:130,sortable:!0},{key:"subject",label:ASC.ls(1299),width:130,sortable:!0},{key:"classroom",label:ASC.ls(1197),width:80,sortable:!0}],data:d,style:{flex:"1 1 200px"},selectedIdRef:u,fitWidth:!0,onRowDoubleClick:m}))},N.npp=i.neededPartProvider(function(){return[b.TeachersView]}),e._hotswap=[N,k,I,D,R]},"/react/pickfromhistory.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../asc/asc_react"),i=t("react"),a=t("../asc/lib_date"),o=t("./datatable"),l=new Map;e.PickFromHistory=function(e){var t=this,n=r.useReq(),c=e.table,u=e.column,d=e.valueRef,m=c+"."+u,p=l.get(m);function b(e){(null==e?void 0:e.trim())&&(p.entries=p.entries.filter(function(t){return t.value!=e}),p.entries.unshift({value:e,time:Date.now()}))}p||l.set(m,p={initialized:!1,entries:[]});var f=i.useRef();f.current=d.value,i.useEffect(function(){return function(){return b(f.current)}},[]);var _=r.useHoverWithMenu(),h=_[0],g=_[1],v=_[2];return i.createElement("span",{style:{position:"relative",verticalAlign:"top"}},i.createElement("i",s.__assign({},g,{className:"fa fa-ellipsis-h",style:{fontSize:12,color:"#c0c0c0",backgroundColor:h?"rgba(0, 0, 0, 0.1)":void 0,padding:"3px 7px",cursor:"pointer",position:"absolute",right:0,top:0},title:n.ls(6551),onClick:function(r){return s.__awaiter(t,void 0,void 0,function(){var t;return s.__generator(this,function(i){switch(i.label){case 0:return t=r.currentTarget,p.initialized?[3,2]:[4,function(){return s.__awaiter(this,void 0,void 0,function(){var t,r,i,l,d,m,f,_,h,g,v,y;return s.__generator(this,function(s){switch(s.label){case 0:return t=e.date||n.timezone_date(),r=a.date_delta(t,-14),i=a.date_delta(t,14),[4,n.maindbi(n.getSchoolYear(t),{needed_part:(y={},y[c]=[u],y),vt_filter:{datefrom:r,dateto:i}})];case 1:if(l=s.sent(),(d=l.tableData(c)).sort(function(e,t){return o.compareStrings(t.date,e.date)}),m=d.map(function(e){return e[u]||""}),c.startsWith("subst")&&"note"==u)for(f=function(e){m=m.filter(function(t){return!(t.startsWith(e)&&t.length<e.length+15)})},_=0,h=[n.lsf(7442,{date:""}),n.lsf(7443,{date:""})];_<h.length;_++)f(h[_]);for(g=0,v=m;g<v.length;g++)b(v[g]);return p.initialized=!0,[2]}})})}()];case 1:i.sent(),i.label=2;case 2:return p.entries.splice(50),v(p.entries.map(function(e){return{text:e.value,onClick:function(){return d.set(e.value)}}}),t),[2]}})})}})))}},"/substitution/dlg/addcard.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("../../rpr/dbi"),a=t("../server/commands"),o=t("../../asc/asc_react"),l=t("../../asc/edurequest"),c=t("../subst"),u=t("../online/timetable"),d=t("../../asc/asc_react2"),m=t("../../rpr/dbi_react"),p=(t("../../asc/actions"),t("../online/combo")),b=t("../../react/pickfromhistory"),f=t("../../react/combobox"),_=t("../../asc/lib_date"),h="_no_teacher_",g="_more_";function v(e){for(var t=e.kolizie,n=e.table,s=0,i=t;s<i.length;s++)if(i[s].table==n)return r.createElement("img",{src:"/static/pics/item_bad_16.png",style:{height:16,verticalAlign:"top",paddingTop:3},title:ASC.ttls(3447)});return null}function y(e){var t=e.dbi,n=e.ttdbi,y=e.date,E=e.substid,w=e.join_doubles;r.useEffect(function(){return barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstEditAddCardDlg.open",eventLabel:""})},[]),o.useTTLang();var S=r.useRef(),x=r.useMemo(function(){var e=null,n=[];if(E){var r=t.rowData("substonline_substitutions",E),i=c.buildSubstOnlineTTItemsEx(t,y,w),a=c.findTTItemFromSubstId(i,E);e={id:r.id,date:r.date,subId:r.subId,uniperiod:a.uniperiod,endtime:a.endtime,durationperiods:a.durationperiods||1,subjectid:a.subjectid,teacherids:a.teacherids,cancel_teacher:r.cancel_teacher,classids:a.classids,groupnames:a.groupnames,igroupid:a.igroupid,classroomids:a.classroomids,substitution_typeid:r.substitution_typeid,note:r.note,origid:r.origid},n=s.__spreadArrays([a.id],a.join_ttitemids||[])}return{orig:e,remove_ttitemids:n}},[]),T=x.orig,C=x.remove_ttitemids,k=o.useStateValueRef(T||{id:"",date:y,subId:"",uniperiod:"1",endtime:"",durationperiods:1,subjectid:"",teacherids:[],cancel_teacher:!1,classids:[],groupnames:[""],igroupid:"",classroomids:[],substitution_typeid:"",note:"",origid:""}),D=t.req,I=k.value,R=E?ASC.ttls(1058):ASC.ttls(3784);T&&T.origid&&(R=ASC.lsf(7443,{date:_.date_format_date(l.client_req,T.origid.split(":")[0])})),M()&&(R+="*");var A={verticalAlign:"top"},N=D.isApp()?{}:{width:100},B=[];I.classids.forEach(function(e){return B.push({table:"classes",id:e})}),I.teacherids.forEach(function(e){return B.push({table:"teachers",id:e})}),I.classroomids.forEach(function(e){return B.push({table:"classrooms",id:e})});var j={id:"_editing_",date:y,subId:"",type:"tcard",uniperiod:I.uniperiod,endtime:I.endtime,durationperiods:I.durationperiods,subjectid:I.subjectid,teacherids:I.teacherids,classids:I.classids,groupnames:I.groupnames,classroomids:I.classroomids,igroupid:I.igroupid,added:!0,changes:[],substids:[],origofids:[]},P=u.getSubstTTItemKolizie(t,n,j,C);function M(){return!T||!!i.DBITools.rowChanges2write(T,I)}function O(){return s.__awaiter(this,void 0,void 0,function(){var e;return s.__generator(this,function(n){switch(n.label){case 0:return[4,t.frontend.showVyberDlg("teachers",I.teacherids)];case 1:return(e=n.sent())&&k.sub("teacherids").set(e),[2]}})})}return r.createElement(o.RDialog,{header:R,width:970,controlRef:S,onConfirm:function(){return function(){return s.__awaiter(this,void 0,void 0,function(){var e;return s.__generator(this,function(t){switch(t.label){case 0:return M()?[4,ASC.blockUI(a.updateSubstSubstitutionAddCard(null,I))]:(S.current.close(),[2]);case 1:return(e=t.sent()).fail?[4,o.showUniResponse(e)]:[3,3];case 2:return t.sent(),[3,4];case 3:S.current.confirmClose(),barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstEditAddCardDlg.ok",eventLabel:""}),t.label=4;case 4:return[2]}})})}()},buttons:["ok","cancel"]},r.createElement(o.VGap,{height:6}),r.createElement(d.HorizontalSplit,null,r.createElement(d.SectionWithIcon,{icon:t.table("subjects").icon(),small:!0,style:A},r.createElement(o.RLabel,{text:t.table("subjects").itemName()+":",style:N}),r.createElement(f.default,{valueRef:k.sub("subjectid"),items:t.tools.tableCombo("subjects")})),r.createElement(d.SectionWithIcon,{icon:t.table("classes").icon(),small:!0,style:A},r.createElement(o.RLabel,{text:t.table("classes").itemName()+":",style:N}),r.createElement(m.UniClassPicker,s.__assign({},{dbi:t,date:y,rowRef:k})),r.createElement(v,{kolizie:P,table:"classes"}))),r.createElement(d.SeparatorLine,null),r.createElement(d.HorizontalSplit,null,r.createElement(d.SectionWithIcon,{icon:t.table("teachers").icon(),small:!0,style:A},r.createElement(o.RLabel,{text:t.table("teachers").itemName()+":",style:N}),1<I.teacherids.length?r.createElement(o.RButton,{label:t.rowNames("teachers",I.teacherids),onClick:O,style:{width:200}}):r.createElement(f.default,{valueRef:k.cast(function(e){return 0==e.teacherids.length?e.cancel_teacher?h:"":e.teacherids[0]},function(e,t){return s.__assign(s.__assign({},t),{teacherids:e&&e!=h?[e]:[],cancel_teacher:e==h})}).onSet(function(e){if(e==g)return O(),!1}),items:s.__spreadArrays([{value:"",name:"-"}],p.substTTItemComboItems({table:"teachers",dbi:t,tt_dbi:n,ttitem:j,remove_ttitemids:C,topid:I.teacherids[0]}).map(function(e){return{value:e.id,name:t.rowName("teachers",e.id),classname:e.className||void 0}}),[[],{value:h,name:D.ttls(3118)},[],{value:g,name:D.ls(1239)}]),style:{width:200}}),r.createElement(v,{kolizie:P,table:"teachers"})),r.createElement(d.SectionWithIcon,{icon:t.table("classrooms").icon(),small:!0,style:A},r.createElement(o.RLabel,{text:t.table("classrooms").itemName()+":",style:N}),r.createElement(m.UniClassroomPicker,s.__assign({},{dbi:t,rowRef:k,style:{width:200},substCombo:p.substTTItemComboItems({table:"classrooms",dbi:t,tt_dbi:n,ttitem:j,remove_ttitemids:C,topid:I.classroomids[0]})})),r.createElement(v,{kolizie:P,table:"classrooms"}))),r.createElement(d.SeparatorLine,null),r.createElement(d.HorizontalSplit,null,r.createElement(d.SectionWithIcon,{icon:"/static/pics/alarm_48.png",small:!0,style:A},r.createElement(o.RLabel,{text:ASC.ls(1345)+":",style:N}),r.createElement("span",{style:{display:"inline-block",verticalAlign:"top"}},r.createElement(m.UniPeriodPicker,s.__assign({},{dbi:t,rowRef:k,modes:["period","starttime","daypart"]})),1<I.durationperiods&&"period"==i.DBITools.typeOfUniPeriod(I.uniperiod)&&r.createElement("span",{style:{verticalAlign:"middle"}}," - ",t.rowName("periods",i.DBITools.uniperiod_delta(I.uniperiod,I.durationperiods-1))))),r.createElement(d.SectionWithIcon,{icon:t.table("substitution_types").icon(),small:!0,style:A},r.createElement(o.RLabel,{text:t.column("substonline_substitutions","substitution_typeid").name()+":",style:N}),r.createElement(f.default,{valueRef:k.sub("substitution_typeid"),items:t.tools.tableCombo("substitution_types"),style:{width:200}}),r.createElement(o.VGap,{height:3}),r.createElement(o.RLabel,{text:t.column("substonline_substitutions","note").name()+":",style:s.__assign(s.__assign({},N),{verticalAlign:"top"})}),r.createElement(o.RTextArea,{valueRef:k.sub("note"),style:{width:200}}),r.createElement(b.PickFromHistory,{valueRef:k.sub("note"),table:"substonline_substitutions",column:"note",date:y}))),r.createElement(d.SeparatorLine,null),r.createElement("div",{style:{minHeight:200}},!1,r.createElement(u.SubstDlgTimetableView,s.__assign({},{where:"addcard",date:y,dbi:t,tt_dbi:n,join_doubles:w,items:B,style:{height:Math.min(50+60*B.length,300)},remove_ttitemids:C,editing_ttitems:[j],onPeriodClick:"period"==i.DBITools.typeOfUniPeriod(I.uniperiod)?function(e){return k.set(s.__assign(s.__assign({},I),{uniperiod:e,endtime:""}))}:void 0,kolizie:P}))))}(e.SubstEditAddCardDlg=y).npp=c.substOnlineNeededPartProvider(function(){return[u.getSubstTTItemKolizie,c.buildSubstOnlineTTItemsEx,p.substTTItemComboItems,u.SubstDlgTimetableView,{subjects:["__name"],classes:["__name"],teachers:["__name"],classrooms:["__name"],igroups:["__name"],periods:["__name"],dayparts:["__name"],substitution_types:["__name"],substonline_substitutions:["cancel_teacher"]}]}),y.ttdbi={npp:i.neededPartProvider(function(){return[u.getSubstTTItemKolizie.ttdbi]})},e.showSubstEditAddCardDlg=function(e,t,n){return s.__awaiter(this,void 0,void 0,function(){var e;return s.__generator(this,function(s){return!(e=n.date)&&t&&(e=t.split(":")[0]),[2,m.showRDialogWithDbi({dlg:y,date:e,substid:t,join_doubles:n.join_doubles})]})})},e._hotswap=[y]},"/substitution/dlg/absent.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("../../asc/asc_react"),a=r.Fragment,o=t("../../rpr/dbi"),l=t("../subst"),c=t("../../rpr/dbi_react"),u=t("../server/commands"),d=t("../../asc/edurequest"),m=t("../../timetable/server/timetable"),p=t("../../asc/asc_react2"),b=t("../../asc/actions"),f=t("../commands"),_=t("../../react/datefield"),h=t("../../react/combobox");e.TABLE_absents="substonline_absents",e.TABLE_ttitems="substonline_ttitems",e.TABLE_substs="substonline_substitutions";var g=["teachers","classes","classrooms"];function v(e){return"absent_"+o.DBITools.removeEs(e)+"ids"}function y(e){return!(!e.longtime_datefrom&&!e.longtime_dateto)}function E(e,t){return void 0===t&&(t={}),s.__awaiter(this,void 0,void 0,function(){var n;return s.__generator(this,function(s){return n=t.date||e.split(":")[0],[2,c.showRDialogWithDbi({dlg:S,date:n,absentid:e,add_data:t.row,add_teacherids:t.teacherids,add_classids:t.classids,add_classroomids:t.classroomids})]})})}e.showSubstAbsentEditDlg=E;var w={multiple:!(e.showSubstOnlineAbsentDlg=function(e,t,n,r){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){return[2,E(n,r)]})})}),absent_user:"",groupname:"",split_entireclass:!1,absent_teacherids:[],absent_classids:[],absent_classroomids:[],absent_typeid:"",allday:!0,period:"",durationperiods:1,exclude_breaks:"",is_longtime:!1,longtime_datefrom:"",longtime_dateto:"",note:"",su_dozory:!1};function S(n){var E=this,S=d.client_req,T=n.dbi,C=n.date,k=n.absentid,D=!k;function I(e){return s.__awaiter(E,void 0,void 0,function(){var n,r,i;return s.__generator(this,function(s){switch(s.label){case 0:return n=v(e),r=B[n],[4,Promise.resolve().then(function(){return t("../../rpr/vyber")})];case 1:return[4,s.sent().showDBIVyberDlg(T,e,r,{date:C})];case 2:return!(i=s.sent())||0==i.length&&0==r.length||(A.sub(n).set(i),A.sub("multiple").set(!0)),[2]}})})}"string"!=typeof k&&ASC.dieError("6320169500"),C||ASC.dieError("5946326033"),i.useTTLang();var R=T.rowData(e.TABLE_absents,k),A=i.useStateValueRef(function(){var e,t=s.__assign({},w);return D?(e=n.add_data,t.absent_teacherids=n.add_teacherids||[],t.absent_classids=n.add_classids||[],t.absent_classroomids=n.add_classroomids||[],s.__spreadArrays(t.absent_teacherids,t.absent_classids,t.absent_classroomids).length?t.multiple=!0:(null==e?void 0:e.table)&&(t.absent_user=o.DBITools.rowid2user(l.absentGetTable(e),l.absentGetId(e)))):(R||ASC.dieError("6304814492",[k]),t.absent_user=o.DBITools.rowid2user(l.absentGetTable(R),l.absentGetId(R)),e=R),e&&(t.groupname=e.groupname||"",t.absent_typeid=e.absent_typeid||"",t.note=e.note||"",e.period&&(t.period=e.period,t.durationperiods=e.durationperiods||null),t.exclude_breaks=e.exclude_breaks||"",t.split_entireclass=e.split_entireclass||!1,t.longtime_datefrom=e.longtime_datefrom||"",t.longtime_dateto=e.longtime_dateto||"",t.is_longtime=y(e)),t}),N=r.useMemo(function(){var e=[];e.push({name:"-",value:""});for(var t=0,n=g;t<n.length;t++){var r=n[t];e.push([]);for(var i=T.table(r).icon(),a=[],l=0,c=T.tableData(r);l<c.length;l++){var u=c[l],m=u.id;if(!(u.dateto&&u.dateto<C)){var p={value:o.DBITools.rowid2user(r,m),name:T.rowName(r,m,d.client_req.sort_name_col+"u"),icon:i};u.cb_hidden||u.subst_hidden?(p.classname="cb_hidden",a.push(p)):e.push(p)}}e=s.__spreadArrays(e,a)}return e},[T]),B=A.value,j=o.DBITools.user2rowid(B.absent_user),P=j.table,M=j.id,O=g.map(function(e){return{text:T.table(e).name(),onClick:function(){return s.__awaiter(E,void 0,void 0,function(){return s.__generator(this,function(t){return[2,I(e)]})})}}}),z={width:160},F={dbi:T,table:"substonline_absents",rowRef:A},L=!1;B.period&&(B.exclude_breaks?L=!0:B.su_dozory&&(B.multiple?(0<B.absent_teacherids.length||0<B.absent_classroomids.length)&&(L=!0):P&&"classes"!=P&&(L=!0)));var G=""!=B.groupname&&r.createElement(i.RCheckBox,{valueRef:A.sub("split_entireclass"),label:ASC.ls(3775)}),U=r.useRef();return r.useEffect(function(){barTrackEvent({eventCategory:"SubstOnline",eventAction:"AbsentDlg.open",eventLabel:""}),m.suDozory(null,C).then(function(e){return A.sub("su_dozory").set(e)})},[]),r.createElement(i.RDialog,{header:D?ASC.ttls(1447):ASC.ls(1622),width:520,controlRef:U,onConfirm:function(){return s.__awaiter(E,void 0,void 0,function(){var t,n,r,a,c,d,m,p,b,f,_,h;return s.__generator(this,function(s){switch(s.label){case 0:if(t=T.table(e.TABLE_absents),n=[],B.multiple)for(r=0,a=g;r<a.length;r++)for(c=a[r],d=0,m=B[v(c)];d<m.length;d++)p=m[d],n.push(o.DBITools.rowid2user(c,p));else B.absent_user&&n.push(B.absent_user);return 0!=n.length?[3,2]:[4,i.RDialog.showMessage(ASC.ttls(2165))];case 1:return s.sent(),[2];case 2:for(f in b={},B)t.column(f)&&(b[f]=B[f]);return B.is_longtime||(b.longtime_datefrom="",b.longtime_dateto=""),D||(_=R,(b=o.DBITools.rowChanges2write(_,b))||n[0]==o.DBITools.rowid2user(l.absentGetTable(_),l.absentGetId(_))||(b={})),b?[4,ASC.blockUI(u.absentEditWrite(null,D?C:k,n,b))]:(U.current.close(),[2]);case 3:return(h=s.sent()).fail?[4,i.showUniResponse(h)]:[3,5];case 4:return s.sent(),[3,6];case 5:U.current.confirmClose(),barTrackEvent({eventCategory:"SubstOnline",eventAction:"AbsentDlg.ok",eventLabel:""}),s.label=6;case 6:return[2]}})})},buttons:S.isApp()?["ok"]:["ok","cancel"],footer:!D&&r.createElement(i.RButton,{label:b.action_name("delete"),onClick:function(){return s.__awaiter(E,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,f.showAbsentDeleteDlg(T,k)];case 1:return e.sent()&&U.current.confirmClose("delete"),[2]}})})}})},r.createElement(p.SectionWithIcon,{icon:"/static/pics/help_48.png"},B.multiple?r.createElement(r.Fragment,null,g.map(function(e){var t=B[v(e)];return r.createElement("div",{key:e},r.createElement(i.RButton,{content:r.createElement("img",{src:T.table(e).icon(),style:{height:16}}),onClick:function(){return I(e)}})," ",T.rowNames(e,t),"classes"==e&&1==t.length&&r.createElement(r.Fragment,null," ",r.createElement(c.GroupNameCombo,{date:C,classid:t[0],groupnameRef:A.sub("groupname")}),G))})):r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(i.RLabel,{text:ASC.ttls(1449)+":"}),r.createElement(h.default,{items:N,valueRef:A.sub("absent_user"),style:z}),r.createElement(i.HGap,{width:5}),D&&r.createElement(i.RButton,{label:S.ls(1239)+"...",menu:O,style:{minWidth:"auto"}})),r.createElement("div",null,"classes"==P&&r.createElement(r.Fragment,null,r.createElement(i.RLabel,{text:""}),r.createElement(c.GroupNameCombo,{date:C,classid:M,groupnameRef:A.sub("groupname")}),G)))),r.createElement(p.SeparatorLine,null),r.createElement(p.SectionWithIcon,{icon:"/static/pics/reason_absence_48.png"},r.createElement(i.RLabel,{text:ASC.ttls(1450)+":"}),r.createElement(h.default,{valueRef:A.sub("absent_typeid"),items:T.tools.tableCombo("absent_types"),style:z})),r.createElement(p.SeparatorLine,null),r.createElement(p.SectionWithIcon,{icon:"/static/pics/alarm_48.png"},r.createElement(i.RLabel,{text:ASC.ttls(1451)+":"}),r.createElement("div",{style:{display:"inline-block",verticalAlign:"top"}},r.createElement(c.UniPeriodExpPicker,{modes:["allday","periods_interval"],rowRef:A,dbi:T}),L&&r.createElement("div",{style:{marginTop:3}},r.createElement(x,{valueRef:A.sub("exclude_breaks"),enable_inbetween:1<B.durationperiods})))),r.createElement(p.SeparatorLine,null),r.createElement(p.SectionWithIcon,{icon:"/static/pics/calendar_48.png"},r.createElement(i.RCheckBox,{valueRef:A.sub("is_longtime"),label:ASC.ttls(1453),disabled:R&&y(R)}),r.createElement("br",null),B.is_longtime&&r.createElement(a,null,r.createElement("div",{style:{marginLeft:100,marginTop:5}},r.createElement(_.default,{valueRef:A.sub("longtime_datefrom")})," - ",r.createElement(_.default,{valueRef:A.sub("longtime_dateto")})))),r.createElement(c.DlgField,{dlgRow:F,column:"note",label_style:"top",style:{width:"100%"}}))}function x(e){function t(e){return e.cast(function(e){return!e},function(e){return!e})}var n=e.valueRef.cast(function(e){return{exclude_b:0<=e.indexOf("b"),exclude_i:0<=e.indexOf("i"),exclude_a:0<=e.indexOf("a")}},function(e){return(e.exclude_b?"b":"")+(e.exclude_i?"i":"")+(e.exclude_a?"a":"")});return r.createElement(a,null,ASC.ls(2846),": ",r.createElement(i.RCheckBox,{label:ASC.ttls(3275),valueRef:t(n.sub("exclude_b"))})," ",e.enable_inbetween&&r.createElement(i.RCheckBox,{label:ASC.ttls(4352),valueRef:t(n.sub("exclude_i"))})," ",r.createElement(i.RCheckBox,{label:ASC.ttls(3276),valueRef:t(n.sub("exclude_a"))}))}(e.AbsentEditDlg=S).npp=o.neededPartProvider(function(){return[{substonline_absents:["table","classid","teacherid","classroomid","groupname","absent_typeid","note","period","durationperiods","exclude_breaks","split_entireclass","longtime_datefrom","longtime_dateto"],teachers:["__name","cb_hidden","subst_hidden","dateto"],classes:["__name"],classrooms:["__name","cb_hidden"],absent_types:["__name"],periods:["__name"]},f.showAbsentDeleteDlg]}),e._hotswap=[S]},"/timetable/server/timetable.js":function(e,t,n){n.implementRpc(["timetableGroupnameCombo","suDozory"])},"/substitution/subststudents_popup.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../asc/edurequest"),i=t("react"),a=t("../calendar/event_popup"),o=t("../asc/asc_react"),l=t("../react/popuppanel"),c=t("../rpr/dbi_react"),u=t("../asc/asc_react2"),d=t("../asc/actions"),m=t("../rpr/maindbi_ui"),p=t("../asc/lib_date"),b=t("../rpr/dbi"),f="/substitution/pics/subst_students_32.svg";function _(e,t){if(!t)return"";var n=e.ls(12014)+" (";return 0<t.add_st.length&&(n+="+"+t.add_st.length),0<t.remove_st.length&&(n+="-"+t.remove_st.length),n+")"}function h(e,t){var n=e.rowName("classes",t.classid);return t.groupname&&(n+=" - "+e.tools.groupnames_names([t.groupname])),n+" Â· "+e.rowName("subjects",t.subjectid)}function g(e){var t=e.subst,n=e.online,r=s.__spreadArrays(t.add_ss,t.remove_ss);return i.createElement(y,{table:n?"substonline_students":"subst_students",ids:r})}function v(e){var t,n,a=this,f=r.client_req,_=e.table,g=e.id,v=g.split(":")[0],y=f.getSchoolYear(v),E="substonline_students"==_,w=c.useMainDBI(y,{needed_part:(t={},t[_]=["date","studentids","longtime_datefrom","longtime_dateto","longtimeids","uniperiod","durationperiods","moveto"],t.students=["__name","classid"],t.classes=["__name"],t.subjects=["__name"],t.groupsubjects=["__name"],t.periods=["__name"],t),vt_filter:{date:v},suspense:!0}),S=w.rowData(_,g);if(!S)return null;for(var x=new Map,T=0,C=S.studentids;T<C.length;T++){var k=C[T],D=w.rowData("students",k,{classid:""});b.map2array_get(x,D.classid).push(k)}return i.createElement(i.Fragment,null,i.createElement(l.PopupDetail,{hidden:S.longtime_datefrom==S.longtime_dateto,label:f.ls(1602)},p.date_format_2dates(f,S.longtime_datefrom,S.longtime_dateto,!1)),i.createElement(l.PopupDetail,{hidden:"ad"==S.uniperiod,label:w.tools.uniperiodLabel(S.uniperiod)},w.tools.uniperiodName(S.uniperiod,"name",S)),i.createElement(l.PopupDetail,{label:f.ls(2060)},b.map2array(x).map(function(e){var t=e[0],n=e[1];return i.createElement("div",{key:n},w.rowName("classes",n)+": "+w.rowNames("students",t))}),i.createElement("div",{style:{padding:3}},i.createElement("i",{className:"fa fa-arrow-down"})),i.createElement(u.RJoin,{glue:", "},null===(n=S.moveto)||void 0===n?void 0:n.map(function(e){return h(w,e)}))),E&&i.createElement(i.Fragment,null,i.createElement(u.SeparatorLine,null),i.createElement("div",{style:{display:"flex",flexDirection:"row"}},i.createElement(o.RButton,{label:d.action_name("delete"),onClick:function(){return s.__awaiter(a,void 0,void 0,function(){var e;return s.__generator(this,function(t){switch(t.label){case 0:return e=d.action_name("delete"),S.longtime_datefrom<S.longtime_dateto&&(e+="\n"+p.date_format_2dates(f,S.longtime_datefrom,S.longtime_dateto)),[4,o.RDialog.showConfirm(e,{msgType:"areyousure"})];case 1:return t.sent()&&ASC.blockUI(w.backend.removeRows(_,S.longtimeids,{log_module:"SubstStudentsPopupDiv"})),[2]}})})}}),i.createElement("div",{style:{flex:"1"}}),i.createElement(o.RButton,{label:d.action_name("edit"),type:"green",onClick:function(){return s.__awaiter(a,void 0,void 0,function(){return s.__generator(this,function(e){return[2,m.showMainDbiItemDlg(y,_,g)]})})}}))))}function y(e){var t=e.table,n=b.idsArrayUnique(e.ids||[e.id]);return i.createElement(l.PopupWithHeader,{icon:f,title:function(e){return void 0===e&&(e=r.client_req),e.ls(12014)}()},i.createElement(u.RJoin,{glue:i.createElement(u.SeparatorLine,null)},n.map(function(e,n){return i.createElement(v,{key:n,table:t,id:e})})))}e.studentsinfoSubstText=_,e.substStudents_mvtText=h,e.StudentsinfoSubstBar=function(e){var t=e.subst,n=e.online,c=r.client_req,u=l.useSimplePopup(),d=u[0],m=u[1],p=u[2];return t?i.createElement(i.Fragment,null,i.createElement("div",{style:s.__assign({cursor:"pointer"},e.style||{}),onClick:m},i.createElement("img",{src:f,style:o.rtlCss(s.__assign(s.__assign({},a.EventIcon.style),{marginRight:3,verticalAlign:"middle"}))}),_(c,t)),p&&i.createElement(d,null,i.createElement(g,{subst:t,online:n}))):null},e.SubstStudentsPopup=y,e.showSubstStudentsPopup=function(e,t){l.showPopup(e,i.createElement(y,s.__assign({},t)))}},"/substitution/server/settings.js":function(e,t,n){n.implementRpc(["getSubstOnlineUISettings","updateSubstOnlineUISettings"])},"/substitution/online/leftpanel.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("../../rpr/dbi"),a=t("../../asc/asc_react"),o=t("../../dashboard/dbi_events"),l=t("../subst"),c=t("../../asc/actions"),u=t("../server/commands"),d=t("../../asc/edurequest"),m=t("../../asc/lib_date"),p=t("../../react/menu"),b=t("../filter"),f=t("../../react/popuppanel"),_=t("../../calendar/event_popup"),h=t("./subst_popup"),g=t("../subststudents_popup");function v(e,t){return t.name||e.rowName("event_types",t.typ)}function y(e){for(var t=this,n=e.dbi,d=e.getDate(),m=n.req,p={eventInfo:new Map,eventTypeInfo:new Map,absentInfo:new Map},b=e.getEvents(),f=e.getAbsents(),_=l.buildSubstOnlineTTItemsEx(n,d,!1),h=l.buildSubstOnlineTTItemsEx(n,d,!0),g=0,v=f;g<v.length;g++){var E=v[g];p.absentInfo.set(E.id,{eventids:[]})}for(var w=[],S=function(b){var g={state:"",menu:[]};if("changeroom"==b.typ){for(var v=b.teacherids[0],E=b.classroomids[0],S=b.classroomids[1],x=null,T=null,C=0,k=1<b.durationperiods?h:_;C<k.length;C++){var D=k[C];D.uniperiod==i.DBITools.getUniPeriod(b)&&D.teacherids.includes(v)&&("period"==i.DBITools.typeOfUniPeriod(D.uniperiod)&&(D.durationperiods||1)!=b.durationperiods||(D.classroomids.includes(E)&&(x=D),D.classroomids.includes(S)&&(T=D)))}if(x){if(0==x.substids.length&&1==x.classroomids.length){var I=function(){return s.__awaiter(t,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,u.updateSubstTTItem(null,x.id,{classroomids:[S]},{substitution_typeid:l.getDefault_substitution_typeid(n,"changeroom")},1<x.durationperiods)];case 1:return e.sent(),[2]}})})};g.menu.push({text:ASC.ls(1257)+" -> "+m.ls(1003),icon:c.action_icon("add"),onClick:function(){return s.__awaiter(t,void 0,void 0,function(){var e;return s.__generator(this,function(t){switch(t.label){case 0:return e=n.tools.ttitem_popis(x,"short"),[4,a.RDialog.showConfirm(r.createElement("div",null,m.ttls(3794)+"?",r.createElement("br",null),r.createElement("br",null),e.period+" "+e.subject+" "+e.class,r.createElement("br",null),r.createElement("br",null),e.classroom," -> ",n.rowName("classrooms",S,"short")),{srcFunction:y})];case 1:return t.sent()?[4,I()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})}}),w.push(I)}}else T&&(g.state="handled")}else if("bookroom"==b.typ);else{var R={teachers:[],classes:[],classrooms:[]},A=!1;for(var N in R)if(!("classes"==N&&o.isTTCancelEvent(n,b)&&(null===(B=b.groupnames)||void 0===B?void 0:B.includes(""))))for(var B=0,j=o.event_tableIds(b,N,{dbi:n,date:d,expand_ctevent:!0});B<j.length;B++){var P=j[B],M=A=!0,O=b.groupnames;if("classes"!=N||!O||0!=O.length&&!i.DBITools.groupnames_sg(O)){if(b.period)for(var z=parseInt(b.period),F=z+(b.durationperiods||1)-1,L=z;L<=F;L++){var G;(G=l.findAbsent(f,N,P,{groupnames:O,period:""+L}))?i.idsArraySetAdd(p.absentInfo.get(G.id).eventids,b.id):M=!1}else(G=l.findAbsent(f,N,P,{groupnames:O,starttime:b.starttime,endtime:b.endtime,daypart:b.daypart}))?i.idsArraySetAdd(p.absentInfo.get(G.id).eventids,b.id):M=!1;M||R[N].push(P)}}0==R.classes.length&&0==R.teachers.length&&0==R.classrooms.length?g.state=A?"handled":"":(g.state="",g.menu.push({text:ASC.ls(1257)+" -> "+ASC.ls(1622),icon:c.action_icon("add"),onClick:function(){return e.showAbsentEditDlg("",{classids:R.classes,teacherids:R.teachers,classroomids:R.classrooms,period:b.period,durationperiods:b.durationperiods,groupname:b.groupnames[0]})}}))}p.eventInfo.set(b.id,g)},x=0,T=b;x<T.length;x++)S(T[x]);if(1<w.length){var C=m.ls(1257)+" -> "+m.ls(1003)+" ("+w.length+")";p.eventTypeInfo.set("changeroom",{menu:[{text:C,icon:c.action_icon("add"),onClick:function(){return s.__awaiter(t,void 0,void 0,function(){var e,t,n;return s.__generator(this,function(s){switch(s.label){case 0:return[4,a.RDialog.showConfirm(r.createElement(r.Fragment,null,C,r.createElement(a.VGap,{height:10}),m.ls(1054)))];case 1:if(!s.sent())return[3,5];e=0,t=w,s.label=2;case 2:return e<t.length?(n=t[e],[4,ASC.blockUI(n())]):[3,5];case 3:s.sent(),s.label=4;case 4:return e++,[3,2];case 5:return[2]}})})}}]})}return p}function E(e){var t=e.online,n=e.event,l=e.eventInfo,c=t.dbi,u=c.tools.ttitem_popis(n).period,d=f.useSimplePopup(),m=d[0],p=d[1],b=d[2],h=v(c,n),g=[];return 0<n.classids.length&&(h=c.rowNames("classes",n.classids,"short")+": "+h,i.DBITools.groupnamesIsEntireClass(n.groupnames)||g.push(c.tools.groupnames_names(n.groupnames))),n.subjectid&&g.push(c.rowName("subjects",n.subjectid,"short")),0<n.teacherids.length&&g.push(c.rowNames("teachers",n.teacherids,"short")),0<n.classroomids.length&&g.push(c.rowNames("classrooms",n.classroomids,"short")),r.createElement(r.Fragment,null,r.createElement(T,s.__assign({},{key:n.subId,state:l.state,icon:o.eventIcon(c,n),name:h,when:u,reason:g.join("; "),popupShown:b,onClick:function(e){return p(e)}})),b&&r.createElement(m,null,r.createElement(_.EventPopup,{eventid:n.id,where:"subst",footer:l.menu.map(function(e,t){return r.createElement(a.RButton,{key:t,label:e.text,icon:e.icon,onClick:e.onClick})})})))}function w(e){var t=e.online,n=e.eventsInfo,i=t.dbi,o=t.filter,l=a.useStateValueRef(!1),c=l.value,u=a.useStateAsValueRef(a.useLocalState("SubstOnline.AbsentPanelEvents.etCollapsedRef",{},{where:"localStorage"})),d=i.tableFilterData("events",{date:t.getDate()});if(0==(d=b.substFilterRows(i,o,"events",d)).length)return null;for(var m={},p=0,f=d;p<f.length;p++){var _=f[p],h=_.typ;m[h]||(m[h]=[]),m[h].push(_)}var g=i.tableIds("event_types"),v=(g=s.__spreadArrays(["changeroom"],g.filter(function(e){return"changeroom"!=e}))).map(function(e){var s=m[e];if(!s)return null;var a=n.eventTypeInfo.get(e);return r.createElement(x,{key:e,title:i.rowName("event_types",e),collapsedRef:u.sub(e,!1),count:s.length,level:1,menu:a?a.menu:void 0},s.map(function(e){return r.createElement(E,{key:e.id,online:t,event:e,eventInfo:n.eventInfo.get(e.id)})}))});return r.createElement(r.Fragment,null,r.createElement(x,{title:ASC.ls(1844),collapsedRef:l,count:d.length}),r.createElement(a.AnimatedCollapseDiv,{collapsed:c},v))}function S(e){var t=d.client_req,n="",s="/static/pics/patient_ok_128.png";return e.uploaded?n=t.ttls(1995):e.holiday?(n=t.ls(1245),s="/static/pics/rest_area_128.png"):n=e.isAbsent?t.ttls(1447):t.ttls(3815)+"\n"+m.date_format_date(t,e.date,!1)+"\n"+t.ttls(3816),r.createElement("div",{className:"add isAbsent",onClick:function(t){e.uploaded?e.online.checkUploaded(e.date):e.online.showAbsentEditDlg("")}},r.createElement("div",{className:"img",style:{backgroundImage:"url("+s+")"}}),n)}function x(e){var t=e.children||[],n=e.collapsedRef.value,s=e.count;return void 0===s&&(s=t.length),r.createElement(r.Fragment,null,r.createElement("div",{className:e.level?"subheader":"header",style:{cursor:"pointer",userSelect:"none",display:"flex",flexDirection:"row"},onClick:function(){return e.collapsedRef.set(!n)}},r.createElement("span",{style:{flex:1}},e.title+(n?" ("+s+")":":")),e.menu&&r.createElement("span",{style:{padding:"1px 4px"},onClick:function(t){return p.showMenu(e.menu,t.currentTarget)}},r.createElement("i",{className:"fa fa-caret-down"}))),r.createElement(a.AnimatedCollapseDiv,{collapsed:n},t))}function T(e){var t=a.useHover(),n=t[0],i=t[1],o=e.onClick,l="",c="#ffffff";switch(e.state){case"handled":l="/static/pics/item_ok_16.png",c="#d0ffd0";break;case"event":l="/static/pics/events_32.png";break;case"error":l="/static/pics/item_bad_16.png"}return e.smallicon&&(l=e.smallicon),(n||e.popupShown)&&(c="#b3d4ff"),r.createElement("div",s.__assign({},i,{onClick:o,onContextMenu:o,style:{backgroundColor:c,padding:4,cursor:"pointer",minHeight:32,position:"relative"}}),r.createElement("img",{src:e.icon,style:a.rtlCss({height:32,float:"left",marginRight:4})}),r.createElement("div",{style:{float:"right",color:"#808080",fontSize:"80%"}},e.when),r.createElement("div",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},e.name),r.createElement("div",{style:{marginTop:3,color:"#808080"}},e.reason),!!l&&r.createElement("img",{src:l,style:a.rtlCss({position:"absolute",left:21,top:23,height:16,filter:"drop-shadow(1px 1px 2px rgba(0,0,0,0.5))"})}))}function C(e){var t=e.absent,n=e.online.naming_dbi,s=e.absentInfo.eventids,a=f.useSimplePopup(),o=a[0],c=a[1],u=a[2],d=l.absentGetTable(t),m=l.absentGetId(t),p=n.rowName(d,m);"groups"==t.table&&(p+=" ("+n.tools.groupnames_names([t.groupname])+")");var b="";t.longtime_datefrom&&(b=ASC.ASC_date2str(t.longtime_datefrom,!1)+"-"+ASC.ASC_date2str(t.longtime_dateto,!1)+" "),void 0!==t.period&&(b+=n.tools.ttitem_popis(t).period);var _=n.rowName("absent_types",t.absent_typeid);return r.createElement(r.Fragment,null,r.createElement(T,{key:t.subId,icon:"/static/pics/"+i.DBITools.removeEs(d)+"_32.png",state:0<s.length?"event":"",smallicon:void 0,name:"teachers"==d?r.createElement("span",{className:"ascSeCnt"},p):p,when:b,reason:_,popupShown:u,onClick:function(e){return c(e)}}),u&&r.createElement(o,null,r.createElement(h.AbsentPopup,{where:"subst",absentid:t.id,eventids:s})))}function k(e){var t=e.online,n=t.filter,s=t.dbi,i=a.useStateValueRef(!1),o=e.online.getAbsents().filter(function(t){return l.absentGetTable(t)==e.table});o=b.substFilterRows(s,n,"substonline_absents",o);var c=new Map;function u(e){return c.get(l.absentGetId(e))||1e3}return t.dbi.tableData(e.table).forEach(function(e,t){return c.set(e.id,t+1)}),o.sort(function(e,t){return u(e)-u(t)}),0==o.length?null:r.createElement(x,{title:e.title,collapsedRef:i},o.map(function(t){return r.createElement(C,{key:t.id,online:e.online,absent:t,absentInfo:e.eventsInfo.absentInfo.get(t.id)})}))}function D(e){for(var t,n,s=d.client_req,a=e.dbi,o=e.row,l=a.table("substonline_students"),c=o.studentids||[],u=new Map,p=0,b=c;p<b.length;p++){var f=b[p],_=a.rowData("students",f,{}).classid||"";i.map2array_get(u,_).push(f)}for(var h=[],v=0,y=a.tableIds("classes");v<y.length;v++){_=y[v];var E=u.get(_);if(E){var w=a.rowName("classes",_,"short")+": ";1<u.size?w+=E.length:w+=s.lsf(10885,{n:E.length}),h.push(w)}}var S="";o.longtime_datefrom<o.longtime_dateto&&(S=m.date_format_2dates(s,o.longtime_datefrom,o.longtime_dateto,!1)),"ad"!=o.uniperiod&&(S&&(S+=", "),S+=a.tools.uniperiodName(o.uniperiod,"short",o));var x="âž” ";return x+=a.rowNames("classes",o.moveto_classids||[],"short")+": ",x+=s.lsf(12018,{n:(null===(t=o.moveto)||void 0===t?void 0:t.length)+(null===(n=o.groupsubjectids)||void 0===n?void 0:n.length)}),r.createElement(r.Fragment,null,r.createElement(T,{name:h.join(", "),icon:l.icon(),when:S,reason:x,onClick:function(e){return g.showSubstStudentsPopup(e,{table:"substonline_students",id:o.id})}}))}function I(e){var t=e.online,n=t.dbi,s=t.getDate(),i="substonline_students",o=a.useStateValueRef(!1),l=n.table(i);if(!l)return null;var c=n.tableFilterData(i,{date:s});return 0==c.length?null:r.createElement(x,{title:l.name(),collapsedRef:o},c.map(function(e){return r.createElement(D,{key:e.id,dbi:n,row:e})}))}(e.eventName=v).needed_part=i.typed({events:["name","typ"],event_types:["name"]}),y.npp=i.neededPartProvider(function(){return[l.buildSubstOnlineTTItemsEx,o.event_tableIds,o.isTTCancelEvent,{events:["date","typ","__ttitem_old"],substonline_absents:["date","table","teacherid","classroomid","classid","groupname","period","durationperiods"]}]}),w.npp=i.neededPartProvider(function(){return[v,o.eventIcon,{events:["date","typ","__ttitem_old"],event_types:["name"]}]}),(e.LeftPanel=function(e){var t=e.online,n=y(t),i=t.getDateRow(),a=t.getAbsents();return r.createElement("div",{style:s.__assign({width:"200px",display:"flex",flexDirection:"column"},e.style||{}),className:"absent_d"},r.createElement(S,{online:e.online,uploaded:!!i.uploaded_int,holiday:i.is_holiday,isAbsent:0<a.length,date:t.getDate()}),r.createElement("div",{className:"list",style:{overflow:"auto",flex:"1 100px"}},r.createElement(k,{online:e.online,table:"teachers",title:ASC.ttls(3817),eventsInfo:n}),r.createElement(k,{online:e.online,table:"classes",title:ASC.ttls(3779),eventsInfo:n}),r.createElement(k,{online:e.online,table:"classrooms",title:ASC.ttls(3780),eventsInfo:n}),r.createElement(I,{online:e.online}),r.createElement(w,{online:e.online,eventsInfo:n})))}).npp=i.neededPartProvider(function(){return[w,k,I,y]}),k.needed_part=i.typed({substonline_absents:["date","table","classid","teacherid","classroomid","groupname","note","absent_typeid","longtime_datefrom","longtime_dateto"],absent_types:["__name"]}),I.needed_part=i.typed({substonline_students:["date","studentids","groupsubjectids","longtime_datefrom","longtime_dateto","uniperiod","durationperiods","moveto","moveto_classids"],students:["classid"],classes:["__name"],periods:["short"]})},"/substitution/server/substdbi.js":function(e,t,n){n.implementRpc(["substDBIAccessor"])},"/react/splitline.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../asc/asc_react"),i=t("react");e.SplitLine=function(e){var t=e.sizeRef,n=e.style,a=e.axis,o=e.unit,l=e.min,c=e.max,u=i.useRef(),d=i.useState(1),m=d[0],p=d[1],b=a.includes("x");r.useDomReader(function(){if("%"==o){var e=u.current.parentElement,t=b?e.clientWidth:e.clientHeight;p(Math.max(t,10)/100)}});var f=1==m?t:t.cast(function(e){return e*m},function(e){return e/m}),_=r.useMouseResize(f,{axis:a,min:(null!=l?l:0)*m,max:null!=c?c*m:void 0});return i.createElement("div",{ref:u,onMouseDown:_,style:s.__assign(s.__assign({boxSizing:"border-box",flex:"0 0 auto"},b?{width:5,cursor:"e-resize"}:{height:5,cursor:"s-resize"}),n||{})})}},"/asc/purchase.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("./server/purchase"),i=t("../rpr/dbi"),a=t("../rpr/dbi_react"),o=t("./edurequest"),l=t("react"),c=t("./asc_react"),u=t("./lib_date"),d=t("../rpr/maindbi_ui");function m(e){return void 0===e&&(e={}),s.__awaiter(this,void 0,void 0,function(){var t;return s.__generator(this,function(n){switch(n.label){case 0:return[4,ASC.blockUI(r.getPurchaseEdupageLink(null,e))];case 1:return t=n.sent(),c.openUrl(t),[2]}})})}e.showPurchaseEdupage=m,(e.LicenseExpiredBanner=function e(t){var n,r,p=o.client_req,b=a.useMainDBI(t.dbi?null:p.getSchoolYear(),{needed_part:e.needed_part,interactive:!1})||t.dbi,f=i.patchmissingobj(b.rowData("global_settings","1",{}).license);if("Xascpalo"==p.edupage&&(f={expire:"2022-04-01",pro:!1,ttonline:!0,limited:!1,standard:!1,certik_url:"https://www.asctimetables.com"}),b.mock)return null;if(!(p.isAdmin()||p.hasRight("timetable")||p.hasRight("subst")||p.hasRight("agenda")))return null;if(["sk","cz","de","at","ch","pl","tr","ru"].includes(p.school_country)&&"ascpalo"!=p.edupage)return null;var _=function(){return m()},h="";if(f.certik_url)n=p.ls(11860),_=function(){return c.openUrl(f.certik_url)},h="certik";else if(f.ttonline||f.pro){if(!(f.expire&&f.expire<u.date_delta(p.timezone_date(),31)))return null;n=p.lsf(9338,{date:u.date_format_date(p,f.expire)}),r=p.ls(9336)}else f.expire?(n=p.ls(9337),r=p.ls(9335),h="expired"):(n=p.ls(11609),r=p.ls(11610));return l.createElement("div",{style:s.__assign({backgroundColor:"#ffeee9",padding:4,display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer"},t.style||{}),onClick:_},l.createElement("img",{src:"/static/pics/register_32.png",style:{height:32}}),l.createElement(c.HGap,null),l.createElement("div",{style:{fontSize:16,lineHeight:"90%"}},n,r&&l.createElement(l.Fragment,null,l.createElement("br",null),l.createElement("span",{style:{fontSize:10,color:"#888"}},r))),l.createElement(c.ROnMount,{onMount:function(){h&&d.maindbiActionStat("LicenseExpiredBanner."+h,"global_settings","show")}}))}).needed_part=i.typed({global_settings:["license"]})},"/asc/server/purchase.js":function(e,t,n){n.implementRpc(["getPurchaseEdupageLink"])},"/substitution/vieweradmin.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("./online/report"),a=t("../asc/asc_react"),o=t("./viewer"),l=t("../asc/edurequest"),c=t("./server/viewer"),u=t("../asc/asc_react2"),d=t("../customize/privacy"),m=t("../react/combobox");function p(e){var t=e.settingsRef,n=e.dbi,s=e.type,o=e.substViewerAdmin,c=l.client_req;return r.createElement("div",{style:{flex:1}},r.createElement(u.ModuleHeader,{title:c.localize(i.substReportTypeName[s]),icon:n.table(s).icon(),small:!0}),r.createElement(a.RLabel,{text:c.ls(1671)+":"}),r.createElement(m.default,{items:d.privacyCombo2(c,{students_me:"classes"==s}),valueRef:t.sub("privacy")}),r.createElement(a.VGap,{height:20}),r.createElement("div",{style:"disabled"==t.value.privacy?{visibility:"hidden"}:{}},r.createElement(i.SubstReportSettingsDiv,{settingsRef:t.sub("settings"),type:s,substViewerAdmin:o})))}function b(e){var t=e.settingsRef,n=e.dbi,s=l.client_req;return r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",flexDirection:"row",position:"relative"}},r.createElement(p,{settingsRef:t.sub("classes"),type:"classes",dbi:n,substViewerAdmin:!0}),r.createElement(u.VSeparatorLine,{height:"auto",style:{alignSelf:"stretch"}}),r.createElement(p,{settingsRef:t.sub("teachers"),type:"teachers",dbi:n,substViewerAdmin:!0})),r.createElement(u.SeparatorLine,null),r.createElement("div",null,r.createElement(a.RLabel,{text:s.ls(2206)+":",style:{width:"auto"}}),r.createElement(a.HGap,{width:10}),r.createElement(m.default,{items:function(e,t){void 0===t&&(t=31);for(var n=[{value:"-1",name:e.ls(1349)},{value:"-2",name:e.ls(3146)},[]],s=0;s<=t;s++)n.push({value:""+s,name:e.lsf(2261,{n:s})});return n}(s),valueRef:t.sub("past_limit_days").cast(function(e){return""+e},function(e){return parseInt(e)})})))}function f(){return s.__awaiter(this,void 0,void 0,function(){var e,t,n,i;return s.__generator(this,function(o){switch(o.label){case 0:return e=l.client_req,[4,ASC.loadTTLang()];case 1:return o.sent(),[4,c.getSubstViewerSettings(null)];case 2:return t=o.sent(),[4,e.maindbi(e.getSchoolYear(),{tables:["teachers","subjects","classes","classrooms","absent_types","substitution_types"],columns:["short","name"],info_columns:["__name"]})];case 3:return n=o.sent(),[4,a.RDialog.showInput({settings:t},function(e){var t=e.stateRef.sub("settings");return r.createElement(b,s.__assign({},{settingsRef:t,dbi:n}))},{header:e.ls(1003)+" - "+e.ls(1989)+" / "+e.ls(6950)+" - "+e.ls(1637),width:800})];case 4:return(i=o.sent())?[4,c.setSubstViewerSettings(null,i.settings)]:[2,!1];case 5:return o.sent(),[2,!0]}})})}e.SubstViewerAdmin=function(e){var t=r.useState(0),n=t[0],l=t[1];function c(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,f()];case 1:return e.sent()&&l(function(e){return e+1}),[2]}})})}var u=a.useReq();return r.createElement(a.RScopedStyle,{rules:i.EditSettingsBtn.rules,style:{position:"relative"},className:"SubstViewerAdmin"},r.createElement("div",{className:"messageBox customize",style:{marginBottom:5}},r.createElement(a.HGap,{width:8}),r.createElement(a.RButton,{label:u.ls(2339),type:"green",onClick:function(){return c()}}),r.createElement(a.HGap,{width:8}),r.createElement(a.RButton,{label:u.ls(2340),type:"green",onClick:function(){return document.location.href="/substitution/online.php"}})),r.createElement(i.EditSettingsBtn,{onClick:function(){return c()}}),r.createElement(o.SubstViewer,s.__assign({},s.__assign(s.__assign({},e),{refresh:n}))))},e.showSubstViewerAdminSettingsDlg=f,e._hotswap=[p,b]},"/substitution/online/report.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("react-dom"),a=t("../../dashboard/printSheet"),o=t("../subst"),l=t("../../rpr/dbi"),c=t("../../asc/asc_react"),u=t("../../dashboard/dbi_events"),d=t("../../rpr/dbi_react"),m=t("../../asc/lib_date"),p=t("../server/report"),b=t("../../asc/asc_react2"),f=t("../../timetable/ttitem"),_=t("../../react/combobox"),h=t("../filter");function g(e,t){return{names_teachers:e.sort_name_col,names_classes:"name",names_classrooms:"name",names_subjects:"name",names_igroups:"classes"==t?"hide":"name",names_absent_types:"hide",names_substitution_types:"hide",show_signatures:"",show_absents:"absent",show_time:!1,hideabsentteacher:"classes"==t&&"de/th"==e.school_country,hideabsentclass:!1,absent_summary_teachers:!1,absent_summary_classes:!1,absent_summary_classrooms:!1,pagebreak_date:!0,change_format:"",style:""}}e.substReportTypeName={teachers:"{1929}",classes:"{1930}"},e.substReportTypes=[{type:"teachers",name:e.substReportTypeName.teachers},{type:"classes",name:e.substReportTypeName.classes}],e.substReportDefaultSettings=g;var v=[{value:"",name:ASC.ls(1858)},{value:"compact",name:ASC.ls(4953)},{value:"compact_extra",name:ASC.ls(4953)+" (Extra)"},{value:"bars",name:ASC.ls(8996)},{value:"table",name:ASC.ls(1891)}];ASC.asc&&(v.push([]),v.push({value:"mobile",name:ASC.ls(6950)+" (aSc)"}));var y=[{value:"",name:"-"},{value:"subst_day",name:ASC.ls(1003)+" - "+ASC.ls(1465)},{value:"subst_lesson",name:ASC.ls(1003)+" - "+ASC.ls(1301)}],E=[{value:"",name:"-"},{value:"absent",name:ASC.ls(1846)},{value:"absent_lesson",name:ASC.ls(1846)+" + "+ASC.ls(1460)}],w=[{value:"",name:ASC.req.localize("{1858} - {2323}")},{value:"ss",name:ASC.req.localize("{2324}")}],S=100,x="---";function T(e){return{TABLE_ttitems:e?"substonline_ttitems":"subst_ttitems",TABLE_substs:e?"substonline_substitutions":"subst_substitutions",TABLE_absents:e?"substonline_absents":"subst_absents",TABLE_dates:e?"substonline_dates":"subst_dates",TABLE_subst_students:e?"substonline_students":"subst_students"}}function C(e){return s.__awaiter(this,void 0,void 0,function(){var t;return s.__generator(this,function(n){switch(n.label){case 0:return t=[s.__assign(s.__assign({filter:{}},e),T(e.unpublished))],[4,function(e){return s.__awaiter(this,void 0,void 0,function(){var t,n,r,i,a,c,d,m,p,b,_,g,v,y;return s.__generator(this,function(s){switch(s.label){case 0:return t=e.req,n=e.unpublished,r=e.dates,i=r[0],a=r[r.length-1],c=T(n),d=l.DBITools.mergeNeededParts({subst_dates:["date","tt_num","subst_dbid","subst_note"],subst_absents:["date","allday","period","durationperiods","table","teacherid","classid","classroomid","groupname","absent_typeid","note"],subst_substitutions:["date","absent","changes","substitution_typeid","note"],subst_students:["date","studentids","uniperiod","durationperiods","groupsubjectids","moveto","moveto_classids"],subst_ttitems:["date","__ttitem","type","orig","changes","cancelled","substids","origofids","origsubstid"],absent_types:["__name"],substitution_types:["__name"],subjects:["__name"],teachers:["__name","nameprefix","namesuffix"],classes:["__name"],igroups:["__name"],classrooms:["__name","buildingid"],periods:["__name"],dayparts:["__name"],events:["date","__ttitem_old","studentids","_uial"],event_types:[],students:["classid","changes"],groupsubjects:["classids"]},u.eventPrivacy,u.splitClassTeacherEvents,u.eventName,u.isAttachEvent,u.isEntireSchoolEvent,o.buildSubstOnlineTTItemsEx,h.substFilterRows),n&&(d=o.substOnlineNeededPartProvider(function(){return[d,{substonline_dates:["is_online"]}]})()),[4,t.maindbi(t.getSchoolYear(i),{needed_part:d,vt_filter:{datefrom:i,dateto:a}})];case 1:m=s.sent(),_=b=null,g=0,v=(p=m).tableData(c.TABLE_dates),s.label=2;case 2:return g<v.length?(y=v[g],b||!y.tt_num?[3,4]:[4,t.timetabledbi(y.tt_num,{needed_part:l.DBITools.mergeNeededParts(f.TTItemTimeProvider.tt_dbi_needed_part,{classes:["__name"],teachers:["__name"],subjects:["__name"],classrooms:["__name"],custombells:["day","period","break","classids","lessonids","starttime","endtime"]})})]):[3,7];case 3:b=s.sent(),s.label=4;case 4:return _||!y.subst_dbid?[3,6]:[4,t.substdbi(y.subst_dbid,{tables:["classes","teachers","classrooms","subjects","absent_types","substitution_types"],columns:["name","short"]})];case 5:_=s.sent(),s.label=6;case 6:return g++,[3,2];case 7:return _&&(p=b||_?new l.MergeDBI(m,b,_):m),[2,{dbi:p,main_dbi:m,tt_dbi:b,subst_dbi:_}]}})})}(e)];case 1:return[2,s.__assign.apply(void 0,[s.__assign.apply(void 0,t.concat([n.sent()])),{settings:e.settings||g(e.req,e.type)}])]}})})}function k(e){return r.createElement("div",{className:"editSettings print-skip",onClick:e.onClick},r.createElement("i",{className:"fa fa-fw fa-pencil"}))}function D(e){var t=e.settingsRef,n=e.type,s=e.multidate,i=e.substViewerAdmin,a=c.useReq();c.useTTLang();var o=d.useMainDBI(e.year||a.getSchoolYear(),{needed_part:{teachers:[],subjects:[],classes:[],classrooms:[],igroups:[],absent_types:[],substitution_types:[]}});return r.createElement("div",null,r.createElement(c.RLabel,{text:a.ls(1353)+(i?" ("+a.ls(1989)+")":"")}),r.createElement(_.default,{valueRef:t.sub("style"),items:v}),r.createElement(c.VGap,{height:10}),r.createElement(b.RGroupBox,{title:a.ls(6473)},["teachers","subjects","classes","igroups","classrooms","absent_types","substitution_types"].map(function(e){if("classes"==n&&["absent_types","substitution_types"].includes(e))return null;var s=!1;return["absent_types","substitution_types"].includes(e)&&(s=!0),"classes"==n&&("teachers"!=e&&"igroups"!=e||(s=!0)),r.createElement(c.Fragment,{key:e},r.createElement(c.RLabel,{text:o.table(e).name()+":"}),r.createElement(d.DBINameColInput,{valueRef:t.sub("names_"+e),table:e,allowHide:s}),r.createElement("br",null))}),r.createElement(c.VGap,{height:10}),r.createElement(c.RLabel,{text:a.ls(1622)+" - "+a.ls(1489)}),r.createElement(_.default,{valueRef:t.sub("show_absents"),items:E}),r.createElement(c.VGap,{height:10}),r.createElement(c.RLabel,{text:a.ls(2325)+":"}),r.createElement(_.default,{valueRef:t.sub("change_format"),items:w})),r.createElement(c.VGap,{height:10}),r.createElement(b.RGroupBox,{title:a.ls(1363)+" - "+a.ls(1898)},["teachers","classes","classrooms"].map(function(e){return r.createElement(c.Fragment,{key:e},r.createElement(c.RCheckBox,{label:a.localize(ce[e]),valueRef:t.sub("absent_summary_"+e)}),r.createElement("br",null))})),r.createElement(c.VGap,{height:10}),"teachers"==n&&r.createElement(r.Fragment,null,r.createElement(c.RCheckBox,{valueRef:t.sub("hideabsentclass"),label:a.ls(1933)}),r.createElement("br",null),r.createElement(c.RLabel,{text:a.ls(2694)+":"}),r.createElement(_.default,{valueRef:t.sub("show_signatures"),items:y}),r.createElement("br",null)),"classes"==n&&r.createElement(r.Fragment,null,r.createElement(c.RCheckBox,{valueRef:t.sub("hideabsentteacher"),label:a.ls(2074)}),r.createElement("br",null)),r.createElement(c.VGap,{height:10}),r.createElement(c.RLabel,{text:a.ls(1345)+":"}),r.createElement(c.RCheckBox,{label:a.ls(1489),valueRef:t.sub("show_time")}),s&&r.createElement(r.Fragment,null,r.createElement(c.VGap,{height:10}),r.createElement(c.RCheckBox,{valueRef:t.sub("pagebreak_date"),label:a.ls(3157)})))}e.substReportScope=C,e.showSubstReportDlg=function(e){return s.__awaiter(this,void 0,void 0,function(){var t,n,i,a,o,l;return s.__generator(this,function(s){switch(s.label){case 0:return n=(t=c.RDialog).show,a=(i=r).createElement,o=[R],l={},[4,C(e)];case 1:return n.apply(t,[a.apply(i,o.concat([(l.scope=s.sent(),l)]))]),[2]}})})},(e.EditSettingsBtn=k).rules=l.typed({"div.editSettings":{display:"none",padding:"0.25em",backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",cursor:"pointer",margin:"1px",textDecoration:"none",position:"absolute",right:0,top:0},"&:hover div.editSettings":{display:"block"}}),e.SubstReportInReportovac=function(e){var t=this,n=r.useState(null),a=n[0],o=n[1],l=r.useState(0),u=l[0],d=l[1],m=e.dates,b=e.reportid,f=e.subst_unpublished,_=e.buildingid,h=e.classes_cz_zs_stupen,g=e.classes_sk_zs_stupen,v=c.useReq(),y=b.split("_")[1],E=c.useAsyncMemo(function(){return s.__awaiter(t,void 0,void 0,function(){var e,t;return s.__generator(this,function(n){switch(n.label){case 0:return e=C,t={req:v,type:y,where:"report",unpublished:f,filter:{buildingid:_,cz_zs_stupen:h,sk_zs_stupen:g},dates:m},[4,p.getSubstReportInReportovacSettings(v,y)];case 1:return[4,e.apply(void 0,[(t.settings=n.sent(),t)])];case 2:return[2,n.sent()]}})})},[y,f,m.join(),_,u],null,{inputs_reset:[u]});function w(){return s.__awaiter(this,void 0,void 0,function(){var e,t,n,i;return s.__generator(this,function(s){switch(s.label){case 0:return e=E.settings,t=E.dbi,n=E.dates,[4,c.RDialog.showInput({settings:e},function(e){var s=e.stateRef.sub("settings").cast(function(e){return e},function(e){return o(e),e});return r.createElement(D,{settingsRef:s,type:y,year:parseInt(t.dbid),multidate:1<n.length})},{header:v.ls(1637),width:400})];case 1:return(i=s.sent())?[4,p.setSubstReportInReportovacSettings(null,y,i.settings)]:[3,3];case 2:return s.sent(),o(null),d(function(e){return e+1}),[3,4];case 3:o(null),s.label=4;case 4:return[2]}})})}return E?r.createElement(c.RAutoUnmount,null,r.createElement(c.RScopedStyle,{className:"SubstReportInReportovac",rules:k.rules,style:{position:"relative"},ref:function(e){e&&(i.findDOMNode(e)._editSettings=function(){return w()})}},r.createElement(k,{onClick:function(){return w()}}),r.createElement(de,s.__assign({},s.__assign(s.__assign({},E),{settings:a||E.settings}))))):r.createElement(c.Loading,null)},e.showSubstReportInReportovacSettings=function(e){return s.__awaiter(this,void 0,void 0,function(){var t,n;return s.__generator(this,function(s){return t=$j(e).find(".SubstReportInReportovac").first(),(n=t.get(0))&&n._editSettings(),[2]})})},e.SubstReportSettingsDiv=D;var I,R=(I=r.Component,s.__extends(A,I),A.prototype.render=function(){var e=this,t=this.props.scope,n=t.type,i=t.req,o=this.state.settings;return r.createElement(a.PrintSheet,{renderer:function(){return null},asDialog:!0,filename:i.ls(1003),onCustomize:function(){return s.__awaiter(e,void 0,void 0,function(){var e,t,a=this;return s.__generator(this,function(o){switch(o.label){case 0:return e=this.state.settings,[4,c.RDialog.showInput({settings:e},function(e){var t=e.stateRef.sub("settings").cast(function(e){return e},function(e){return a.setState({settings:e}),e});return r.createElement(D,s.__assign({},{settingsRef:t,type:n}))},{header:i.ls(1637),width:400})];case 1:return t=o.sent(),this.setState({settings:t?t.settings:e}),[2]}})})}},r.createElement(de,s.__assign({},s.__assign(s.__assign({},t),{settings:o}))))},A.prototype.componentDidMount=function(){barTrackEvent({eventCategory:"SubstPrintSheet",eventAction:"SubstPrintSheet.open",eventLabel:""})},A);function A(e){var t=I.call(this,e)||this;return t.state={settings:e.scope.settings},t}var N="/static/pics/absent_32.svg",B="/static/pics/events_32.svg";function j(e){return r.isValidElement(e)?e.type==b.RJoin&&0==r.Children.count(e.props.children):""==e||null==e||null==e||"boolean"==typeof e}function P(e){var t=e.scope,n=e.uniperiod,s=e.data,i=e.what,o=e.info,c=e.info_detail,u=e.className,d=e.show_signature,p=t.settings,b=t.dbi,f=t.timeProvider,_=t.req,h=p.show_time,g="",v="";switch(u){case"event":g=B;break;case"event_absent":g=B,v=N;break;case"absent":g=N}var y="remove"==u,E=l.DBITools.typeOfUniPeriod(n),w=b.tools.uniperiodName(n,void 0,s);"starttime"==E&&h&&(w=""),y&&(w="("+w+")");var S="";if(h&&n&&!["daypart","allday"].includes(E)){var T=s||{},C=f.provide({uniperiod:n,classids:T.classids||[],endtime:T.endtime||"",durationperiods:T.durationperiods||null});if(C){var k=function(e){return m.date_format_time0(_,e,{ajSekundy:!1,short:!0})};S=k(C.starttime)+"-"+k(C.endtime)}}var D=w,I=null;g&&(I=r.createElement("img",{src:g,style:{height:16,display:"inline-block",verticalAlign:"text-bottom",marginRight:5}}),v&&(I=r.createElement("span",{style:{position:"relative"}},I,r.createElement("img",{src:v,style:{height:10,display:"block",position:"absolute",left:8,bottom:-1}}))));var R=r.createElement(r.Fragment,null,S&&r.createElement(r.Fragment,null,S,", "),I,i,!j(i)&&!j(o)&&" - ",o);return"table"==p.style?r.createElement(r.Fragment,null,r.createElement("td",{className:"period"},r.createElement(a.PrintFontResizable,null,D)),h&&r.createElement("td",{className:"time"},r.createElement(a.PrintFontResizable,null,S)),r.createElement("td",{className:"what"},r.createElement(a.PrintFontResizable,null,I,i)),r.createElement("td",{className:"info"},r.createElement(a.PrintFontResizable,null,o)),"subst_lesson"==p.show_signatures&&r.createElement("td",{className:"signature"},d||x)):r.createElement("div",{className:"row "+u},r.createElement("div",{className:"period"},r.createElement(a.PrintFontResizable,null,D)),r.createElement("div",{className:"info"},r.createElement(a.PrintFontResizable,null,R,d&&r.createElement(Y,null),c&&r.createElement("div",{className:"detail"},c))))}function M(e){var t=e.scope,n=e.old,s=e.new,i=e.prefix;return n==s?r.createElement(r.Fragment,null,i,s):n?"ss"==t.settings.change_format?r.createElement(r.Fragment,null,i,r.createElement("s",null,n),s&&r.createElement(r.Fragment,null," âž” ",s)):r.createElement(r.Fragment,null,i,"(",n,")",s&&r.createElement(r.Fragment,null," âž” ",s)):s?r.createElement(r.Fragment,null,i,"+",s):null}function O(e){var t=e.scope,n=e.infos,s=e.ttitem,i=e.orig,a=e.col,c=e.ignoreid,u=e.force_show,d=t.dbi,m=t.settings,p=t.req,b=m.hideabsentteacher,f=o.changeColumn2table(a);if(!f)throw ASC.dieError("9561628993");var _=m["names_"+f];if("teachers"!=f||"hide"!=_){var h=new Set,g=!!u;if(!l.idsArrayMatchI(s[a],i[a]))if(s.added&&0==i[a].length)g=!0;else for(var v=0,y=s.changes;v<y.length;v++){var E=y[v];if(o.changeColumn2table(E.column)==f&&(!c||E.old!=c&&E.new!=c))if(E.new){if(E.old)if("teachers"==f&&b)n.push(p.ls(1003)+": "+d.rowName(f,E.new,_));else{var w="?";"teachers"==f&&(w=p.ls(1003),"mobile"==m.style&&(w="")),"classrooms"==f&&(w=p.ls(1895)),n.push(r.createElement(M,{scope:t,prefix:w&&w+": ",old:d.rowName(f,E.old,_),new:d.rowName(f,E.new,_),key:""+n.length}))}else n.push(r.createElement(M,{scope:t,new:d.rowName(f,E.new,_),key:""+n.length}));h.add(E.new)}else if(E.old)if("teachers"==f&&b)if(0==s.teacherids.length){var S=p.ttls(3118);n.includes(S)||n.push(S)}else n.push(r.createElement(M,{scope:t,old:p.ls(3356),key:""+n.length}));else n.push(r.createElement(M,{scope:t,old:d.rowName(f,E.old,_),key:""+n.length}))}if(g){var x=s[a];x=x.filter(function(e){return!h.has(e)}),c&&(x=x.filter(function(e){return e!=c})),x.length&&n.push(d.tools.itemName(f,x.length)+": "+d.rowNames(f,x,_))}}else l.idsArrayMatchI(s[a],i[a])||n.push(p.ls(1003))}function z(e){var t=e.infos,n=e.scope,s=e.ttitem,r=e.orig,i=n.dbi,a=n.settings,o=n.req,c=l.idsArrayDiff(r.classids,s.classids);0<c.length&&t.push("("+o.ttls(2825)+" "+i.rowNames("classes",c,a.names_classes)+")")}function F(e){var t=e.infos,n=e.scope,s=e.ttitem,i=e.orig,a=n.dbi,o=n.req;l.idsArrayMatchI(s.groupnames,i.groupnames)||t.push(r.createElement(M,{scope:n,prefix:o.ls(6964)+": ",old:a.tools.groupnames_names(i.groupnames),new:a.tools.groupnames_names(s.groupnames),key:""+t.length}))}function L(e){for(var t=e.infos,n=e.scope,s=e.ttitem,r=n.dbi,i=n.TABLE_substs,a=n.req,o="",l=0,c=[7442,7443];l<c.length;l++)for(var u=c[l],d=a.lsf(u,{date:""}).trim(),m=0,p=t;m<p.length;m++){var b=p[m];if("string"==typeof b&&b.includes(d)){o=d;break}}for(var f=0,_=s.substids;f<_.length;f++){var h=_[f],g=r.rowData(i,h);if(g){var v=g.note;o&&v.includes(o)&&v.length<=o.length+8&&(v=""),v&&(t.includes(v)||t.push(v))}}}function G(e){var t=e.infos,n=e.ttitem,s=e.scope,r=s.dbi,i=s.date,a=s.req,o="";if(n.cancelled&&0<n.origofids.length){var l=n.origofids[0].split(":")[0];if(l!=i)o=a.lsf(7442,{date:m.date_format_day(a,l,!1,!0)});else for(var c=0,u=n.changes;c<u.length;c++){var d=u[c];"period"==d.column&&d.new&&(o=a.lsf(9701,{period:r.tools.uniperiodName(d.new,"name",n)}))}}return!!o&&(t.push(o),!0)}function U(e){var t=e.scope,n=e.ttitem,s=t.dbi,r=t.teacherid,i=t.classid,a=t.absents,c=t.TABLE_substs,u=r?"teachers":"classes",d=r||i;if(!d)return!1;if(o.substTTItem_tableIds(n,u).includes(d))return!1;for(var m=0,p=n.substids;m<p.length;m++){var b=p[m],f=s.rowData(c,b);if(f&&(g=f.absent)&&o.absentGetTable(g)==u&&o.absentGetId(g)==d)return!0}if(n.cancelled&&"teachers"==u)for(var _=0,h=a;_<h.length;_++){var g=h[_];if(o.absentGetTable(g)==u&&o.absentGetId(g)==d){if(g.allday)return!0;if(g.period&&"period"==l.DBITools.typeOfUniPeriod(n.uniperiod)){var v=parseInt(g.period),y=v+(g.durationperiods||1)-1,E=parseInt(n.uniperiod);if(v<=E&&E<=y)return!0}}}return!1}function q(e){var t=e.scope,n=e.ttitem,s=t.dbi,r=t.TABLE_substs;if(!n.orig)return!1;if(n.classids.length==n.orig.classids.length)return!1;if(t.classid&&!n.classids.includes(t.classid))return!0;for(var i=0,a=n.substids;i<a.length;i++){var l=a[i],c=s.rowData(r,l);if(!c.absent)return!1;if("classes"!=o.absentGetTable(c.absent))return!1}return!0}function H(e){var t=e.infos,n=e.ttitem,s=e.scope,r=s.dbi,i=s.date,a=s.req,o="";if(n.origsubstid){var l=n.origsubstid.split(":")[0];if(l!=i)o=a.lsf(7443,{date:m.date_format_day(a,l,!1,!0)});else for(var c=0,u=n.changes;c<u.length;c++){var d=u[c];"period"==d.column&&d.old&&(o=a.lsf(9702,{period:r.tools.uniperiodName(d.old,"name",n)}))}}return!!o&&(t.push(o),!0)}function V(e){var t=e.scope,n=e.ttitem,i=t.dbi,a=t.settings,o=t.classid,c=t.req,u=n.orig||n,d="",m="";if(l.idsArrayMatchI(n.groupnames,u.groupnames)||n.cancelled){var p="",f=n.groupnames.length?n.groupnames:u.groupnames;l.DBITools.groupnamesIsEntireClass(f)||(p=i.tools.groupnames_names(f)),p&&("mobile"==a.style?d=p:m=p+": ")}var _=r.createElement(M,{scope:t,prefix:m,old:i.rowName("subjects",u.subjectid||n.subjectid,a.names_subjects),new:i.rowName("subjects",n.subjectid||u.subjectid,a.names_subjects)}),h=[],g="";return!n.classids.includes(o)||n.cancelled?(n.cancelled&&0<u.teacherids.length&&"hide"!=a.names_teachers&&h.push(i.rowNames("teachers",u.teacherids,a.names_teachers)),G({infos:h,scope:t,ttitem:n})||h.push(c.ls(2322)),g="remove"):(n.added?(H({infos:h,scope:t,ttitem:n})||h.push(c.ls(6270)),g="add"):0<n.changes.length&&(g="change"),O({scope:t,infos:h,ttitem:n,orig:u,col:"teacherids",force_show:0<n.teacherids.length||0<u.teacherids.length}),O({scope:t,infos:h,ttitem:n,orig:u,col:"classroomids"}),z({infos:h,scope:t,ttitem:n,orig:u}),F({infos:h,scope:t,ttitem:n,orig:u})),L({infos:h,scope:t,ttitem:n}),0==h.length&&h.push(c.ls(2252)),r.createElement(P,s.__assign({},{scope:t,uniperiod:n.uniperiod,data:n,className:g,what:_,info:r.createElement(b.RJoin,{children:h,glue:", "}),info_detail:d}))}function W(e){var t=e.scope,n=e.ttitem,i=t.dbi,a=t.settings,o=t.req,c=n.orig||n,u="";if(l.idsArrayMatchI(n.groupnames,c.groupnames)||n.cancelled){var d=n.groupnames.length?n.groupnames:c.groupnames;l.DBITools.groupnamesIsEntireClass(d)||(u=i.tools.groupnames_names(d)+": ")}var m=r.createElement(M,{scope:t,prefix:u,old:i.rowName("subjects",c.subjectid||n.subjectid,a.names_subjects),new:i.rowName("subjects",n.subjectid||c.subjectid,a.names_subjects)}),p=[],f="";return!n.igroupid||n.cancelled?(G({infos:p,scope:t,ttitem:n})||p.push(o.ls(2322)),f="remove"):(n.added?(H({infos:p,scope:t,ttitem:n})||p.push(o.ls(6270)),f="add"):0<n.changes.length&&(f="change"),O({scope:t,infos:p,ttitem:n,orig:c,col:"teacherids"}),O({scope:t,infos:p,ttitem:n,orig:c,col:"classroomids"})),L({infos:p,scope:t,ttitem:n}),0==p.length&&p.push(o.ls(2252)),r.createElement(P,s.__assign({},{scope:t,uniperiod:n.uniperiod,data:n,className:f,what:m,info:r.createElement(b.RJoin,{children:p,glue:", "})}))}function K(e){var t=e.scope,n=e.ttitem,i=t.dbi,a=t.settings,l=t.teacherid,c=t.TABLE_substs,u=t.req,d=n.orig||n,m="";if("classroomsupervision"==n.type)m=u.ls(1723)+": "+i.rowNames("classrooms",d.classroomids,a.names_classrooms);else{var p,f=n.cancelled?d:n;p=f.igroupid?i.rowName("igroups",f.igroupid,a.names_igroups):i.tools.ttitem_popis(f,a.names_classes).class,m=r.createElement(M,{scope:t,prefix:p+": ",old:i.rowName("subjects",d.subjectid||n.subjectid,a.names_subjects),new:i.rowName("subjects",n.subjectid||d.subjectid,a.names_subjects)})}var _=[],h="",g=!1;if(n.cancelled)G({infos:_,scope:t,ttitem:n})||_.push(u.ls(2322)),h="remove";else if(n.teacherids.includes(l)){if(g=!0,n.added)H({infos:_,scope:t,ttitem:n})||_.push(u.ls(6270)),h="add";else{0<n.changes.length&&(h="change");for(var v=0,y=n.changes;v<y.length;v++)if(N=y[v],"teachers"==o.changeColumn2table(N.column)&&N.new==l){var E=u.ls(1003);N.old&&(E=u.ls(8987)+": "+i.rowName("teachers",N.old,a.names_teachers)),_.push(E)}}for(var w=0,S=n.substids;w<S.length;w++){var x=S[w],T=i.rowData(c,x);if(T){for(var C=!1,k=0,D=T.changes;k<D.length;k++)if(N=D[k],"teachers"==o.changeColumn2table(N.column)&&N.new==l){C=!0;break}C&&T.substitution_typeid&&"hide"!=a.names_substitution_types&&_.push(u.ls(1619)+": "+i.rowName("substitution_types",T.substitution_typeid,a.names_substitution_types))}}O({scope:t,infos:_,ttitem:n,orig:d,col:"teacherids",ignoreid:l}),O({scope:t,infos:_,ttitem:n,orig:d,col:"classroomids",force_show:!d.teacherids.includes(l)}),z({infos:_,scope:t,ttitem:n,orig:d}),F({infos:_,scope:t,ttitem:n,orig:d})}else{for(var I=!1,R=0,A=n.changes;R<A.length;R++){var N=A[R];"teachers"==o.changeColumn2table(N.column)&&N.old==l&&(I=!0,N.new?_.push(u.ttls(1481)+": "+i.rowName("teachers",N.new,a.names_teachers)):_.push(u.ttls(1481)+": "+u.ttls(3118)))}I||_.push("Error9952969758"),h="remove"}return L({infos:_,scope:t,ttitem:n}),0==_.length&&_.push(u.ls(2252)),r.createElement(P,s.__assign({},{scope:t,uniperiod:n.uniperiod,data:n,className:h,show_signature:g&&"subst_lesson"==a.show_signatures,what:m,info:r.createElement(b.RJoin,{children:_,glue:", "})}))}function Y(e){return r.createElement("div",{className:"signature"},"Â ")}function J(e){var t=e.scope,n=e.event,i=e.absent,a=t.dbi,o=t.settings,c=t.req,d=[],m=[],p="";if(d.push(u.eventName(a,n,{brief:!0})),0==n.groupnames.length)0<n.studentids.length&&d.push(c.ls(6253));else if(!l.DBITools.groupnamesIsEntireClass(n.groupnames)){var f=a.tools.groupnames_names(n.groupnames);"mobile"==o.style?p=f:d.push(f)}return n.subjectid&&m.push(a.rowName("subjects",n.subjectid)),0<n.classids.length&&!l.idsArrayMatchI(n.classids,[t.classid])&&m.push(a.rowNames("classes",n.classids,o.names_classes)),0<n.teacherids.length&&!l.idsArrayMatchI(n.teacherids,[t.teacherid])&&"hide"!=o.names_teachers&&m.push(a.rowNames("teachers",n.teacherids,o.names_teachers)),0<n.classroomids.length&&m.push(a.tools.itemName("classrooms",n.classroomids.length)+": "+a.rowNames("classrooms",n.classroomids,o.names_classrooms)),i&&i.absent_typeid&&"hide"!=o.names_absent_types&&m.push(c.ttls(1464)+": "+a.rowName("absent_types",i.absent_typeid,o.names_absent_types)),r.createElement(P,s.__assign({},{scope:t,uniperiod:l.DBITools.getUniPeriod(n),data:n,className:i?"event_absent":"event",what:d.join(", "),info:r.createElement(b.RJoin,{children:m,glue:", "}),info_detail:p}))}function Z(e){var t=e.scope,n=e.absent,i=t.dbi,a=t.settings,o=t.req,c=[],u=[],d="",m=o.ls(1846);return"classes"==t.type&&n.groupname&&("mobile"==a.style?d=n.groupname:m=n.groupname+": "+m),c.push(m),n.absent_typeid&&"hide"!=a.names_absent_types&&u.push(o.ttls(1464)+": "+i.rowName("absent_types",n.absent_typeid,a.names_absent_types)),r.createElement(P,s.__assign({},{scope:t,uniperiod:l.DBITools.getUniPeriod(n),data:n,className:"absent",what:c.join(", "),info:r.createElement(b.RJoin,{children:u,glue:", "}),info_detail:d}))}function $(e){var t=e.scope,n=e.header,i=e.items,o=e.signature,l=e.hideHeader,c=t.settings,u=r.createElement(ne,s.__assign({},{scope:t,items:i}));switch(c.style){case"compact_extra":return r.createElement("div",{className:"section print-nobreak"},r.createElement("div",{className:"header"},r.createElement(a.PrintFontResizable,null,n)),r.createElement("div",{className:"rows"},o,u));case"bars":return r.createElement("div",{className:"section print-nobreak"},r.createElement("div",{className:"header"},r.createElement(a.PrintFontResizable,null,o,n)),r.createElement("div",{className:"rows"},u));case"table":return r.createElement("tbody",{className:"print-nobreak"},i.map(function(e,a){return r.createElement("tr",{key:""+a},0==a&&r.createElement("td",{rowSpan:i.length,className:"header"},n),r.createElement(te,s.__assign({},{scope:t,item:e},{key:""+a})),0==a&&"subst_day"==c.show_signatures&&r.createElement("td",{rowSpan:i.length,className:"signature"},!o&&x))}))}return r.createElement("div",{className:"section print-nobreak"},o,l||r.createElement("div",{className:"header"},r.createElement(a.PrintFontResizable,null,n)),r.createElement("div",{className:"rows"},u))}function X(e){switch(l.DBITools.typeOfUniPeriod(e)){case"period":return parseInt(e);case"allday":return-10;case"daypart":return-9+parseInt(e[1])}return 0}function Q(e){return e.event?-2:e.absent?-1:e.cancelled?1:0}function ee(e){e.sort(function(e,t){var n=X(e.uniperiod),s=X(t.uniperiod);return n!=s?n-s:Q(e)-Q(t)})}function te(e){var t=e.scope,n=e.item,i=n.ttitem,a=n.event,o=n.absent,l=n.text,c=n.uniperiod;return i?"teachers"==t.type?r.createElement(K,s.__assign({},{scope:t,ttitem:i,key:i.id})):i.igroupid||i.orig&&i.igroupid?r.createElement(W,s.__assign({},{scope:t,ttitem:i,key:i.id})):r.createElement(V,s.__assign({},{scope:t,ttitem:i,key:i.id})):a?r.createElement(J,s.__assign({},{scope:t,event:a,absent:o,key:a.id})):o?r.createElement(Z,s.__assign({},{scope:t,absent:o,key:o.id})):l?r.createElement(P,s.__assign({},{scope:t,uniperiod:c,data:n.text_data||null,className:n.nosubst?"nosubst":"",what:n.text_what,info:l})):null}function ne(e){var t=e.scope,n=e.items;return r.createElement(r.Fragment,null,n.map(function(e,n){return r.createElement(te,s.__assign({},{scope:t,item:e},{key:""+n}))}))}function se(e){var t=e.classid,n=s.__assign(s.__assign({},e.scope),{classid:t}),i=n.req,a=n.dbi,c=n.settings,d=n.my_classids,m=n.TABLE_substs,p=[];n.ttitems.filter(function(e){return!!e.classids.includes(t)||!(!e.orig||!e.orig.classids.includes(t))}).filter(function(e){for(var t=0,s=e.substids;t<s.length;t++){var r=s[t],i=a.rowData(m,r);if(i){if(i.note)return!0;if(i.cancelled||0<i.changes.length)return!0}}for(var o=function(e){if(n.events.find(function(t){return t.id==e}))return{value:!0}},l=0,c=e.changeeventids;l<c.length;l++){var u=o(c[l]);if("object"==typeof u)return u.value}return!1}).forEach(function(e){"absent_lesson"!=c.show_absents&&U({scope:n,ttitem:e})||c.hideabsentclass&&q({scope:n,ttitem:e})||p.push({uniperiod:e.uniperiod,cancelled:e.cancelled,ttitem:e})});var b=n.events.filter(function(e){return!!u.event_tableIds(e,"classes",{expand_ctevent:!0,dbi:a}).includes(t)});b=h.substFilterRows(a,n.filter,"events",b);var f=new Set;n.absents.filter(function(e){return"classes"==o.absentGetTable(e)&&o.absentGetId(e)==t}).forEach(function(e){var t=le(e,b);p.push({uniperiod:l.DBITools.getUniPeriod(e),absent:e,event:t}),t&&f.add(t)}),b.filter(function(e){return!f.has(e)}).forEach(function(e){return p.push({uniperiod:l.DBITools.getUniPeriod(e),event:e})});for(var _=0,g=n.subst_students;_<g.length;_++){for(var v=g[_],y=[],E=0,w=v.studentids;E<w.length;E++){var S=w[E],x=a.rowData("students",S);x&&(x=l.DBITools.rowApplyChanges(x,n.date)).classid==t&&y.push(S)}if(0<y.length){var T=i.lsf(10885,{n:y.length});0<v.moveto_classids.length&&(T+=" âž” "+a.rowNames("classes",v.moveto_classids)),p.push({uniperiod:v.uniperiod,subst_students:v,text:T,text_what:i.ls(12014),text_data:v})}}if(!d){if(0==p.length)return null;if(!c.show_absents&&!p.find(function(e){return!e.absent}))return null}return 0==p.length&&p.push({uniperiod:"",text:i.ls(1348),nosubst:!0}),ee(p),r.createElement($,{scope:n,header:a.rowName("classes",t,c.names_classes),items:p})}function re(e){var t=e.igroupid,n=s.__assign(s.__assign({},e.scope),{igroupid:t}),i=n.req,a=n.dbi,c=n.settings,d=n.my_igroupids,m=n.TABLE_substs,p=[];n.ttitems.filter(function(e){return e.igroupid==t||!(!e.orig||e.orig.igroupid!=t)}).filter(function(e){if(0<e.changes.length)return!0;for(var t=0,n=e.substids;t<n.length;t++){var s=n[t],r=a.rowData(m,s);if(r&&r.note)return!0}return!1}).forEach(function(e){"absent_lesson"!=c.show_absents&&U({scope:n,ttitem:e})||p.push({uniperiod:e.uniperiod,cancelled:e.cancelled,ttitem:e})});var b=n.events.filter(function(e){return!!u.event_tableIds(e,"igroups").includes(t)});b=h.substFilterRows(a,n.filter,"events",b);var f=new Set;if(n.absents.filter(function(e){return"igroups"==o.absentGetTable(e)&&o.absentGetId(e)==t}).forEach(function(e){var t=le(e,b);p.push({uniperiod:l.DBITools.getUniPeriod(e),absent:e,event:t}),t&&f.add(t)}),b.filter(function(e){return!f.has(e)}).forEach(function(e){return p.push({uniperiod:l.DBITools.getUniPeriod(e),event:e})}),d){var _=!1;if(n.ttitems.forEach(function(e){e.igroupid==t&&(_=!0),e.orig&&e.orig.igroupid==t&&(_=!0)}),!_)return null}else{if(0==p.length)return null;if(!c.show_absents&&!p.find(function(e){return!e.absent}))return null}return 0==p.length&&p.push({uniperiod:"",text:i.ls(1348),nosubst:!0}),ee(p),r.createElement($,{scope:n,header:a.rowName("igroups",t,c.names_igroups),items:p})}function ie(e){var t=e.teacherid,n=s.__assign(s.__assign({},e.scope),{teacherid:t}),i=n.req,a=n.dbi,c=n.settings,d=n.my_teacherids,m=n.TABLE_substs,p=[],b=!1;n.ttitems.filter(function(e){return!!e.teacherids.includes(t)||!(!e.orig||!e.orig.teacherids.includes(t))}).filter(function(e){if(0<e.changes.length)return!0;for(var t=0,n=e.substids;t<n.length;t++){var s=n[t],r=a.rowData(m,s);if(r&&r.note)return!0}return!1}).forEach(function(e){if(("absent_lesson"==c.show_absents||!U({scope:n,ttitem:e}))&&(!c.hideabsentclass||!q({scope:n,ttitem:e}))&&(p.push({uniperiod:e.uniperiod,cancelled:e.cancelled,ttitem:e}),e.teacherids.includes(t))){e.added&&(b=!0);for(var s=0,r=e.changes;s<r.length;s++){var i=r[s];"teachers"==o.changeColumn2table(i.column)&&i.new==t&&(b=!0)}}});var f=n.events.filter(function(e){return!!u.event_tableIds(e,"teachers",{expand_ctevent:!0,dbi:a}).includes(t)});f=h.substFilterRows(a,n.filter,"events",f);var _=new Set;if(n.absents.filter(function(e){return"teachers"==o.absentGetTable(e)&&o.absentGetId(e)==t}).forEach(function(e){var t=le(e,f);p.push({uniperiod:l.DBITools.getUniPeriod(e),absent:e,event:t}),t&&_.add(t)}),f.filter(function(e){return!_.has(e)}).forEach(function(e){return p.push({uniperiod:l.DBITools.getUniPeriod(e),event:e})}),!d){if(0==p.length)return null;if(!c.show_absents&&!p.find(function(e){return!e.absent}))return null}return 0==p.length&&p.push({uniperiod:"",text:i.ls(1348),nosubst:!0}),ee(p),r.createElement($,{scope:n,hideHeader:1==(n.my_teacherids||[]).length,header:a.rowName("teachers",t,c.names_teachers).trim(),signature:b&&"subst_day"==c.show_signatures&&r.createElement(Y,null),items:p})}function ae(e){return r.createElement(r.Fragment,null,r.createElement("div",{style:{fontSize:25,textAlign:"center"}},e.title),r.createElement("div",{style:{fontSize:16,textAlign:"center"}},e.subtitle),r.createElement(c.VGap,{height:5}))}function oe(t){var n=t.scope,i=t.hideTitle,o=t.repeatHeader,l=n.date,u=n.dbi,d=n.type,p=n.settings,b=n.TABLE_dates,f=n.req,_=n.unpublished,h=u.rowData(b,l),g=r.createElement(r.Fragment,null,i||r.createElement(ae,{title:f.ls(1003)+" - "+e.substReportTypes.filter(function(e){return e.type==d}).map(function(e){return f.localize(e.name)}),subtitle:m.date_format_day(f,l,!0,!0)}),h.subst_note&&r.createElement("div",{className:"subst_note",style:{textAlign:"center",whiteSpace:"pre-wrap",marginBottom:3}},r.createElement(a.PrintFontResizable,null,h.subst_note)),!n.me&&r.createElement(r.Fragment,null,r.createElement(ue,s.__assign({},{scope:n,table:"teachers"})),r.createElement(ue,s.__assign({},{scope:n,table:"classes"})),r.createElement(ue,s.__assign({},{scope:n,table:"classrooms"}))),_&&h.is_online&&r.createElement("div",{style:{textAlign:"center",marginTop:5,fontWeight:"bold"}},f.ls(1645)),p.show_signatures&&r.createElement("div",{style:{float:"right",color:"#c0c0c0",textAlign:"center",width:S,marginRight:10}},f.ls(2694)),"mobile"!=p.style&&r.createElement(c.VGap,{height:15}));return o?r.createElement("div",{className:"print-header"},g):g}function le(e,t){for(var n=o.absentGetTable(e),s=o.absentGetId(e),r=l.DBITools.getUniPeriod(e),i=0,a=t;i<a.length;i++){var c=a[i];if(u.event_tableIds(c,n).includes(s)&&l.DBITools.getUniPeriod(c)==r&&(c.durationperiods||1)==(e.durationperiods||1)&&("classes"!=n||c.groupnames.includes(e.groupname||"")))return c}return null}e.SubstReportTitle=ae;var ce={teachers:"{tt:3817}",classes:"{tt:3779}",classrooms:"{tt:3780}"};function ue(e){var t=e.scope,n=e.table,s=t.req,i=t.dbi,c=t.absents,d=t.events,m=t.settings;if(!m["absent_summary_"+n])return null;for(var p=c.filter(function(e){return o.absentGetTable(e)==n}),f=[],_=0,h=i.tableIds(n);_<h.length;_++)for(var g=h[_],v=0,y=p;v<y.length;v++){var E=y[v];if(o.absentGetId(E)==g){var w=le(E,d),S=l.DBITools.getUniPeriod(E),x="classes"==n&&E.groupname||"",T=w?u.eventName(i,w,{brief:!0}):"",C=!1;if(T)for(var k=0,D=f;k<D.length;k++){var I=D[k];if(I.uniperiod==S&&I.durationperiods==E.durationperiods&&I.groupname==x&&I.eventname==T){I.ids.push(g),I.absents.push(E),C=!0;break}}C||f.push({uniperiod:S,durationperiods:E.durationperiods,ids:[g],absents:[E],groupname:x,eventname:T})}}if(0==f.length)return null;var R=m["names_"+n];return r.createElement("div",{style:{textAlign:"center"}},r.createElement(a.PrintFontResizable,null,s.localize(ce[n]),": ","hide"==R?f.length:r.createElement(b.RJoin,{glue:", "},f.map(function(e,t){return r.createElement(b.RJoin,{glue:" ",key:""+t},[r.createElement(b.RJoin,{glue:"short"==R?"+":" + ",key:"names"},e.ids.map(function(e){return i.rowName(n,e,R)})),e.groupname||null,r.createElement(b.RJoin,{glue:" ",before:" (",after:")",key:"details"},["ad"!=e.uniperiod&&i.tools.uniperiodName(e.uniperiod,void 0,e),e.eventname||null])])}))))}function de(e){var t=e.req,n=e.dbi,i=e.dates,a=e.type,d=e.me,p=e.my_classids,b=e.my_igroupids,_=e.my_teacherids,g=e.settings,v=e.filter,y=e.where,E=e.hideTitle,w=e.repeatHeader,x="mobile"==g.style&&!t.isApp();r.useEffect(function(){x&&barCssLoad("/app/pics/css/substitution.css")},[x]);var T={},C={float:"right",borderBottom:"1px dashed #c0c0c0",width:S,marginRight:4,marginLeft:10},k={fontSize:16,textAlign:"center",flexGrow:0,marginRight:10},D={".signature":s.__assign({},C),".row":s.__assign({},{display:"flex",flexDirection:"row",alignItems:"baseline",fontSize:12,marginBottom:1}),".period":s.__assign({},k),".period>span":s.__assign({},{whiteSpace:"pre",display:"inline-block",minWidth:30}),".info":s.__assign({},{flex:1})};switch(g.style){case"compact":T=s.__assign(s.__assign({},D),{".section":{paddingLeft:4,paddingRight:4,paddingBottom:1,borderBottom:"1px solid #c0c0c0",marginBottom:1},".header":{fontSize:14,fontWeight:"bold",marginBottom:1},".rows":{paddingLeft:5},".period":s.__assign(s.__assign({},k),{fontSize:"inherit"})});break;case"compact_extra":T=s.__assign(s.__assign({},D),{".section":{paddingLeft:4,paddingRight:4,paddingBottom:1,borderBottom:"1px solid #c0c0c0",marginBottom:1,display:"flex",flexDirection:"row"},".header":{fontSize:14,fontWeight:"bold",display:"block",flex:0,minWidth:"teachers"==a&&"short"!=g.names_teachers?150:50},".rows":{paddingLeft:5,flex:1},".period":s.__assign(s.__assign({},k),{fontSize:"inherit"})});break;case"bars":T=s.__assign(s.__assign({},D),{".section":{marginBottom:20},".header":{fontSize:20,fontWeight:"bold",padding:4,backgroundColor:"#e0e0e0",marginBottom:5},".header .signature":{borderColor:"#a0a0a0"},".rows":{paddingLeft:20}});break;case"mobile":T=s.__assign({},D);break;case"table":T=s.__assign(s.__assign({},D),{table:{width:"100%",tableLayout:"auto"},tbody:{border:"2px solid #808080"},td:{border:"1px solid #808080",padding:2},".header":{fontSize:16,textAlign:"center"},".period":{fontSize:12,textAlign:"center",whiteSpace:"nowrap"},".time":{fontSize:12,textAlign:"center",whiteSpace:"pre"},".period>span":{},".signature":{width:S,textAlign:"center",color:"#a0a0a0"}});break;default:T=s.__assign(s.__assign({},D),{".section":{marginBottom:15,border:"1px solid #c0c0c0",borderRadius:6,padding:4},".header":{fontSize:20,marginBottom:5,fontWeight:"bold",border:"2px solid #c0c0c0",borderRadius:6,padding:4,display:"inline-block"},".rows":{paddingLeft:5},".signature":s.__assign({fontSize:20},C),".rows .signature":{fontSize:"inherit"}})}var I=e,R=null;if("viewer"==y){var A=n.rowData(e.TABLE_dates,i[0]);if(A&&A.published_int){var N=t.timezone_datetime(A.published_int),B="www.asctimetables.com";["de","at","ch"].includes(t.school_country)&&(B="www.asc-raabe.de"),R=r.createElement("div",{style:{textAlign:"center",fontSize:12}},"mobile"!=I.settings.style&&r.createElement(r.Fragment,null,r.createElement("a",{href:"https://"+B,target:"_blank"},B)," - "),m.date_format_time(t,N,{ajDenSlovom:!1}))}}return r.createElement(c.RScopedStyle,{rules:T,className:x&&"app-subst"},i.map(function(e,i){var m;m=o.buildSubstOnlineTTItemsEx(n,e,!0,{table:I.TABLE_ttitems}).map(function(e){return s.__assign(s.__assign({},e),{eventids:[]})}),m=h.substFilterRows(n,v,"subst_ttitems",m);var S=u.splitClassTeacherEvents(n,n.tableFilterData(u.TABLE_events,{date:e})),x=(S=(S=S.filter(function(e){if("infoscreen"!=y&&"report"!=y)return 0<e._uial;var t=u.eventPrivacy(n,e);if("teachers"==a)switch(t){case"public":case"teachers":case"private":case"students":case"participants+teachers":return!0}if("classes"==a)switch(t){case"public":case"students":return!0}return!1})).filter(function(e){return!u.isAttachEvent(n,e)})).filter(function(e){return u.isEntireSchoolEvent(n,e)});"teachers"==a&&S.forEach(function(e){5<=e.teacherids.length&&(x.includes(e)||x.push(e))}),"classes"==a&&S.forEach(function(e){5<=e.classids.length&&(x.includes(e)||x.push(e))}),0<x.length&&(S=S.filter(function(e){return!x.includes(e)}));var T=n.tableFilterData(I.TABLE_subst_students,{date:e}),C=n.tableFilterData(I.TABLE_substs,{date:e}),k=new f.TTItemTimeProvider(n);k.setDate(n.rowData(I.TABLE_dates,e),I.tt_dbi);var D=s.__assign(s.__assign({},I),{date:e,timeProvider:k,absents:n.tableFilterData(I.TABLE_absents,{date:e}),ttitems:m,events:S,subst_students:T}),R=[];return 0<x.length&&R.push(r.createElement($,{scope:D,header:t.ls(1155),items:x.map(function(e){return{uniperiod:l.DBITools.getUniPeriod(e),event:e}})})),"classes"==a&&((p||h.substFilterRows(n,v,"classes",n.tableData("classes"),{onlyDirect:!0}).map(function(e){return e.id})).forEach(function(e){return R.push(r.createElement(se,s.__assign({},{scope:D,classid:e,key:e})))}),"hide"!=g.names_igroups&&(b||h.substFilterRows(n,v,"igroups",n.tableData("igroups"),{onlyDirect:!0}).map(function(e){return e.id})).forEach(function(e){return R.push(r.createElement(re,s.__assign({},{scope:D,igroupid:e})))})),"teachers"==a&&(_||n.tableIds("teachers")).forEach(function(e){return R.push(r.createElement(ie,s.__assign({},{scope:D,teacherid:e,settings:g,key:e})))}),0<C.length||0<x.length||"classes"==a&&0<T.length||d||R.push(r.createElement($,{scope:D,header:"",hideHeader:!0,items:[{uniperiod:"",text:t.ls(1348),nosubst:!0}]})),r.createElement(c.Fragment,{key:e},"mobile"!=g.style&&0<i&&(g.pagebreak_date?r.createElement("div",{className:"print-pagebreak"}):r.createElement(c.VGap,{height:15})),r.createElement("div",{"data-date":e},r.createElement(oe,s.__assign({},{scope:D,hideTitle:E,repeatHeader:w})),"table"==g.style?r.createElement("table",null,R):R))}),R)}e.SubstReport=de,e._hotswap=[R,D]},"/dashboard/printSheet.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("react-dom"),a=t("../asc/asc_react"),o=t("../asc/actions"),l=t("../asc/edurequest"),c=t("../react/combobox");e.initUI=function(e,t){t.asDialog?a.RDialog.show(r.createElement(d,s.__assign({},t))):i.render(r.createElement(d,s.__assign({},t)),e)},e.PrintToolbar={formats:[{id:"a4-portrait",name:"A4 - "+ASC.ls(1835),width:716,height:1044},{id:"a4-landscape",name:"A4 - "+ASC.ls(1836),width:1044,height:716}],fontSizes:[80,90,100,110,120,130,140,150,170,200]};var u,d=(u=r.Component,s.__extends(m,u),m.prototype.render=function(){var t=this,n=l.client_req,i=r.createElement("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,padding:"100px 40% 20px 40%",backgroundColor:"rgba(222, 234, 217, 0.5)"}},r.createElement("div",{style:{textAlign:"right",padding:"1em 0"}},r.createElement("i",{className:"fa fa-close",style:{cursor:"pointer",padding:"0.5em"},onClick:function(){t.setState({hideReloadBtn:!0})}})),r.createElement(a.RButton,{label:"Reload the report content",type:"blue",onClick:function(){t.setState({hideReloadBtn:!0}),t.props.renderer(t.refs.sheet)}})),u=r.createElement("div",{ref:"sheet",className:"print-sheet print-"+this.state.format,id:"sheet"},this.props.showReloadBtn&&!this.state.hideReloadBtn&&i,this.props.children),d=r.createElement(a.Fragment,null,this.props.onCustomize&&r.createElement(r.Fragment,null,r.createElement(a.RButton,{label:o.action_name("customize"),fa_icon:o.action_fa_icon("customize"),onClick:this.props.onCustomize}),r.createElement(a.HGap,{width:15})),r.createElement(a.RButton,{label:ASC.ls(1638),fa_icon:"print",onClick:this.print.bind(this)}),r.createElement(a.RButton,{label:ASC.ls(1529),fa_icon:"download",menu:s.__spreadArrays(n.isAdmin()||n.isUcitel()?[{text:"PDF",onclick:this.download.bind(this,"pdf")},[]]:[],[{text:"HTML",onclick:this.download.bind(this,"html")},{text:"HTML ("+ASC.ls(1906)+")",onclick:this.download.bind(this,"html_p")}])}),r.createElement(a.RButton,{label:ASC.ls(1837),fa_icon:"search",onClick:this.print.bind(this,{preview:!0})}),r.createElement("span",{style:{marginLeft:"10px"}},this.props.showConvertToA3&&r.createElement(a.RButton,{label:ASC.ls(1837)+" (A3)",onClick:function(){var e=window.open("about:blank","_blank");t.print({preview:!0,window:e}),ASC.PaginatedDiv.convertToA3(e.document.body)}}),this.props.showFormat&&r.createElement(c.default,{items:e.PrintToolbar.formats.map(function(e){return{value:e.id,name:e.name}}),valueRef:a.stateRef(this,"format")}),this.props.showFontSize&&r.createElement(c.default,{items:e.PrintToolbar.fontSizes.map(function(e){return{value:""+e,name:ASC.ls(2153)+" "+e+"%"}}),valueRef:a.stateRef(this,"fontSize")})));return this.props.asDialog?r.createElement(a.RDialog,{header:ASC.ls(1641)+" - "+this.props.filename,width:900,height:650,buttons:["close"],footer:d,allowMaximizeBtn:!0},r.createElement("div",{style:{overflow:"auto",padding:"0 1px"}},u)):r.createElement(a.Fragment,null,r.createElement("div",{style:{flex:"1 1 auto",overflow:"auto",padding:"0 1px"}},u),r.createElement("div",{ref:"toolbar",className:"ui-widget-content print-toolbar",style:{flex:"0 0 auto",padding:"10px"}},d))},m.prototype.componentDidMount=function(){var e=this;setTimeout(function(){e.props.showReloadBtn||e.props.renderer(e.refs.sheet)},100)},m.prototype.componentDidUpdate=function(){var t=this;e.PrintToolbar.formats.forEach(function(e){$j(t.refs.sheet).toggleClass("print-"+e.id,e.id==t.state.format)}),e.PrintToolbar.fontSizes.forEach(function(e){$j(t.refs.sheet).toggleClass("print-font-size-"+e,e==parseInt(t.state.fontSize))})},m.prototype.componentWillReceiveProps=function(e){this.setState({hideReloadBtn:!e.showReloadBtn})},m.prototype.print=function(e){void 0===e&&(e={}),!e.preview&&$j(this.refs.sheet).hasClass("landscape")&&!confirm('Please do not forget to configure printer settings to "Landscape".')||ASC.printDiv(this.refs.sheet,s.__assign(s.__assign({},e),{watermark:this.props.watermark}))},m.prototype.download=function(e){return s.__awaiter(this,void 0,void 0,function(){var n,r,i=this;return s.__generator(this,function(s){switch(s.label){case 0:return""!=this.refs.sheet.innerHTML?[3,1]:(ASC.flashMessage(ASC.ls(3161)),[3,5]);case 1:switch(n=ASC.paginateDiv(this.refs.sheet,"html"==e?0:"auto",{watermark:this.props.watermark,css_inline:!0}),e){case"html":case"html_p":return[3,2];case"pdf":return[3,3]}return[3,5];case 2:return this.downloadBlob(new Blob([n.html],{type:"text/html"})),[3,5];case 3:return(r=new ASC.ui.Dialog({title:this.props.filename,width:"300px"})).setBody("<img src='/static/pics/dialogLoading.gif' style='vertical-align:middle'/> "+ASC.ls(8769)),[4,Promise.resolve().then(function(){return t("./server/print_pdf")})];case 4:return s.sent().getHTMLToPdf(null,n.html,{format:this.state.format.substr(0,2).toUpperCase(),landscape:0<=this.state.format.indexOf("landscape")}).then(function(e){ASC.timer_start(),i.downloadBlob(new Blob([new Uint8Array(e.data)],{type:"text/pdf"})),r.hide(),ASC.timer_dump("downloaded")}),[3,5];case 5:return[2]}})})},m.prototype.downloadBlob=function(e){var t="text/pdf"==e.type?"pdf":"html";if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(e,this.props.filename+"."+t);else{var n=window.document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=this.props.filename+"."+t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}},m.defaultProps={showFormat:!0,showFontSize:!0},m);function m(e){var t=u.call(this,e)||this;return t.state={format:t.props.format||"a4-portrait",fontSize:"100"},t}e.PrintSheet=d,e.PrintFontResizable=function(e){return r.createElement("span",{className:"print-font-resizable"},e.children)}},"/substitution/server/report.js":function(e,t,n){n.implementRpc(["getSubstReportInReportovacSettings","setSubstReportInReportovacSettings"])},"/substitution/viewer.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("react"),i=t("./online/report"),a=t("../asc/lib_date"),o=t("../asc/asc_react"),l=t("./server/viewer");e.substViewerModeName={teachers:"{1929}",classes:"{1930}",me:"{9092}",admin:"Information for admin"};var c={teachers:"{1005}",classes:"{1194}",me:"{1751}",admin:"Admin"};function u(t){var n=t.mode,i=t.selected,a=t.onClick,l=o.useReq(),u=o.useHover(),d=u[0],m=u[1],p=o.useResponsiveLevel();return r.createElement("span",s.__assign({},m,{style:{color:i?"#000000":"#A0A0A0",marginLeft:10,cursor:a?"pointer":void 0,backgroundColor:d||i?"#e8e8e8":void 0,padding:0<p?5:void 0},onClick:a}),l.localize((0<p?c:e.substViewerModeName)[n]))}function d(e){var t=o.useReq(),n=0<o.useResponsiveLevel(),i=o.useColors(),l=r.useState(function(){if(n)return e.date;var s=a.date_week(t,a.date_delta(e.date,-7)),r=a.week_start(t,s);return e.date_limitfrom&&e.date_limitfrom>r&&(r=e.date_limitfrom),r}),c=l[0],u=l[1],d=r.useState(!1),m=d[0],p=d[1];r.useEffect(function(){return p(!0)});var b=e.date_limitfrom,f=a.date_delta(c,n?6:18),_=a.date_interval_array(c,f),h=[-1,1].map(function(e){return r.createElement("div",{className:"scroller",onMouseDown:function(e){return e.preventDefault()},style:{},onClick:function(t){e<0&&c==b||u(a.date_delta(c,e))}},e<0?"<":">")}),g=n?35:Math.floor((704-1*_.length)/_.length);return r.createElement(o.RScopedStyle,{className:"SubstViewDateSwitcher",rules:{".switcher":{display:"flex",flexDirection:"row",flex:1},".cell":{whiteSpace:"pre",textAlign:"center",flex:"1 1 0px",minWidth:g,width:g,flexBasis:g,color:i.fgGrey,cursor:"pointer",marginRight:1,transition:"opacity 0.1s"},".cell::first-line":{fontSize:15,fontWeight:"bold"},".cell:hover":{backgroundColor:i.bgHover},".cell.weekend":{color:"#d0d0d0"},".cell.selected":{backgroundColor:i.bgHover,color:i.fgBlack,cursor:"auto",opacity:1},".cell.filler":{visibility:"hidden",height:0,display:"none"},".scroller":{paddingTop:7,cursor:"pointer",minWidth:n?25:30,width:30,flex:"0 0 auto",textAlign:"center",color:"#808080",visibility:n?void 0:"hidden"},".scroller:hover":{backgroundColor:"#e8e8e8"},"&:hover .scroller":{visibility:"visible"}},style:{display:"flex",flexDirection:"row",fontSize:11,flex:"none"}},h[0],r.createElement("div",{className:"switcher"},_.map(function(n){var i=a.date_isWeekend(t,n),l=a.date_format_day(t,n,!1,"short"),c=l.indexOf(" ");0<=c&&(l=l.substr(0,c)+"\n"+l.substr(c+1)),l=l.replace(/ /g,"");var u=n==e.date;return r.createElement("div",{key:n,className:o.classNames({cell:!0,selected:u,weekend:i}),style:s.__assign({},m||u?{}:{opacity:.5,pointerEvents:"none",cursor:"auto"}),onClick:u?void 0:function(){return e.onDate(n)}},l)}),o.rangeFromTo(1,21).map(function(e){return r.createElement("div",{key:""+e,className:"cell filler"})})),h[1])}function m(e,t,n,s){for(var r=a.date_delta(t,n),i=0;i<3&&a.date_isWeekend(e,r);i++)r=a.date_delta(r,n);return r<s.date_limitfrom?"":r}function p(e){var t=e.date,n=o.useReq();function s(s){var i=m(n,t,s,e),a=!!i;return r.createElement("div",{onClick:function(){return a&&e.onDate(i)},style:{cursor:"pointer",padding:"0px 10px",color:a?void 0:"#c0c0c0"},onMouseDown:function(e){return e.preventDefault()}},s<0?"<":">")}return r.createElement("div",{style:{fontSize:20,display:"flex",flexDirection:"row"}},s(-1),r.createElement("div",{style:{textAlign:"center",flex:"1 1 0px"}},a.date_format_day(n,t,!0,!0)),s(1))}e.SubstViewer=function(e){var t=this,n=r.useState(e.date),c=n[0],b=n[1],f=r.useState(e.mode),_=f[0],h=f[1],g=r.useRef(!0),v=o.useResponsiveLevel(),y=o.useReq(),E=o.useAsyncMemo(function(){return s.__awaiter(t,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return g.current?(g.current=!1,[2,e.report_html]):[4,l.getSubstViewerDayDataHtml(null,{date:c,mode:_})];case 1:return[2,t.sent()]}})})},[c,_,e.refresh],function(){return g.current?e.report_html:""},{inputs_reset:[c,_,e.refresh]}),w=0<v?p:d,S=function(e){var t=r.useRef();return{onTouchStart:function(e){e.persist(),t.current=e},onTouchEnd:function(n){var s=t.current,r=s.changedTouches[0],i=n.changedTouches[0];if(e.onHoziontalSwipe){var a=r.pageX-i.pageX;n.timeStamp-s.timeStamp<300&&80<Math.abs(a)&&e.onHoziontalSwipe(a<0?-1:1,n)}}}}({onHoziontalSwipe:function(t){var n=m(y,c,t,e);n&&b(n)}}),x=e.date_limitfrom,T=e.enabled_modes;return r.createElement("div",s.__assign({},S,{className:e.mobile?"app-view-fullHeight":"",style:{backgroundColor:"#ffffff",color:"#000000",padding:5}}),r.createElement(w,s.__assign({},{date_limitfrom:x,date:c,onDate:function(e){return b(e)}})),r.createElement(o.VGap,{height:20}),0<T.length?r.createElement(r.Fragment,null,r.createElement(i.SubstReportTitle,{title:0<v?void 0:y.ls(1003)+" - "+a.date_format_day(y,c,!0,!0),subtitle:T.map(function(e){var t=_==e;return r.createElement(u,s.__assign({},{req:y,key:e,mode:e,selected:t,onClick:t?void 0:function(){h(e)}}))})}),E?r.createElement("div",{dangerouslySetInnerHTML:{__html:E}}):r.createElement(o.Loading,null)):r.createElement("div",{style:{textAlign:"center"}},y.ls(2854)))},e.DateSwitcher=d},"/substitution/server/viewer.js":function(e,t,n){n.implementRpc(["getSubstViewerSettings","setSubstViewerSettings","getSubstViewerDayDataHtml","substViewerProps","getMobileSubstViewerData","getSubstViewerAdminProps"])},"/customize/privacy.js":function(e,t,n){e.__esModule=!0;var s=t("tslib"),r=t("../asc/edurequest"),i=t("../asc/asc_react"),a=t("../rpr/itemdlg"),o=t("react"),l=t("../rpr/dbi_react"),c=t("../asc/asc_react2");function u(e){var t=r.client_req,n=a.useMainDBIItemDlgState(t.getSchoolYear(),"global_settings","1",{needed_part:{global_settings:["privacy_public"]}}),u=n.rdlgProps,d=n.dlgRow;return o.createElement(i.RDialog,s.__assign({},u,{header:void 0}),o.createElement(c.DlgHeader,{title:t.ls(10190),icon:"/static/pics/privacy_32.svg"}),o.createElement("div",null,o.createElement("span",{style:{fontWeight:"bold"}},t.ls(10191)),o.createElement(i.VGap,{height:10}),o.createElement(l.DlgField,{dlgRow:d,column:"privacy_public",subcolumn:"teachers_name",label_style:"embeded"}),o.createElement(l.DlgField,{dlgRow:d,column:"privacy_public",subcolumn:"students_name",label_style:"embeded"})))}e.privacyCombo2=function(e,t){void 0===t&&(t={});var n=[];return n.push({value:"disabled",name:e.ls(1686),icon:"/static/pics/delete_32.svg"}),n.push({value:"teachers",name:e.ls(1005),icon:"/static/pics/teacher_32.svg"}),t.students_me?(n.push({value:"participants+teachers",name:e.ls(1006)+" - "+e.ls(9092),icon:"/static/pics/home_32.svg"}),n.push({value:"students",name:e.ls(1006)+" - "+e.ls(1349),icon:"/static/pics/student_32.svg"})):n.push({value:"students",name:e.ls(1006),icon:"/static/pics/student_32.svg"}),n.push({value:"public",name:e.ls(2064),icon:"/static/pics/privacy_public_32.svg"}),n},e.showPrivacyPublicDlg=function(){i.RDialog.show(o.createElement(u,null))},e._hotswap=[u]}});