"use strict";ASC.installBundle("subst",["dbi"],{"/substitution/online.js":function(e,require,t){e.__esModule=!0;var M=require("tslib"),O=require("react"),n=require("react-dom"),z=require("./subst"),F=require("../asc/asc_react"),L=require("../asc/edurequest"),b=require("../timetable/timeoff_r"),g=O.Fragment,G=require("../rpr/dbi"),U=require("./online/rightpanel"),q=require("./online/leftpanel");require("../rpr/server/maindbi"),require("../substitution/server/substdbi");var H=require("../asc/actions"),V=require("./online/timetable"),x=require("./dlg/addcard"),T=require("./dlg/ttitem"),C=require("../timetable/ttitem"),W=require("./commands"),K=require("./server/commands"),k=require("../react/ribbon"),Y=require("../react/splitline"),v=require("../react/datatable"),u=require("../react/datefield"),J=require("../asc/lib_date"),Z=require("../rpr/dbi_react"),$=require("../react/menu"),X=require("./dlg/absent"),l=require("../timetable/ttview_components"),s=require("../dashboard/dbi_events"),Q=require("./filter"),f=require("./online/editduties"),D=require("./server/generator"),I=require("../rpr/maindbi_ui"),y=require("../calendar/event_popup"),ee=require("../asc/purchase"),te="SubstOnline",E={"":"",ok:z.ICON_subst_ok,zle:z.ICON_subst_kolizia,zle_ignored:z.ICON_subst_kolizia_ignored,spoj:z.ICON_subst_spojenie,changelesson:z.ICON_subst_changelesson,addlesson:z.ICON_subst_addlesson,addlesson_todo:"/substitution/pics/subst_add_todo_32.svg",cancelled:z.ICON_subst_cancelled,movelesson:z.ICON_subst_movelesson,movelesson_todo:"/substitution/pics/subst_move_todo_32.svg",movedlesson:z.ICON_subst_moved,nomatch:"/substitution/pics/nomatch_32.png",error:"/substitution/pics/error_16.png"},_=["spoj","zle_ignored","nomatch","zle","error"],R=["officialtimetables","teachers","subjects","absent_types","substitution_types","approbations"],A=["absent_types","substitution_types","approbations"],ne={mode:"substs",date:"2000-01-01",filter:{},join_doubles:!0,selectedOtherId:"",selectedSubstId:"",tt:{teachers:{},classes:{},classrooms:{}},leftWidth:200,rightWidthPercent:25};function se(v,y,e,t){try{var E=[],w=new Map,S=[],x=new C.TTItemTimeProvider(v);x.setDate(v.rowData("substonline_dates",e),null);for(var n=v.tableFilterData("substonline_substitutions",{date:e}),T=v.tableFilterData("substonline_ttitems",{date:e}),s=function(e){var t=e.absent;if(t&&"classes"==z.absentGetTable(t))return"continue";var n=z.coreTTItemOfSubst(e,!1),s=z.coreTTItemOfSubst(e,!0),r=z.findTTItemFromSubstId(T,e.id,e.cancelled),i=r;if(i||e.cancelled||(i=z.findTTItemFromSubstId(T,e.id,!0)),i&&i.cancelled_absent)return"continue";var a=M.__assign(M.__assign({},e),{stav:"",starttime:x.provide(n).starttime,ttitemid:r?r.id:"",kolizie:[]});if(!r)return a.stav="nomatch",S.push(a),"continue";if(!t)if(z.substIsAddCard(e)){var o=0<(null==r?void 0:r.teacherids.length)||e.cancel_teacher;e.origid?a.stav=o?"movelesson":"movelesson_todo":a.stav=o?"addlesson":"addlesson_todo"}else a.stav="changelesson";for(var l=0,u=V.getSubstTTItemKolizie(v,y,r,[r.id]);l<u.length;l++){var c=u[l];if(c.item){if(c.table){var d=!1;if(s.uniperiod!=n.uniperiod&&(d=!0),z.substIsAddCard(e)&&(d=!0),G.idsArrayMatchI(z.substTTItem_tableIds(s,c.table),z.substTTItem_tableIds(n,c.table))||(d=!0),!d)continue}if(c.join)a.stav||(a.stav="spoj");else{for(var m=c.item.subjectid,p=0,b=["classids","groupnames","teacherids","classroomids"];p<b.length;p++){var f=b[p];m+="|",m+=c.item[f].join(",")}a.kolizie.push(m),0<=e.kolizie_ignored.indexOf(m)?"zle"!=a.stav&&(a.stav="zle_ignored"):a.stav="zle"}}c.absent&&(a.stav="zle")}if(e.cancelled&&(0<(null===(p=e.origofids)||void 0===p?void 0:p.length)?a.stav="movedlesson":a.stav="cancelled"),e.orig_err&&(a.stav="error"),t){var _=z.absentGetTable(t),h=z.absentGetId(t),g=e.changes.find(function(e){return z.changeColumn2table(e.column)==_&&e.old==h});g&&!a.stav&&(g.new?a.stav="ok":"teachers"==_&&e.cancel_teacher&&(a.stav="ok"))}0==a.kolizie.length&&(a.kolizie=void 0),E.push(a),w.set(a.id,a)},r=0,i=n;r<i.length;r++){s(i[r])}var a=z.buildSubstOnlineTTItemsEx(v,e,t),o=new Map;a.map(function(e){return[e.id,e]});var l=new Map;if(a.forEach(function(e){o.set(e.id,e),e.join_substid2first&&e.join_substid2first.forEach(function(e,t){l.set(t,w.get(e))})}),t)E=E.filter(function(e){var t=o.get(e.ttitemid);if(t)return e.join_duration=t.durationperiods,!0;var n=l.get(e.id);return n?(_.indexOf(e.stav)>_.indexOf(n.stav)&&(n.stav=e.stav),!1):(e.stav="error",!0)});else for(var u=0,c=E;u<c.length;u++){var d=c[u],m=o.get(d.ttitemid);(m.join_previd||m.join_nextid)&&(d.join_can=!0)}for(var p=0,b=S;p<b.length;p++){d=b[p];E.push(d)}return E.sort(function(e,t){return e.starttime<t.starttime?-1:1}),E}catch(e){if(v.mock)return[];throw e}}function re(e){var t=e.stav;return!!t&&("movelesson_todo"!=t&&"addlesson_todo"!=t)}function ie(e){var t,o=this,l=L.client_req;F.useTTLang();var u=e.jsc,c=F.useStateValueRef(M.__assign(M.__assign({},ne),{date:e.date||l.timezone_date()})),d=c.value,m=d.date,p=d.join_doubles,b=d.filter,n=d.selectedSubstId,s=l.getSchoolYear(m),r=O.useRef(),f=O.useRef(),_=Z.useMainDBI(s,{vt_filter:{date:m},needed_part:G.DBITools.mergeNeededParts(ie,{substonline_ttitems:["ol_is","eventids","changeeventids"]}),needed_combos:G.DBITools.mergeNeededCombos(Q.substFilterMenu.needed_combos,{substitution_types:["default_for"]}),interactive:!0}),i=_.rowData("substonline_dates",m,{date:m,tt_num:null}),a=Z.useTTDBI(i.tt_num,{needed_part:G.DBITools.mergeNeededParts(ie.ttdbi)}),h=Z.useSubscribedDBI("substdbi",i.subst_dbid,{needed_part:G.DBITools.mergeNeededParts(ie.substdbi)}),g=O.useMemo(function(){return new G.MergeDBI(_,a,h)},[_,a,h]),v=O.useMemo(function(){return _.tableFilterData("substonline_absents",{date:m})},[_,m]),y=O.useMemo(function(){return _.tableFilterData("substonline_substitutions",{date:m})},[_,m]),E=O.useMemo(function(){return _.tableFilterData("events",{date:m})},[_,m]),w=O.useMemo(function(){return _.tableFilterData("substonline_ttitems",{date:m})},[_,m]),S=O.useMemo(function(){return se(_,a,m,p)},[_,a,m,p]),x=S.find(function(e){return e.id==n}),T={dbi:_,tt_dbi:a,naming_dbi:g,filter:d.filter,state:d,stateRef:c,jsc:u,ribbonMenu:r,showExtraInfo:!0,setState:function(t){c.set(function(e){return"function"==typeof t&&(t=t(e)),M.__assign(M.__assign({},e),t)})},goToDate:function(e){var t={prev:-1,next:1}[e];if(t){e=m;for(var n=0;n<3&&(e=J.date_delta(e,t),J.date_isWeekend(l,e));n++);}this.setState({date:e})},setMode:function(e){this.setState({mode:e,selectedOtherId:""})},getDate:function(){return m},getDateRow:function(){return i},getSubstsEx:function(){return S},getAbsents:function(){return v},getSubsts:function(){return y},getEvents:function(){return E},getTTItems:function(){return w},getSelectedSubst:function(){return x},checkUploaded:function(t){return M.__awaiter(this,void 0,void 0,function(){return M.__generator(this,function(e){return t=t||this.getDate(),[2,W.checkUploaded(this.dbi,t)]})})},timetableMenu:function(e,t){var n=this;return[{text:H.action_name("timetable")+" + "+H.action_name("substitution"),icon:H.action_icon("timetable"),onClick:function(){return n.showTimetableDlg(e,t)}},{text:l.ls(8735),icon:H.action_icon("timetable"),onClick:function(){return n.showPermanentTimetableDlg(e,t)}}]},clickSet_tcards_subst:function(n){var s,r;return void 0===n&&(n=void 0),M.__awaiter(this,void 0,void 0,function(){var t;return M.__generator(this,function(e){switch(e.label){case 0:return t=null===(r=null===(s=_.rowData("global_settings","1"))||void 0===s?void 0:s.subst_online)||void 0===r?void 0:r.tcards_subst,void 0===n&&(n=!t,i.uploaded_int||(n=!i.tcards_subst)),[4,F.RDialog.showConfirm(O.createElement(O.Fragment,null,H.action_name(n?"activate":"deactivate"),L.client_req.localize(": {6724} - {1003}"),O.createElement("br",null),H.action_name("date"),": ",J.date_format_date(L.client_req,m),O.createElement("br",null),O.createElement("br",null),L.client_req.ls(1054)))];case 1:return e.sent()?t==n?[3,3]:[4,ASC.blockUI(_.backend.updateRow("global_settings",{id:"1",subst_online:{tcards_subst:n}}))]:[2];case 2:e.sent(),e.label=3;case 3:return i.tcards_subst==n?[3,5]:[4,ASC.blockUI(K.setDateTcardsSubst(null,m,n))];case 4:e.sent(),e.label=5;case 5:return[2]}})})},purchase:function(){u.purchase_action()},importFile:function(i,a){return void 0===a&&(a=""),M.__awaiter(this,void 0,void 0,function(){var t,n,s,r;return M.__generator(this,function(e){switch(e.label){case 0:return n=["cmd=upload","date="+m,"mode="+a],s="data=",r=encodeURIComponent,[4,F.file2base64(i)];case 1:return t=n.concat([s+r.apply(void 0,[e.sent()])]).join("&"),u.ASC_action("import",t),[2]}})})},showAbsentEditDlg:function(t,n){return void 0===n&&(n={}),M.__awaiter(this,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,this.checkUploaded(t?t.split(":")[0]:"")];case 1:return e.sent()?[2]:[4,X.showSubstAbsentEditDlg(t,{date:this.getDate(),row:{period:n.period,durationperiods:n.durationperiods,groupname:n.groupname},teacherids:n.teacherids,classids:n.classids,classroomids:n.classroomids})];case 2:return e.sent(),[2]}})})},showAbsentDeleteDlg:function(s){return M.__awaiter(this,void 0,void 0,function(){var t,n;return M.__generator(this,function(e){switch(e.label){case 0:return[4,this.checkUploaded()];case 1:return e.sent()?[2]:(t=_.rowData("substonline_absents",s),n=l.ttls(2117),t&&"teachers"!=t.table&&(n=H.action_name("delete")+" - "+l.ls(1054)),[4,F.RDialog.showConfirm(n)]);case 2:return e.sent()?[4,K.removeAbsent(null,s)]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})},showDayNoteDlg:function(){return M.__awaiter(this,void 0,void 0,function(){var t,n,s;return M.__generator(this,function(e){switch(e.label){case 0:return t="substonline_dates",n=_.rowData(t,m),[4,F.RDialog.showInput({id:this.getDate(),subst_note:n.subst_note},function(e){return O.createElement(F.RTextArea,{valueRef:e.stateRef.sub("subst_note"),style:{height:100,width:"100%"}})},{header:this.dbi.column(t,"subst_note").name()})];case 1:return(s=e.sent())?G.DBITools.rowChanges2write(n,s)?[4,ASC.blockUI(_.backend.updateRow(t,s,{log_module:te}))]:[3,3]:[2];case 2:e.sent(),e.label=3;case 3:return[2]}})})},showTimetableDlg:function(s,r,i){return void 0===i&&(i={}),M.__awaiter(this,void 0,void 0,function(){var t,n=this;return M.__generator(this,function(e){return r||(t=G.DBITools.splitItemsForCombo(this.dbi.tableData(s),this.getDate())[0],r=t&&t.id||""),V.showSubstTimetableDlg(this.getDate(),s,r,{join_doubles:p,move_substid:i.move_substid,onGoToDate:function(e){return n.goToDate(e)}}),[2]})})},showPermanentTimetableDlg:function(t,n){return void 0===t&&(t=""),void 0===n&&(n=""),M.__awaiter(this,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.loadBundle("ttviewer")];case 1:return e.sent(),[4,Promise.resolve().then(function(){return require("../timetable/ttviewer")})];case 2:return e.sent().showTTViewerDlg({num:i.tt_num,user:n&&G.DBITools.rowid2user(t,n)}),[2]}})})}};u.online=T;var C=null;if(i.uploaded_int)C=O.createElement("div",{style:{flex:"0 0 auto",padding:"80px 20px"}},O.createElement("img",{src:"/substitution/pics/uploaded_32.png",style:{float:"left",margin:5}}),l.ls(2740),O.createElement("br",null),"(",O.createElement(F.DateTimeText,{datetime_int:i.uploaded_int}),","," ",O.createElement("span",{onClick:function(){return T.jsc.ASC_action("showDB","date="+m)},style:{cursor:"pointer"}},l.ls(3027)),")",O.createElement("br",null),O.createElement("br",null),_.tableFilterData("substonline_substitutions",{date:m}).find(function(e){return e.ttmatchfail})&&O.createElement(O.Fragment,null,O.createElement("img",{src:"/substitution/pics/nomatch_32.png",style:{float:"left",margin:3}}),l.ls(2573)));else if(x){var k="",D="",I="",R="",A=T.getSelectedSubst();if(A&&(k=A.ttitemid,A.absent)){var N=z.absentGetTable(A.absent);if("teachers"==N||"classrooms"==N){D=N,I=z.absentGetId(A.absent);var B=A.changes.find(function(e){return z.changeColumn2table(e.column)==D&&e.old==I});B&&(R=B.new||"")}}var j=G.DBITools.removeEs(D)+(A.classroomsupervision?"id":"ids");C=O.createElement(U.TeachersView,{online:T,dbi:_,tt_dbi:a,date:m,filter:b,ttitemid:k,table:D,topid:R,join_doubles:d.join_doubles,onRowDoubleClick:function(e){ASC.hidePopups(),A&&I&&W.showTTItemEditDlg(k,p,{dbi:_,filter:b,select_change:{column:j,old:I,new:e}})},onRowPeriodClick:function(n,e){var s="new_"+G.DBITools.removeEs(D)+"id";e.stopPropagation();var r=[];r.push({text:l.ls(2105),icon:"/substitution/pics/ok_16.png",onClick:function(){return M.__awaiter(o,void 0,void 0,function(){var t;return M.__generator(this,function(e){return[2,K.updateSubstSubstitution(null,A.id,(t={},t[s]=n,t),1<A.join_duration)]})})}}),r.push([]);for(var t=function(t){r.push({text:ASC.escapeHTML(t.name),icon:_.table("substitution_types").icon(),checked:t.id==A.substitution_typeid,onClick:function(){var e;return K.updateSubstSubstitution(null,A.id,((e={})[s]=n,e.substitution_typeid=t.id,e),1<A.join_duration)}})},i=0,a=_.tableData("substitution_types");i<a.length;i++){t(a[i])}r.push([]),r.push({text:l.ttls(1034),icon:H.action_icon("edit"),onClick:function(){return W.showTTItemEditDlg(k,p,{dbi:_,filter:b,select_change:{column:j,old:I,new:n}})}}),$.showMenu(r,e.target)}})}else C=O.createElement(O.Fragment,null,!i.tt_num&&O.createElement("div",{style:{flex:"0",padding:"80px 20px"}},O.createElement("img",{src:"/global/pics/ui/item_warning_32.png",style:{marginRight:10,verticalAlign:"middle"}}),l.ls(2005)),0<T.getAbsents().length&&O.createElement("div",{style:{flex:"0",padding:"80px 20px"}},l.ttls(2122)));var P=O.useRef();return O.useLayoutEffect(function(){wndResize()},[]),O.createElement("div",{ref:P,id:"fitheight",style:{display:"flex",flexDirection:"column"},className:F.classNames({subst_online_colorblind:null===(t=_.rowData("global_settings","1"))||void 0===t?void 0:t.colorblind})},O.createElement(F.RDropZone,{className:"ribbon_d",onFile:function(e){return T.importFile(e,"multi")}},O.createElement(ae,{online:T,onClickSelecteNextSubst:function(){for(var e=f.current,t=d.selectedSubstId,n="",s=!1,r="",i=0,a=e.getSortedData();i<a.length;i++){var o=a[i],l=o.id;re(o.subst)||(n=n||l,s&&!r&&(r=l)),l==t&&(s=!0)}c.sub("selectedSubstId").set(r||n)}})),O.createElement("div",{style:{flex:"1 1 100px",height:100,minHeight:0},className:"content_d"},O.createElement(q.LeftPanel,{online:T,style:{width:d.leftWidth}}),O.createElement(Y.SplitLine,{sizeRef:c.sub("leftWidth"),axis:"x",min:50}),O.createElement(F.RDropZone,{className:"subst_d",style:{flex:"1 1 100px",minWidth:0,display:"flex",flexDirection:"column"},onFile:function(e){T.importFile(e)}},O.createElement(ee.LicenseExpiredBanner,{dbi:_}),O.createElement(oe,{online:T}),"substs"==d.mode?O.createElement(ue,{online:T,controlRef:f}):O.createElement(ce,{online:T,table:d.mode}),O.createElement(le,{online:T})),O.createElement(Y.SplitLine,{sizeRef:c.sub("rightWidthPercent"),axis:"-x",unit:"%",min:5,max:50}),O.createElement("div",{className:"teachers_d",style:{display:"flex",flexDirection:"column",position:"relative",width:d.rightWidthPercent+"%"}},C,O.createElement(U.MenuIcon,{style:{position:"absolute",right:1,top:3},fa_icon:H.action_fa_icon("help"),onClick:function(e){return window.open("https://help.edupage.org/text.php?id=1880","_blank")},title:H.action_name("help")}))))}function ae(e){var t,n,s,r=this,i=e.online,a=i.state,o=i.dbi,l=i.stateRef,u=a.mode,c=a.join_doubles,d=L.client_req,m=i.getDate(),p=d.getSchoolYear(m),b=A.includes(u),f=i.getDateRow();F.useLockBodyScroll();var _=[];"officialtimetables"==a.mode&&d.hasRight("timetable")&&(_.length&&_.push([]),_.push({text:d.ls(1001),icon:i.dbi.table("officialtimetables").icon(),submenu:[{text:d.ls(1059),icon:"/global/pics/ui/verify_32.png",onClick:function(){i.jsc.ASC_action("tt_verify","date="+m+"&id="+a.selectedOtherId)}}]})),f.uploaded_int&&(_.length&&_.push([]),_.push({text:"PC "+d.ls(1003),icon:"/global/pics/ui/subst_32.png",submenu:[{text:d.ls(3027),icon:"/customize/pics/gridedit.png",onClick:function(){i.jsc.ASC_action("showDB","date="+m)}}]})),"substs"==u&&!f.uploaded_int&&(f.is_online||i.getAbsents().length||i.getSubsts().length)&&(_.length&&_.push([]),_.push({text:d.ls(3988),onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.ui.Dialog.areYouSureDlg(ASC.ls(3988))];case 1:return e.sent()?[4,ASC.blockUI(K.unpublishDay(null,i.getDate()))]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}})),_.length&&_.push([]);var h=null===(n=null===(t=o.rowData("global_settings","1"))||void 0===t?void 0:t.subst_online)||void 0===n?void 0:n.tcards_subst;_.push({text:L.client_req.localize("{6724} - {1003} (beta)"),checked:h,onClick:function(){return i.clickSet_tcards_subst(!h)}}),_.length&&_.push([]);var g=null===(s=o.rowData("global_settings","1"))||void 0===s?void 0:s.colorblind;_.push({text:L.client_req.ls(3149),submenu:[{text:L.client_req.ls(3150),checked:g,onClick:function(){return o.backend.updateRow("global_settings",{id:"1",colorblind:!g},{log_module:te})}}]});var v=[];function y(e){I.showDashboardReport(e,{datefrom:m,dateto:m,subst_unpublished:!0})}"de"!=d.school_country&&!d.props.ascdevelop||(v.push({text:"NRW - UntStat",onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../exports/de_nrw/weekstats")})];case 1:return[2,e.sent().showNRW_WeekStatsDlg(J.date_week(L.client_req,m))]}})})}}),v.push({text:"NRW - GPC",onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../exports/de_nrw/gpc")})];case 1:return[2,e.sent().showNRW_GPCExport()]}})})}}),v.push({text:"Bayern - Statistik",onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../exports/de_by/bayern_weekstats")})];case 1:return[2,e.sent().showBayern_WeekStatsDlg(J.date_week(L.client_req,m))]}})})}}),v.push({text:"ThÃ¼ringen - Statistik zur UnterrichtserfÃ¼llung",onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../exports/de_th/weekstats")})];case 1:return[2,e.sent().showThuringen_WeekStatsDlg(J.date_week(L.client_req,m))]}})})}}));var E=[{text:d.ttls(2076)+" - "+d.ls(1929),onClick:function(){return y("substinfo_teachers")},icon:"/substitution/pics/subst_daily.png"},{text:d.ttls(2076)+" - "+d.ls(1930),onClick:function(){return y("substinfo_classes")},icon:"/global/pics/ui/student_32.png"},{text:d.ttls(2114),onClick:function(){return y("substitutionsummary")},icon:"/substitution/pics/missing2_128.png"},{text:d.ttls(2079),onClick:function(){return y("absentsummary")},icon:"/substitution/pics/parameters_32.png"},[],{text:d.ls(1641),onClick:function(){return y(void 0)}},[],{text:"("+d.ls(1470)+") "+d.ttls(2076),onClick:function(){return y("substitution2teachers")},icon:"/substitution/pics/subst_daily.png"},{text:"("+d.ls(1470)+") "+d.ttls(2077),onClick:function(){return y("substitution2students")},icon:"/global/pics/ui/student_32.png"}],w=[{text:d.ls(1337),onClick:function(){return i.jsc.ASC_action("send","msgType=email&date="+m)}}];["skullerud","gorazdnr","gymlipany","robotnik","zspovke","zssneznica"].includes(d.edupage)&&w.push({text:d.ls(1346),onClick:function(){return i.jsc.ASC_action("send","msgType=sms&date="+m)}});var S=i.getSubstsEx().filter(function(e){return!re(e)}).length;return O.createElement(k.RibbonMenu,{controlRef:i.ribbonMenu},O.createElement(k.Ribbon,{title:d.ttls(3222),key:"main",right:O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ls(1347),icon:de("refresh_32"),onClick:function(){return Z.refreshSubscribedDBI(o)}}))},O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:"",icon:de(d.props.rtl?"next_32":"previous_32"),onClick:function(){i.goToDate("prev")}}),O.createElement(k.RibbonDiv,null,O.createElement(me,{valueRef:P(i,"date").cast(function(e){return e},function(e,t){return i.goToDate(e),t}),style:{textAlign:"center"}}),O.createElement("br",null),O.createElement("div",{style:{textAlign:"center",marginTop:"10px"}},ASC.ASC_date2str_day(i.getDate()))),O.createElement(k.RibbonButton,{label:"",icon:de(d.props.rtl?"previous_32":"next_32"),onClick:function(){i.goToDate("next")}})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ttls(1995),icon:de("patient_ok_32"),menu:[{text:d.ttls(3806),onClick:function(){i.showAbsentEditDlg("")}}]}),O.createElement(k.RibbonButton,{label:S?d.ttls(3800)+"\n("+S+")":d.ls(1341),icon:S?de("next_subs_32"):"/global/pics/ui/item_ok_32.svg",onClick:e.onClickSelecteNextSubst})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ttls(3798),icon:de("tools_32"),menu:M.__spreadArrays([{text:d.ls(1783),onClick:function(){ASC.blockUI(D.generateSubstitution(null,m,{filter:i.filter,join_doubles:c}))},icon:de("gener_32")},{text:d.ttls(3795),onClick:function(){i.showDayNoteDlg()},icon:"/substitution/pics/daily_remark_32.png"},{text:d.ttls(3794),onClick:function(){F.RDialog.show(O.createElement(T.ChangeOtherLessonDlg,{app:i}))},icon:"/global/pics/ui/modified_32.svg"},{text:d.ttls(3793),onClick:function(){return M.__awaiter(r,void 0,void 0,function(){var t;return M.__generator(this,function(e){return(t=i.getSelectedSubst())&&W.showSubstDeleteDlg(i.dbi,t.id,c),[2]})})},icon:de("del_32")},{text:d.ttls(3784),onClick:function(){return x.showSubstEditAddCardDlg(p,"",{date:m,join_doubles:c})},icon:z.ICON_subst_addlesson},{text:d.ttls(3111),icon:"/global/pics/ui/link_32.svg",onClick:function(){return Promise.resolve().then(function(){return require("./online/joinclasses")}).then(function(e){return e.showSubstJoinClassesDlg({date:m})})}},{text:d.ls(12014)+" (beta)",icon:"/substitution/pics/subst_students_32.svg",onClick:function(){return I.showMainDbiItemDlg(p,"substonline_students","",{date:m})}},{text:d.ls(2741),onClick:function(){return W.showDayDeleteDlg(m)},icon:"/global/pics/ui/delete2_32.png"}],["ascpalo","schillertest2","gsg-waldkirch","europaschule-bornheim","esg-filderstadt"].includes(d.edupage)||d.props.isAsc?[{text:"Review day (aSc)",onClick:function(){return Promise.resolve().then(function(){return require("./review")}).then(function(e){return e.showSubstReviewDlg(m)})}}]:[])}),O.createElement(k.RibbonButton,{icon:"/global/pics/ui/filter_32.svg",label:Q.substFilterText(o,a.filter)||d.ls(1838),menu:function(){return Q.substFilterMenu(o,l.sub("filter"))},selected:Q.isSubstFilterOn(a.filter)}),O.createElement(k.RibbonButton,{label:H.action_name("timetable"),icon:H.action_icon("timetable"),menu:M.__spreadArrays(["classes","teachers","classrooms","igroups"].filter(function(e){return 0<o.tableData(e).length}).map(function(e){var t=o.table(e);return{text:t.name(),icon:t.icon(),onClick:function(){return i.showTimetableDlg(e,"")}}}),[[],{text:d.ls(8735),onClick:function(){return i.showPermanentTimetableDlg()},icon:H.action_icon("timetable")}])})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ls(1638),icon:de("print_preview_32"),menu:E}),O.createElement(k.RibbonButton,{label:d.ls(1590),icon:de("email_32"),menu:w}),O.createElement(k.RibbonButton,{label:d.ls(4159),icon:"/global/pics/ui/notifications_32.svg",onClick:function(){return W.showNotifications()}}),0<v.length&&O.createElement(k.RibbonButton,{label:H.action_name("export"),icon:H.action_icon("export"),menu:v})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ls(1989),icon:de("home_32"),onClick:function(){window.open("/substitution/?date="+i.getDate(),"_blank")}}),(["de","at"].includes(d.school_country)||"ascpalo"==d.edupage)&&O.createElement(k.RibbonButton,{label:d.ls(9067),icon:"/global/pics/ui/infoscreen_32.svg",onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../infoscreen/admin")})];case 1:return[2,e.sent().showInfoscreensAdminDlg()]}})})}})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ls(1077),icon:de("onlinehelp_32"),onClick:function(){window.open("https://help.edupage.org/text.php?id=1635&lang="+L.client_req.lang,"_blank")}}),O.createElement(k.RibbonButton,{label:d.ls(1593),icon:de("help_32"),onClick:function(){W.showFeedbackDlg()}}))),O.createElement(k.Ribbon,{title:d.ls(1637),key:"settings"},O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ls(1748),icon:de("back_32"),onClick:function(){i.ribbonMenu.current.select("main"),"substs"!=u&&i.setMode("substs")}})),O.createElement(k.RibbonGroup,null,R.map(function(e){var t=i.dbi.table(e);return O.createElement(k.RibbonButton,{key:e,label:t.name(),icon:t.icon(),selected:e==u,onClick:function(){i.setMode(e)}})})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ls(1257),icon:de("add_32"),onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,I.showMainDbiItemDlg(p,u,"")];case 1:return e.sent(),[2]}})})},mini:!0,enabled:b}),O.createElement(k.RibbonButton,{label:d.ls(1053),icon:de("edit_32"),onClick:function(){return M.__awaiter(r,void 0,void 0,function(){var t;return M.__generator(this,function(e){switch(e.label){case 0:return(t=a.selectedOtherId)?[4,I.showMainDbiItemDlg(p,u,t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},mini:!0,enabled:b}),O.createElement(k.RibbonButton,{label:d.ls(1047),icon:de("del_32"),onClick:function(){return M.__awaiter(r,void 0,void 0,function(){var t;return M.__generator(this,function(e){switch(e.label){case 0:return(t=a.selectedOtherId)?[4,I.showMainDbiRemoveDlg(p,u,t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},mini:!0,enabled:b})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ttls(3796),icon:de("dayintimetable_32"),onClick:function(){W.showSubstDaysDlg({date:m,onGoToDate:function(e){return i.goToDate(e)}})}}),O.createElement(k.RibbonButton,{label:L.client_req.ls(6737),icon:de("settings_basic_32"),onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(Promise.resolve().then(function(){return require("./online/settings")}))];case 1:return[4,e.sent().showSubstSettingsCriteriaDlg()];case 2:return e.sent(),[2]}})})}}),O.createElement(k.RibbonButton,{label:d.ls(1989)+" / "+d.ls(6950),icon:de("home_32"),onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(Promise.resolve().then(function(){return require("./vieweradmin")}))];case 1:return e.sent().showSubstViewerAdminSettingsDlg(),[2]}})})}}),O.createElement(k.RibbonButton,{label:d.ls(1601),icon:de("settings_adv_32"),menu:_}))),O.createElement(k.Ribbon,{title:d.ls(1077),key:"help"},O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ls(1748),icon:de("back_32"),onClick:function(){i.ribbonMenu.current.select("main"),"substs"!=u&&i.setMode("substs")}})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ttls(2797),icon:de("register_32"),onClick:function(){i.purchase()}})),O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:d.ls(1077),icon:de("onlinehelp_32"),onClick:function(){window.open("https://help.edupage.org/#921","_blank")}}),O.createElement(k.RibbonButton,{label:d.ls(1593),icon:de("help_32"),onClick:function(){i.jsc.ASC_action("feedback","")}})),d.props.isAsc&&O.createElement(k.RibbonGroup,null,O.createElement(k.RibbonButton,{label:"ASC tools",icon:"/global/pics/ui/settings_adv_32.png",menu:[{text:d.ls(2790),onClick:function(){return i.jsc.ASC_action("regenerate","date="+m)}},{text:"Parse UPLOAD",onClick:function(){return i.jsc.ASC_action("refresh","parse=1&date="+m)}},{text:"Download UPLOAD",onClick:function(){return i.jsc.ASC_action("refresh","download=1&date="+m)}}]}))))}function oe(e){var t,n=e.online,s=n.state,r=n.getDate(),i=n.dbi,a=i.req,o=n.getDateRow(),l=null===(t=i.rowData("globals","1"))||void 0===t?void 0:t.subst_onlinedays,u=null;if("substs"==s.mode)if(o.needsregenerate)u=O.createElement(W.SubstNeedsRegenerateBar,{date:r});else if(o.is_online||0<l){var c=o.is_online?a.ls(2744):a.lsf(2827,{n:l});u=O.createElement(O.Fragment,null,O.createElement("span",{style:{marginRight:"10px"}},c),O.createElement(F.RButton,{label:a.ls(1587),icon:"/global/pics/ui/item_ok_16.svg",onClick:function(){return W.showSubstPublishDlg(r,{log_module:te})}}),o.is_online?O.createElement(F.RButton,{label:a.ls(1038),icon:"/global/pics/ui/item_bad_16.svg",onClick:function(){n.jsc.ASC_action("revert","date="+r)}}):null)}return O.createElement(F.AnimatedCollapseDiv,{duration:.5,className:"info_top",style:{height:"32px"},collapsed:!u},u)}function le(e){var t,n,i=e.online;if("substs"!=i.state.mode)return null;var s=i.dbi,r=i.tt_dbi,a=i.getDate(),o=s.req,l=[],u="",c=i.getDateRow();if(c.tt_num&&r){u=o.ls(1001)+": "+s.rowName("officialtimetables",""+c.tt_num);for(var d=0,m=[["tt_term","terms"],["tt_week","weeks"],["tt_day","days"]];d<m.length;d++){var p=m[d],b=p[0],f=p[1];r.tableData(f).length<2||(u+=", "+r.rowName(f,c[b]))}l=c.subst_problems||[]}var _=null,h=null===(n=null===(t=s.rowData("global_settings","1"))||void 0===t?void 0:t.subst_online)||void 0===n?void 0:n.tcards_subst;return c.tcards_subst!=h?_=O.createElement(O.Fragment,null,O.createElement("br",null),o.ls(6724),": ",c.tcards_subst?o.ls(1671):o.ls(1686)," (",O.createElement("a",{style:{cursor:"pointer"},onClick:function(){return i.clickSet_tcards_subst(h)}},h?o.ls(1669):o.ls(1670)),")"):c.tcards_subst&&(_=o.ls(6724)),c.published_int&&(u+="\n("+o.ls(3279)+": "+J.date_format_time(o,o.timezone_datetime(c.published_int),{ajDenSlovom:!1})+")"),O.createElement("div",{className:"info"},0<l.length&&O.createElement(O.Fragment,null,o.ls(2025)+": ",l.map(function(e,t){var n={},s=null,r=o.ls(6370);return"warning"!=e.level&&(n={color:"red",fontWeight:"bold",fontSize:"150%"}),"unlinked"==e.type&&(s=function(){i.jsc.ASC_action("tt_verify","date="+a)},r=o.ls(1001)+" - "+o.ls(1059)),O.createElement(g,{key:t},0<t&&", ",O.createElement("span",{style:n},e.text,s&&O.createElement("span",{style:{cursor:"pointer",marginLeft:"5px",whiteSpace:"nowrap",color:"#808080",textDecoration:"underline"},onClick:s},r)))}),O.createElement("br",null)),u,_&&O.createElement(O.Fragment,null,", ",_),O.createElement("br",null),c.subst_note&&O.createElement("span",{onClick:function(){return i.showDayNoteDlg()},style:{cursor:"pointer"}},o.ttls(3795),": ",(""+c.subst_note).replace(/\n/g,"â†² ").replace(/\r/g,"")))}(e.buildSubstExItems=se).npp=z.substOnlineNeededPartProvider(function(){return[C.TTItemTimeProvider,z.coreTTItemOfSubst,z.findTTItemFromSubstId,V.getSubstTTItemKolizie,z.buildSubstOnlineTTItemsEx,{substonline_substitutions:["date","absent","kolizie_ignored","addcard","addtcard","origid"],substonline_ttitems:["date","cancelled_absent"]}]}),se.ttdbi={npp:G.neededPartProvider(function(){return[V.getSubstTTItemKolizie.ttdbi]})},(e.SubstOnline=ie).npp=z.substOnlineNeededPartProvider(function(){return[{globals:["subst_onlinedays"],global_settings:["colorblind","subst_online"],substonline_dates:["tt_num","subst_dbid","uploaded_int"],substonline_substitutions:["origofids"]},ae,q.LeftPanel,U.TeachersView,ue,ce,oe,le,se,z.coreTTItemOfSubst,W.showTTItemEditDlg,X.AbsentEditDlg,Q.substFilterRows,ee.LicenseExpiredBanner]}),ie.ttdbi={npp:G.neededPartProvider(function(){return[le.ttdbi,U.TeachersView.ttdbi,b.MiniTimeoff.ttdbi,{classes:["__name"],teachers:["__name"],classrooms:["__name"],subjects:["__name"]}]})},ie.substdbi={npp:G.neededPartProvider(function(){return[{classes:["__name"],teachers:["__name"],classrooms:["__name"],subjects:["__name"],absent_types:["__name"],substitution_types:["__name"]}]})},ae.npp=G.neededPartProvider(function(){return[{buildings:["__name"]},Q.substFilterMenu]}),oe.needed_part=G.typed({globals:["subst_onlinedays"],substonline_dates:["is_online","needsregenerate"]}),le.needed_part=G.typed({substonline_dates:["subst_problems","tt_term","tt_week","tt_day","tcards_subst","subst_note","published_int"]}),le.ttdbi={needed_part:G.typed({terms:["__name"],weeks:["__name"],days:["__name"]})};var r,a=(r=O.Component,M.__extends(i,r),i.prototype.componentDidMount=function(){this.doUpdate()},i.prototype.componentDidUpdate=function(){this.doUpdate()},i.prototype.render=function(){return this.props.children},i.prototype.doUpdate=function(){var e=n.findDOMNode(this),t=e&&e.parentElement;t&&("TD"!=t.tagName&&ASC.dieError("7539815024",[t.tagName,t]),t.className=this.props.className)},i);function i(){return null!==r&&r.apply(this,arguments)||this}function o(e){return O.createElement(O.Fragment,null,O.Children.map(e.children,function(e,t){return O.createElement(g,{key:""+t},0<t&&", ",e)}))}function w(e){var t=e.dbi,n=e.table,s=e.id,r=e.name_col,i="short"==r?"name":"short";return O.createElement("span",{style:e.style,title:t.rowName(n,s,i)},t.rowName(n,s,r))}function c(e){var t=e.dbi,n=e.table,s=e.origid,r=e.changes,i=e.name_col,a=s?r.find(function(e){return z.changeColumn2table(e.column)==n&&e.old==s}):void 0;return a?O.createElement(O.Fragment,null,O.createElement(w,{dbi:t,table:n,id:s,name_col:i})," âž”  ",a.new?O.createElement(w,{dbi:t,table:n,id:a.new,name_col:i,style:{fontWeight:"bold"}}):O.createElement("span",null,"(X)")):O.createElement(w,{dbi:t,table:n,id:s,name_col:i})}function S(e){var n=e.dbi,s=e.table,t=e.origids,r=e.changes,i=e.name_col;return O.createElement(a,{className:r.some(function(e){return z.changeColumn2table(e.column)==s})?"change":""},O.createElement(F.HideSupportName,{table:s},O.createElement(o,null,M.__spreadArrays(t.map(function(e,t){return O.createElement(c,{key:""+t,dbi:n,table:s,origid:e,changes:r,name_col:i})}),r.filter(function(e){return z.changeColumn2table(e.column)==s&&t.indexOf(e.old)<0}).map(function(e,t){return O.createElement(g,{key:"a"+t},"+",O.createElement(w,{dbi:n,table:s,id:e.new,name_col:i,style:{fontWeight:"bold"}}))})))))}function N(e){var t=e.online,n=e.table,s=e.subst,r=t.naming_dbi,i=r.req,a="short",o=z.subst_item_tableIds(s,n),l=s.card||s.tcard;if(l)return"classes"==n&&s.tcard&&s.tcard.igroupid?O.createElement(w,{dbi:r,table:"igroups",id:s.tcard.igroupid,name_col:a}):O.createElement(O.Fragment,null,O.createElement(S,{dbi:r,table:n,origids:o,changes:s.cancelled?[]:s.changes,name_col:a}),"classes"==n&&l.groupnames&&0<l.groupnames.length&&!G.DBITools.groupnamesIsEntireClass(l.groupnames)&&" "+r.tools.groupnames_names(l.groupnames));if(s.classroomsupervision){if("classes"==n)return O.createElement(O.Fragment,null,"-");if("subjects"==n)return O.createElement(O.Fragment,null,i.ttls(3294));if("teachers"==n)return O.createElement(S,{dbi:r,table:n,origids:o,changes:s.changes,name_col:a});if("classrooms"==n)return O.createElement(w,{dbi:r,table:n,id:s.classroomsupervision.classroomid,name_col:a})}return null}function B(e){var t=e.online,n=e.table,s=e.ttitem;if(!s)return O.createElement(O.Fragment,null,"Error1053608384");var r=t.naming_dbi,i=r.req,a="short",o=s.orig||s,l=z.substTTItem_tableIds(o,n);return"classroomsupervision"!=s.type?"classes"==n&&o.igroupid?O.createElement(w,{dbi:r,table:"igroups",id:o.igroupid,name_col:a}):O.createElement(O.Fragment,null,O.createElement(S,{dbi:r,table:n,origids:l,changes:s.cancelled?[]:s.changes,name_col:a}),"classes"==n&&0<s.groupnames.length&&!G.DBITools.groupnamesIsEntireClass(s.groupnames)&&" "+r.tools.groupnames_names(s.groupnames)):"classes"==n?O.createElement(O.Fragment,null,"-"):"subjects"==n?O.createElement(O.Fragment,null,i.ttls(3294)):"teachers"==n?O.createElement(S,{dbi:r,table:n,origids:l,changes:s.changes,name_col:a}):"classrooms"==n?O.createElement(w,{dbi:r,table:n,id:o.classroomids[0],name_col:a}):null}function h(e){var t=e.row,n=L.client_req,s=0,r=0,i=n.getSchoolYear(t.datefrom||t.dateto||"2000-01-01"),a=n.schoolYear_turnOver(i);return t.datefrom&&(s=J.date_diff(t.datefrom,a)/365*100),t.dateto&&(r=J.date_diff(t.dateto,a)/365*100),O.createElement(O.Fragment,null,O.createElement("div",{style:{backgroundColor:"rgba(0,0,0,0.2)",height:2,marginTop:-4,marginLeft:s+"%",marginRight:100-r+"%"}}),J.date_format_date(n,t.datefrom)+" - "+J.date_format_date(n,t.dateto))}function ue(e){var a=this,o=e.online,l=o.dbi,u=o.naming_dbi,t=o.state,i=t.join_doubles,s=t.filter,c=l.req,n=1;window.innerWidth,n=.7;var r=o.getDateRow(),d=o.getTTItems(),m=o.getSubstsEx(),p=(m=Q.substFilterRows(l,o.state.filter,"substonline_substitutions",m)).map(function(e){var t=z.coreTTItemOfSubst(e),n=z.coreTTItemOfSubst(e,!0),s={id:e.id,stav:e.stav,subst:e,ttitem:z.findTTItemFromSubstId(d,e.id,e.cancelled),item_orig:z.coreTTItemOfSubst(e),item_new:z.coreTTItemOfSubst(e,!0),popis_orig:l.tools.ttitem_popis(t),popis_new:l.tools.ttitem_popis(n)};if(i&&e.join_duration){var r=e.join_duration-1;s.popis_orig.period+="-"+l.rowName("periods",G.DBITools.uniperiod_delta(t.uniperiod,r)),s.popis_new.period+="-"+l.rowName("periods",G.DBITools.uniperiod_delta(n.uniperiod,r))}return s});function b(e){return e.orig==e.new?O.createElement(O.Fragment,null,e.orig):O.createElement(O.Fragment,null,e.orig,"âž”â€‹",e.new)}var f=[{key:"stav",label:"",width:16,icons:E},{key:"periodorbreak",label:c.ttls(2096),width:34,sortable:!0,formatter:function(e){var t=e.row;return O.createElement(b,{orig:t.popis_orig.period,new:t.popis_new.period})}},{key:"absent",label:c.ttls(1995),width:100*n-6,sortable:!0,resizable:!0,formatter:function(e){var t=e.row.subst;return t.absent?O.createElement(F.HideSupportName,{table:t.absent.table},t.absent.name):null},sortFunction:function(e,t){return v.compareLocaleStrings(e.subst.absent&&e.subst.absent.name,t.subst.absent&&t.subst.absent.name)}},{key:"classids",label:c.ls(1263),width:100*n-6,sortable:!0,resizable:!0,formatter:function(e){return O.createElement(N,{online:o,table:e.row.item_orig.igroupid?"igroups":"classes",subst:e.row.subst})},sortFunction:function(e,t){return C.sortTTItemClass(l,e.item_orig,t.item_orig)}},{key:"subjectid",label:c.ls(1299),width:170*n-6,resizable:!0,formatter:function(e){return O.createElement(N,{online:o,table:"subjects",subst:e.row.subst})}},{key:"substitution_typeid",width:100*n-6,label:c.ttls(1997),resizable:!0,formatter:function(e){var t,n=e.row.subst;return n.cancelled?0<(null===(t=n.origofids)||void 0===t?void 0:t.length)?c.ls(11611):c.ttls(1476):o.naming_dbi.rowName("substitution_types",e.row.subst.substitution_typeid)}},{key:"substitute",label:c.ttls(2090),width:94,resizable:!0,formatter:function(e){var t=e.row.subst;if(t.absent){var n=z.absentGetTable(t.absent),s=z.absentGetId(t.absent);if("classrooms"==n)return O.createElement(O.Fragment,null,"âž”");for(var r=0,i=t.changes;r<i.length;r++){var a=i[r];if(z.changeColumn2table(a.column)==n&&a.old==s)return O.createElement(F.HideSupportName,{table:n},o.naming_dbi.rowName(n,a.new))}if("teachers"==n&&t.cancel_teacher)return O.createElement(O.Fragment,null,"-")}else if(t.changes.some(function(e){return"teachers"==z.changeColumn2table(e.column)}))return O.createElement(S,M.__assign({},{dbi:u,table:"teachers",origids:z.subst_item_tableIds(t,"teachers"),changes:t.changes,name_col:l.req.sort_name_col}));return null}},{key:"classroomids",label:c.ls(1197),width:100*n-6,resizable:!0,formatter:function(e){var t=e.row,n=t.subst,s=t.ttitem;if(n.absent){var r=z.absentGetTable(n.absent),i=z.absentGetId(n.absent);if("classrooms"==r&&s&&1==s.changes.filter(function(e){return z.changeColumn2table(e.column)==r}).length){var a=n.changes.find(function(e){return z.changeColumn2table(e.column)==r&&e.old==i});if(a)return O.createElement(w,{dbi:u,table:"classrooms",id:a.new,name_col:"short"})}}return O.createElement(B,{online:o,table:"classrooms",ttitem:s})}},{key:"note",label:c.ls(1579),width:95*n-6,resizable:!0,formatter:function(e){var t=e.row,n=t.subst,s=t.ttitem;return O.createElement(O.Fragment,null,O.createElement("div",null,O.createElement(j,{ttitem:s,online:o}),n.note),n.inote&&O.createElement("div",null,O.createElement("img",{src:"/substitution/pics/inote_32.svg",style:y.EventIcon.style}),n.inote))}}];if(p.find(function(e){return!(!e.subst.join_duration&&!e.subst.join_can)})){var _=o.state.join_doubles;f.splice(1,0,{key:"zgrc",width:0,label:" ",resizable:!1,align:"center",formatter:function(e){var t=e.row.subst,n="";return _?t.join_duration&&(n="/global/pics/ui/tree_plus.png"):t.join_can&&(n="/global/pics/ui/tree_minus.png"),n?O.createElement("img",{src:n,style:{cursor:"pointer",marginLeft:-4,marginRight:-4},onClick:function(){o.setState({join_doubles:!_}),function(e){barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstOnline."+e,eventLabel:""})}(_?"join_doubles_off":"join_doubles")},title:L.client_req.ls(9339)+" (beta)"}):null}})}function h(e){var t,n=null===(t=e.ttitem)||void 0===t?void 0:t.id;n&&!r.uploaded_int&&W.showTTItemEditDlg(n,i,{dbi:l,filter:s})}return O.createElement(v.RDatatable,{columns:f,data:p,selectedIdRef:P(o,"selectedSubstId"),dbi:l,fitWidth:!0,style:{width:"100%",height:"100%"},controlRef:e.controlRef,rowClassNames:function(e){var t=e.subst,n=t.absent,s=[];return n&&"classrooms"==n.table&&s.push("absent_classroom"),n||s.push("changecard"),t.cancelled&&s.push("cancelled"),s},onRowClick:function(t){return M.__awaiter(a,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return r.uploaded_int?"nomatch"!=t.stav?[3,2]:[4,Promise.resolve().then(function(){return require("./pc_subst")})]:[3,2];case 1:e.sent().showSubstNoMatchDlg(o,t.subst),e.label=2;case 2:return[2]}})})},onRowDoubleClick:function(e){return h(e)},onRowContextMenu:function(e,t){if(t.preventDefault(),!o.getDateRow().uploaded_int){var n=e.subst,s=e.ttitem,r=o.state.join_doubles,i=[];z.substIsMovedDate(n)?(i.push({text:c.ttls(3194)+" - "+c.ls(1090),icon:z.ICON_subst_movelesson,onClick:function(){return W.showMoveSubstDlg(n.id,r)}}),i.push({text:c.ttls(3194)+" - "+c.ls(1038),icon:z.ICON_subst_movelesson,onClick:function(){return M.__awaiter(a,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.ui.Dialog.areYouSureDlg(c.ttls(3194)+" - "+c.ls(1038))];case 1:return e.sent()?[4,ASC.blockUI(K.cancelSubstMove(null,n.id,r))]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}})):(i.push({text:c.ttls(1054),icon:H.action_icon("edit"),onClick:function(){return h(e)}}),n.cancelled?i.push({text:c.ls(1859)+": "+c.ttls(1476),icon:H.action_icon("add"),onClick:function(){return ASC.blockUI(K.uncancelSubstOnlineTTItem(null,s.id,r))}}):z.isSubstAdd(n)||i.push({text:c.ttls(1476),icon:H.action_icon("delete"),onClick:function(){return ASC.blockUI(K.removeSubstOnlineTTItem(null,s.id,1<n.join_duration))}}),n.absent||(i.push([]),i.push({text:c.ttls(3793),icon:de("del_32"),onClick:function(){return W.showSubstDeleteDlg(o.dbi,n.id,r)}})),!n.card&&!n.tcard||n.cancelled||n.addcard||n.join_duration||(i.push([]),i.push({text:c.ls(6201),icon:H.action_icon("blank"),onClick:function(){Promise.resolve().then(function(){return require("./online/splitlesson")}).then(function(e){return e.showSplitTTitemDlg(s.id,r)})}})),n.card&&!n.cancelled&&(i.push([]),i.push({text:c.ls(7441),icon:z.ICON_subst_movelesson,onClick:function(){return W.showMoveSubstDlg(n.id,r)}}))),n.kolizie_ignored.length?(i.push([]),i.push({text:c.ls(1038)+": "+c.ls(6675)+" ("+n.kolizie_ignored.length+")",icon:H.action_icon("blank"),onClick:function(){return K.updateSubstIgnoreKolizie(null,n.id,!1)}})):n.kolizie&&(i.push([]),i.push({text:c.ls(6675)+" ("+n.kolizie.length+")",icon:H.action_icon("blank"),onClick:function(){return K.updateSubstIgnoreKolizie(null,n.id,!0)}})),$.showMenu(i,t)}}})}function j(e){var t=e.ttitem,n=e.online;if(!n.showExtraInfo||!t)return null;var s=L.client_req,r=n.dbi,i=t.wds,a=t.ol_is,o=M.__spreadArrays(t.eventids||[],t.changeeventids||[]);return O.createElement(O.Fragment,null,0<(null==i?void 0:i.length)&&O.createElement(O.Fragment,null,a?O.createElement(l.TTView_IconOL,null):O.createElement("img",{src:"/exam/pics/hw/ucivo_c1.png",style:y.EventIcon.style,title:s.ls(10435)})),r.rowDatas("events",o).map(function(e,t){return O.createElement(F.RCatchError,{key:t},O.createElement(y.EventIcon,{dbi:r,eventid:e.id,where:"subst"}))}))}function ce(e){var r=this,i=e.online,s=e.table,t=s,n=i.dbi,a=n.req,o=parseInt(n.dbid),l=i.getDateRow(),u=[];u.push({key:"icon",label:"",width:16,singleIcon:n.table(t).icon()});function c(t){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(i.dbi.backend.updateRow(s,t,{log_module:te}))];case 1:return e.sent(),[2]}})})}switch(s){case"officialtimetables":u.push({key:"name",width:200}),u.push({key:"daterange",label:a.ls(1581),width:140,formatter:h}),u.push({key:"tools",label:"",width:80,formatter:function(s){return O.createElement("a",{style:{display:"inline-block"},onClick:function(e){var t=s.row.id,n=[];n.push({text:a.ls(6391)+": "+a.ttls(1501),onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(Promise.resolve().then(function(){return require("./online/copyduties")}))];case 1:return e.sent().showCopySubstDuties({year:o,target_tt_num:t}),[2]}})})}}),$.showMenu(n,e.currentTarget),e.preventDefault()}},a.ls(1768))}});break;case"teachers":u.push({key:"firstname",width:110}),u.push({key:"lastname",width:110}),u.push({key:"short",width:80}),u.push({key:"subst_hidden",label:a.ls(1003),width:50,align:"center",formatter:function(e){var t=!!e.row.subst_hidden;return O.createElement("img",{src:t?"/substitution/pics/subst_hidden.png":"/substitution/pics/subst_allowed.png",style:{cursor:"pointer"},onClick:function(){return c({id:e.row.id,subst_hidden:!t})}})}}),u.push({key:"subst_timeoff",label:a.ttls(1471),width:80,align:"center",formatter:function(e){var t,n=e.row,s=i.getDateRow().tt_num;if(!s)return null;var r=null===(t=n.subst_tt_timeoff)||void 0===t?void 0:t[s];return r&&b.timeoff_isEmpty(r," .")&&(r=null),O.createElement("span",{style:{cursor:"pointer",display:"inline-block"},onClick:function(){return f.showSubstTimeoffDlg({teacherid:n.id,date:i.getDate()})}},r?O.createElement(b.MiniTimeoff,{dbi:i.tt_dbi,timeoff:r,joiner:f.substVolnoJoiner}):O.createElement("img",{src:"/substitution/pics/sluzba.png",style:{margin:0}}))}}),u.push({key:"approbationids",width:150,formatter:function(e){var t=e.row,n=t.approbationids||[];return O.createElement("span",{style:{cursor:"pointer",paddingRight:5},onClick:function(){return M.__awaiter(r,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../rpr/vyber.js")})];case 1:return[4,e.sent().showDBIVyberDlg(i.dbi,"approbations",n)];case 2:return(n=e.sent())&&c({id:t.id,approbationids:n}),[2]}})})}},i.dbi.rowNames("approbations",n,"short")||"-")}});for(var d=0,m=["contract","de_contract_verfugung"];d<m.length;d++){var p=m[d];n.column("teachers",p)&&u.push({key:p,width:40,align:"center"})}break;case"subjects":u.push({key:"name",width:200}),u.push({key:"short",width:100}),u.push({key:"subst_join_forbidden",label:a.ttls(2107),width:50,align:"center",formatter:function(e){var t=e.row,n=!!t.subst_join_forbidden;return O.createElement("img",{src:n?"/substitution/pics/join_forbidden_16.png":"/substitution/pics/join_allowed_16.png",style:{cursor:"pointer",margin:0},onClick:function(){return c({id:t.id,subst_join_forbidden:!n})}})}});break;case"substitution_types":u.push({key:"name",width:200}),u.push({key:"short",width:100}),u.push({key:"default_for",width:200});break;case"approbations":u.push({key:"name",width:200}),u.push({key:"short",width:80}),u.push({key:"subjectids",width:200}),u.push({key:"teacherids",width:300});break;default:u.push({key:"name",width:200}),u.push({key:"short",width:100})}return O.createElement(v.RDatatable,{columns:u,data:n.tableData(t),selectedIdRef:P(i,"selectedOtherId"),dbi:n,dbi_table:s,onRowDoubleClick:function(n){return M.__awaiter(r,void 0,void 0,function(){var t;return M.__generator(this,function(e){switch(e.label){case 0:return A.includes(s)?(t=n.id,[4,I.showMainDbiItemDlg(o,s,t)]):[2];case 1:return e.sent(),[2]}})})},rowClassNames:function(e){return"officialtimetables"==s?{"row-green":l.tt_num==e.id}:{}},style:{width:"100%",height:"100%"}})}function P(n,s){return F.makeSimpleValueRef(function(){return n.state[s]},function(e){var t;n.state[s]!==e&&n.setState(((t={})[s]=e,t))})}function de(e){return"/timetable/pics/app/office/"+e+".png"}function me(e){var t=L.client_req,n=e.valueRef,s=n.value,r=t.getSchoolYear(s),i=F.useAsyncMemo(function(){return K.getSubstDateFieldData(null,r)},[r],{absent_dates:[],online_dates:[]}),a=i.absent_dates,o=i.online_dates,l=O.useMemo(function(){for(var e={},t=0,n=a;t<n.length;t++){e[n[t]]="#fff97d"}for(var s=0,r=o;s<r.length;s++){e[r[s]]="#ff648b"}return e},[a,o]);return O.createElement(u.default,{valueRef:n,date2color:l,style:e.style,blank:!1})}ue.npp=z.substOnlineNeededPartProvider(function(){return[z.findTTItemFromSubstId,s.eventIcon,s.eventName,j,z.isSubstAdd,{substonline_dates:["uploaded_int"],substonline_substitutions:["cancelled","changes","note","inote"],substonline_ttitems:["changes"],teachers:["__name","classroomid"],classes:["__name","classroomid"],igroups:["__name","classroomid"],classrooms:["__name","buildingid"],subjects:["__name"],periods:["__name"],dayparts:["__name"]}]}),j.npp=G.neededPartProvider(function(){return[y.EventIcon,{substonline_ttitems:["eventids","changeeventids","ol_is"]}]}),ce.needed_part=G.typed({officialtimetables:["name","datefrom","dateto"],teachers:["firstname","lastname","short","subst_hidden","subst_tt_timeoff","approbationids","contract","de_contract_verfugung"],subjects:["name","short","subst_join_forbidden"],absent_types:["name","short"],substitution_types:["name","short","default_for"],approbations:["name","short","subjectids","teacherids"]}),e._hotswap=[ae,oe,le,me]},"/substitution/subst.js":function(e,require,t){e.__esModule=!0;var y=require("tslib"),k=require("../rpr/dbi");function s(e){return"types"==e.substring(e.length-5)?e.substring(0,e.length-1):"es"==e.substring(e.length-2)?e.substring(0,e.length-2):e.substring(0,e.length-1)}function r(e,t){void 0===t&&(t=!1);var n=l(e),s=e[n];if(t){s=y.__assign({},s);for(var r=function(t){var e=t.column,n=s[e];Array.isArray(n)?(n=n.filter(function(e){return e!=t.old}),t.new&&n.push(t.new)):n=t.new||"",s[e]=n},i=0,a=e.changes||[];i<a.length;i++){r(a[i])}}var o=k.DBITools.getUniPeriod(s);return{type:n,uniperiod:o,endtime:"starttime"==k.DBITools.typeOfUniPeriod(o)&&s.endtime||"",subjectid:s.subjectid||"",classids:s.classids||[],teacherids:s.teacherids||(s.teacherid?[s.teacherid]:[]),classroomids:s.classroomids||(s.classroomid?[s.classroomid]:[]),igroupid:s.igroupid||"",groupnames:s.groupnames||[]}}function g(e,t){switch(t){case"classes":return e.classids||[];case"teachers":return e.teacherids||[];case"classrooms":return e.classroomids||[];case"subjects":return e.subjectid?[e.subjectid]:[];case"igroups":return e.igroupid?[e.igroupid]:[]}return[]}function v(e,t){if(t.period){var n=parseInt(t.period),s=n+(t.durationperiods||1)-1;switch(k.DBITools.typeOfUniPeriod(e.uniperiod)){case"period":var r=parseInt(e.uniperiod);if(r+(e.durationperiods||1)-1<n)return!1;if(s<r)return!1;break;case"break":var i=parseInt(e.uniperiod.substr(1)),a=t.exclude_breaks||"",o=a.includes("b")?1:0,l=a.includes("i"),u=a.includes("a")?1:0;if(i<n+o)return!1;if(1+s-u<i)return!1;if(n<i&&i<=s&&l)return!1;break;default:return!1}}return!0}function n(e,t){switch(t.table){case"teachers":if(!e.teacherids.includes(t.teacherid))return!1;break;case"classrooms":if(!e.classroomids.includes(t.classroomid))return!1;break;case"classes":if(!e.classids.includes(t.classid))return!1;break;case"groups":if(!e.classids.includes(t.classid))return!1;if(e.groupnames.includes(t.groupname));else if(!e.groupnames.includes("")||!t.split_entireclass)return!1}return!!v(e,t)}function i(e){return!(!e.addcard&&!e.addtcard)}function a(i,a,o){for(var l=null,e=function(t){if(!a.classids.includes(t))return"continue";var e=!1;if(k.groupnamesIsOverlap(k.DBITools.groupnames2ssg(i.groupnames,i.subjectid),k.DBITools.groupnames2ssg(a.groupnames,a.subjectid))&&(e=!0),!e&&o){var n=o.tableData("groups"),s=n.find(function(e){return e.classid==t&&i.groupnames.includes(e.name)}),r=n.find(function(e){return e.classid==t&&a.groupnames.includes(e.name)});s&&r&&s.ascttdivision!=r.ascttdivision&&(e=!0)}e&&(l?l.includes(t)||l.push(t):l=[t])},t=0,n=i.classids;t<n.length;t++){e(n[t])}return l}function l(e){return ASC.boolVal(e.card)?"card":ASC.boolVal(e.tcard)?"tcard":ASC.boolVal(e.classroomsupervision)?"classroomsupervision":void ASC.dieError("7424907584")}function E(e){if(!e)return"";var t=e.table;return"groups"==t&&(t="classes"),t}function w(e){switch(E(e)){case"classes":return e.classid;case"teachers":return e.teacherid;case"classrooms":return e.classroomid}return""}function o(e,t,n,s){void 0===s&&(s={});for(var r=0,i=e;r<i.length;r++){var a=i[r];if(E(a)==t&&w(a)==n){if("groups"==a.table&&s.groupnames)if(s.groupnames.includes(a.groupname));else if(!k.DBITools.groupnamesIsEntireClass(s.groupnames)||!a.split_entireclass)continue;if(a.period){var o=parseInt(a.period),l=o+(a.durationperiods||1)-1;if(s.period){if(parseInt(s.period)<o)continue;if(parseInt(s.period)>l)continue}if(s.break){if(parseInt(s.break)<o)continue;if(parseInt(s.break)>1+l)continue}if(s.daypart)continue;if(s.starttime)continue}return a}}return null}function u(e,t,n){void 0===n&&(n=!1);for(var s=0,r=e;s<r.length;s++){var i=r[s];if((!i.cancelled||n)&&i.substids.includes(t))return i}return null}function D(e){if(!e)return-1;var t=60*parseInt(e.substr(0,2))+parseInt(e.substr(3,2));return 8<=e.length&&(t+=parseInt(e.substr(6,2))/60),t}function I(e){if(e<0)return"";var t=e%60,n=(e-t)/60;return(n<10?"0":"")+n+":"+(t<10?"0":"")+t}function c(e){return e.addcard||e.addtcard}function d(e,t){if(0==e.length)return t;for(var n=e,s=0,r=t;s<r.length;s++){for(var i=r[s],a=!1,o=0,l=n;o<l.length;o++){var u=l[o];if(u.column===i.column&&(u.old===i.old&&u.new===i.new)){a=!0;break}}a||(n==e&&(n=y.__spreadArrays(n)),n.push(i))}return n}function S(e,t,n,s){var r="subst_ttitems"==t?"subst_substitutions":"substonline_substitutions";if("classroomsupervision"==n.type)return!1;if(n.subjectid!=s.subjectid)return!1;if(!k.idsArrayMatch(n.classids,s.classids))return!1;if(!k.idsArrayMatch(n.groupnames,s.groupnames))return!1;if(n.igroupid!=s.igroupid)return!1;if(!k.idsArrayMatch(n.teacherids,s.teacherids))return!1;if(!k.idsArrayMatch(n.classroomids,s.classroomids))return!1;if(n.type!=s.type)return!1;if(n.cancelled!=s.cancelled)return!1;if(n.added!=s.added)return!1;if("period"!=k.DBITools.typeOfUniPeriod(n.uniperiod))return!1;if(s.uniperiod!=""+(parseInt(n.uniperiod)+1))return!1;var i=n.orig,a=s.orig;if(i){if(!a)return!1;if(i.subjectid!=a.subjectid)return!1;if(!k.idsArrayMatch(i.teacherids,a.teacherids))return!1;if(i.igroupid!=a.igroupid)return!1;if(!k.idsArrayMatch(i.classids,a.classids))return!1;if(!k.idsArrayMatch(i.groupnames,a.groupnames))return!1;if(!k.idsArrayMatch(i.classroomids,a.classroomids))return!1;if(a.uniperiod!=""+(parseInt(i.uniperiod)+1))return!1}else if(a)return!1;if(n.origsubstid){if(!s.origsubstid)return!1;if(n.origsubstid.split(":")[0]!=s.origsubstid.split(":")[0])return!1}if(n.origofids.length!=s.origofids.length)return!1;var o=n.origofids.length;if(1<o)return!1;if(1==o&&n.origofids[0].split(":")[0]!=s.origofids[0].split(":")[0])return!1;if(n.substids.length!=s.substids.length)return!1;for(var l=0;l<n.substids.length;l++){var u=e.rowData(r,n.substids[l]),c=e.rowData(r,s.substids[l]);if(u.note!=c.note)return!1;if(u.inote!=c.inote)return!1;if(u.substitution_typeid!=c.substitution_typeid)return!1}return n.wds.length==s.wds.length&&(n.ol_is==s.ol_is&&(n.eventid==s.eventid&&(!!k.idsArrayMatch(n.eventids,s.eventids)&&!!k.idsArrayMatch(n.changeeventids,s.changeeventids))))}e.ICON_subst_ok="/global/pics/ui/item_ok_16.svg",e.ICON_subst_kolizia="/global/pics/ui/item_bad_16.svg",e.ICON_subst_spojenie="/substitution/pics/plus_32.svg",e.ICON_subst_kolizia_ignored="/substitution/pics/no_ignored_32.svg",e.ICON_subst_changelesson="/global/pics/ui/modified_32.svg",e.ICON_subst_addlesson="/substitution/pics/subst_add_32.svg",e.ICON_subst_movelesson="/substitution/pics/subst_move_32.svg",e.ICON_subst_moved="/substitution/pics/subst_moved_32.svg",e.ICON_subst_cancelled="/substitution/pics/subst_remove_32.svg",e.ICON_subst_todo="/global/pics/ui/help_16.svg",e.subst_period=function(e){return e?""!=(t=ASC.strVal(e.period))?t:""!=(t=ASC.strVal(e.break))?"b"+t:""!=(t=ASC.strVal(e.daypart))?t:5==(t=ASC.strVal(e.starttime)).length?t.substr(0,2)+"-"+t.substr(3):"":"";var t},e.subst_item=function(e){return e.card||e.classroomsupervision||e.tcard},e.subst_item_tableIds=function(e,t,n){return void 0===n&&(n=!1),g(r(e,n),t)},e.removeEs=s,e.blankSubstTTItem_Core=function(){return{type:"",uniperiod:"",endtime:"",subjectid:"",classids:[],teacherids:[],classroomids:[],igroupid:"",groupnames:[]}},(e.coreTTItemOfSubst=r).needed_part=k.typed({subst_substitutions:["card","tcard","classroomsupervision","changes"]}),e.substTTItem_tableIds=g,e.substTTItem_filter_match=function(e,t,n){switch(t){case"teachers":return e.teacherids.includes(n);case"classes":return e.classids.includes(n);case"classrooms":return e.classroomids.includes(n);case"igroups":return e.igroupid==n}return!1},e.substTTItem_absent_match_time=v,(e.substTTItem_absent_match=n).needed_part=k.typed({subst_absents:["table","teacherid","classroomid","classid","groupname","period","durationperiods","exclude_breaks"]}),e.susbtTTItemPopis=function(e,t,n){var s=t.req;if("classroomsupervision"==e.type)return s.ls(1723)+" "+t.rowNames("classrooms",e.classroomids,n)+" "+t.rowNames("teachers",e.teacherids,n);var r=t.rowName("subjects",e.subjectid,n);r+=" ",r+=t.rowNames("classes",e.classids,n);var i=e.groupnames;return i&&i.length&&!k.DBITools.groupnamesIsEntireClass(i)&&(r+=" ("+t.tools.groupnames_names(i)+")"),r+=" ",r+=t.rowNames("teachers",e.teacherids,n),r+=" ",r+=t.rowNames("classrooms",e.classroomids,n)},e.substTTItemMovable=function(e){return"classroomsupervision"!=e.type&&"period"==k.DBITools.typeOfUniPeriod(e.uniperiod)},(e.isSubstAdd=i).needed_part=k.typed({substonline_substitutions:["addcard","addtcard"]}),e.idsArrayMatch=k.idsArrayMatch,e.idsArrayMatchI=k.idsArrayMatchI,e.idsArrayDiff=k.idsArrayDiff,e.idsArrayIntersect=k.idsArrayIntersect,e.idsIsOverlap=k.idsIsOverlap,e.idsIsSubArray=k.idsIsSubArray,e.groupnamesIsOverlap=k.groupnamesIsOverlap,(e.ttitem_isClassColision=a).needed_part=k.typed({substonline_ttitems:["classids","groupnames"]}),a.ttdbi={needed_part:k.typed({groups:["classid","name","ascttdivision"]})},e.subst_item_type=l,e.subst_isTargetAbsent=function(e){if(!e.absent)return!1;var t=E(e.absent);return e.classroomsupervision?"classrooms"==t:"classes"==t||"igroups"==t},e.absentGetTable=E,e.absentGetId=w,(e.findAbsent=o).needed_part=k.typed({subst_absents:["table","teacherid","classid","classroomid","groupname","period","durationperiods"]}),(e.findTTItemFromSubstId=u).needed_part=k.typed({subst_ttitems:["cancelled","substids"]}),e.findCollisions=function(e,t,n,s,r){void 0===r&&(r={});for(var i=[],a=0,o=["teachers","classrooms","classes","igroups"];a<o.length;a++)for(var l=o[a],u=0,c=g(t,l);u<c.length;u++){for(var d=c[u],m=0,p=n;m<p.length;m++){var b=p[m];b.date==e&&g(b,l).includes(d)&&(r.ignore_substid&&b.substids.includes(r.ignore_substid)||b.uniperiod==t.uniperiod&&i.push({table:l,id:d,ttitem:b}))}for(var f=0,_=s;f<_.length;f++){var h=_[f];E(h)==l&&w(h)==d&&v(t,h)&&i.push({table:l,id:d,absent:h})}}return i},e.getDefault_substitution_typeid=function(e,t){void 0===t&&(t="normal");for(var n=0,s=e.tableData("substitution_types");n<s.length;n++){var r=s[n];if(r.default_for==t)return r.id}return""},e.changeColumn2table=function(e){switch(e){case"period":return"periods";case"subjectid":return"subjects";case"teacherids":case"teacherid":return"teachers";case"classids":return"classes";case"classroomids":case"classroomid":return"classrooms";case"igroupid":return"igroups"}return""},e.coreOfTTItem=function(e){return{type:e.type,uniperiod:e.uniperiod,endtime:"starttime"==k.DBITools.typeOfUniPeriod(e.uniperiod)?e.endtime:"",subjectid:e.subjectid,classids:e.classids,teacherids:e.teacherids,classroomids:e.classroomids,igroupid:e.igroupid,groupnames:e.groupnames}},e.time2int=D,e.int2time=I,e.dp_fixTime=function(e,t,n,s){for(var u=new Map,c=function(e){var t=u.get(e);return t||(t={starttime:"",endtime:"",cbs:[]},u.set(e,t)),t},d=null!=e.tt_day?""+e.tt_day:"",r=0,i=n.tableData("periods");r<i.length;r++){var a=(f=i[r]).id;(C=c(a)).starttime=f.starttime,C.endtime=f.endtime}for(var o=0,l=n.tableData("dayparts");o<l.length;o++){var m=l[o];a=m.id;(C=c(a)).starttime=m.starttime,C.endtime=m.endtime}if(s){for(var p=0,b=s.tableData("periods");p<b.length;p++){var f;a=(f=b[p]).id;(C=c(a)).starttime=f.starttime,C.endtime=f.endtime}for(var _=0,h=s.tableData("breaks");_<h.length;_++){var g=h[_];a="b"+g.id;(C=c(a)).starttime=g.starttime,C.endtime=g.endtime}for(var v=0,y=s.tableData("custombells");v<y.length;v++){var E=y[v];a=E.period;E.break&&(a="b"+E.break),(C=u.get(a))&&C.cbs.push(E)}}function w(e,t){if(a=u.get(e)){if(0<a.cbs.length)for(var n=0<=t.classids.length?t.classids[0]:"",s=0,r=a.cbs;s<r.length;s++){var i=r[s];if(!i.day||i.day==d){if(0<i.classids.length){if(!n)continue;if(!i.classids.includes(n))continue}return k.unpartial(i)}}return a}var a=c(e);if("b"==e[0]){var o=u.get(""+(parseInt(e.substr(1))-1)),l=u.get(e.substr(1));l&&(a.endtime=l.starttime,a.starttime=o?o.endtime:I(D(a.endtime)-5))}return a}for(var S=0,x=t;S<x.length;S++){var T=x[S];if(!T.starttime||!T.endtime){a=T.uniperiod||k.DBITools.getUniPeriod(T);if("starttime"!=k.DBITools.typeOfUniPeriod(a)){var C=w(a,T);T.starttime=C.starttime,T.durationperiods&&1<T.durationperiods&&(C=w(""+(parseInt(a)+T.durationperiods),T)),T.endtime=C.endtime}else T.starttime=a.replace("-",":")}}},(e.substIsAddCard=c).needed_part=k.typed({subst_substitutions:["addcard","addtcard"]}),e.substIsIgnored=function(e){return!(!e.absent||"classes"!=E(e.absent))},e.substIsMovedDate=function(e){for(var t=y.__spreadArrays([e.origid],e.origofids||[]),n=e.id.split(":")[0],s=0,r=t;s<r.length;s++){var i=r[s];if(i&&i.split(":")[0]!=n)return!0}return!1},e.mergeSubstChanges=d,e.substChangesEquals=function(e,t){return e.length==t.length&&d(e,t).length==e.length},e.substBasicChanges=function(e){var t=[],n=e.absent;return n&&t.push({column:s(E(n))+"ids",old:w(n)}),t},S.needed_part=k.typed({subst_ttitems:["date","uniperiod","orig","subjectid","teacherids","classids","groupnames","igroupid","substids","classroomids","origsubstid","origofids","ol_is","wds","eventid","eventids","changeeventids"],subst_substitutions:["note","inote","substitution_typeid"]});var x=[null,"",[]];function m(c,e,a,t){void 0===t&&(t={});try{var d=t.table||"substonline_ttitems",s="substonline_ttitems"==d?"substonline_substitutions":"subst_substitutions",n=[e,!!a,d].join(),r=x;if(r[0]==c&&r[1]==n)return r[2];for(var i=[],o=c.tableFilterData(d,{date:e}),m=new Map,l=0,u=c.tableIds("periods");l<u.length;l++){var p=u[l];m.set(parseInt(p),[])}for(var b=function(e){if(e.length<=1)return e;function n(e){var t=c.rowData(s,e);return JSON.stringify(t.changes)}return(e=y.__spreadArrays(e)).sort(function(e,t){return n(e)<n(t)?-1:1}),e},f=0,_=o;f<_.length;f++){var h=_[f],g=y.__assign(y.__assign({},h),{substids:b(h.substids)});i.push(g);p=parseInt(g.uniperiod);m.has(p)&&m.get(p).push(g)}m.forEach(function(e,t){var n=m.get(t+1);if(n)for(var s=0,r=e;s<r.length;s++)for(var i=r[s],a=0,o=n;a<o.length;a++){var l=o[a];if(S(c,d,i,l)){i.join_nextid=l.id,l.join_previd=i.id,l.join_substid2prev=new Map;for(var u=0;u<l.substids.length;u++)l.join_substid2prev.set(l.substids[u],i.substids[u]);break}}});var v=new Map;return m.forEach(function(e){for(var t=0,n=e;t<n.length;t++){var s=n[t];if(a||s.eventid)if(s.join_previd){var r=v.get(s.join_previd);r.durationperiods++,r.join_ttitemids.push(s.id),v.set(s.id,r);for(var i=0;i<s.substids.length;i++)r.join_substid2first.set(s.substids[i],r.substids[i])}else s.join_nextid&&(s.durationperiods=1,s.join_ttitemids=[],s.join_substid2first=new Map,v.set(s.id,s))}}),i=i.filter(function(e){return!(e.join_previd&&v.get(e.id))}),x=[c,n,i],i}catch(e){if(c.mock)return[];throw e}}(e.buildSubstOnlineTTItemsEx=m).npp=k.neededPartProvider(function(){return[S,{subst_ttitems:["date","substids"]}]}),e.substOnlineNeededPartProvider=function(i){return function(){var e,t=k.neededPartProvider(i)(),n=[],s={subst_dates:"substonline_dates",subst_absents:"substonline_absents",subst_substitutions:"substonline_substitutions",subst_ttitems:"substonline_ttitems",subst_students:"substonline_students"};for(var r in t)n.push(((e={})[s[r]||r]=t[r],e));return k.DBITools.mergeNeededParts.apply(k.DBITools,n)}}},"/timetable/timeoff_r.js":function(e,require,t){e.__esModule=!0;var S=require("tslib"),x=require("react"),n=require("../rpr/dbi"),T=require("../asc/asc_react"),s=x.Fragment,C=require("../asc/edurequest"),l=require("../react/combobox"),u=[[["."]]];function y(e,t){return"0"==e||"0"==t?"0":"?"==e||"?"==t?"?":e}function b(e,t,n,s,r,i){void 0===i&&(i=y);var a=e;if(t<0){var o=b(e,0,n,s,r,i);for(t=1;t<a.length;t++)o=i(o,b(e,t,n,s,r,i));return o}var l=a[t<a.length?t:a.length-1];if(n<0){o=b(e,t,0,s,r,i);for(n=1;n<l.length;n++)o=i(o,b(e,t,n,s,r,i));return o}var u=l[n<l.length?n:l.length-1];if(s<0){o=b(e,t,n,0,r,i);for(s=1;s<u.length;s++)o=i(o,b(e,t,n,s,r,i));return o}var c=u[s<u.length?s:u.length-1];if(r<0){o=b(e,t,n,s,0,i);for(r=1;r<c.length;r++)o=i(o,b(e,t,n,s,r,i));return o}return c.charAt(r<c.length?r:c.length-1)}function k(e,t,n,s,r,i,a){return I(e=c(e=D(e,t),n,s,r,i,a))}function c(e,t,n,s,r,i){if(a=e.length,t<0){if(1<a){for(t=0;t<a;t++)e=c(e,t,n,s,r,i);return e}t=0}if(a=e[t].length,n<0){if(1<(a=e[t].length)){for(n=0;n<a;n++)e=c(e,t,n,s,r,i);return e}n=0}if(a=e[t][n].length,s<0){if(1<(a=e[t][n].length)){for(s=0;s<a;s++)e=c(e,t,n,s,r,i);return e}s=0}if(r<0){var a=e[t][n][s].length;for(r=0;r<a;r++)e=c(e,t,n,s,r,i);return e}var o=(e=ASC.clone(e))[t][n][s],l=o.substr(0,r)+i+o.substring(r+1);return e[t][n][s]=l,e}function o(e,t){for(;e.length<t;)e.push(ASC.clone(e[e.length-1]))}function d(e){for(var t=e.tools.tableIntIdRange("periods"),n={nTerms:e.tableIds("terms").length||1,nWeeks:e.tableIds("weeks").length||1,nDays:e.tableIds("days").length||1,nPeriods:t[1]+1,hodinyOd:t[0],hodinyDo:t[1]},s=0,r=["terms","weeks","days"];s<r.length;s++){var i=r[s],a=e.tableIds(i),o=1;if(0<a.length)o=a.length;else{var l=e.tableData(i+"defs")[0],u=void 0;l&&(u=l.vals||l[i])&&(o=u[0].length)}n["n"+i[0].toUpperCase()+i.substr(1)]=o}return n}function D(e,t){e=ASC.clone(e);var n=d(t);o(e,n.nTerms);for(var s=0;s<e.length;s++){o(e[s],n.nWeeks);for(var r=0;r<e[s].length;r++){o(e[s][r],n.nDays);for(var i=0;i<e[s][r].length;i++){var a=".";for(0<e[s][r][i].length&&(a=e[s][r][i].substr(e[s][r][i].length-1));e[s][r][i].length<n.nPeriods;)e[s][r][i]+=a}}}return ASC.clone(e)}function I(e){return function e(t){for(var n=0;n<t.length;n++)Array.isArray(t[n])&&e(t[n]);for(;1<t.length&&JSON.stringify(t[t.length-1])==JSON.stringify(t[t.length-2]);)t.splice(t.length-1)}(e=ASC.clone(e)),e}function r(e){for(var t,n=Math.min(24,null!==(t=e.rowHeight)&&void 0!==t?t:24),s=0,r=e.icons;s<r.length;s++){var i=r[s];if(i.d==e.value)return i.img?x.createElement("img",{style:{width:n,height:n,verticalAlign:"middle"},src:i.img}):null}return null}function f(t){return x.createElement("td",{style:{border:"1px solid #e0e0e0",textAlign:"center",verticalAlign:"middle",backgroundColor:t.obsadene?"#8a8a9e":"",position:"relative",cursor:"pointer"},onMouseDown:function(e){e.preventDefault(),t.onToggle(2==e.button)},onContextMenu:function(e){return e.preventDefault()}},x.createElement(r,{value:t.value,icons:t.icons,rowHeight:t.rowHeight}),t.overlay)}function R(l){function i(e,t,n){void 0===n&&(n=!1);for(var s=b(p,Math.max(c,0),Math.max(d,0),Math.max(e,0),Math.max(t,0)),r=l.icons,i=0,a=0;a<r.length;a++){r[a].d==s&&(i=a)}var o=n?i-1:i+1;o>=r.length&&(o=0),o<0&&(o=r.length-1),l.timeoffRef.set(k(p,u,c,d,e,t,r[o].d))}var e,u=l.tt_dbi,t=u.tableData("periods"),n=u.tableData("days"),c=l.term,d=l.week,a=l.overlay,s=100/(t.length+1)+"%",o=null!==(e=l.rowHeight)&&void 0!==e?e:35,m={width:s,textAlign:"center",verticalAlign:"middle",height:o,fontWeight:"normal",cursor:"pointer"},p=l.timeoffRef.value;return x.createElement("table",{style:{width:"100%",backgroundColor:"#ffffff",borderCollapse:"collapse"}},x.createElement("thead",null,x.createElement("tr",null,x.createElement("th",null),t.map(function(t){return x.createElement("th",{key:t.id,style:S.__assign(S.__assign({},m),{fontSize:"15px"}),onMouseDown:function(e){e.preventDefault(),i(-1,parseInt(t.id),2==e.button)},onContextMenu:function(e){return e.preventDefault()},title:t.name},t.short)}))),x.createElement("tbody",{style:{fontSize:Math.min(20,o)}},n.map(function(r,e){return x.createElement("tr",{key:r.id},x.createElement("th",{style:S.__assign(S.__assign({},m),{whiteSpace:"pre"}),onMouseDown:function(e){e.preventDefault(),i(parseInt(r.id),-1,2==e.button)},onContextMenu:function(e){return e.preventDefault()},title:r.name},r.short),t.map(function(e,t){var n=parseInt(r.id),s=parseInt(e.id);return x.createElement(f,{key:e.id,value:b(p,Math.max(c,0),Math.max(d,0),n,s),icons:l.icons,rowHeight:o,onToggle:function(e){return i(n,s,e)},obsadene:l.obsadene&&"1"==b(l.obsadene,Math.max(c,0),Math.max(d,0),n,s),overlay:a?a({term:c,week:d,day:n,period:s}):void 0})}))})))}function A(e){var t=C.client_req;return x.createElement("div",{style:{marginTop:20}},x.createElement("span",{style:{marginRight:10}},t.ttls(1119)),e.icons.filter(function(e){return!!e.name}).map(function(e){return x.createElement(s,{key:e.d},x.createElement("img",{src:e.img,style:{marginRight:10,verticalAlign:"middle",width:24,height:24}}),x.createElement("span",{style:{marginRight:30}},t.localize(e.name)))}),x.createElement("div",{style:{marginTop:6}},t.ttls(1123)),x.createElement("div",{style:{marginTop:6}},t.ttls(3548)))}function N(t){var n=t.tt_dbi,s=t.table,e=t.valueRef,r=t.timeoffRef;if(n.tableData(t.table).length<=1)return null;var i=e.value,a=r.value,o=x.useMemo(function(){var e=!0,t=I(r.value);if("terms"==s)1<t.length&&(e=!1);else for(var n=0;n<t.length;n++)1<t[n].length&&(e=!1);return e},[a]);return x.useLayoutEffect(function(){i<0&&!o&&e.set(0)},[o,i]),x.createElement("div",{style:{display:"inline-block",width:180,marginLeft:15,verticalAlign:"top"}},x.createElement("label",null,x.createElement("input",{type:"checkbox",disabled:!o,checked:i<0,onChange:function(){i<0?e.set(0):o&&e.set(-1)}}),t.text_rovnako),x.createElement("br",null),x.createElement(T.AnimatedCollapseDiv,{collapsed:i<0},x.createElement(l.default,{valueRef:e.cast(function(e){return""+e},function(e){return parseInt(e)}),items:n.tableIds(s).map(function(e){return{value:e,name:n.rowName(t.table,e)}}),style:{width:"100%"}})))}function B(n){var e=0,t=n.tt_dbi.tableData("terms").length-1,s=n.termRef.value;s<0&&(e=t=s);var r=0,i=n.tt_dbi.tableData("weeks").length-1,a=n.weekRef.value;return a<0&&(r=i=a),x.createElement("div",null,T.rangeFromTo(e,t).map(function(t){return T.rangeFromTo(r,i).map(function(e){return x.createElement("span",{key:t+":"+e,style:{display:"inline-block",borderWidth:1,borderStyle:"solid",borderColor:t==s&&e==a?"black":"transparent",padding:2,marginRight:5,cursor:"pointer"},onClick:function(){n.termRef.set(t),n.weekRef.set(e)}},x.createElement(h,{dbi:n.tt_dbi,timeoff:n.timeoff,t:t,w:e}))})}))}function i(e){var t=e.tt_dbi,n=e.icons,s=e.table,r=e.id,i=C.client_req,a=e.valueRef.cast(function(e){return D(e,t)},function(e){return I(e)}),o=T.useStateValueRef(-1),l=T.useStateValueRef(-1),u=[o.value,l.value],c=u[0],d=u[1],m=D([[["0"]]],t);if(s&&r&&!t.mock)for(var p=0,b=t.tableData("cards");p<b.length;p++){var f=b[p];if(f.period){var _=t.rowData("lessons",f.lessonid);if(("subjects"!=s||_.subjectid==r)&&("teachers"!=s||_.teacherids.includes(r))&&("classes"!=s||_.classids.includes(r))&&("classrooms"!=s||f.classroomids.includes(r)))for(var h=parseInt(f.period),g=h+((_.durationperiods||1)-1),v=0;v<f.days.length;v++)if("1"==f.days[v])for(var y=0;y<f.weeks.length;y++)if("1"==f.weeks[y]&&!(0<=d&&y!=d))for(var E=0;E<_.terms.length;E++)if("1"==_.terms[E]&&!(0<=c&&E!=c))for(var w=h;w<=g;w++)m=k(m,t,E,y,v,w,"1")}}return x.createElement("div",null,x.createElement(R,{timeoffRef:a,tt_dbi:t,icons:n,term:c,week:d,obsadene:m,overlay:e.overlay}),x.createElement(T.AnimatedCollapseDiv,{collapsed:!(0<=c||0<=d)},x.createElement("div",{style:{marginTop:3,textAlign:"right"}},x.createElement(B,S.__assign({},{timeoff:a.value,tt_dbi:t,termRef:o,weekRef:l})))),x.createElement(A,{icons:n}),x.createElement("div",{style:{display:"inline-block",width:150}}),x.createElement(N,{valueRef:o,timeoffRef:a,table:"terms",tt_dbi:t,text_rovnako:i.ttls(3675)}),x.createElement(N,{valueRef:l,timeoffRef:a,table:"weeks",tt_dbi:t,text_rovnako:i.ttls(3674)}))}e.defaultVolnoJoiner=y,e.timeoff_isEmpty=function(e,t){for(var n=0,s=e;n<s.length;n++)for(var r=0,i=s[n];r<i.length;r++)for(var a=0,o=i[r];a<o.length;a++)for(var l=o[a],u=0;u<l.length;u++)if(!t.includes(l[u]))return!1;return!0},e.timeoff_get=b,e.timeoff_getByBits=function(e,t,n,s,r,i,a){void 0===a&&(a=y),"string"==typeof r&&(r=parseInt(r)),1<=i||ASC.dieError("7623249487");var o="";function l(e,t){return e.length<=t?e:e.substr(0,t-1)+(0<=e.indexOf("1",t-1)?"1":"0")}for(var u=l(t,e.length),c=0;c<u.length;c++)if("1"==u[c])for(var d=e[c],m=l(n,d.length),p=0;p<m.length;p++)if("1"==m[p])for(var b=d[p],f=l(s,b.length),_=0;_<s.length;_++)if("1"==f[_]){var h=b[_];r>=h.length?o+=h[h.length-1]:o+=h.substr(r,i)}if(!(1<o.length))return o;for(var g=o[0],v=1;v<o.length;v++)return g=a(g,o[v])},e.timeoff_set=k,e.timeoff_setUncompressed=c,e.timeoffStructure_needed_part={periods:[],days:[],weeks:[],terms:[]},e.timeoff_uncompress=D,e.timeoff_compress=I,e.timeoff2str=function(e){e=I(e);for(var t="",n=0;n<e.length;n++){0<n&&(t+="|");for(var s=0;s<e[n].length;s++){0<s&&(t+=";");for(var r=0;r<e[n][s].length;r++)0<r&&(t+=","),t+=e[n][s][r]}}return t},e.TOC_Grid=R,(e.TimeoffInput=i).tt_dbi={needed_part:n.typed({terms:["__name"],weeks:["__name"],days:["__name"],periods:["__name"],cards:["lessonid","period","days","weeks","classroomids"],lessons:["subjectid","teacherids","classids","terms","durationperiods"]})};var m=8,p=3;function a(e){var t="#ffffff";switch(b(e.timeoff,e.t,e.w,e.d,e.h,e.joiner)){case"1":t="#00ff00";break;case"?":t="#0000ff";break;case"0":t="pos"==e.type?"#ffffff":"#ff0000";break;case"O":t="#8080ff";break;case"D":t="#0000ff"}return x.createElement("div",{style:{backgroundColor:t}})}function _(t){var n=t.struct;return x.createElement("div",{className:"row"},T.rangeFromTo(n.hodinyOd,n.hodinyDo).map(function(e){return x.createElement(a,S.__assign({key:e},S.__assign(S.__assign({},t),{h:e,firstCell:e==n.hodinyOd})))}))}function h(s){var e=s.dbi,t=s.maxHeight,r=D(s.timeoff||u,e),i=d(e),n=m,a=p;t&&i.nDays*a+1>t&&(a=2);var o=i.hodinyDo-i.hodinyOd+1;return x.createElement(T.RScopedStyle,{style:s.style,rules:{"div.row":{display:"flex",flexFlow:"row",alignItems:"stretch",maxWidth:n*o-1,height:a,boxSizing:"border-box",borderBottom:"1px solid black"},"div.row:first-of-type":{height:a+1,borderTop:"1px solid black"},"div.row > div":{flexShrink:1,width:n-1,borderRight:"1px solid black"},"div.row > div:first-of-type":{borderLeft:"1px solid black"}}},T.rangeFromTo(0,i.nDays-1).map(function(e){var t,n;return x.createElement(_,{key:e,timeoff:r,struct:i,t:null!==(t=s.t)&&void 0!==t?t:-1,w:null!==(n=s.w)&&void 0!==n?n:-1,d:e,type:s.type,joiner:s.joiner||y})}))}(e.MiniTimeoff=h).ttdbi={needed_part:n.typed({terms:[],weeks:[],days:[],periods:[]})}},"/substitution/online/rightpanel.js":function(e,require,t){e.__esModule=!0;var Z=require("tslib"),$=require("react"),k=$.Fragment,X=require("../../asc/asc_react"),Q=require("../subst"),ee=require("../server/commands"),te=require("../../rpr/dbi"),ne=require("../../asc/actions"),se=require("./timetable"),Y=require("./combo"),J=require("../../asc/edurequest"),re=require("../server/settings"),ie=require("../../timetable/ttitem"),ae=require("../../asc/asc_react2"),oe=require("../../rpr/dbi_react"),le=require("../../react/menu"),ue=require("../../asc/lib_date"),f=require("../commands"),l=require("../../dashboard/dbi_events"),ce=require("../../react/popuppanel"),u=require("../../calendar/event_popup"),de=require("./subst_popup"),me=[{id:"date",name:"{1465}"},{id:"week",name:"{tt:3855}"},{id:"month",name:"{tt:3854}"},{id:"year",name:"{1578}"}];function pe(e){var t=e.tv,n=t.ttitem,s=t.naming_dbi,r=t.join_doubles,i=X.useReq(),a=X.useColors();if(!n)return null;var o=Z.__assign(Z.__assign({},n),n.orig||{}),l="",u=s.tools.ttitem_popis(o,"short");"."!=(l=u.period).substr(l.length-1)&&(l+="."),l+=" ",l+=u.subject,l+=" ",l+=s.rowNames("teachers",o.teacherids,1<o.teacherids.length?"short":""),l+=" ",l+=u.class,"classroomsupervision"==n.type&&(l=u.period,l+=" ",l+=u.classroom,l+=" ",l+=" "+s.rowNames("teachers",o.teacherids));var c="";if(n.changes)for(var d=0,m=n.changes;d<m.length;d++){var p=m[d];if(p.new){""!=c&&(c+=" ");var b="groupnames"==p.column?"groupnames":Q.changeColumn2table(p.column);b||ASC.dieError("9589868469"),c+=s.tools.rowName(b,p.new,"teachers"==b?i.sort_name_col:"short")}}return""!=c&&(l+=" -> "+c),$.createElement("div",{style:{textAlign:"center",color:a.darkMode?a.fgBlack:"#00156e",paddingTop:4,fontSize:11,fontWeight:"bold",cursor:"default",flex:"0 0 auto",position:"relative"},title:"",onClick:function(){f.showTTItemEditDlg(n.id,r)}},l)}function be(e){var t=e.tv,n=t.ttitem,s=t.combo_items,r=t.table,i=t.sel_item;return n&&r?$.createElement($.Fragment,null,s.map(function(e){return $.createElement(p,{key:e.id,tv:t,table:r,id:e.id,item:e,sel:!!i&&e.id==i.id})})):null}function fe(e){var i=e.tv,a=i.dbi,t=i.ttitem,n=i.table,o=X.useColors();if(!t)return null;var s=Z.__assign(Z.__assign({},t),t.orig||{}),l=[t.uniperiod];if(1<t.durationperiods)for(var r=1;r<t.durationperiods;r++)l.push(te.DBITools.uniperiod_delta(t.uniperiod,r));var u=i.tlr;u.clear();for(var c=0,d=a.tableIds("periods");c<d.length;c++){var m=d[c];u.addItem("main",{uniperiod:m})}return a.rowData("periods",t.uniperiod)||u.addItem("main",{uniperiod:t.uniperiod,endtime:t.endtime}),u.render(),$.createElement($.Fragment,null,$.createElement("div",{style:{height:u.qSize,position:"relative"}},i.kriteriaCols.map(function(e,t){return $.createElement(X.RTextBox,{x1:i.nameWidth+t*_e,y1:0,x2:i.nameWidth+(t+1)*_e,y2:u.qSize,key:""+t,text:"teachers"==n?e.name[0]:"",title:e.name,hAlign:"center",vAlign:"center"})}),u.renderOrderItems().map(function(e,t){var n=e.data.uniperiod,s=u.item2box(e,i.ttOffset);if(n){var r=["period"];return 0<=l.indexOf(n)&&r.push("sel"),$.createElement(X.RTextBox,Z.__assign({},s,{key:n,style:{position:"absolute",textAlign:"center",color:o.fgBlack,fontSize:10,fontWeight:"bold",paddingTop:2,paddingBottom:2,backgroundColor:l.includes(n)?"#ffff00":void 0},className:r.join(" "),text:a.tools.uniperiodName(n,"short"),hAlign:"center",vAlign:"center"}))}return null})),0<s.classids.length&&$.createElement($.Fragment,null,$.createElement("div",{className:"row",style:{height:0,borderBottom:"1px solid #c5bdc5"}}),s.classids.map(function(e,t){return $.createElement(p,{key:""+t,tv:i,table:"classes",id:e,isHeader:!0})})))}function p(e){var _=e.tv,h=e.isHeader,g=e.table,v=e.id,y=e.item,t=e.sel,E=_.ttitems,w=_.absents,n=_.online,S=_.dbi,s=_.date,x=_.ttitem,r=_.onRowDoubleClick,T=_.onRowPeriodClick,i=_.colorblind,a=X.useReq(),o=X.useColors(),l=_.stats_mode,u=_.stats_dbi,C=[x.uniperiod];if(1<x.durationperiods)for(var c=1;c<x.durationperiods;c++)C.push(te.DBITools.uniperiod_delta(x.uniperiod,c));var d=["row"],m=[];e.sel&&d.push("sel"),y&&(y.ft||y.frh?m.push("#0000ff"):y.fu&&m.push("#00ff00"),y.fp&&m.push("#f5ca70"));var p=!1,b=o.fgBlack;return y&&(p=y.cb_hidden||y.subst_hidden||y.filter_out,y.fd&&(b="#00ffff"),p&&(b=o.fgGrey),y.fx&&(b="#ff0000")),$.createElement("div",{className:d.join(" "),style:{height:_.rowHeight,position:"relative",borderBottom:"1px solid #c5bdc5",backgroundColor:t?"#33ae66":void 0,backgroundImage:t&&i?"url(/global/pics/ui/textures/w_h.png)":void 0},onClick:y?function(){return _.setSel_item(y)}:null,onDoubleClick:function(){!h&&r&&r(y.id)}},$.createElement("div",{title:S.rowName(g,v,a.sort_name_col),style:X.rtlCss({position:"absolute",left:0,top:0,bottom:0,paddingLeft:2,paddingRight:2,display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontSize:10,fontWeight:p?"normal":"bold",overflow:"hidden",whiteSpace:"nowrap",cursor:"default",width:_.nameWidth,boxSizing:"border-box",color:b,textDecoration:p?"line-through":void 0}),onContextMenu:function(e){if(e.preventDefault(),n){var t=Z.__spreadArrays(n.timetableMenu(g,v));le.showMenu(t,e,{header:S.rowName(g,v,a.sort_name_col)})}}},S.rowName(e.table,e.id,"short"),$.createElement(A,{farby:m}),h&&$.createElement(N,{nameWidth:_.nameWidth,setNameWidth:_.setNameWidth})),_.kriteriaCols.map(function(e,t){return $.createElement("div",{key:e.id,style:X.rtlCss({position:"absolute",boxSizing:"border-box",top:0,bottom:0,left:_.nameWidth+t*_e,width:_e,borderLeft:"1px solid #c5bdc5",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",color:"#808080"})},"teachers"==g&&e.render({stats_dbi:u,date:s,teacherid:v,stats_mode:l}))}),function(){var l=_.tlr;l.clear();for(var e=new Set,t=0,n=E;t<n.length;t++){var s=n[t];if(ie.ttitemFilterMatch(te.unpartial(s),g,v)||s.orig&&ie.ttitemFilterMatch(te.unpartial(s.orig),g,v)){for(var r=s.uniperiod,i=s.durationperiods,a=0;a<(i||1);a++){var o=te.DBITools.uniperiod_delta(r,a);C.includes(o)&&e.add(o)}var u="classroomsupervision"==s.type,c={uniperiod:r,ttitem:s,endtime:s.endtime,durationperiods:s.durationperiods,type:u?"classroomsupervision":"",classids:s.orig?s.orig.classids:s.classids};l.addItem(u?"supervision":"main",c)}}if(x.uniperiod)if(0==e.size){c={uniperiod:x.uniperiod,endtime:x.endtime,durationperiods:x.durationperiods};l.addItem("b"==x.uniperiod[0]?"supervision":"main",c)}else for(var d=0,m=C;d<m.length;d++){r=m[d];if(!e.has(r)){c={uniperiod:r,endtime:x.endtime};l.addItem("b"==x.uniperiod[0]?"supervision":"main",c)}}for(var p=0,b=w;p<b.length;p++){var f=b[p];Q.absentGetTable(f)==g&&Q.absentGetId(f)==v&&l.addItem("autobottom",{uniperiod:te.DBITools.getUniPeriod(f)||"ad",durationperiods:f.durationperiods,absent:f,classids:"classes"==g?[v]:[]})}return l.items.sort(function(e,t){var n=e.data.ttitem,s=t.data.ttitem;return n?s?n.added?-1:s.added?1:n.cancelled?1:s.cancelled?-1:s.changes.length-n.changes.length:-1:1}),l.render(),$.createElement("div",{style:X.rtlCss({position:"absolute",left:_.ttOffset,top:0,bottom:0})},S.tableIds("periods").map(function(e){var t=l.data2t({uniperiod:e}),n=l.t2p(t.t1),s=l.t2p(t.t2);return $.createElement(k,{key:e},$.createElement(X.RBox,{x1:n,y1:0,x2:n+1,y2:l.qSize,style:{backgroundColor:"#c5bdc5"}}),$.createElement(X.RBox,{x1:s,y1:0,x2:s+1,y2:l.qSize,style:{backgroundColor:"#c5bdc5"}}))}),l.renderOrderItems().map(function(e,t){var n=e.data,s=n.ttitem,r=n.absent,i=n.uniperiod,a=l.item2box(e,0,-1);if(r)return $.createElement(D,Z.__assign({key:t},a,{tv:_,absent:r}));if(null==s?void 0:s.eventid){var o=S.rowData("events",s.eventid);return o&&$.createElement(I,Z.__assign({key:t},a,{tv:_,event:o}))}return $.createElement(R,Z.__assign({key:t},a,{tv:_,table:g,id:v,item_uniperiod:x.uniperiod,ttitem:s,je_sel_subst:s?s.id==x.id||te.idsIsOverlap(s.substids,x.substids):C.includes(i),selFn:e&&e.data.uniperiod==x.uniperiod&&!h&&T?function(e){_.setSel_item(y),T(v,e)}:null}))}))}())}function D(e){var t=e.absent,n=J.client_req.ls(1622),s=ce.useSimplePopup(),r=s[0],i=s[1],a=s[2];return $.createElement($.Fragment,null,$.createElement(X.RBox,{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,className:"cell chyba_cast",title:n||void 0,style:{borderBottomWidth:1,overflow:"visible"},onContextMenu:function(e){return i(e)}}),a&&$.createElement(r,null,$.createElement(de.AbsentPopup,{absentid:t.id,where:"subst"})))}function I(e){var t=e.event,n=e.tv.dbi,s=ce.useSimplePopup(),r=s[0],i=s[1],a=s[2],o=l.eventName(n,t);return $.createElement($.Fragment,null,$.createElement(X.RBox,{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,className:"cell event",title:o||void 0,style:{borderBottomWidth:1,overflow:"visible"},onContextMenu:function(e){return i(e)}}),a&&$.createElement(r,null,$.createElement(u.EventPopup,{eventid:t.id,where:"subst"})))}function R(e){var t=this,n=e.tv,r=e.ttitem,s=e.table,i=e.id,a=e.item_uniperiod,o=n.date,l=n.absents,u=n.ttitem,c=n.join_doubles,d=n.dbi,m=n.tt_dbi,p=d.req,b=ce.useSimplePopup(),f=b[0],_=b[1],h=b[2],g=["cell"],v="",y=null,E="",w=Z.__assign(Z.__assign({},u),u.orig||{});if(e.je_sel_subst&&g.push("sel"),r){var S=!1,x=!1,T=!1;if("classes"==s){for(var C=0,k=r.changes;C<k.length;C++){var D=k[C],I=Q.changeColumn2table(D.column);"teachers"!=I&&"classes"!=I||(x=!0)}if(u&&0==r.changes.length&&"period"==te.DBITools.typeOfUniPeriod(r.uniperiod)&&"period"==te.DBITools.typeOfUniPeriod(a)&&parseInt(r.uniperiod)>parseInt(a)&&(u.durationperiods||1)==(r.durationperiods||1)){var R=Z.__assign(Z.__assign({},r),{uniperiod:a});0==se.getSubstTTItemKolizie(d,m,R,Z.__spreadArrays([u.id],u.join_ttitemids||[])).length&&(y={text:ASC.ttls(3195),onClick:function(){return Z.__awaiter(t,void 0,void 0,function(){var t,n,s;return Z.__generator(this,function(e){switch(e.label){case 0:return t=d.tools.ttitem_popis(u.cancelled?u.orig:u),(n=d.tools.ttitem_popis(r)).period+=" -> "+d.tools.ttitem_popis(R).period,s=function(e){return[e.period,e.subject,e.class,e.teacher].join(", ")},barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstOnline.suggested_move_view",eventLabel:""}),[4,X.RDialog.showConfirm($.createElement($.Fragment,null,$.createElement(ae.DlgHeader,{title:p.ttls(3195),icon:"/substitution/pics/subst_move_64.png",small:!0}),$.createElement("div",null,$.createElement("h2",null,p.ttls(1476)+":"),s(t),$.createElement(X.VGap,{height:20}),$.createElement("h2",null,p.ttls(3194)+":"),s(n),$.createElement(X.VGap,{height:20}))),{buttons:[{label:p.ttls(3194),type:"green",action:"move"},"cancel"],footer:$.createElement(X.RButton,{label:ne.action_name("help"),fa_icon:ne.action_fa_icon("help"),onClick:function(){return window.open("https://help.asctimetables.com/text.php?id=638","_blank")}}),width:500})];case 1:return e.sent()?(barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstOnline.suggested_move_op",eventLabel:""}),u.cancelled?[3,3]:[4,ASC.blockUI(ee.removeSubstOnlineTTItem(null,u.id,1<u.durationperiods))]):[3,5];case 2:e.sent(),e.label=3;case 3:return[4,ASC.blockUI(ee.updateSubstTTItem(null,r.id,{uniperiod:a},{},1<r.durationperiods))];case 4:e.sent(),e.label=5;case 5:return[2]}})})}})}}else{for(var A=0,N=r.substids;A<N.length;A++)for(var B=N[A],j=0,P=d.rowData("substonline_substitutions",B).changes;j<P.length;j++){D=P[j];if(Q.changeColumn2table(D.column)==s&&D.new==i&&D.old!=i){x=!0;break}}for(var M=0,O=l;M<O.length;M++){var z=O[M];Q.absentGetTable(z)==s&&Q.absentGetId(z)==i&&Q.substTTItem_absent_match_time(r,z)&&(S=!0)}if(ie.ttitemUniperiodMatchSimple(te.unpartial(r),a)&&te.idsIsOverlap(w.classids,r.classids)){T=!0;for(var F=0,L=[w.subjectid,r.subjectid];F<L.length;F++){var G=L[F],U=d.rowData("subjects",G);U&&U.subst_join_forbidden&&(T=!1)}}}if(ie.ttitemFilterMatch(te.unpartial(r),s,i))g.push("uci"),x||r.added?g.push("subst"):T&&g.push("spoj");else if(r.orig&&ie.ttitemFilterMatch(te.unpartial(r.orig),s,i))if(r.cancelled&&0<r.origofids.length){g.push("class_cancelled");var q=r.origofids[0],H=q.split(":")[0],V=void 0;if(H!=o)V=ue.date_format_date(p,H,!1),E=o<H?"down":"up";else{var W=d.rowData("substonline_ttitems",q);V=d.tools.uniperiodName(W.uniperiod),W&&(E=parseInt(W.uniperiod)<parseInt(r.uniperiod)?"left":"right")}v=p.lsf(7442,{date:V})}else"classes"==s||S||r.cancelled&&!r.cancelled_absent?g.push("cancelled"):g.push("mal_ucit");1<te.idsArrayUnique(r.teacherids).length&&g.push("teamteaching"),y&&g.push("move_sipocka");var K=function(e){var t=d.rowName("subjects",e.subjectid,"short");return t+=" ",t+=d.rowNames("classes",e.classids,"short"),0<e.groupnames.length&&!te.DBITools.groupnamesIsEntireClass(e.groupnames)&&(t+=" ("+d.tools.groupnames_names(e.groupnames)+")"),t+=" ",t+=d.rowNames("teachers",e.teacherids,"short"),t+=" ",t+=d.rowNames("classrooms",e.classroomids,"short")};r.cancelled?r.orig&&(v=p.ttls(1476)+": "+K(r.orig)):v=K(te.unpartial(r))}var Y=null,J=null;return r&&(J=function(e){return _(e)},y&&(Y=J)),e.selFn&&(Y=e.selFn,J=J||Y),$.createElement($.Fragment,null,$.createElement(X.RBox,{x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,className:g.join(" "),title:v||void 0,style:{cursor:e.selFn?"pointer":"",borderBottomWidth:1,overflow:"visible",backgroundImage:E?"none":void 0},onClick:function(e){ASC.hidePopups(e),Y&&Y(e)},onContextMenu:function(e){ASC.hidePopups(e),J&&J(e)}},E&&$.createElement("i",{className:"fa fa-arrow-"+X.rtlStr(E),style:X.rtlCss({position:"absolute",left:1,top:1,fontSize:12,color:"red",textShadow:"rgba(0,0,0,0.5) 0px 1px"})})),h&&$.createElement(f,null,$.createElement(de.SubstTTItemPopup,{ttitem:r,where:"subst",join_doubles:c,footer:y&&$.createElement(X.RButton,{content:y.text,onClick:y.onClick})})))}function A(e){var t=e.farby;if(0==t.length)return null;var n={position:"absolute",right:0,top:0,bottom:0,width:2};if(1==t.length)return $.createElement("div",{className:"pruzok",style:Z.__assign(Z.__assign({},n),{backgroundColor:t[0]})});function s(e){return e/t.length*100+"%"}return $.createElement("div",{style:X.rtlCss(Z.__assign(Z.__assign({},n),{background:"linear-gradient(to bottom,"+t.map(function(e,t){return e+" "+s(t)+","+e+" "+s(t+1)}).join(",")+")"}))})}function N(e){var t=X.useStateAsValueRef([e.nameWidth,e.setNameWidth]),n=X.useMouseResize(t,{axis:"x",min:20,max:150});return $.createElement("div",{style:{position:"absolute",top:0,right:0,bottom:0,width:3,cursor:"ew-resize"},onMouseDown:n})}function v(e,t,n,s){var r=e.req;return"date"==t?e.rowData("substonline_teacher_date",n+":"+s):"week"==t?e.rowData("substonline_teacher_week",ue.date_week(r,n)+":"+s):"month"==t?e.rowData("substonline_teacher_month",n.substr(0,7)+":"+s):e.rowData("substonline_teacher_year",r.getSchoolYear(n)+":"+s)}e.TeachersPanelHeader=pe,p.needed_part=te.typed({substonline_ttitems:["type","endtime","added"]});var _e=25;function he(e){var t=[],n=e.table("substonline_teacher_month");if(n)for(var s=function(l){var e=n.column(l);if("int"!=e.type())return"continue";t.push({id:"sc_"+l,name:e.name(),render:function(e){var t=e.stats_dbi,n=e.date,s=e.teacherid,r=v(t,e.stats_mode,n,s),i=r?r[l]:0;if("de_plusminus"!=l)return i;var a="#00b050",o="normal";return 3==i&&(a="#c55a11",o="bold"),3<i&&(a="red",o="bold"),$.createElement("span",{style:{color:a,fontWeight:o}},i)}})},r=0,i=n.columns();r<i.length;r++){s(i[r])}return t}function n(e){var t,n,s=e.online,m=e.dbi,r=e.tt_dbi,i=e.date,a=e.filter,o=e.table,l=e.topid,u=e.ttitemid,c=e.onRowSelect,d=e.onRowDoubleClick,p=e.onRowPeriodClick,b=e.join_doubles,f=m.req,_=X.useColors(),h=(null===(n=m.rowData("global_settings","1"))||void 0===n?void 0:n.subst_online_ui)||{grid_mode:"periods",kriteria_cols:[]},g=!!m.rowData("substonline_dates",i).uploaded_int,v=$.useMemo(function(){return Q.buildSubstOnlineTTItemsEx(m,i,b)},[m,i,b]),y=u?v.find(function(e){return e.id==u}):null,E=$.useMemo(function(){return o&&y?Y.substTTItemComboItems({table:o,ttitem:y,dbi:m,tt_dbi:r,filter:a,remove_ttitemids:Z.__spreadArrays([y.id],y.join_ttitemids||[]),topid:l}):[]},[o,y,m,r,a,l]),w=X.useLocalState("SubstOnline.TeachersView.stats_mode","month"),S=w[0],x=w[1],T=$.useState(null),C=T[0],k=T[1],D=C?C.id:"";$.useEffect(function(){c&&c(D)},[D]),$.useEffect(function(){k(E[0]||null)},[i,u,l]);for(var I=X.useClientWidth(),R=I[0],A=I[1],N=f.isApp()?30:19,B=X.useLocalState("SubstOnline.TeachersView.nameWidth",33,{where:"localStorage"}),j=B[0],P=B[1],M=h.kriteria_cols,O=j,z=[],F=0,L=he(m);F<L.length;F++){var G=L[F];M.indexOf(G.id)<0||(z.push(G),O+=_e)}var U=se.TTLR_TProvider_uni(h.grid_mode,m,{tt_dbi:r}),q=new se.TimetableLayoutRenderer(R-O-25,2+N,U.minT,U.maxT);q.data2t=function(e){return U.t(e)},q.qSide=7,q.gap=-1;var H=oe.useMainDBI("month"!=S?f.getSchoolYear(i):null,{needed_part:(t={},t["substonline_teacher_"+S]=["absent","cancelled","substing","sv_substing","duty","de_plusminus"],t),vt_filter:{date:i}})||m,V=s?s.naming_dbi:new te.MergeDBI(m,r),W=(m.rowData("global_settings","1")||{}).colorblind,K={online:s,date:i,req:f,dbi:m,stats_dbi:H,tt_dbi:r,naming_dbi:V,table:o,ttitem:y,combo_items:E,onRowDoubleClick:d,onRowPeriodClick:p,uiSettings:h,join_doubles:b,ttitems:v,absents:m.tableFilterData("substonline_absents",{date:i}),stats_mode:S,setStats_mode:x,sel_item:C,setSel_item:k,rowHeight:N,nameWidth:j,setNameWidth:P,ttOffset:O,tlr:q,kriteriaCols:z,colorblind:W};return $.createElement(X.RScopedStyle,{ref:A,style:{display:"flex",flexDirection:"column",flex:"1 1 0px",position:"relative"},rules:{".cell":{position:"absolute",border:"1px solid #c5bdc5",borderBottomWidth:0,top:-1,bottom:0},".cell.sel":{backgroundColor:"#ffff00",backgroundImage:W?"url(/global/pics/ui/textures/b_v.png)":void 0},".header .cell.sel:before":{position:"absolute",left:-2,top:-2,right:-2,bottom:-1,content:'" "',border:"2px solid black",zIndex:2},".cell.teamteaching":{backgroundImage:"url(/substitution/pics/teamteaching.png)",backgroundRepeat:"no-repeat",backgroundPosition:"top 1px right 1px"},".cell.move_sipocka":{backgroundImage:"url(/substitution/pics/move_sipocka.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center"},".cell.uci, .cell.uci.mal_ucit":{backgroundColor:"#fec2c2"},".cell.mal_ucit":{backgroundColor:"#00ffff",backgroundImage:W?"url(/global/pics/ui/textures/b_d1.png)":void 0},".cell.spoj":{backgroundColor:"#bffc07",backgroundImage:W?"url(/global/pics/ui/textures/b_dots.png)":void 0},".cell.chyba_cast":{backgroundColor:"#7b7b7b",backgroundImage:W?"url(/global/pics/ui/textures/w_d2.png)":void 0},".cell.event":{backgroundColor:"#d0ffd0"},".cell.class_cancelled, .cell.cancelled":{backgroundColor:"#c0c0c0"},".cell.subst":{backgroundColor:"#ff0000",backgroundImage:W?"url(/global/pics/ui/textures/w_chess.png)":void 0},".cell.subst.mal_ucit":{boxShadow:"0px 0px 0px 2px #00ffff inset"}}},!g&&y&&$.createElement($.Fragment,null,$.createElement(pe,{tv:K}),$.createElement("div",{className:"tt",style:{flex:"1",display:"flex",flexDirection:"column",paddingLeft:4,paddingRight:4,backgroundColor:_.bgWhite}},$.createElement("div",{className:"header",style:{flex:"0 0 auto",overflow:"hidden"}},$.createElement(fe,{tv:K})),$.createElement("div",{style:{borderTop:"1px solid #000000",flex:"1 1 0px",overflowX:"hidden",overflowY:"auto"}},$.createElement(be,{tv:K})),$.createElement(ge,{tv:K,stats_mode:S}))),0<E.length&&!f.isApp()&&$.createElement(ve,{style:{position:"absolute",left:1,top:3},fa_icon:"caret-down",title:ne.action_name("customize"),onClick:function(e){for(var n=[],t=function(e){n.push({text:e.name,checked:e.id==h.grid_mode,onClick:function(){return re.updateSubstOnlineUISettings(null,{grid_mode:e.id})}})},s=0,r=se.gridModes;s<r.length;s++){t(r[s])}n.push([]);for(var i=h.kriteria_cols,a=function(t){var e=0<=i.indexOf(t.id);n.push({text:t.name,checked:e,onClick:function(){return re.updateSubstOnlineUISettings(null,{kriteria_cols:e?i.filter(function(e){return e!=t.id}):Z.__spreadArrays(i,[t.id])})}})},o=0,l=he(m);o<l.length;o++){a(l[o])}n.push([]);for(var u=function(e){n.push({text:J.client_req.localize(e.name),checked:e.id==K.stats_mode,onClick:function(){return K.setStats_mode(e.id)}})},c=0,d=me;c<d.length;c++){u(d[c])}le.showMenu(n,e.currentTarget),e.preventDefault(),e.stopPropagation()}}))}function ge(e){var t=e.tv,n=e.stats_mode,s=t.date,r=t.dbi,i=t.stats_dbi,a=t.naming_dbi,o=t.sel_item,l=t.ttitem,u=t.table||"teachers",c=o&&o.id,d=r.req,m=null;if(l&&o){var p={display:"inline-block",width:"110px",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},b=function(e){var t=e.b;return $.createElement("span",{style:Z.__assign(Z.__assign({},p),{color:t<0?"#800000":t?"#000080":"#808080"}),title:e.name},e.name)},f=function(e){var t=r.column("global_settings","subst_online_criteria",e);return t?t.name():e},_=null;"teachers"==u&&(_=r.rowData("teacher_beeps",s+":"+c));var h="teachers"==u?v(i,n,s,c):null,g=function(e){var t=r.column("substonline_teacher_month",e);return t?$.createElement($.Fragment,null,$.createElement(b,{name:t.name()+":",b:1}),h&&h[e]||0):null};m=$.createElement($.Fragment,null,$.createElement("div",{style:{height:"20px"}}),$.createElement("div",null,$.createElement("span",{style:Z.__assign(Z.__assign({},p),{fontWeight:"bold"})},ASC.ttls(2071)),$.createElement("span",{style:Z.__assign(Z.__assign({},p),{fontWeight:"bold"})},a.rowName(u,c,d.sort_name_col))),$.createElement("div",{style:{height:"5px"}}),"teachers"==u&&$.createElement($.Fragment,null,$.createElement("div",{style:{flex:"1 1 50px"}},$.createElement(b,{name:f("assign"),b:o.fa}),$.createElement(b,{name:f("teachesclass"),b:o.fu}),$.createElement(b,{name:f("classteacher"),b:o.ft}),$.createElement(b,{name:f("approbation"),b:o.fp}),$.createElement(b,{name:f("join"),b:o.fj}),$.createElement(b,{name:ASC.ttls(2153),b:-o.fx}),$.createElement(b,{name:f("duty"),b:o.fd}),o.filter_out&&$.createElement(b,{name:d.ls(1838),b:-1}),_&&$.createElement("span",{style:{display:"block",marginTop:"5px"}},_.text),d.isAscDevelop()&&$.createElement("span",{style:{color:"#a0a0a0",marginTop:5}},"p=",o.priorita," fa=",o.fa," fq=",o.fq)),$.createElement("div",{style:{height:50}},$.createElement("div",{style:{borderBottom:"1px solid #282873"}},"month"==n?ASC.ttls(2197):J.client_req.localize("{1011} - "+J.client_req.localize(me.find(function(e){return e.id==n}).name))),g("substing"),$.createElement(k,null,$.createElement(X.HGap,{width:20}),g("sv_substing")),$.createElement("br",null),g("absent"),$.createElement(X.HGap,{width:20}),g("cancelled"),$.createElement("br",null),g("duty"),$.createElement(X.HGap,{width:20}),g("de_plusminus"))))}return $.createElement("div",{className:"info",style:{flex:"0 0 200px",height:"200px",display:"flex",flexDirection:"column"}},m)}function ve(e){var t=X.useHover(),n=t[0],s=t[1];return $.createElement("i",Z.__assign({},s,{className:"fa fa-"+e.fa_icon,style:X.rtlCss(Z.__assign({fontSize:12,color:"#c0c0c0",backgroundColor:n?"#e0e0e0":void 0,padding:"3px 7px",cursor:"pointer"},e.style)),title:e.title,onClick:e.onClick}))}he.needed_part=te.typed({substonline_teacher_month:["absent","cancelled","substing","sv_substing","duty","de_plusminus"]}),(e.TeachersView=n).npp=te.neededPartProvider(function(){return[Y.substTTItemComboItems,Q.buildSubstOnlineTTItemsEx,se.TTLR_TProvider_uni,p,ge,he,{global_settings:["colorblind","subst_online_ui"]}]}),n.ttdbi={npp:te.neededPartProvider(function(){return[Y.substTTItemComboItems.ttdbi]})},ge.needed_part=te.typed({teacher_beeps:["text"],substonline_teacher_month:["absent","cancelled","substing","sv_substing","duty","de_plusminus"]}),e.MenuIcon=ve},"/substitution/server/commands.js":function(e,require,t){t.implementRpc(["getSubstPublishData","updateSubstPublishData","publishDay","unpublishDay","removeSubstOnlineTTItem","uncancelSubstOnlineTTItem","updateSubstTTItem","updateSubstSubstitution","updateSubstSubstitutionAddCard","addSubstSubstitution","removeSubstSubstitution","absentEditWrite","removeAbsent","cancelSubstMove","deleteSubstDay","getAbsentLessons","getSubstDateFieldData","setDateTcardsSubst","updateSubstIgnoreKolizie","substStudentsEditWrite"])},"/substitution/online/timetable.js":function(d,require,e){d.__esModule=!0;var se=require("tslib"),re=require("react"),ie=require("../../rpr/dbi"),ae=require("../../asc/edurequest"),oe=require("../../asc/svg"),le=require("../subst"),_=require("../server/commands"),ue=require("../../asc/asc_react"),p=require("../../asc/actions"),B=require("../../timetable/ttitem"),W=require("../../asc/asc_react2"),ce=require("../../dashboard/dbi_events"),de=require("../../timetable/timeoff_r"),K=require("../../asc/lib_date"),Y=require("../../rpr/dbi_react"),b=require("./combo"),me=require("../../timetable/ttview_components"),J=require("../../react/combobox"),D=require("../../react/menu"),Z=require("../../react/prevnextarrows"),l=require("./editduties"),$=require("../../react/popuppanel"),X=require("./subst_popup"),m=require("../../calendar/event_popup"),Q=require("../../react/anchor"),pe="substonline_absents",ee="substonline_substitutions",te="substonline_ttitems",be="substonline_dates",ne="#fec2c2",fe="#00ffff",_e="#ff0000",he="#C0C0C0",ge="#c0c0c0",ve="#ff0000",ye="#8080ff",Ee="#40ff40",we="#0000FF",Se="#00FFFF",xe="{tt:3194}",Te="{7856}",Ce="{3894}";function ke(e){var t=this,n=re.useRef(),s=ue.useReq(),r=s.isApp(),i=e.onGoToDate,a=ue.useStateRef(e.join_doubles),o=a[0],l=a[1],u=re.useState({table:e.table,id:e.id}),c=u[0],d=c.table,m=c.id,p=u[1],b=s.getSchoolYear(e.date),f=s.schoolYear_turnOver(b),_=s.schoolYear_turnOver_end(b),h=K.date_week(s,e.date),g=re.useState(ie.strMax(K.week_start(s,h),f)),v=g[0],y=g[1],E=re.useState(ie.strMin(K.week_end(s,h),_)),w=E[0],S=E[1],x=re.useState(""),T=x[0],C=x[1],k=ue.useStateValueRef(!0),D=k.value,I=ue.useStateValueRef("periods"),R=I.value;re.useEffect(function(){return barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstTimetableDlg.open",eventLabel:""})},[]);for(var A=Y.useMainDBI(b,{needed_part:ie.DBITools.mergeNeededParts(ke),vt_filter:{datefrom:v,dateto:w}}),N="",B=0,j=A.tableData("substonline_dates");B<j.length;B++){var P=j[B];if(P.date>=v&&P.date<=w&&P.tt_num){N=P.tt_num;break}}var M=Y.useTTDBI(N,{needed_part:ie.DBITools.mergeNeededParts(ke.ttdbi,{teachers:[],classes:[],classrooms:[]})}),O=re.useRef(!0);if(O.current&&!A.mock&&(O.current=!1,e.move_substid))for(var z=0,F=A.tableData(te);z<F.length;z++){var L=F[z];if(0<=L.substids.indexOf(e.move_substid)&&!L.cancelled){C(L.id);break}}var G=null;if(T)if(o){var U=T.split(":")[0],q=le.buildSubstOnlineTTItemsEx(A,U,o,{table:"substonline_ttitems"});G=q.find(function(e){return e.id==T})}else G=A.rowData(te,T);G&&De(se.__assign({},G),{});var H={close:function(){return n.current.confirmClose()},onGoToDate:i,table:d,id:m,setItem:function(e,t){return p({table:e,id:t})},moveTTItem:G,setMoveTTItemid:C,cancelMove:function(){C(""),S(K.date_delta(v,6))}},V=re.createElement(ue.Fragment,null,re.createElement(Z.default,{onDelta:function(e){return function(e){void 0===e&&(e=!1);var t=ie.DBITools.splitItemsForCombo(A.tableData(d),v).map(function(e){return e.id});if(t.length){var n=t.indexOf(m)+(e?t.length-1:1);n%=t.length,p({table:d,id:t[n]})}}(e<0)}}),re.createElement(ue.HGap,null),re.createElement(Q.RAnchor,{label:re.createElement(re.Fragment,null,A.table(d).itemName()+" "+A.rowName(d,m),re.createElement(ue.HGap,null),re.createElement("i",{className:"fa fa-caret-down"})),style:{color:"inherit"},menu:ie.DBITools.splitItemsForCombo(A.tableData(d),v).map(function(e){var t=e.cb_hidden,n=e.dateto;return n&&n<v&&(t=!0),{text:A.rowName(d,e.id,ae.client_req.sort_name_col),checked:m==e.id,onClick:function(){return p({table:d,id:e.id})},className:t?"cb_hidden":""}})}));return re.createElement(ue.RDialog,{controlRef:n,header:s.ls(1001)+" + "+s.ls(1003),width:920,height:600,buttons:r?[]:["close"],backgroundColor:"#ffffff",footer:re.createElement(ue.Fragment,null,[-7,7].map(function(e){var t=!0;return e<0&&v<=f&&(t=!1),0<e&&_<=w&&(t=!1),re.createElement(ue.RButton,{key:e,label:e<0?"<< "+s.ls(1729):s.ls(1729)+" >>",onClick:t?function(){G?e<0?y(K.date_delta(v,e)):S(K.date_delta(w,e)):(y(K.date_delta(v,e)),S(K.date_delta(w,e)))}:void 0})}),r||re.createElement(re.Fragment,null,re.createElement(ue.HGap,{width:10}),re.createElement("span",null,s.ls(1691),": "),re.createElement(J.default,{valueRef:I,items:[{value:"periods",name:s.ls(6399)},{value:"time",name:s.ls(1345)}]}),re.createElement(ue.HGap,{width:10}),re.createElement("span",null,s.ls(1489),": "),re.createElement(ue.RCheckBox,{label:s.ls(1844),valueRef:k}),re.createElement(ue.HGap,null),re.createElement(ue.RCheckBox,{label:s.ls(9339),valueRef:l}))),allowMaximizeBtn:!0},re.createElement("div",{style:{flex:"1 1 0px",display:"flex",flexDirection:"column"}},G?re.createElement(Ie,{dlg:H,dbi:A,move_ttitem:G}):re.createElement(W.DlgHeader,{title:V,icon:"/global/pics/ui/timetables_48.svg",right:M&&M.rowData(d,m)&&re.createElement(Q.RAnchor,{label:s.ls(8735),style:{alignSelf:"start"},onClick:function(){return se.__awaiter(t,void 0,void 0,function(){return se.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../../timetable/ttviewer")})];case 1:return[2,e.sent().showTTViewerDlg({num:N,user:ie.DBITools.rowid2user(d,m)})]}})})}})}),re.createElement(Ae,{where:"timetable",style:{flex:"1"},datefrom:v,dateto:w,dbi:A,tt_dbi:M,table:d,id:m,show_moves:!0,show_events:D,move_ttitem:G,grid_mode:R,join_doubles:o,dlg:H}),G&&!r&&re.createElement(Re,null)))}function De(e,t){if(0==e.teacherids.length&&e.orig&&1==e.orig.teacherids.length){var n=e.orig.teacherids;t.teacherids=n,e.teacherids=n}e.starttime&&(e.starttime=void 0,e.endtime=void 0)}function I(a,o,l,u,e,t,n){void 0===n&&(n={});var c=0,d=1,m=function(e,t){return t?d:c},p=new B.TTItemTimeProvider(a),b=n.periods||a.tableData("periods"),f=new Map;function s(e){var t={t1:c,t2:d,wasAligned:!1};if(e.starttime&&e.endtime||!e.date||((e=se.__assign({},e)).uniperiod||(e.uniperiod=ie.DBITools.getUniPeriod(e)),e.classids||(e.classids=e.classid?[e.classid]:[]),p.setDate(a.rowData(l,e.date),o),p.fill(ie.unpartial(e),ie.unpartial(e))),u)e.starttime&&(t.t1=le.time2int(e.starttime)),e.endtime&&(t.t2=le.time2int(e.endtime));else{var n=e.period,s="";if(e.uniperiod){var r=ie.DBITools.typeOfUniPeriod(e.uniperiod);"period"==r&&(n=e.uniperiod),"break"==r&&(s=e.uniperiod.substr(1))}if(n){var i;if(t.t1=parseInt(n),t.t2=t.t1+(e.durationperiods||1),e.starttime)(i=f.get(n))&&i.starttime!=e.starttime&&(t.wasAligned=!0);if(e.endtime)(i=f.get(ie.DBITools.uniperiod_delta(n,(e.durationperiods||1)-1)))&&i.endtime!=e.endtime&&(t.wasAligned=!0)}else s?(t.t1=parseInt(s)-.25,t.t2=parseInt(s)+.25):(e.starttime&&(t.t1=m(e.starttime,!1)),e.endtime&&(t.t2=m(e.endtime,!0)))}return isNaN(t.t1)||isNaN(t.t2),t}b.forEach(function(e){return f.set(e.id,e)});var r={starttime:"08:00",endtime:"12:00"};if(c=s(b[0]||r).t1,d=s(b[b.length-1]||r).t2,u){c-=15,d+=15,a.req.jeZUS()&&(c=420,d=1200)}else{var _=b.map(function(e){return{t1:le.time2int(e.starttime),t2:le.time2int(e.endtime)}}),h=parseInt((b[0]||{id:"0"}).id);m=function(e,t){for(var n=0;n<b.length;n++){var s=b[n];if(e<s.starttime)return h+n;if(!(e>s.endtime)){var r=_[n],i=le.time2int(e)-r.t1;return h+n+i/Math.max(r.t2-r.t1,1)}}return h+b.length}}var i=new v(e,t,c,d);return i.data2t=function(e){return s(e.ttitem||e.absent||e.event||e)},i}function i(e){var t=e.dlg,n=e.dbi,s=e.table,r=e.id,i=t.table==s&&t.id==r;return re.createElement("a",{title:n.rowName(s,r),onClick:function(){return t.setItem(s,r)},style:{color:"#000000",textDecoration:i?"underline":"",cursor:i?"inherit":"pointer"}},n.rowName(s,r,"short"))}function Ie(e){var n=e.dlg,s=e.dbi,t=e.move_ttitem,r=s.req;return re.createElement(W.DlgHeader,{title:re.createElement(re.Fragment,null,r.ls(7441),": ",s.tools.ttitem_popis(t,"short").subject," ",t.classids.map(function(e,t){return re.createElement(ue.Fragment,{key:""+t},re.createElement(i,{dlg:n,dbi:s,table:"classes",id:e})," ")})," ",t.teacherids.map(function(e,t){return re.createElement(ue.Fragment,{key:""+t},re.createElement(i,{dlg:n,dbi:s,table:"teachers",id:e})," ")})," ",t.classroomids.map(function(e,t){return re.createElement(ue.Fragment,{key:""+t},re.createElement(i,{dlg:n,dbi:s,table:"classrooms",id:e})," ")})," ",re.createElement("span",{style:{fontSize:12}},"(",re.createElement("a",{style:{cursor:"pointer"},onClick:function(){return n.cancelMove()}},r.ls(1038)),")")),icon:le.ICON_subst_movelesson,right:r.isApp()||re.createElement(ue.RButton,{type:"",label:r.ls(1333),fa_icon:"question-circle",onClick:function(){return window.open("http://help.edupage.org/text.php?id=1870","_blank")}})})}function Re(e){var t=ue.useReq();return re.createElement("div",{style:{marginTop:5}},t.ls(6698)+": ",[[Ee,xe],[we,Te],[Se,Ce],["#808080",t.ls(1895)]].map(function(e,t){return re.createElement(ue.Fragment,{key:""+t},re.createElement("span",{style:{display:"inline-block",height:"10px",width:"10px",border:["2px",3==t?"dotted":"solid",e[0]].join(" "),verticalAlign:"middle",marginLeft:20}})," - "+ae.client_req.localize(e[1]))}))}function Ae(e){for(var t,n=ue.useClientSize(),s=n[0],r=n[1],i=n[2],a=re.useState(null),o=a[0],l=a[1],u=e.dbi,c=e.tt_dbi,d=e.move_ttitem,m=e.grid_mode,p=e.dlg,b=e.join_doubles,f=u.req,_=s-55-1,h=r-50-1,g=new Map,v=[],y=e.datefrom;y<=e.dateto;y=K.date_delta(y,1))(!K.date_isWeekend(f,y)||0<=(null!==(t=u.rowData("substonline_dates",y,{}).tt_day)&&void 0!==t?t:-1))&&v.push(y);function E(e){return{y1:Math.round(e*h/v.length),y2:Math.round((e+1)*h/v.length)}}var w=I(u,c,"substonline_dates","time"==m,_,50),S=v.map(function(e,t){return se.__assign(se.__assign({date:e},E(t)),{row:u.rowData("substonline_dates",e)})}),x={where:e.where,dbi:u,tt_dbi:c,date:v[0],table:e.table,id:e.id,tlr:w,width:s,height:r,gap:2,gap_row:6,dayWidth:55,periodHeight:50,row2y:E,nRows:v.length,show_events:e.show_events,join_doubles:b,dlg:e.dlg,setHoverMove:l},T={x1:55,x2:55+_,y1:50,y2:50+h},C={x1:T.x1,x2:T.x2+1,y1:T.y1,y2:T.y2+1},k={x1:T.x1,x2:T.x2,y1:0,y2:50};return re.createElement("div",{ref:i,style:se.__assign({position:"relative",backgroundColor:"#ffffff"},e.style)},re.createElement(me.TTView_Periods,{dbi:u,periodsBox:k,tlr:w,showTime:"time"==m}),re.createElement(me.TTView_OuterLines,{outerBox:C}),re.createElement(ue.RBox,{x1:0,x2:55,y1:50,y2:r},S.map(function(e){if(!e.row)return null;var t={x1:0,x2:55,y1:e.y1,y2:e.y2},n=[];p&&p.onGoToDate&&n.push({text:f.ttls(3812),onClick:function(){p.close(),p.onGoToDate(e.date)}});var s="",r="";return e.row.is_online?(s="/global/pics/ui/item_warning_16.png",r=f.ls(1645)):e.row.uploaded_int&&(s="/substitution/pics/uploaded_32.png",r=f.ls(2740)),re.createElement(me.TTView_Header,{key:e.date,box:t,text:re.createElement(re.Fragment,null,K.date_day_name(f,e.date,!0),re.createElement("span",{style:{fontSize:10}},K.date_format_date(f,e.date,!1))),icon:s,icon_tooltip:r,onClick:function(e){n.length&&(D.showMenu(n,e),e.preventDefault())},style:e.date<f.timezone_date()?{color:"#c0c0c0"}:void 0,splitLineTop:0<e.y1})})),re.createElement(ue.RBox,se.__assign({},T,{style:{overflow:"visible"}}),S.map(function(e){return e.row?re.createElement(N,se.__assign({},{key:e.date,tvs:se.__assign(se.__assign({},x),{date:e.date}),je_upload:!!e.row.uploaded_int,ttWidth:_,y1:e.y1,y2:e.y2,ttitems_center:g,gap_row:6})):null}),re.createElement(R,{dbi:u,ttWidth:_,ttHeight:h,move_ttitem:d,hoverMove:o,ttitems_center:g,show_moves:e.show_moves})))}function R(e){var t=e.ttWidth,n=e.ttHeight,s=e.move_ttitem,r=e.hoverMove,i=e.ttitems_center,a=e.dbi,o="url(#tien)",l=[];if(e.show_moves)for(var u=0,c=a.tableData(te);u<c.length;u++){var d=c[u];if(d.origofids.length){var m=i.get(d.id);if(m)for(var p=0,b=d.origofids;p<b.length;p++){var f=b[p],_=a.rowData(te,f);if(_){var h=i.get(_.id);h&&l.push(re.createElement("g",{stroke:s?"rgba(255,255,255,0.5)":"#ffffff",filter:o,strokeWidth:"3",strokeLinecap:"round",key:""+l.length},re.createElement(oe.RSvgArrow,{p1:m,p2:h,head_size:20,typ:"forward"})))}}}}if(s&&r){var g=i.get(s.id);g&&l.push(re.createElement("g",{stroke:r.color,filter:o,strokeWidth:"3",strokeLinecap:"round",key:""+l.length},re.createElement(oe.RSvgArrow,{p1:g,p2:r.center,head_size:20,typ:r.typ})))}return re.createElement("svg",{width:t+40+10,height:n+40+20,style:{pointerEvents:"none",position:"absolute",left:-40,top:-40,zIndex:10}},re.createElement("defs",null,re.createElement("filter",{id:"tien"},re.createElement("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"3"}),re.createElement("feOffset",{dx:"2",dy:"2",result:"offsetblur"}),re.createElement("feMerge",null,re.createElement("feMergeNode",null),re.createElement("feMergeNode",{in:"SourceGraphic"})))),re.createElement("g",{transform:"translate(40 40)"},l))}function f(e,t,n,s,r){void 0===s&&(s=[]),void 0===r&&(r=!1);var i=[],a=n.date,o=e.rowData("substonline_dates",a,{});if(0<e.tableData("periods").length&&"period"==ie.DBITools.typeOfUniPeriod(n.uniperiod)){var l=!1;e.rowData("periods",n.uniperiod)||(l=!0),1<n.durationperiods&&!e.rowData("periods",ie.DBITools.uniperiod_delta(n.uniperiod,n.durationperiods-1))&&(l=!0),l&&i.push({out:l})}if(o.is_holiday&&i.push({out:!0}),o.tt_num&&"period"==ie.DBITools.typeOfUniPeriod(n.uniperiod))for(var u=parseInt(n.uniperiod),c=u+(n.durationperiods||1)-1,d=0,m=n.teacherids;d<m.length;d++){var p=m[d],b=e.rowData("teachers",p);if(b){var f=(b.subst_tt_timeoff||b.subst_tt_timeoff_vt||{})[o.tt_num];if(f)for(var _=u;_<=c;_++)"0"==de.timeoff_get(f,o.tt_term,o.tt_week,o.tt_day,_)&&i.push({table:"teachers",id:p,subst_timeoff:!0})}}for(var h=function(e){return!!ie.idsIsOverlap(e.classids,n.classids)&&!!B.ttitemUniperiodMatchSimple(ie.unpartial(n),e.uniperiod)},g=0,v=le.buildSubstOnlineTTItemsEx(e,n.date,r);g<v.length;g++){var y=v[g];if(!s.includes(y.id)){if("event"==y.type&&"ad"==y.uniperiod){var E=e.rowData("events",y.eventid,{});if("distant"==E.typ)continue;if(E.elearn_superid)continue}if(B.ttitemUniperiodMatchSimple(ie.unpartial(n),y.uniperiod)||B.ttitemUniperiodMatchSimple(ie.unpartial(y),n.uniperiod)){for(var w=0,S=le.ttitem_isClassColision(y,n,t)||[];w<S.length;w++){var x=S[w];i.push({item:y,table:"classes",id:x})}for(var T=0,C=ie.idsArrayIntersect(y.teacherids,n.teacherids);T<C.length;T++){p=C[T];i.push({item:y,table:"teachers",id:p,join:h(y),subjectid:y.subjectid})}if("classroomsupervision"!==n.type)for(var k=0,D=ie.idsArrayIntersect(y.classroomids,n.classroomids);k<D.length;k++){var I=D[k];i.push({item:y,table:"classrooms",id:I,join:ie.idsIsOverlap(y.teacherids,n.teacherids)&&h(y)})}}}}for(var R=0,A=e.tableFilterData("substonline_absents",{date:n.date});R<A.length;R++){var N=A[R];le.substTTItem_absent_match(n,N)&&i.push({absent:N,table:le.absentGetTable(N),id:le.absentGetId(N)})}return i}function A(e,t,n,s){void 0===s&&(s=!1);for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a.table==t&&a.id==n){if(s&&a.join)continue;return!0}}return!1}function Ne(e,t,n,s){for(var r=[],i=0,a=f(e,t,n,[],s);i<a.length;i++){for(var o=a[i],l=!1,u=0,c=r;u<c.length;u++){var d=c[u];o.absent&&d.absent==o.absent&&(l=!0),o.item&&d.item==o.item&&(l=!0)}l||r.push(o)}return r}function Be(e,t){var n=ie.DBITools.getUniPeriod(e)||"ad";if(n!=(ie.DBITools.getUniPeriod(t)||"ad"))return!1;switch(ie.DBITools.typeOfUniPeriod(n)){case"period":if((e.durationperiods||1)!=(t.durationperiods||1))return!1;break;case"starttime":if(e.endtime!=t.endtime)return!1}return!0}function N(l){var u=l.tvs,e=l.ttWidth,c=l.y1,t=l.y2,n=l.gap_row,d=l.ttitems_center,s=l.remove_ttitemids,r=l.editing_ttitems,b=u.date,f=u.dbi,_=u.tt_dbi,h=u.table,g=u.id,i=u.dlg,a=u.show_events,v=u.join_doubles,y=(i||{}).moveTTItem,o=t-c,E=u.tlr;E.clear(),E.qSize=o-n;for(var m=le.buildSubstOnlineTTItemsEx(f,b,v),p=[],w=new Set,S=0,x=m;S<x.length;S++){var T=x[S];if(!s||!s.includes(T.id))if(T.eventid){var C=f.rowData("events",T.eventid);a&&C&&(le.substTTItem_filter_match(T,h,g)||ce.isEventCancelDay(f,C))&&p.push(C)}else{var k=!1;if(le.substTTItem_filter_match(T,h,g)&&(k=!0),T.orig&&!T.added&&le.substTTItem_filter_match(T.orig,h,g)&&(k=!0),k){var D="main";"classroomsupervision"==T.type?D="supervision":T.cancelled&&(D="autobottom"),E.addItem(D,{ttitem:T});for(var I=0,R=T.eventids||[];I<R.length;I++){var A=R[I];w.add(A)}}}}if(r)for(var N=0,B=r;N<B.length;N++){T=B[N];E.addItem("classroomsupervision"==T.type?"supervision":"main",{ttitem:T,editing:!0})}for(var j=0,P=f.tableFilterData(pe,{date:b});j<P.length;j++){var M=P[j];if(le.absentGetTable(M)==h&&le.absentGetId(M)==g){for(var O=null,z=0,F=p;z<F.length;z++){var L=F[z];if(Be(L,M)){O=L,w.add(O.id);break}}E.addItem("bottom",{absent:M,event:O})}}for(var G=0,U=p;G<U.length;G++){var q=U[G];w.has(q.id)||E.addItem(ce.isEventCancelDay(f,q)?"autotop":"top",{event:q})}if("teachers"==h){var H=f.rowData("teachers",g),V=f.rowData(be,b);if(H&&V&&null!=V.tt_day&&0<=V.tt_day&&!V.is_holiday){var W=(H.subst_tt_timeoff||H.subst_tt_timeoff_vt)[V.tt_num];if(W)for(var K=0,Y=f.tableIds("periods");K<Y.length;K++){var J=Y[K],Z=de.timeoff_get(W,V.tt_term,V.tt_week,V.tt_day,parseInt(J))||" ";"."==(Z=Z.trim())&&(Z=""),Z&&E.addItem("autobottom",{uniperiod:J,teacher_timeoff:Z})}}}var $=new Map;if(y&&"period"==ie.DBITools.typeOfUniPeriod(y.uniperiod))for(var X=function(e){if(b==y.date&&e==y.uniperiod)return"continue";var t=se.__assign(se.__assign({},y),{date:b,uniperiod:e}),n={date:b,uniperiod:e};De(t,n);function s(e){if("classrooms"==h)return e;for(var t=e.filter(function(e){return"classrooms"!=e.table}),n=0,s=e;n<s.length;n++){var r=s[n];if("classrooms"==r.table){for(var i=!1,a=0,o=t;a<o.length;a++){var l=o[a];r.item&&l.item==r.item&&(i=!0)}i||(u=!0)}}return t}var u=!1,r=s(Ne(f,_,t,v));if(0==r.length){var i=E.data2t(se.__assign(se.__assign({},t),n));E.addItem("overlay",{move:{typ:"forward",color:Ee,name:ae.client_req.localize(xe),moves:[{orig:y,moved:t}],changeClassroom:u}},{t1:i.t1,t2:i.t2})}else for(var a=0,o=r;a<o.length;a++){var l=o[a].item;if(l&&(l.uniperiod==e&&le.substTTItem_filter_match(l,h,g)&&le.substTTItemMovable(l))){var c=u;u=!1;var d={date:y.date,uniperiod:y.uniperiod},m=se.__assign(se.__assign({},l),d);De(m,d);var p=s(Ne(f,_,m,v));1==p.length&&p[0].item&&p[0].item.id==y.id&&(1==r.length&&r[0].item.id==l.id?(c&&(u=!0),$.set(l.id,{color:we,typ:"bidi",name:ae.client_req.localize(Te),moves:[{orig:y,moved:t},{orig:l,moved:se.__assign(se.__assign({},l),d)}],changeClassroom:u})):$.set(l.id,{color:Se,typ:"back",name:ae.client_req.localize(Ce),moves:[{orig:y,cancel:!0},{orig:l,moved:se.__assign(se.__assign({},l),d)}],changeClassroom:u}))}}},Q=0,ee=f.tableIds("periods");Q<ee.length;Q++){X(J=ee[Q])}E.render();var te=E.renderOrderItems(),ne=te.filter(function(e){return e.data.move});return re.createElement(ue.RBox,{x1:0,x2:e,y1:c,y2:t,style:{overflow:"visible"}},re.createElement(me.TTView_Lines,{dbi:f,rowHeight:o,tlr:E}),te.map(function(e,t){var n=E.item2box(e);if(e.data.ttitem){d&&d.set(e.data.ttitem.id,new oe.CPoint((e.p1+e.p2)/2,c+(e.q1+e.q2)/2));var s=$.get(e.data.ttitem.id);return re.createElement(ue.Fragment,{key:""+t},re.createElement(Fe,{box:n,ttitem:e.data.ttitem,je_upload:l.je_upload,tvs:u,side:"bottom"==e.part,editing:e.data.editing}),s&&re.createElement(Pe,{box:n,move:se.__assign(se.__assign({},s),{center:je(n,c)}),tvs:u}))}if(e.data.move){for(var r=1e5,i=0,a=ne;i<a.length;i++){var o=a[i];o.p1<=e.p1||o.q1>=e.q2||o.q2<=e.q1||(r=Math.min(r,E.item2box(o).x1))}return re.createElement(Pe,{key:""+t,box:n,move:se.__assign(se.__assign({},e.data.move),{center:je(n,c,r)}),tvs:u,cut_x:r})}return e.data.absent?re.createElement(Me,{key:""+t,box:n,absent:e.data.absent,tvs:u,event:e.data.event}):e.data.event?re.createElement(Oe,{key:""+t,box:n,event:e.data.event,tvs:u}):e.data.teacher_timeoff?re.createElement(Le,{key:""+t,box:n,teacher_timeoff:e.data.teacher_timeoff}):null}))}function je(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1e5),new oe.CPoint((e.x1+Math.min(e.x2,n))/2,(e.y1+e.y2)/2+t)}function h(e){var r=e.dbi,i=e.tt_dbi,t=e.move,a=e.classroomRef,o=e.ignore_ttitemids,l=e.join_doubles,u=r.req,c=t.orig,n=t.moved,d=t.cancel,m=c;n&&(m=se.__assign(se.__assign({},m),n));function s(e){var t=e.date,n=e.uniperiod,s=r.tools.uniperiodName(n,"short",m);return m.date==c.date&&!d||(s=K.date_format_day(u,t,!1,!0)+" "+s),s}return re.createElement("div",null,re.createElement("b",null,r.rowName("subjects",m.subjectid)),re.createElement(ue.VGap,{height:10}),s(c),d||re.createElement(re.Fragment,null,re.createElement("img",{src:"/global/pics/ui/replace_32.svg",style:{verticalAlign:"middle",height:16,padding:"0px 5px"}}),s(m)),d&&re.createElement(re.Fragment,null,re.createElement(ue.VGap,{height:10}),re.createElement("img",{src:p.action_icon("delete"),style:{height:16,verticalAlign:"middle",marginRight:5}}),u.ttls(1476)),!d&&a&&function(){var t=a.value,e=f(r,i,se.__assign(se.__assign({},m),{classroomids:t?[t]:[]}),o,l),n=b.substTTItemComboItems({table:"classrooms",dbi:r,tt_dbi:i,ttitem:m,topid:m.classroomids[0],remove_ttitemids:o});t&&!n.find(function(e){return e.id==t})&&a.set("");var s=A(e,"classrooms",t);return!t&&0<c.classroomids.length&&(s=!0),re.createElement(re.Fragment,null,re.createElement(ue.VGap,{height:10}),re.createElement(ue.RLabel,{text:r.tools.itemName("classrooms")+":"}),re.createElement(J.default,{valueRef:a,items:n.map(function(e){return{value:e.id,name:r.rowName("classrooms",e.id),classname:e.className}})}),s&&re.createElement("img",{src:"/global/pics/ui/item_bad_32.svg",style:{height:16,verticalAlign:"middle",marginLeft:5},title:u.ttls(3447)}))}())}function Pe(e){var t=this,l=e.move,u=e.tvs,n=e.box,s=e.cut_x,r=l.color,c=l.changeClassroom,d=u.dbi,m=u.tt_dbi,p=u.join_doubles,b="SubstTimetableDlg",i=re.useState(!1),a=i[0],f=i[1],o=void 0!==s&&n.x2>s;return o&&(n=se.__assign(se.__assign({},n),{x2:s-4})),re.createElement(ue.RBox,se.__assign({},n,{onClick:function(){return se.__awaiter(t,void 0,void 0,function(){var t,s,n,r,i,a,o=this;return se.__generator(this,function(e){switch(e.label){case 0:f(!0),u.setHoverMove(l),e.label=1;case 1:for(e.trys.push([1,,3,4]),t={moves_classroomid:l.moves.map(function(e){return e.orig.classroomids[0]||""})},s=[],n=0,r=l.moves;n<r.length;n++)i=r[n],s.push(i.orig.id);return[4,ue.RDialog.showInput(t,function(e){e.state;var n=e.stateRef;return u.setHoverMove(l),re.createElement(re.Fragment,null,re.createElement(W.DlgHeader,{title:l.name,icon:"/substitution/pics/subst_move_64.png",small:!0}),re.createElement(W.RJoin,{children:l.moves.map(function(e,t){return re.createElement(h,{dbi:d,tt_dbi:m,move:e,classroomRef:c?n.sub("moves_classroomid").index(t):null,ignore_ttitemids:s,join_doubles:p})}),glue:re.createElement(W.SeparatorLine,null)}))},{width:400,buttons:[{label:l.name,action:"ok",type:"default"},"cancel"]})];case 2:return(a=e.sent())&&ASC.blockUI(function(){return se.__awaiter(o,void 0,void 0,function(){var t,n,s,r;return se.__generator(this,function(e){switch(e.label){case 0:t=0,e.label=1;case 1:return t<l.moves.length?(n=l.moves[t],s=a.moves_classroomid[t],n.cancel?[4,_.removeSubstOnlineTTItem(null,n.orig.id,p,{log_module:b})]:[3,3]):[3,6];case 2:return e.sent(),[3,5];case 3:return[4,_.updateSubstTTItem(null,n.orig.id,{date:n.moved.date,uniperiod:n.moved.uniperiod,teacherids:n.moved.teacherids,classroomids:c?s?[s]:[]:void 0},{},p,{log_module:b})];case 4:r=e.sent(),0==t&&u.dlg.setMoveTTItemid(r),e.label=5;case 5:return t++,[3,1];case 6:return[2]}})})}),[3,4];case 3:return f(!1),u.setHoverMove(null),[7];case 4:return[2]}})})},onMouseEnter:function(){return u.setHoverMove(l)},onMouseLeave:function(){a||u.setHoverMove(null)},style:{borderWidth:3,borderStyle:c?"dashed":"solid",borderColor:r,borderRightWidth:o?0:void 0}}))}function Me(e){var t=e.absent,n=e.tvs,s=e.event,r=n.dbi,i=r.req,a=$.useSimplePopup(),o=a[0],l=a[1],u=a[2],c=r.rowName("absent_types",t.absent_typeid);return c=c||i.ls(1846),"classes"==le.absentGetTable(t)&&t.groupname&&(c+=" ("+t.groupname+")"),s&&(c+=", "+ce.eventName(r,s,{brief:!0})),re.createElement(re.Fragment,null,re.createElement(ze,{box:e.box,text_center:c,tooltip:c,side:!0,background:s?d.BACKGROUND_event_absent:d.BACKGROUND_absent,style_center:{color:"#ffffff",textShadow:"0px 0px 1px #000000"},onClick:function(e){return l(e)}}),u&&re.createElement(o,null,s&&re.createElement(re.Fragment,null,re.createElement(m.EventPopup,{eventid:s.id,where:"timetable"})),re.createElement(X.AbsentPopup,{absentid:t.id,where:"timetable"})))}function Oe(e){var t=e.event,n=e.tvs.dbi,s=$.useSimplePopup(),r=s[0],i=s[1],a=s[2],o=ce.eventName(n,t,{brief:!0});return re.createElement(re.Fragment,null,re.createElement(ze,{box:e.box,text_center:o,tooltip:o,side:!0,background:d.BACKGROUND_event,onClick:function(e){return i(e)}}),a&&re.createElement(r,null,re.createElement(m.EventPopup,{where:"subst",eventid:t.id})))}function g(e){return re.createElement("img",{src:e,style:{verticalAlign:"middle",height:16,width:16,filter:"drop-shadow(0px 0px 3px rgb(255,255,255,0.8))",display:"inline-block"}})}function ze(e){var t=e.box,n=e.side,s=e.je_odpadlo,r=e.je_sel,i=e.text_center,a=e.text_tl,o=e.text_tr,l=e.text_bl,u=e.text_br,c=e.tooltip,d=e.icons_tl||[],m=e.icons_tr||[],p=e.background||"#c0c0c0",b=s?"#808080":"#000000";function f(e){return(e=e.filter(function(e){return e})).length<2?e[0]:re.createElement("div",null,re.createElement(W.RJoin,{children:e,glue:" "}))}return re.createElement(re.Fragment,null,re.createElement(ue.RTextBox,se.__assign({},t,{text:i,hAlign:"center",vAlign:"center",style:se.__assign({background:p,color:b,padding:1,fontSize:n?void 0:18,borderRadius:3,cursor:"pointer",border:e.border,whiteSpace:n?"pre":void 0},e.style_center||{}),title:c,onClick:e.onClick})),!n&&re.createElement(re.Fragment,null,(a||0<d.length)&&re.createElement(ue.RTextBox,se.__assign({},e.box,{text:f(se.__spreadArrays(d.map(g),[a])),hAlign:"left",vAlign:"top",style:{color:b,paddingLeft:3,paddingTop:1,fontSize:10,pointerEvents:"none"}})),(o||0<m.length)&&re.createElement(ue.RTextBox,se.__assign({},e.box,{text:f(se.__spreadArrays([o],m.map(g))),hAlign:"right",vAlign:"top",style:{color:b,paddingRight:3,paddingTop:1,fontSize:10,pointerEvents:"none"}})),l&&re.createElement(ue.RTextBox,se.__assign({},e.box,{text:l,hAlign:"left",vAlign:"bottom",style:{color:b,paddingLeft:3,paddingBottom:1,fontSize:10,pointerEvents:"none"}})),u&&re.createElement(ue.RTextBox,se.__assign({},e.box,{text:u,hAlign:"right",vAlign:"bottom",style:{color:b,paddingLeft:3,paddingBottom:1,fontSize:10,pointerEvents:"none"}}))),r&&re.createElement(me.TTView_CellSelect,{box:t}))}function Fe(e){var t,n,s,r,i,a=ae.client_req,o=e.ttitem,l=e.tvs,u=e.box,c=l.dbi,d=l.table,m=l.id,p=l.dlg,b=l.join_doubles,f=l.show_events,_=l.where,h=l.ti2kolizie,g=(p||{}).moveTTItem,v=$.useSimplePopup(),y=v[0],E=v[1],w=v[2],S=o,x="#c0c0c0",T="classroomsupervision"==S.type?"1px solid black":void 0,C="",k=!1,D=!1,I=e.editing||!1;C=le.susbtTTItemPopis(S,c,"short"),g&&S.id==g.id&&(k=!0),r=le.substTTItem_filter_match(S,d,m),i=!(!S.added&&S.orig)||le.substTTItem_filter_match(S.orig,d,m);var R=null==h?void 0:h.get(o.id);if(r?(x=i?ne:_e,"classes"==d&&S.orig&&!ie.idsArrayMatch(S.teacherids,S.orig.teacherids)&&(x=_e)):i&&("teachers"!=d||I?(x=ge,D=!0):x=fe),S.cancelled)if(S.origofids&&S.origofids.length){x=he;var A=c.rowData("substonline_ttitems",S.origofids[0]);C=a.ttls(3194),A&&(C=A.date!=S.date?a.ttls(3194)+": "+K.date_format_date(a,S.date,!1)+" -> "+K.date_format_date(a,A.date,!1):a.ttls(3194)+": "+c.rowName("periods",S.uniperiod,"short")+" -> "+c.rowName("periods",A.uniperiod,"short"))}else x=ge,D=!0,C=a.ls(2322)+": "+le.susbtTTItemPopis(S.orig,c,"short");k&&(x=ve),I&&(x=D?ge:ye),"review"==_&&(x=r?ne:ge,r&&(0<S.changes.length||0<S.changeeventids.length)&&(T="2px dashed #000"),R&&(R.find(function(e){return e.todo})&&(T="3px dashed #4E7AB5"),r&&R.find(function(e){return!e.todo})&&(T="3px dashed #f00")));var N="",B="",j="",P="",M=null;r?M=S:S&&S.orig&&(M=S.orig),r||i||!k||(x="#ff8080"),M&&(N="classroomsupervision"==M.type?a.ls(1723):c.rowName("subjects",M.subjectid,"short"),"classes"==d?P=c.rowNames("teachers",M.teacherids,"short"):S.classids&&(P=c.rowNames("classes",M.classids,"short")),S.groupnames&&!ie.DBITools.groupnamesIsEntireClass(M.groupnames)&&(B=c.tools.groupnames_names(M.groupnames)),"classroomsupervision"==M.type&&("classrooms"!=d&&(j=c.rowNames("classrooms",M.classroomids,"short")),"teachers"!=d&&(P=c.rowNames("teachers",M.teacherids,"short"))));var O=[],z=[],F="";0<(null===(t=o.changes)||void 0===t?void 0:t.length)&&(F=le.ICON_subst_changelesson),o.cancelled&&(F=le.ICON_subst_cancelled),0<(null===(n=o.origofids)||void 0===n?void 0:n.length)&&(F=le.ICON_subst_moved),o.added&&(F=le.ICON_subst_addlesson),o.origsubstid&&(F=le.ICON_subst_movelesson),F&&O.push(F),o.ol_is&&z.push("/global/pics/ui/videocall_16.svg");for(var L=0,G=o.substids||[];L<G.length;L++){var U=G[L],q=c.rowData(ee,U,{});q.inote&&(O.push("/substitution/pics/inote_32.svg"),C+="\n"+c.tools.columnName(ee,"inote")+": "+q.inote)}if(f)for(var H=0,V=o.eventids||[];H<V.length;H++){var W=V[H];z.push(ce.eventIcon(c,c.rowData("events",W)))}return(null===(s=o.studentsinfo)||void 0===s?void 0:s.subst)&&O.push("/substitution/pics/subst_students_32.svg"),re.createElement(re.Fragment,null,re.createElement(ze,{box:u,text_center:N,text_tl:B,text_tr:j,text_bl:P,icons_tl:O,icons_tr:z,tooltip:C,background:x,side:e.side,border:T,je_odpadlo:D,je_sel:k||I,onClick:function(e){e.preventDefault(),I||E(e)}}),w&&re.createElement(y,null,re.createElement(X.SubstTTItemPopup,{where:l.where,closeParent:l.closeParent,ttitem:S,dlg:p,join_doubles:b,kolizie:R})))}function Le(e){for(var t=e.box,n=e.teacher_timeoff,s="",r="",i=0,a=l.timeoff_Icons_subst;i<a.length;i++){var o=a[i];o.d==n&&(s=o.img,r=ae.client_req.localize(o.name))}return re.createElement(ue.RBox,se.__assign({},t,{style:{backgroundColor:"#e0e0e0",borderRadius:3,display:"flex",justifyContent:"center",alignItems:"center"},title:r}),re.createElement("img",{src:s,style:{height:Math.min(t.y2-t.y1-2,16)}}))}d.gridModes=[{id:"periods",name:ASC.ls(6399)},{id:"time",name:ASC.ls(1345)}],d.showSubstTimetableDlg=function(e,t,n,s){return void 0===s&&(s={}),ue.RDialog.show(re.createElement(ke,{table:t,id:n,date:e,move_substid:s.move_substid,onGoToDate:s.onGoToDate,join_doubles:s.join_doubles}))},(d.SubstTimetableDlg=ke).npp=ie.neededPartProvider(function(){return[f,Ae,{subjects:["name","short","cb_hidden"],teachers:["short","firstname","lastname","approbationids","cb_hidden","classroomid","subst_tt_timeoff_vt"],classes:["changes","name","short","teacherid","classroomid"],classrooms:["name","short","cb_hidden","classids"],igroups:["changes","name","short","teacherid","classroomid"],approbations:["name","short","subjectids","teacherids"],periods:["name","short","period","starttime","endtime"],dayparts:["name","short","daypart","starttime","endtime"],timetables:["changes","name"],tcards:["subjectid","teacherids","classids","classroomids","igroupid","groupnames","period","durationperiods","daypart","starttime","endtime"],events:["date","subId","name","typ","subjectid","teacherids","classids","classroomids","groupnames","period","durationperiods","daypart","starttime","endtime","allday","ctevent","ttcancel"],absent_types:["name","short"],event_types:["name","allday","ctevent","d_ctevent","noclassallclasses","ttcancel"],substonline_dates:["date","tt_num","tt_day","tt_week","tt_term","tcards_subst","is_online","uploaded_int"],substonline_absents:["date","subId","name","absent_typeid","teacherid","classid","classroomid","groupname","table","period","durationperiods","allday","split_entireclass"],substonline_substitutions:["date","subId","absent","card","tcard","classroomsupervision","changes","addcard","addtcard","origid","origofids","cancelled"],substonline_ttitems:["date","subId","type","changes","subjectid","teacherids","classids","classroomids","igroupid","groupnames","endtime","uniperiod","origofids","orig","origsubstid","added","cancelled","substids"]}]}),ke.ttdbi={npp:ie.neededPartProvider(function(){return[f.ttdbi,{groups:["classid","name","ascttdivision"],periods:["name","period","starttime","endtime"],breaks:["name","break","starttime","endtime"],custombells:["period","break","day","classids","starttime","endtime"]}]})},d.makeTLR=I,Ae.npp=ie.neededPartProvider(function(){return[N,{substonline_dates:["tt_day"]}]}),(d.getSubstTTItemKolizie=f).npp=le.substOnlineNeededPartProvider(function(){return[le.substTTItem_absent_match,le.buildSubstOnlineTTItemsEx,{periods:[],teachers:["subst_tt_timeoff"],substonline_dates:["tt_num","tt_term","tt_week","tt_day","is_holiday"],substonline_ttitems:["uniperiod","teacherids","classids","groupnames","classroomids","eventid"],substonline_absents:[],events:["typ","elearn_superid"]}]}),f.ttdbi={npp:ie.neededPartProvider(function(){return[le.ttitem_isClassColision.ttdbi]})},d.jeSubstKoliziaRow=A,d.jeSubstKolizaAbsent=function(e,t,n){for(var s=0,r=e;s<r.length;s++){var i=r[s];if(i.table==t&&i.id==n&&i.absent)return!0}return!1},N.npp=le.substOnlineNeededPartProvider(function(){return[le.buildSubstOnlineTTItemsEx,ce.isEventCancelDay,ce.event_tableIds,Fe,Me,{substonline_ttitems:["eventid"],substonline_dates:["tt_num","tt_day","tt_week","tt_term","is_holiday"]}]}),d.BACKGROUND_absent="#7b7b7b",d.BACKGROUND_event="#d0ffd0",d.BACKGROUND_event_absent="repeating-linear-gradient(-45deg, #87A587, #87A587 5px, #7b7b7b 5px, #7b7b7b 10px)",Me.needed_part=ie.typed({absent_types:["__name"],substonline_absents:["date","table","classid","teacherid","classroomid","groupname"]}),Fe.npp=le.substOnlineNeededPartProvider(function(){return[X.SubstTTItemPopup,ce.eventIcon,{substonline_ttitems:["__ttitem","wds","ol_is","studentsinfo"],subjects:["__name"],teachers:["__name"]}]});var v=(t.prototype.clear=function(){this.items.length=0},t.prototype.addItem=function(e,t,n){void 0===n&&(n={});var s=n.t1,r=n.t2,i=n.wasAligned;if(void 0===s||void 0===r){var a=this.data2t(t);s=a.t1,r=a.t2,i=a.wasAligned}(isNaN(s)||isNaN(r))&&ASC.dieError("0685305852"),this.items.push({data:t,part:e,t1:s,t2:r,wasAligned:i,slices:n.slices||"",order:n.order,r1:0,r2:0,autoside:!1,p1:0,p2:0,q1:0,q2:0})},t.prototype.t2p=function(e){var t=(e-this.tMin)/(this.tMax-this.tMin)*(this.pSize+this.gap);return(t=Math.round(t))<0&&(t=0),t>this.pSize&&(t=this.pSize),"number"==typeof t&&!isNaN(t)||ASC.dieError("5985426422"),t},t.prototype.p2t=function(e){return this.tMin+e/this.pSize*(this.tMax-this.tMin)},t.prototype.item2box=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),{x1:e.p1+t,x2:e.p2+t,y1:e.q1+n,y2:e.q2+n}},t.prototype.initSpan=function(e,t){if(void 0===t&&(t=!0),t){this.rSpan=[];for(var n=0;n<this.rSize;n++)this.rSpan.push(!1)}for(var s=0,r=e;s<r.length;s++){var i=r[s];for(n=i.r1;n+1<i.r2;n++)this.rSpan[n]=!0}},t.prototype.partItems=function(t){return this.items.filter(function(e){return e.part==t})},t.prototype.renderPart=function(S){var x=this.partItems(S);this.initSpan(x),this.rMulti=[],"main"==S&&(this.rMulti.length=this.rSize);for(var T,C=this.gap,k=[],e=0;e<this.rSize;e++)k.push([]);for(var t=function(t){for(T=t;D.rSpan[T];)T++;T++;var r=x.filter(function(e){return e.r1>=t&&e.r1<T});if(0==r.length)return"continue";var i=0,a=D.qSize;if("main"==S||"supervision"==S)for(var e=t;e<T;e++)i=Math.max(i,D.r2qSideTop[e]),a=Math.min(a,D.r2qSideBottom[e]);if("supervision"==S||"supervisionside"==S){var n=a-i;a=Math.round(i+.75*n),i=Math.round(i+.25*n)}if("main"==S&&!r.find(function(e){return!e.slices})){for(var o=!0,l=r[0].slices.length,s=function(t){var n=t.slices;if(n.length!=l&&(o=!1),r.find(function(e){return e!=t&&function(e,t){for(var n=0;n<e.length;n++)if("1"==e[n]&&"1"==t[n])return!0;return!1}(e.slices,n)})&&(o=!1),!o)return"break";for(var e=0;e<n.length;){var s=n.indexOf("1",e);if(s<0)break;(e=n.indexOf("0",s))<0&&(e=n.length),t.q1=Math.round(i+s*(a-i+C)/l),t.q2=Math.round(i+e*(a-i+C)/l-C)}},u=0,c=r;u<c.length&&"break"!==s(p=c[u]);u++);if(o)return"continue"}"top"!=S&&"bottom"!=S||r.sort(function(e,t){return t.t2-t.t1-(e.t2-e.t1)}),"main"==S&&r.sort(function(e,t){return e.order-t.order});for(var d=0,m=r;d<m.length;d++){for(var p=m[d],b=0;;){var f=!1;for(e=p.r1;e<p.r2;e++)k[e][b]&&(f=!0);if(!f)break;b++}for(e=p.r1;e<p.r2;e++)k[e][b]=p}var _=1;for(e=t;e<T;e++)_=Math.max(_,k[e].length);if("top"==S&&(a=_*(D.qSide+C)-C),"bottom"==S){for(var h=!1,g=0,v=D.items;g<v.length;g++)if("main"==(p=v[g]).part&&p.r1<T&&p.r2>t){h=!0;break}i=D.qSize-Math.min(_*(D.qSide+C)-C,Math.round(D.qSize*(h?.5:.8)))}for(e=t;e<T;e++)for(var y=k[e].length,E=0;E<y;E++)if((p=k[e][E])&&p.r1==e){"main"!=S||p.autoside||(D.rMulti[e]=!0);var w=E;"bottom"==S&&(w=_-E-1),p.q1=Math.round(i+w*(a-i+C)/_),p.q2=Math.round(i+(w+1)*(a-i+C)/_-C)}},D=this,n=0;n<this.rSize;n=T)t(n);if("top"==S)for(var s=0,r=x;s<r.length;s++)for(e=(o=r[s]).r1;e<o.r2;e++)this.r2qSideTop[e]=Math.max(this.r2qSideTop[e],o.q2+C);if("bottom"==S)for(var i=0,a=x;i<a.length;i++){var o;for(e=(o=a[i]).r1;e<o.r2;e++)this.r2qSideBottom[e]=Math.min(this.r2qSideBottom[e],o.q1-C)}},t.prototype.render=function(){for(var r=this,e=new Set,t=0,n=this.items;t<n.length;t++){var s=n[t];e.add(s.t1),e.add(s.t2)}this.r2t=[],e.forEach(function(e){return r.r2t.push(e)}),this.r2t.sort(function(e,t){return e-t}),this.rSize=this.r2t.length,this.t2r=new Map,this.r2qSideTop=[],this.r2qSideBottom=[];for(var i=0;i<this.rSize;i++)this.t2r.set(this.r2t[i],i);for(var a=0,o=this.items;a<o.length;a++)(s=o[a]).r1=this.t2r.get(s.t1),s.r2=this.t2r.get(s.t2),"supervisionside"==s.part&&(s.r2=s.r1+1,this.rSize=Math.max(this.rSize,s.r2));for(var l=new Map,u=0,c=se.__spreadArrays(this.partItems("autotop"),this.partItems("autobottom"));u<c.length;u++)s=c[u],l.set(s,"autotop"==s.part?"top":"bottom"),s.part="main",s.autoside=!0;for(var d=function(e){for(var t=0;t<m.rSize;t++)m.r2qSideTop[t]=0,m.r2qSideBottom[t]=m.qSize;if(m.renderPart("top"),m.renderPart("bottom"),m.renderPart("main"),1==e){var s=!1;if(l.forEach(function(e,t){for(var n=t.r1;n<t.r2;n++)if(r.rMulti[n]){t.part=e,s=!0;break}}),!s)return"break"}},m=this,p=1;p<=2&&"break"!==d(p);p++);this.renderPart("supervision"),this.renderPart("supervisionside");for(var b=0,f=this.partItems("overlay");b<f.length;b++)(s=f[b]).q1=0,s.q2=this.qSize;for(var _=0,h=this.items;_<h.length;_++){if((s=h[_]).p1=this.t2p(s.t1),s.p2=this.t2p(s.t2)-this.gap,"supervisionside"==s.part){var g=this.t2p((s.t1+s.t2)/2),v=this.qSide,y=this.pSize,E=g-v/2;E=Math.max(E,0),E=Math.min(E,y-v),s.p1=E,s.p2=E+v}s.p2<s.p1&&(s.p2=s.p1)}},t.prototype.renderOrderItems=function(){return se.__spreadArrays(this.partItems("top"),this.partItems("bottom"),this.partItems("main"),this.partItems("supervision"),this.partItems("supervisionside"),this.partItems("overlay"))},t);function t(e,t,n,s){this.pSize=e,this.qSize=t,this.tMin=n,this.tMax=s,this.items=[],this.gap=1,this.qSide=14,this.data2t=null,this.rSize=0,this.t2r=null,this.r2t=null,this.r2qSideTop=null,this.r2qSideBottom=null,this.rSpan=null,this.rMulti=null}function s(e,t){for(var i=y(e,t),r=1,a=1,o=[0],l=[0],n=0,s=e.tableData("periods");n<s.length;n++){var u=s[n],c=parseInt(u.id);r=Math.min(r,c),a=Math.max(a,c+1);var d=le.time2int(u.starttime),m=le.time2int(u.endtime);o[c]=d,l[c]=m}if(i.maxT>l[l.length-1]){c=l.length;o[c]=l[l.length-1],l[c]=i.maxT,a=Math.max(a,c+1)}function p(e,t){for(var n=0;n<o.length;n++)if(!(e>l[n])){if(e<o[n])return n;var s=l[n]-o[n];return 0<s?(e-o[n])/s+n:n}return t?a:r}return{minT:r,maxT:a,t:function(e){var t=e.uniperiod;if(t)switch(ie.DBITools.typeOfUniPeriod(t)){case"period":var n=parseInt(t);return"classroomsupervision"==e.type?{t1:n+.25,t2:n+.75}:{t1:n,t2:n+(e.durationperiods||1)};case"break":var s=parseInt(t.substr(1));return{t1:s-.25,t2:s+.25}}var r=i.t(e);return{t1:p(r.t1,!1),t2:p(r.t2,!0)}}}}function y(e,t){var u=e.table("periods"),c=e.table("breaks"),d=e.table("dayparts");return{minT:420,maxT:1080,t:function(e){var t=e.uniperiod;if(t)switch(ie.DBITools.typeOfUniPeriod(t)){case"period":var n=null;if(i=u.rowData(t))return 2<=e.durationperiods&&(n=u.rowData(parseInt(t)+e.durationperiods-1+"")),{t1:le.time2int(i.starttime),t2:le.time2int((n||i).endtime)};break;case"break":var s=t.substr(1),r=c.rowData(s);if(r)return{t1:le.time2int(r.starttime),t2:le.time2int(r.endtime)};var i=u.rowData(s),a=u.rowData(""+(parseInt(s)-1));if(i&&a)return{t1:le.time2int(a.endtime),t2:le.time2int(i.starttime)};break;case"daypart":var o=d.rowData(t);if(o)return{t1:le.time2int(o.starttime),t2:le.time2int(o.endtime)};break;case"starttime":var l=le.time2int(t);return{t1:l,t2:e.endtime?le.time2int(e.endtime):l+5}}return{t1:0,t2:0}}}}function n(e,t,n){return"time"==e?y(t):s(t,n)}function r(e){var c=e.dbi,t=e.tt_dbi,n=e.date,s=e.items,r=e.onPeriodClick,d=e.kolizie,i=e.join_doubles,a=e.small,m=e.ti2kolizie,o=e.remove_ttitemids||[],l=e.editing_ttitems||[],p=c.req,u=ue.useClientSize(),b=u[0],f=u[1],_=u[2],h=ue.useColors(),g=a?50:80,v=b-g-1,y=f-40-1,E=I(c,t,"substonline_dates",!1,v,40);E.gap=1,E.pSize=v;function w(e){return{y1:Math.round(e*y/s.length),y2:Math.round((e+1)*y/s.length)}}var S={where:e.where,closeParent:e.closeParent,dbi:c,tt_dbi:t,date:n,table:"",id:"",tlr:E,width:b,height:f,gap:1,gap_row:4,dayWidth:g,periodHeight:40,row2y:w,nRows:s.length,ti2kolizie:e.ti2kolizie,show_events:!0,join_doubles:i},x=re.useMemo(function(){var i=new Set;return m&&m.forEach(function(e){for(var t=0,n=e;t<n.length;t++){var s=n[t],r=s.table+":"+s.id;i.add(r)}}),[i]},[m])[0],T={x1:g,x2:g+v,y1:40,y2:40+y},C={x1:T.x1,x2:T.x2+1,y1:T.y1,y2:T.y2+1},k={x1:T.x1,x2:T.x2,y1:0,y2:40};return re.createElement("div",{ref:_,style:se.__assign({position:"relative",backgroundColor:h.bgWhite},e.style||{})},re.createElement(me.TTView_OuterLines,{outerBox:C}),re.createElement(me.TTView_Periods,{periodsBox:k,dbi:c,tlr:E,onPeriodClick:r}),re.createElement(ue.RBox,{x1:0,x2:g,y1:40,y2:f},s.map(function(e,t){var n=e.table,s=e.id,r=w(t),i=r.y1,a=r.y2,o="",l="";if(d&&A(d,n,s)&&(l=A(d,n,s,!0)?(o=le.ICON_subst_kolizia,p.ttls(3447)):(o=le.ICON_subst_spojenie,p.ttls(1535))),m){var u=n+":"+s;x.has(u)&&(o=le.ICON_subst_kolizia,l=p.ttls(3447))}return re.createElement(me.TTView_Object,{key:n+":"+s,box:{x1:0,x2:g,y1:i,y2:a},dbi:c,table:n,id:s,splitLineTop:0<t,showTable:!0,icon:o,icon_tooltip:l})})),re.createElement(ue.RBox,se.__assign({},T,{style:{overflow:"visible"}}),s.map(function(e,t){var n=e.table,s=e.id,r=w(t),i=r.y1,a=r.y2;return re.createElement(N,se.__assign({},{key:n+":"+s,tvs:se.__assign(se.__assign({},S),{table:n,id:s}),ttWidth:v,y1:i,y2:a,gap_row:4,remove_ttitemids:o,editing_ttitems:l}))})))}d.TimetableLayoutRenderer=v,d.TTLR_TProvider_periods=s,d.TTLR_TProvider_time=y,(d.TTLR_TProvider_uni=n).needed_part=ie.typed({periods:["starttime","endtime"],breaks:[],dayparts:["starttime","endtime"]}),(d.SubstDlgTimetableView=r).npp=ie.neededPartProvider(function(){return[N,B.TTItemTimeProvider,{periods:["__name","period","starttime","endtime"]}]}),d._hotswap=[h]},"/asc/svg.js":function(e,require,t){e.__esModule=!0;var s=require("tslib"),d=require("react"),m=require("./asc_react");function x(e,t){return void 0===t&&(t=null),$j(function(e,t){void 0===t&&(t=null);t=t||document;return t.createElementNS("http://www.w3.org/2000/svg",e)}(e,t))}function T(e){return e.get(0).getBBox()}var C=1,n=(r.prototype.Padded=function(e){var t=x("g",this.page_document).appendTo(this.$page);t.attr("transform","translate("+e+" "+e+")");var n=new r(t);return n.width=this.width-2*e,n.height=this.height-2*e,n},r.prototype.SvgEl=function(e,t){var n=x(e,this.page_document);return t&&n.appendTo(t),n},r.prototype.Line=function(e,t,n,s,r){return this.SvgEl("line",this.$page).attr({x1:e,y1:t,x2:n,y2:s,"stroke-width":r*this.extraScale})},r.prototype.LineP=function(e,t,n){return this.Line(e.x,e.y,t.x,t.y,n)},r.prototype.CurvedLine=function(e,t,n){var s=t.sub(e).rotate(Math.PI/2).mul(.1),r=e.midPointTo(t,.2).add(s),i=e.midPointTo(t,.8).add(s);return this.SvgEl("path",this.$page).attr({d:"M"+e.svgStr()+" C "+r.svgStr()+","+i.svgStr()+","+t.svgStr(),"stroke-width":n*this.extraScale,fill:"none"})},r.prototype.Arrow=function(e,t,n,s,r){var i=this;void 0===r&&(r="forward");var a=Math.PI/6,o=function(e,t){return i.LineP(e,t,s)},l=a,u=-a,c=0;o=function(e,t){return i.CurvedLine(e,t,s)},c=-.4;var d=t.sub(e).normalized().mul(n),m=o(e,t);return"forward"!=r&&"bidi"!=r||(m=m.add(o(t.sub(d.rotate(l+c)),t)).add(o(t,t.sub(d.rotate(u+c)))).attr("stroke-linecap","round")),"back"!=r&&"bidi"!=r||(m=m.add(o(e.add(d.rotate(l-c)),e)).add(o(e,e.add(d.rotate(u-c)))).attr("stroke-linecap","round")),m.css({"pointer-events":"none"}),this.Group(m)},r.prototype.Group=function(e){return this.SvgEl("g",this.$page).append(e)},r.prototype.Line_swap=function(e,t,n,s,r,i){return e?this.Line(n,t,r,s,i):this.Line(t,n,s,r,i)},r.prototype.FixFont=function(e){return 0<=["arial","courier","times new roman"].indexOf(e.toLowerCase())?e:e+",Arial"},r.prototype.Rect=function(e,t,n){var s=x("rect",this.page_document).attr({x:e.x1,y:e.y1,width:e.width(),height:e.height(),style:"fill:"+t}).appendTo(this.$page);return 0<n?s.attr("stroke-width",n*this.extraScale):s.attr("stroke","none"),s},r.prototype.TextBox=function(e,t,n,s,r,i){void 0===s&&(s=0),void 0===r&&(r=0),void 0===i&&(i={}),t=Math.min(t,e.height());var a=x("text",this.page_document).attr({"font-size":t,"text-rendering":"geometricPrecision","text-anchor":s<0?"start":0<s?"end":"middle","dominant-baseline":r<0?"text-before-edge":0<r?"text-after-edge":"central"}).appendTo(this.$page).css("pointer-events","none").css("white-space","pre").text(n);i.bold&&a.css("font-weight","bold"),i.italic&&a.css("font-style","italic"),i.underline&&a.css("text-decoration","underline"),i.font&&a.css("font-family",this.FixFont(i.font));var o=a[0];t>e.height()&&(t=e.height(),a.attr("font-size",t));var l=e.width(),u=e.height(),c=1,d=o.getComputedTextLength();if(l<d)if(i.wrap){for(var m=[],p=0;p<n.length;){for(var b=p,f=!1;b<n.length;){var _=b+1;if(f||(_=n.indexOf(" ",_))<0&&(_=n.length),o.getSubStringLength(p,_-p)>l){if(p<b)break;if(f){b=n.length;break}f=!0,b=p}else b=_}for(m.push(n.substring(p,b).trim()),p=b;" "==n.charAt(p);)p++}a.empty();for(var h=0,g=m;h<g.length;h++){var v=g[h],y=x("tspan",this.page_document).appendTo(a).text(v);v!=m[0]&&y.attr({dy:t})}c=m.length}else i.shrink&&(t=t*l/d,a.attr("font-size",t));if((1<c?a.find("tspan"):a).attr("x",e.x1+(1+s)*l/2),a.attr("y",e.y1+(1+r)*(u-(c-1)*t)/2),0<=["edge","ie11","ie10"].indexOf(ASC.browser)){var E=T(a);a.attr("y",parseFloat(a.attr("y"))+e.y1-E.y+(e.height()-E.height)*(1+r)/2)}if(i.clip&&((E=T(a)).width>l||E.height>u)){var w="CP_"+C++,S=x("clipPath",this.page_document).appendTo(this.$page).attr("id",w);x("rect",this.page_document).appendTo(S).attr({x:e.x1,y:e.y1,width:l,height:u}),a.attr("clip-path","url(#"+w+")")}return this.rtl&&(E=T(a),a.attr({transform:"scale(-1 1) translate("+(-2*E.x-E.width)+")"})),a},r.prototype.Image=function(t,e,n,s){void 0===n&&(n=0),void 0===s&&(s=0);var r=x("image",this.page_document),i=document.createAttributeNS("http://www.w3.org/1999/xlink","href");i.nodeValue=e,r[0].attributes.setNamedItemNS(i),r.appendTo(this.$page).attr({x:t.x1,y:t.y1});var a=t.width(),o=t.height();if(n||s){var l=T(r),u=function(){var e=Math.min(a/l.width,o/l.height);a=l.width*e,o=l.height*e,0==n?r.attr("width",t.width()):0<n&&r.attr({x:t.x2-a,width:a}),0==s?r.attr("height",t.height()):0<n&&r.attr({y:t.y2-o,width:o})};l.width?u():r.load(function(){l=T(r),u()})}else r.attr({width:a,height:o});if(this.rtl){var c=T(r);r.attr({transform:"scale(-1 1) translate("+(-2*c.x-c.width)+")"})}return r},r.prototype.Tootlip=function(e,t){x("title",this.page_document).text(t).prependTo(e)},r.prototype.ShadowFilter=function(e,t,n){void 0===e&&(e=3),void 0===t&&(t=2),void 0===n&&(n=2);var s="filter_"+C++;return this.SvgEl("filter",this.$defs).attr({id:s}).html('<feGaussianBlur in="SourceAlpha" stdDeviation="'+e+'"/><feOffset dx="'+t+'" dy="'+n+'" result="offsetblur"/><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>'),"url(#"+s+")"},r.drawToDiv=function(e){e.empty();var t=e.width(),n=e.height(),s=new r($j("<svg style=''>").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("width",t).attr("height",n).attr("stroke","#000000").attr("stroke-width","0").attr("fill","#000000").appendTo(e));return s.width=t,s.height=n,s},r);function r(e){this.$page=e,this.extraScale=1,this.width=0,this.height=0,this.rtl=!1,this.$defs=null,this.page_document=e[0].ownerDocument,this.$defs=x("defs",this.page_document).appendTo(this.$page)}e.SvgDC=n;var i=(a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.add=function(e){return new a(this.x+e.x,this.y+e.y)},a.prototype.sub=function(e){return new a(this.x-e.x,this.y-e.y)},a.prototype.mul=function(e){return new a(this.x*e,this.y*e)},a.prototype.normalized=function(){return this.mul(1/this.length())},a.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e);return new a(this.x*t-this.y*n,this.y*t+this.x*n)},a.prototype.midPointTo=function(e,t){void 0===t&&(t=.5);var n=1-t;return new a(this.x*n+e.x*t,this.y*n+e.y*t)},a.prototype.svgStr=function(){return this.x+" "+this.y},a);function a(e,t){this.x=e,this.y=t}e.CPoint=i;var o=(l.prototype.swap=function(e){return void 0===e&&(e=!0),l.swap(e,this.x1,this.y1,this.x2,this.y2)},l.swap=function(e,t,n,s,r){return e?new l(n,t,r,s):new l(t,n,s,r)},l.prototype.width=function(){return this.x2-this.x1},l.prototype.height=function(){return this.y2-this.y1},l.prototype.center=function(){return new i((this.x1+this.x2)/2,(this.y1+this.y2)/2)},l.prototype.move=function(e,t){return new l(this.x1+e,this.y1+t,this.x2+e,this.y2+t)},l.prototype.pad_rel=function(e,t){return void 0===t&&(t=e),this.pad_abs(this.width()*e,this.height()*t)},l.prototype.pad_abs=function(e,t){return void 0===t&&(t=e),new l(this.x1+e,this.y1+t,this.x2-e,this.y2-t)},l.prototype.sliceY=function(e,t){var n=this.height();return new l(this.x1,this.y1+e*n/t,this.x2,this.y1+(e+1)*n/t)},l.prototype.contains=function(e){return e.x>=this.x1&&e.x<=this.x2&&e.y>=this.y1&&e.y<=this.y2},l);function l(e,t,n,s){this.x1=e,this.y1=t,this.x2=n,this.y2=s}function p(e){return d.createElement("line",{x1:e.p1.x,y1:e.p1.y,x2:e.p2.x,y2:e.p2.y,stroke:e.stroke})}function b(e){var t=e.p1,n=e.p2,s=n.sub(t).rotate(Math.PI/2).mul(.1),r=t.midPointTo(n,.2).add(s),i=t.midPointTo(n,.8).add(s);return d.createElement("path",{d:"M"+t.svgStr()+" C "+r.svgStr()+","+i.svgStr()+","+n.svgStr(),fill:"none"})}e.CRect=o,e.RSvgLine=p,e.RSvgCircle=function(e){var t=e.center,n=e.radius;return d.createElement("circle",s.__assign({cx:t.x,cy:t.y,r:n},{stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill}))},e.RSvgCurvedLine=b,e.RSvgArrow=function(e){var t=e.p1,n=e.p2,s=e.head_size,r=e.typ||"forward",i=Math.PI/6,a=p,o=i,l=-i,u=0;a=b,u=-.4;var c=n.sub(t).normalized().mul(s);return d.createElement(m.Fragment,null,d.createElement(a,{p1:t,p2:n}),("forward"==r||"bidi"==r)&&d.createElement(m.Fragment,null,d.createElement(a,{p1:n.sub(c.rotate(o+u)),p2:n}),d.createElement(a,{p1:n,p2:n.sub(c.rotate(l+u))})),("back"==r||"bidi"==r)&&d.createElement(m.Fragment,null,d.createElement(a,{p1:t.add(c.rotate(o-u)),p2:t}),d.createElement(a,{p1:t,p2:t.add(c.rotate(l-u))})))}},"/timetable/ttitem.js":function(e,require,t){e.__esModule=!0;var v=require("tslib"),y=require("../rpr/dbi");var n=(s.prototype.setDate=function(e,t){var n=e&&null!=e.tt_day?""+e.tt_day:"";n==this.day&&t==this.tt_dbi&&0<this.up_data.size||(this.day=n,this.tt_dbi=t,this.initDate())},s.prototype.setDateAsync=function(r){return v.__awaiter(this,void 0,void 0,function(){var t,n,s;return v.__generator(this,function(e){switch(e.label){case 0:return r==this.date?[3,4]:(this.date=r,t=this.dbi.rowData("dates",r),this.day=null!=t.tt_day?""+t.tt_day:"",n=this,t.tt_num?[4,this.dbi.timetabledbi(t.tt_num)]:[3,2]);case 1:return s=e.sent(),[3,3];case 2:s=null,e.label=3;case 3:n.tt_dbi=s,this.initDate(),e.label=4;case 4:return[2]}})})},s.prototype.ensure_up=function(e){var t=this.up_data,n=t.get(e);return n||(n={starttime:"",endtime:"",cbs:[]},t.set(e,n)),n},s.prototype.initDate=function(){var e=this.up_data,t=this.dbi,n=this.tt_dbi;e.clear();for(var s=0,r=t.tableData("periods");s<r.length;s++){var i=(d=r[s]).id;(m=this.ensure_up(i)).starttime=d.starttime,m.endtime=d.endtime}for(var a=0,o=t.tableData("dayparts");a<o.length;a++){var l=o[a];i=l.id,(m=this.ensure_up(i)).starttime=l.starttime,m.endtime=l.endtime}if(n){for(var u=0,c=n.tableData("periods");u<c.length;u++){i=(d=c[u]).id;var d,m=this.ensure_up(i);d.starttime&&(m.starttime=d.starttime,m.endtime=d.endtime)}for(var p=0,b=n.tableData("breaks");p<b.length;p++){var f=b[p];i="b"+f.id,m=this.ensure_up(i),f.starttime&&(m.starttime=f.starttime,m.endtime=f.endtime)}for(var _=0,h=n.tableData("custombells");_<h.length;_++){var g=h[_];i=g.period,g.break&&(i="b"+g.break),(m=e.get(i))&&m.cbs.push(g)}}},s.prototype.provide=function(e){var t=this.up_data,n=this.day,s=e.uniperiod;if("ad"==s)return{starttime:"00:00",endtime:"24:00"};function r(e){return{starttime:e.starttime,endtime:e.endtime}}if(e.durationperiods&&1<e.durationperiods&&"period"==y.DBITools.typeOfUniPeriod(s)){var i=v.__assign(v.__assign({},e),{durationperiods:null}),a=this.provide(i);i.uniperiod=""+(parseInt(e.uniperiod)+e.durationperiods-1);var o=this.provide(i);return{starttime:a.starttime,endtime:o.endtime}}if(_=t.get(s)){if(0<_.cbs.length){for(var l=e.lessonid,u=0<=e.classids.length?e.classids[0]:"",c=null,d=-1,m=0,p=_.cbs;m<p.length;m++){var b=p[m],f=0;if(b.day){if(b.day!=n)continue;f+=1}if(l&&0<=b.lessonids.indexOf(l))f+=100;else if(0<b.classids.length){if(!u)continue;if(b.classids.indexOf(u)<0)continue;f+=10}d<f&&(c=b,d=f)}if(c)return r(c)}return r(_)}if(5==s.length&&"-"==s[2])return{starttime:s.substr(0,2)+":"+s.substr(3,2),endtime:e.endtime||""};var _=this.ensure_up(s);if("b"==s[0]){var h=t.get(""+(parseInt(s.substr(1))-1)),g=t.get(s.substr(1));g&&(_.endtime=g.starttime,_.starttime=h?h.endtime:function(e){if(e<0)return"";var t=e%60,n=(e-t)/60;return(n<10?"0":"")+n+":"+(t<10?"0":"")+t}(function(e){return e?60*parseInt(e.substr(0,2))+parseInt(e.substr(3,2)):-1}(_.endtime)-5))}return r(_)},s.prototype.fill=function(e,t){var n=this.provide(t);e.starttime=n.starttime,e.endtime=n.endtime},s.ttitem_needed_columns=["subjectid","classids","teacherids","groupnames","igroupid","studentids","groupsubjectids"],s.needed_part={periods:["period","starttime","endtime"],dayparts:["daypart","starttime","endtime"],dates:["tt_day","tt_num"]},s.tt_dbi_needed_part={periods:["starttime","endtime"],breaks:["starttime","endtime"],custombells:["day","period","break","classids","lessonids","starttime","endtime"]},s);function s(e){this.dbi=e,this.date="",this.tt_dbi=null,this.day="",this.up_data=new Map}function r(e,t){if(!t)return!1;if(t==e.uniperiod)return!0;if("ad"==e.uniperiod)return!0;if("ad"==t)return!0;if("period"!=y.DBITools.typeOfUniPeriod(t)||"period"!=y.DBITools.typeOfUniPeriod(e.uniperiod))return!1;var n=parseInt(t),s=parseInt(e.uniperiod),r=s+(e.durationperiods||1)-1;return s<=n&&n<=r}function i(e,t){return"ad"==e.uniperiod||"ad"!=t&&r(e,t)}function a(e,t){var n={uniperiod:y.DBITools.getUniPeriod(t),durationperiods:t.durationperiods,endtime:t.endtime,subjectid:t.subjectid,classids:t.classids,groupnames:t.groupnames,igroupid:t.igroupid,teacherids:t.teacherids,classroomids:t.classroomids,groupsubjectids:t.groupsubjectid?[t.groupsubjectid]:[]};if(t.groupsubjectid){var s=e.rowData("groupsubjects",t.groupsubjectid);s&&(n.subjectid=s.subjectid,n.classids=s.classids,n.groupnames=[s.groupname],n.igroupid=s.igroupid,s.entireclass||(n.studentids=s.studentids))}return n}e.TTItemTimeProvider=n,e.ttitemFromData=function(e){for(var t={uniperiod:e.uniperiod||y.DBITools.getUniPeriod(e),subjectid:e.subjectid||"",classids:e.classids||[],groupnames:e.groupnames||[],teacherids:e.teacherids||[]},n=0,s=["date","classroomids","groupsubjectids","starttime","endtime","durationperiods","studentids","igroupid","eventid"];n<s.length;n++){var r=s[n];void 0!==e[r]&&(t[r]=e[r])}return t},e.ttitemTableIds=function(e,t){switch(t){case"classes":return e.classids;case"teachers":return e.teacherids;case"classrooms":return e.classroomids;case"igroups":return e.igroupid?[e.igroupid]:[];case"subjects":return e.subjectid?[e.subjectid]:[]}return[]},e.ttitemFilterMatch=function(e,t,n){if(!n)return!1;switch(t){case"classes":return 0<=e.classids.indexOf(n);case"teachers":return 0<=e.teacherids.indexOf(n);case"classrooms":return 0<=e.classroomids.indexOf(n);case"igroups":return e.igroupid==n;case"subjects":return e.subjectid==n;case"students":return e.studentids&&0<=e.studentids.indexOf(n)}return!1},e.ttitemUniperiodMatchSimple=r,e.ttitemUniperiods=function(e){var t=e.uniperiod,n=e.durationperiods;if("period"==y.DBITools.typeOfUniPeriod(t)&&1<e.durationperiods){for(var s=parseInt(t),r=s+n-1,i=[],a=s;a<=r;a++)i.push(""+a);return i}return[t]},e.ssUniperiodMatch=i,e.ssTTItemMatch=function(e,t){return!!i(e,t.uniperiod)&&!!e.moveto.find(function(e){return e.subjectid==t.subjectid&&t.classids.includes(e.classid)&&t.groupnames.includes(e.groupname)})},e.sortTTItemClass=function(s,e,t){function n(e){var t=e.classids[0];if(t)return s.rowIndex("classes",t);var n=e.igroupid;return n?1e3+s.rowIndex("igroups",n):2e3}return n(e)-n(t)},(e.ttitemFromTCard=a).needed_part=y.typed({tcards:["period","durationperiods","starttime","daypart","subjectid","classids","groupnames","igroupid","teacherids","classroomids"],groupsubjects:["classids","groupname","igroupid","studentids","entireclass"]})},"/dashboard/dbi_events.js":function(e,require,t){e.__esModule=!0;var l=require("tslib"),c=require("../rpr/dbi");function n(e,t,n){switch(void 0===n&&(n={}),t){case"classes":return e.classids;case"teachers":if(n.expand_ctevent){var s=n.dbi;if(d(s,e)){for(var r=[],i=0,a=e.classids;i<a.length;i++){var o=a[i],l=s.rowData("classes",o);if(l){var u=n.date||e.date;u&&(l=c.DBITools.rowApplyChanges(l,u)),l.teacherid&&!r.includes(l.teacherid)&&r.push(l.teacherid)}}return r}}return e.teacherids;case"classrooms":return e.classroomids;case"subjects":return e.subjectid?[e.subjectid]:[]}return[]}function d(e,t){if("boolean"==typeof t.ctevent)return t.ctevent;var n=e.rowData("event_types",t.typ);return!(!n||!n.ctevent&&!n.d_ctevent)}function s(e,t){if(d(e,t)){for(var n=l.__spreadArrays(t.teacherids),s=0,r=t.classids;s<r.length;s++){var i=r[s],a=e.rowData("classes",i),o=(a=a&&c.DBITools.rowApplyChanges(a,t.date))?a.teacherid:"";o&&n.indexOf(o)<0&&n.push(o)}return n}return t.teacherids}function u(e,t){for(var n=[],s=0,r=t.classids;s<r.length;s++){var i=r[s],a=e.rowData("classes",i),o=(a=a&&c.DBITools.rowApplyChanges(a,t.date))?a.teacherid:"";o?n.push(l.__assign(l.__assign({},t),{classids:[i],teacherids:[o]})):n.push(l.__assign(l.__assign({},t),{classids:[i],teacherids:[]}))}return n}function r(e,t){for(var n=[],s=0,r=t;s<r.length;s++){var i=r[s];if(d(e,i))for(var a=0,o=u(e,i);a<o.length;a++){var l=o[a];n.push(l)}else n.push(i)}return n}function i(e,t){if("boolean"==typeof t.ttcancel)return t.ttcancel;var n=e.rowData("event_types",t.typ);return!(!n||!n.ttcancel&&!n.d_ttcancel)}function a(e,t){var n;if(0<t.classids.length||0<(null===(n=t.igroupids)||void 0===n?void 0:n.length))return!1;var s=e.rowData("event_types",t.typ);return!!s&&s.noclassallclasses}function o(e,t){var n=e.rowData("event_types",t.typ);return!!n&&(n.ttcancel&&n.noclassallclasses&&0==t.classids.length&&0==t.igroupids.length&&(n.allday||t.allday))}function m(e,t){var n=e.rowData("event_types",t.typ);return!!n&&(!(!n.attachevent&&"testing"!=n.id&&"testing"!=n.categoryid)&&!i(e,t))}function p(e,t){return t.subjectid==e.subjectid&&(!!c.idsIsOverlap(t.classids,e.classids)&&(!(!c.DBITools.groupnamesIsEntireClass(e.groupnames)&&!c.idsIsOverlap(t.groupnames,e.groupnames))&&(!e.period||t.uniperiod==e.period)))}function b(e,t){if(t.allday&&!i(e,t))return!1;var n=e.rowData("event_types",t.typ);return n?n.attendance||n.lesson||!1:(ASC.logProblem("0667782150"),!1)}function f(e,t){var n=e.rowData("event_types",t.typ);return n||console.log("event typ error",t),n&&n.attendance&&t.date>new Date(e.req.isAscDevelop()?"2020-02-01":"2020-03-01").toISOString()}function _(e,t){if(t.privacy)return t.privacy;var n=e.rowData("event_types",t.typ);return n?n.privacy:""}function h(e,t,n){void 0===n&&(n={});var s=t.name,r=e.rowName("event_types",t.typ);return n.brief?s||r:r+(s?": "+s:"")}function g(e,t,n){var s;void 0===n&&(n={});var r=t.typ;return r=(null===(s=e.rowData("event_types",r))||void 0===s?void 0:s.templateid)||r,["testing","bexam","exam","sexam","oexam","rexam","pexam"].includes(r)?"/exam/pics/hw/"+r+"_c1.png":["ttcancel","holiday","sholiday","freeday","distant","parentsevening","meeting","bmeeting","bookroom","changeroom","trip","culture","excursion","other_safety"].includes(r)?"/calendar/pics/event_types/"+r+"_32.svg":["lesson","plesson","rlesson","ctlesson"].includes(r)?"/global/pics/ui/subject_32.svg":e.table("events").icon()}e.TABLE_events="events",e.eventMainColumns=["date","subId","typ","name","subjectid","classids","groupnames","teacherids","classroomids","period","durationperiods","starttime","endtime","allday"],e.TABLE_event_types="event_types",e.eventTypeMainColumns=["name","color","ctevent","d_ctevent"],(e.event_tableIds=n).npp=c.neededPartProvider(function(){return[d,{events:["classids","teacherids","classids","subjectid"],classes:["teacherid","changes"]}]}),(e.isClassTeacherEvent=d).needed_part=c.typed({events:["ctevent"],event_types:["ctevent","d_ctevent"]}),(e.eventTeacherids=s).npp=c.neededPartProvider(function(){return[d,{events:["teacherids","classids"],classes:["teacherid","changes"]}]}),(e.splitClassTeacherEvent=u).needed_part=c.typed({classes:["teacherid","changes"],events:["classids"]}),(e.splitClassTeacherEvents=r).needed_part=c.DBITools.mergeNeededParts(d,u),(e.isTTCancelEvent=i).needed_part=c.typed({events:["typ","ttcancel"],event_types:["ttcancel","d_ttcancel"]}),(e.isEntireSchoolEvent=a).needed_part=c.typed({events:["typ","classids","igroupids"],event_types:["noclassallclasses"]}),e.isAllClassesEvent=a,(e.isEventCancelDay=o).needed_part=c.typed({events:["typ","classids","igroupids","allday"],event_types:["ttcancel","noclassallclasses","allday"]}),(e.isAttachEvent=m).npp=c.neededPartProvider(function(){return[{events:["typ"],event_types:["attachevent","categoryid"]},i]}),(e.attachEventMatch=p).needed_part=c.typed({dailyplan:["subjectid","classids","groupnames","uniperiod"],events:["subjectid","classids","groupnames","period"]}),(e.eventCanAddStudentsAbsents=b).needed_part=c.DBITools.mergeNeededParts(i,{event_types:["attendance","lesson"]}),(e.eventHasSaConfirm=f).needed_part=c.typed({event_types:["attendance"]}),(e.eventPrivacy=_).needed_part=c.typed({events:["privacy"],event_types:["privacy"]}),(e.eventName=h).needed_part=c.typed({events:["name","typ"],event_types:["name"]}),(e.eventIcon=g).npp=c.neededPartProvider(function(){return[{events:["typ"],event_types:["templateid"]}]}),e.eventTypeOrCategory=function(e,t){return 0<=t.indexOf(e.id)||0<=t.indexOf(e.categoryid)||0<=t.indexOf(e.templateid)}},"/substitution/online/combo.js":function(e,require,t){e.__esModule=!0;var Je=require("tslib"),Ze=require("../../rpr/dbi"),$e=require("./timetable"),Xe=require("../../timetable/timeoff_r"),Qe=require("./settings"),n=require("../subst"),et=require("../../asc/lib_date"),tt=require("../filter");function s(e){var t,n=e.table,s=e.ttitem,r=e.dbi,i=e.tt_dbi,a=e.remove_ttitemids,o=e.filter,l=s.date,u=et.date_month(l),c=[],d="?",m=s;if(s.cancelled&&(m=Je.__assign(Je.__assign(Je.__assign({},s),{cancelled:!1}),s.orig)),"teachers"==n){for(var p=0,b=r.tableData(n);p<b.length;p++){(ue=b[p]).dateto&&ue.dateto<l||c.push({id:ue.id,debug_name:r.rowName(n,ue.id),cb_hidden:ue.cb_hidden,subst_hidden:ue.subst_hidden})}d="teacherids"}if("classrooms"==n){for(var f=0,_=r.tableData(n);f<_.length;f++){var h=_[f];c.push({id:h.id,cb_hidden:h.cb_hidden})}d="classroomids"}if(o&&tt.isSubstFilterOn(o)){for(var g=new Set,v=0,y=tt.substFilterRows(r,o,n,r.tableData(n));v<y.length;v++){var E=y[v];g.add(E.id)}for(var w=0,S=c;w<S.length;w++){var x=S[w];g.has(x.id)||(x.filter_out=!0)}}for(var T=function(e){var t=r.rowData("subjects",e);return!t||!t.subst_join_forbidden},C=0,k=c;C<k.length;C++){x=k[C];var D=$e.getSubstTTItemKolizie(r,i,Je.__assign(Je.__assign({},m),((t={})[d]=[x.id],t)),a);if(x.fb=$e.jeSubstKolizaAbsent(D,n,x.id),$e.jeSubstKoliziaRow(D,n,x.id)){var I=!1;if("teachers"==n&&T(s.subjectid))for(var R=0,A=D;R<A.length;R++){var N=A[R];if(N.table==n&&N.id==x.id){if(!N.join||!T(N.subjectid)){I=!1;break}I=!0}}I?x.fj=!0:x.fo=!0}}if(c=c.filter(function(e){return!e.fb}),"teachers"==n){var B=new Set;if(i)for(var j=0,P=i.tableData("lessons");j<P.length;j++){var M=P[j];if(Ze.idsIsOverlap(M.classids,m.classids))for(var O=0,z=M.teacherids;O<z.length;O++){var F=z[O];B.add(F)}}for(var L=0,G=c;L<G.length;L++){x=G[L];B.has(x.id)&&(x.fu=!0)}for(var U=new Set,q=(Oe=r.rowData("classes",m.classids[0]))&&Oe.grade||"",H=0,V=r.tableData("approbations");H<V.length;H++){var W=V[H];if(!(W.subjectids.indexOf(m.subjectid)<0)){if(q){if(W.gradefrom&&parseInt(W.gradefrom)>parseInt(q))continue;if(W.gradeto&&parseInt(W.gradeto)<parseInt(q))continue}U.add(W.id)}}for(var K=0,Y=c;K<Y.length;K++){x=Y[K];for(var J=0,Z=r.rowData("teachers",x.id).approbationids;J<Z.length;J++){var $=Z[J];U.has($)&&(x.fp=!0)}}for(var X=0,Q=m.classids;X<Q.length;X++){var ee=Q[X],te=r.rowData("classes",ee);if(te)for(var ne=0,se=c;ne<se.length;ne++){(x=se[ne]).id!=te.teacherid&&x.id!=te.teacher2id||(x.ft=!0)}}if("period"==Ze.DBITools.typeOfUniPeriod(s.uniperiod)){var re=parseInt(s.uniperiod),ie=r.rowData("substonline_dates",s.date),ae=ie.tt_num;if(ae)for(var oe=0,le=c;oe<le.length;oe++){var ue;x=le[oe];if(ue=r.rowData("teachers",x.id)){var ce=(ue.subst_tt_timeoff||ue.subst_tt_timeoff_vt)[ae];if(ce){var de=Xe.timeoff_get(ce,ie.tt_term,ie.tt_week,ie.tt_day,re);"0"==de&&(x.fx=!0),"D"==de&&(x.fd=!0)}}}}if("period"==Ze.DBITools.typeOfUniPeriod(s.uniperiod)){for(var me=parseInt(s.uniperiod),pe=me+(s.durationperiods||1)-1,be=r.tableFilterData("substonline_ttitems",{date:s.date}).filter(function(e){return a.indexOf(e.id)<0}),fe=new Set,_e=0,he=be;_e<he.length;_e++)for(var ge=he[_e],ve=0,ye=ge.teacherids;ve<ye.length;ve++){F=ye[ve];fe.add(F+":"+ge.uniperiod)}for(var Ee=r.tableIds("periods"),we=0,Se=c;we<Se.length;we++){if(!(x=Se[we]).fj&&!x.fo){F=x.id;for(var xe=null,Te=null,Ce=0,ke=Ee;Ce<ke.length;Ce++){var De=ke[Ce];if(fe.has(F+":"+De))(re=parseInt(De))<me&&(xe=re),pe<re&&null===Te&&(Te=re)}var Ie=0;(Ie=null==xe?null==Te?-5:-(Te-pe-1):null==Te?-(me-xe-1):1)&&(x.fa=Ie)}}}for(var Re=0,Ae=c;Re<Ae.length;Re++){x=Ae[Re];var Ne=r.rowData("substonline_teacher_month",u+":"+x.id);if(Ne){var Be=void 0;"classroomsupervision"==s.type?Be=Ne.sv_substing:null==(Be=Ne.de_plusminus)&&(Be=Ne.substing-Ne.absent),Be&&(x.fq=-Be)}}}if("classrooms"==n){for(var je=new Set,Pe=0,Me=m.classids;Pe<Me.length;Pe++){var Oe;ee=Me[Pe];(Oe=r.rowData("classes",ee))&&je.add(Oe.classroomid)}if(m.igroupid){var ze=r.rowData("igroups",m.igroupid);ze&&je.add(ze.classroomid)}for(var Fe=0,Le=c;Fe<Le.length;Fe++){x=Le[Fe];je.has(x.id)&&(x.frh=!0)}}var Ge=r.rowData("global_settings","1"),Ue=Qe.default_subst_online_criteria;Ge&&Ge.subst_online_criteria&&(Ue=Ge.subst_online_criteria);for(var qe=0,He=c;qe<He.length;qe++){x=He[qe];var Ve=0;e.topid&&x.id==e.topid&&(Ve+=1e6),(x.cb_hidden||x.subst_hidden)&&(Ve-=1e5),x.filter_out&&(Ve-=5e5),x.fo&&(Ve+=-5e4),x.fa&&(Ve+=Ue.assign*x.fa),x.fu&&(Ve+=Ue.teachesclass),x.fp&&(Ve+=Ue.approbation),x.fj&&(Ve+=Ue.join),x.fx&&(Ve+=-5e4),x.fd&&(Ve+=Ue.duty),x.ft&&(Ve+=Ue.classteacher),x.fq&&(Ve+=Ue.equable*x.fq),x.priorita=Ve}c.sort(function(e,t){return t.priorita-e.priorita});for(var We=0,Ke=c;We<Ke.length;We++){var Ye=[];(x=Ke[We]).fo&&Ye.push("subst-obsadeny"),(x.cb_hidden||x.subst_hidden||x.filter_out)&&Ye.push("cb_hidden"),x.className=Ye.join(" ")}return c}e.substComboTables=["teachers","classrooms"],(e.substTTItemComboItems=s).npp=n.substOnlineNeededPartProvider(function(){return[tt.substFilterRows,$e.getSubstTTItemKolizie,{global_settings:["subst_online_criteria"],substonline_dates:["tt_num","tt_day","tt_week","tt_term"],classrooms:["cb_hidden"],teachers:["approbationids","cb_hidden","subst_hidden","subst_tt_timeoff","dateto"],classes:["teacherid","teacher2id"],substonline_teacher_month:["de_plusminus","substing","absent","sv_substing"]}]}),s.ttdbi={npp:Ze.neededPartProvider(function(){return[$e.getSubstTTItemKolizie.ttdbi,{lessons:["classids","teacherids"]}]})}},"/substitution/online/settings.js":function(c,require,e){c.__esModule=!0;var d=require("tslib"),m=require("../../asc/asc_react"),p=require("react"),b=require("../../asc/edurequest"),f=require("../../rpr/itemdlg"),_=require("../../asc/asc_react2"),h=p.lazy(function(){return Promise.resolve().then(function(){return require("../../react/slider")})});c.default_subst_online_criteria={assign:10,teachesclass:3,classteacher:10,approbation:70,join:100,duty:1e4,equable:1};var o=[[0,1],[50,10],[300,100],[5e3,1e3]];function g(e){return e.cast(function(e){for(var t=0,n=o.length-1;0<=n;n--){var s=o[n];s[0]>e||(t+=(e-s[0])/s[1],e=s[0])}return t},function(e){for(var t=0,n=1,s=0,r=o;s<r.length;s++){var i=r[s],a=(i[0]-t)/n;if(e<a)break;e-=a,t=i[0],n=i[1]}return t+e*n})}var v=g(m.makeSimpleValueRef(function(){return 5e4},function(){})).value;function t(){var n=b.client_req;m.useTTLang();var e=n.getSchoolYear(),t=f.useMainDBIItemDlgState(e,"global_settings","1",{needed_part:{global_settings:["subst_online_criteria"]},blank:{subst_online_criteria:c.default_subst_online_criteria},trackEvent:function(e){return barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstSettingsCriteriaDlg."+e,eventLabel:""})}}),s=t.dbi,r=t.rowRef,i=t.rdlgProps,a=r.sub("subst_online_criteria"),o=a.value,l=s.column("global_settings","subst_online_criteria"),u=l.subcolumns||[];return p.createElement(m.RDialog,d.__assign({},i,{header:n.ls(1003),width:620,footer:p.createElement(p.Fragment,null,p.createElement(m.RButton,{label:n.ttls(1540),onClick:function(){var e={margin:20,marginTop:10};m.RDialog.showConfirm(p.createElement("div",null,p.createElement(m.VGap,{height:15}),p.createElement("div",null,["classteacher","teachesclass","approbation","join","duty"].map(function(e){return l.subcolumn(e).name()}).join(", ")),p.createElement("div",{style:e},n.ttls(1564),p.createElement(m.VGap,{height:10}),n.ttls(2191)),p.createElement("div",null,l.subcolumn("assign").name()),p.createElement("div",{style:e},n.ttls(1567)),p.createElement("div",{style:e},n.ttls(2192)),p.createElement("div",null,l.subcolumn("equable").name()),p.createElement("div",{style:e},n.ttls(1569))),{width:520,buttons:["close"],header:n.ttls(1540)})}}),p.createElement(m.RButton,{label:n.ttls(1539),onClick:function(){return r.set(function(e){return d.__assign(d.__assign({},e),{subst_online_criteria:d.__assign(d.__assign({},e.subst_online_criteria),c.default_subst_online_criteria)})})}}))}),p.createElement("div",{style:{minHeight:350}},p.createElement(_.DlgHeader,{icon:"/timetable/pics/app/office/settings_basic_32.png",title:n.localize("{6737}"),small:!0}),p.createElement(p.Suspense,{fallback:p.createElement(m.Loading,null)},p.createElement(m.RLabel,{text:n.ttls(1530)}),p.createElement("i",{className:"fa fa-arrow-down"}),p.createElement(m.HGap,{width:298}),p.createElement("i",{className:"fa fa-arrow-up"}),p.createElement(m.VGap,{height:10}),u.map(function(e){var t=a.sub(e.id);return p.createElement(p.Fragment,{key:e.id},p.createElement(m.RLabel,{text:e.name()}),p.createElement(h,{valueRef:g(t),min:0,max:v,style:{width:320}}),p.createElement("span",{style:{display:"inline-block",width:110,overflow:"hidden",textAlign:"center",verticalAlign:"middle",whiteSpace:"pre",textOverflow:"ellipsis"}},o[e.id]||n.ttls(2173)),p.createElement(m.VGap,{height:4}))}),p.createElement(m.VGap,{height:20}),p.createElement("div",null,n.ttls(2196)),p.createElement(m.VGap,{height:10}),p.createElement("div",null,n.ttls(2195)))))}c.showSubstSettingsCriteriaDlg=function(){return d.__awaiter(this,void 0,void 0,function(){return d.__generator(this,function(e){switch(e.label){case 0:return[4,m.RDialog.show(p.createElement(t,null))];case 1:return e.sent(),[2]}})})},c._hotswap=[t]},"/rpr/itemdlg.js":function(e,require,t){e.__esModule=!0;var M=require("tslib"),O=require("react"),z=require("./dbi"),F=require("../asc/asc_react"),L=require("./dbi_react"),G=require("../asc/edurequest"),U=require("../asc/actions"),q=require("../asc/asc_react2");function a(e,t,b,n,f){var s,r,i,a,o=this,_=G.client_req,h=f.trackEvent,g=f.log_module,l=f.allowNavigation,u=f.suspense;O.useEffect(function(){h&&h("open")},[]);var v=L.useSubscribedDBI(e,t,{needed_part:z.DBITools.mergeNeededParts(f.needed_part,(s={},s[b]=["_uial"],s)),client_filter:f.client_filter||(l?{}:(r={},r[b]=[{id:n}],r)),vt_filter:f.vt_filter,needed_combos:f.needed_combos,date:f.date,suspense:u}),c=v.table(b),y=F.useStateValueRef(function(){var e={id:n,changes:n?{}:f.blank_add||{},otherChange:!1,initialized:!1};return!e.id&&f.onAddingRow&&u&&(e.changes=M.__assign(M.__assign({},e.changes),f.onAddingRow({dbi:v}))),e}),d=y.value,E=d.id,m=d.initialized,p=d.changes,w=d.otherChange,S=!E,x=!z.deepStrictEqual(p,{})||w,T=O.useMemo(function(){var e={};return Object.assign(e,c.blankRow(),f.blank,v.rowData(b,E),{id:E}),e},[c,E]);O.useEffect(function(){m||v.mock||v.old||y.set(function(e){var t=e.changes;return S?f.onAddingRow&&!u&&(t=M.__assign(M.__assign({},t),f.onAddingRow({dbi:v}))):f.onEditingRow&&f.onEditingRow({dbi:v,origrow:T}),M.__assign(M.__assign({},e),{changes:t,initialized:!0})})},[m,v]);var C=null!==(i=f.readonly)&&void 0!==i?i:1==(null!==(a=T._uial)&&void 0!==a?a:c._uial),k=O.useMemo(function(){var e=new F.ValueRef(M.__assign(M.__assign({},T),p),function(n){return y.sub("changes").set(function(e){"function"==typeof n&&(n=n(M.__assign(M.__assign({},T),e)));var t=z.DBITools.rowChanges2write(T,n)||{};return delete t.id,t})});if(C)e.set=null;else for(var t=0,n=c.columns();t<n.length;t++){var s=n[t];c.column(s).def.readonly&&(e.sub(s).set=null)}return e},[T,p,c,C]),D=k.value,I=O.useRef();O.useEffect(function(){f.onChange&&f.onChange({row:D})},[D,f.onChange]);var R=F.useWorkIndicator();O.useEffect(function(){if(S&&c.column("short")){var e=function(e,t,n){var s=n.name||"";switch(t){case"classes":case"classrooms":return s;case"teachers":var r=(n.firstname||"").substr(0,1),i=(n.firstname||"").substr(0,1);return e.sort_name_col.indexOf("F")<e.sort_name_col.indexOf("L")?r+i:i+r;case"subjects":for(var a="",o=0,l=s.split(" ");o<l.length;o++){var u=l[o];a+=u.substr(0,1)}return a;default:return s.substr(0,1)}}(_,b,D);e&&k.sub("short").set(e)}},[D.name,D.lastname,D.firstname]);var A=D.name||D.lastname&&(D.firstname+" "+D.lastname).trim()||"",N=O.useRef();N.current=function(p){return void 0===p&&(p={}),M.__awaiter(this,void 0,void 0,function(){var t,n,s,r,i,a,o,l,u,c,d,m=this;return M.__generator(this,function(e){switch(e.label){case 0:return"boolean"==typeof p&&(p={confirm:p}),t=I.current,n=D,f.onValidate?[4,f.onValidate({dbi:v,table:b,origrow:T,row:n,adding:S,changed:x})]:[3,2];case 1:if(!(s=e.sent()))return[2,null];"object"==typeof s&&(n=s),e.label=2;case 2:return r=z.DBITools.rowChanges2write(T,n),i="",p.confirm&&(r||w)?[4,F.RDialog.showConfirm(_.ls(1037)+"?",{buttons:["yes","no","cancel"]})]:[3,4];case 3:if(!(a=e.sent()))return[2,null];if("no"==a)return y.sub("changes").set({}),p.close&&t.close(),[2,{cop:""}];e.label=4;case 4:if(o=E,!r)return[3,9];l=f.doWrite||function(e){var t=e.dbi,n=e.urow,s=e.adding;return M.__awaiter(m,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return s?[4,t.backend.addRow(b,n,{log_module:g})]:[3,2];case 1:return[2,e.sent()];case 2:return[4,t.backend.updateRow(b,n,{log_module:g})];case 3:return e.sent(),[2,""]}})})},u=void 0,e.label=5;case 5:return e.trys.push([5,7,,8]),[4,R(l({dbi:v,origrow:T,urow:r,adding:S}))];case 6:return u=e.sent(),[3,8];case 7:throw c=e.sent(),ASC.showError(c),c;case 8:S?(n=M.__assign(M.__assign({},n),{id:u}),i="add="+u,o=u):i="ok",h&&h("save"),e.label=9;case 9:if(!f.onAfterOk)return[3,13];e.label=10;case 10:return e.trys.push([10,12,,13]),[4,f.onAfterOk({row:n,changed:x})];case 11:return e.sent(),[3,13];case 12:return d=e.sent(),ASC.showError(d),[3,13];case 13:return p.close?t.confirmClose(i):y.set({id:o,changes:{},initialized:!1,otherChange:!1}),[2,{cop:i}]}})})};var B=O.useCallback(function(e){return N.current(e)},[]),j=O.useCallback(function(t){return M.__awaiter(o,void 0,void 0,function(){return M.__generator(this,function(e){switch(e.label){case 0:return E==t||S?[2]:[4,B({confirm:!0})];case 1:return e.sent()&&y.set({id:t,changes:{},otherChange:!1,initialized:!1}),[2]}})})},[B,E]),P=c.itemName();return S&&(P+=" - "+U.action_name("add")),{dbi:v,table:b,id:E,origrow:T,loaded:m&&!v.mock,adding:S,readonly:C,changed:x,rowRef:k,row:D,dlgRow:{dbi:v,table:b,rowRef:k},doApply:B,ensureSaved:function(){return M.__awaiter(o,void 0,void 0,function(){var t,n,s;return M.__generator(this,function(e){switch(e.label){case 0:return!S||x?[3,2]:[4,F.RDialog.showMessage(_.ls(8132),{msgType:"fail"})];case 1:return e.sent(),[2,""];case 2:return[4,B({confirm:!0})];case 3:return(t=e.sent())?(n=E,(s=t.cop).startsWith("add=")&&(n=s.substr(4)),[2,n]):[2,""]}})})},navigate:j,setHasOtherChange:function(){return y.set(function(e){return e.id!=E||e.otherChange?e:M.__assign(M.__assign({},e),{otherChange:!0})})},rdlg:I.current,rdlgProps:{controlRef:I,header:P,buttons:C&&!x?["close"]:["ok","cancel"],width:400,onConfirm:function(n){return M.__awaiter(o,void 0,void 0,function(){var t;return M.__generator(this,function(e){switch(e.label){case 0:return[4,B()];case 1:return(t=e.sent())&&n.confirmClose(t.cop),[2]}})})},footer:l&&!S&&O.createElement(H,{dbi:v,table:b,id:E,navigate:j,navigateids:f.navigateids}),asc_info:E},header:O.createElement(q.DlgHeader,{icon:D.icon||c.icon(),title:A||c.itemName(),subtitle:D.short||(c.column("short")?String.fromCharCode(160):void 0),small:!0})}}function H(e){var t=G.client_req,n=e.dbi,s=e.table,r=e.id,i=e.navigate,a=e.navigateids,o=O.useMemo(function(){return(0<(null==a?void 0:a.length)?a:n.tableIds(s)).filter(function(e){var t=n.rowData(s,e);return t&&0!==t._uial})},[n,s,a]),l=o.indexOf(r);return l<0?null:O.createElement(O.Fragment,null,[[o[l-1],"<",t.ls(1170)],[o[l+1],">",t.ls(1171)]].map(function(e,t){var n=e[0],s=e[1],r=e[2];return O.createElement(F.RButton,{key:t,content:O.createElement("span",{style:{display:"inline-block",transform:"scale(1.5)"}},s),title:r,onClick:void 0!==n?function(){return i(n)}:void 0})}),O.createElement(F.HGap,null))}e.useMainDBIItemDlgState=function(t,e,n,s){var r=G.client_req,i=a("maindbi",""+t,e,n,s);return O.useMemo(function(){var e=i;return t!=r.getSchoolYear()&&(e=M.__assign(M.__assign({},e),{rdlgProps:M.__assign(M.__assign({},e.rdlgProps),{header:O.createElement(O.Fragment,null,e.rdlgProps.header," ("+r.getSchoolYearName(t)+")")})})),e},[i])},e.useItemDlgState0=a,e.ItemDlgNavigation=H},"/substitution/filter.js":function(e,require,t){e.__esModule=!0;var n=require("tslib"),s=require("../rpr/dbi"),j=require("./subst"),P=["cz_zs_stupen","sk_zs_stupen","grade"];function r(t){return!!(t.buildingid||t.schoolid||P.find(function(e){return t[e]}))}function i(a,o){var e=a.req,l=[],u=o.value;0<a.tableData("buildings").length&&l.push({text:a.table("buildings").itemName(),checked:!!u.buildingid,submenu:a.tableIds("buildings").map(function(e){var t=u.buildingid==e;return{text:a.rowName("buildings",e),checked:t,onClick:function(){return o.sub("buildingid").set(t?"":e)}}})}),1<a.tableData("ourschools").length&&l.push({text:e.ls(1949),checked:!!u.schoolid,submenu:a.tableIds("ourschools").map(function(e){var t=u.schoolid==e;return{text:a.rowName("ourschools",e),checked:t,onClick:function(){return o.sub("schoolid").set(t?"":e)}}})});for(var t=function(n){var s=[],e=a.column("classes",n);if(!e)return"continue";for(var t=function(e){if(Array.isArray(e)||!e.value)return"continue";var t=u[n]==e.value;s.push({text:e.name,checked:t,onClick:function(){return o.sub(n).set(t?"":e.value)}})},r=0,i=e.combo();r<i.length;r++){t(i[r])}l.push({text:a.column("classes",n).name(),checked:!!u[n],submenu:s})},n=0,s=P;n<s.length;n++){t(s[n])}return r(u)&&(l.push([]),l.push({text:e.ls(1859),onClick:function(){return o.set({})}})),l}function a(e,t,n,s,r){void 0===r&&(r={});var i=s,a=r.onlyDirect,o=t.buildingid,l=t.schoolid,u="subst_substitutions"==n||"substonline_substitutions"==n,c="subst_absents"==n||"substonline_absents"==n,d="subst_ttitems"==n||"substonline_ttitems"==n;a&&"classrooms"!=n&&"classes"!=n&&"igroups"!=n&&ASC.dieError("9339160101",[n,t]);function m(){return{classrooms:new Set,classes:new Set,igroups:new Set,teachers:new Set}}function p(a){function r(e,t){if(!t)return!1;for(var n=a[e],s=0,r=t;s<r.length;s++){var i=r[s];if(n.has(i))return!0}return!1}if(u&&(i=i.filter(function(e){for(var t=0,n=[j.coreTTItemOfSubst(e),j.coreTTItemOfSubst(e,!0)];t<n.length;t++){var s=n[t];if(r("classrooms",s.classroomids))return!0;if(r("classes",s.classids))return!0;if(s.igroupid&&a.igroups.has(s.igroupid))return!0;if(r("teachers",s.teacherids))return!0}return!1})),d&&(i=i.filter(function(e){for(var t=0,n=[e,e.orig];t<n.length;t++){var s=n[t];if(s){if(r("classrooms",s.classroomids))return!0;if(r("classes",s.classids))return!0;if(s.igroupid&&a.igroups.has(s.igroupid))return!0;if(r("teachers",s.teacherids))return!0}}return!1})),c&&(i=i.filter(function(e){var t=a[j.absentGetTable(e)];return!t||(0==t.size||t.has(j.absentGetId(e)))})),"events"==n&&(i=i.filter(function(e){return!!r("classes",e.classids)||(!!r("classrooms",e.classroomids)||(!!r("teachers",e.teacherids)||!!r("igroups",e.igroupids)))})),"classes"==n||"teachers"==n||"classrooms"==n||"igroups"==n){var t=a[n];0<t.size&&(i=i.filter(function(e){return t.has(e.id)}))}}if(o&&(!a||"classrooms"==n)){for(var b=m(),f=0,_=e.tableData("classrooms");f<_.length;f++){(v=_[f]).buildingid==o&&b.classrooms.add(v.id)}for(var h=0,g=e.tableData("classes");h<g.length;h++){var v=g[h];b.classrooms.has(v.classroomid)&&b.classes.add(v.id)}for(var y=0,E=e.tableData("igroups");y<E.length;y++){v=E[y];b.classrooms.has(v.classroomid)&&b.igroups.add(v.id)}for(var w=0,S=e.tableData("teachers");w<S.length;w++){(v=S[w]).buildingid==o&&b.teachers.add(v.id)}p(b)}if(l&&(!a||"classes"==n||"igroups"==n)){b=m();for(var x=0,T=e.tableData("classes");x<T.length;x++){(v=T[x]).schoolid==l&&b.classes.add(v.id)}for(var C=0,k=e.tableData("igroups");C<k.length;C++){(v=k[C]).schoolid==l&&b.igroups.add(v.id)}p(b)}for(var D=0,I=P;D<I.length;D++){var R=I[D],A=t[R];if(A){if("igroups"==n)return[];b=m();for(var N=0,B=e.tableData("classes");N<B.length;N++){(v=B[N])[R]==A&&b.classes.add(v.id)}p(b)}}return i}e.isSubstFilterOn=r,e.substFilterText=function(e,t){var n=[];t.buildingid&&n.push(e.rowName("buildings",t.buildingid)),t.schoolid&&n.push(e.rowName("ourschools",t.schoolid));for(var s=0,r=P;s<r.length;s++){var i=r[s],a=t[i];if(a){var o=e.column("classes",i);n.push(o?o.textValue(a):i+": "+a)}}return n.join(", ")},(e.substFilterMenu=i).needed_part=s.typed({buildings:["__name"],ourschools:["__name"],classes:P}),i.needed_combos=s.typed({classes:P}),(e.substFilterRows=a).needed_part=s.typed({classrooms:["buildingid"],teachers:["buildingid"],classes:n.__spreadArrays(["schoolid"],P),igroups:["schoolid"]})},"/timetable/ttview_components.js":function(t,require,e){t.__esModule=!0;var J=require("tslib"),Z=require("react"),$=require("../asc/asc_react"),v=require("../asc/edurequest"),X=require("../rpr/dbi"),Q=require("./app/ttdoc"),ee=require("../asc/lib_date"),l=require("../react/sticky"),te=require("../calendar/event_popup"),E=require("../asc/asc_react2");function a(e){var t=e.box,n=e.text,s=e.swap,r=e.splitLineTop,i=e.bgIcon,a=e.icon,o=e.icon_tooltip,l=e.onClick,u=$.useColors();return Z.createElement(Z.Fragment,null,i&&Z.createElement("img",{src:i,style:{position:"absolute",left:t.x1,top:t.y1,height:t.y2-t.y1,width:t.x2-t.x1,opacity:.3}}),Z.createElement($.RTextBox,J.__assign({},$.swapBox(t,s),{text:n,hAlign:"center",vAlign:"center",style:J.__assign({fontSize:18,textShadow:i?"0px 0px 2px #ffffff":void 0,cursor:l?"pointer":void 0},e.style||{}),onClick:l})),a&&Z.createElement("img",{src:a,title:o,style:{position:"absolute",left:t.x2-16,top:t.y1+1,width:16}}),r&&Z.createElement($.RBox,J.__assign({},$.swapBox({x1:t.x2-.25*(t.x2-t.x1),x2:t.x2,y1:t.y1,y2:t.y1+1},s),{style:{backgroundColor:u.faintLine}})))}function y(e){for(var t=[],n=1;n<=23;n++){var s=("0"+n).substr(-2)+":00",r=e.data2t({starttime:s,endtime:s}),i=e.t2p(r.t1);i<=0||i>=e.pSize||t.push({time:s,x:i})}return t}function T(e){var t,s=e.tlr,n=e.dbi,r=e.rowHeight,i=e.swapAxis,a=null!==(t=e.gridMode)&&void 0!==t?t:"periods",o=$.useColors(),l="px solid "+o.faintLine,u={x1:0,x2:s.pSize,y1:0,y2:r},c=null;if("hours"==a){var d={position:"absolute",pointerEvents:"none"};c=y(s).map(function(e,t){e.time;var n=e.x;return i?Z.createElement("div",{key:t,style:J.__assign(J.__assign({},d),{top:n,left:0,right:0,height:1,borderTop:1+l})}):Z.createElement("div",{key:t,style:J.__assign(J.__assign({},d),{left:n,top:0,bottom:0,width:1,borderLeft:1+l})})})}else c=n.tableData("periods").map(function(e){var t=s.data2t(e),n={x1:s.t2p(t.t1),x2:s.t2p(t.t2)+1,y1:0,y2:r};return Z.createElement($.RBox,J.__assign({key:e.id},$.swapBox(n,i),{style:J.__assign({background:"none",pointerEvents:"none"},i?{borderTop:1+l,borderBottom:1+l}:{borderLeft:1+l,borderRight:1+l})}))});return Z.createElement(Z.Fragment,null,Z.createElement($.RBox,J.__assign({},$.swapBox(u,i),{style:{borderTop:"1px solid "+o.faintLine,borderLeft:"1px solid "+o.faintLine}})),c)}function w(e,t){void 0===t&&(t=!1);var n=0;e=e||"";for(var s=0;s<e.length;s++){var r=e.charCodeAt(s);n=(9273780287*(n+=r+r<<12)>>8)+n}for(var i="",a=t?20:110,o=t?128:250,l=0;l<3;l++){var u=n>>8*l&255;i+=(u=u%(o-a)+a).toString(16).substr(-2)}return"#"+i}function b(e){var t=e.box,n=e.side,s=e.text_center,r=e.text_tl,i=e.text_tr,a=e.text_bl,o=e.text_br,l=e.onClick,u=e.tooltip,c=e.small,d=e.status||"",m=e.icons_tl||[],p=e.icons_tr||[],b=.9*Math.max(t.y2-t.y1,8),f=Math.min(c?14:18,b),_=Math.min(c?9:10,b/2),h=e.background||"#c0c0c0";"auto"==h&&(h=w(s));var g="#000000";switch(d){case"out":g="#808080",h="#c0c0c0";break;case"out2":g="#a0a0a0",h="#e0e0e0"}function v(e){return(e=e.filter(function(e){return e})).length<2?e[0]:Z.createElement("div",null,Z.createElement(E.RJoin,{children:e,glue:" "}))}function y(e){return Z.createElement("img",{src:e,style:{verticalAlign:"middle",height:16,width:16,filter:"drop-shadow(0px 0px 3px rgb(255,255,255,0.8))",display:"inline-block"}})}return Z.createElement(Z.Fragment,null,Z.createElement($.RTextBox,J.__assign({},t,{text:s,hAlign:"center",vAlign:"center",style:J.__assign({background:h,color:g,padding:1,fontSize:n?void 0:f,borderRadius:3,cursor:l?"pointer":"default",border:e.border,whiteSpace:n?"pre":void 0},e.style_center||{}),title:u,onClick:l})),!n&&Z.createElement(Z.Fragment,null,(r||0<m.length)&&Z.createElement($.RTextBox,J.__assign({},e.box,{text:v(J.__spreadArrays(m.map(y),[r])),hAlign:"left",vAlign:"top",style:{color:g,paddingLeft:3,paddingTop:1,fontSize:_,pointerEvents:"none"}})),(i||0<p.length)&&Z.createElement($.RTextBox,J.__assign({},e.box,{text:v(J.__spreadArrays([i],p.map(y))),hAlign:"right",vAlign:"top",style:{color:g,paddingRight:3,paddingTop:1,fontSize:_,pointerEvents:"none"}})),a&&Z.createElement($.RTextBox,J.__assign({},e.box,{text:a,hAlign:"left",vAlign:"bottom",style:{color:g,paddingLeft:3,paddingBottom:1,fontSize:_,pointerEvents:"none"}})),o&&Z.createElement($.RTextBox,J.__assign({},e.box,{text:o,hAlign:"right",vAlign:"bottom",style:{color:g,paddingLeft:3,paddingBottom:1,fontSize:_,pointerEvents:"none"}}))),"selected"==d&&Z.createElement(k,{box:t}))}function ne(e,t,n,s){var r=e.req;return"classes"==t&&1<n.length&&X.idsArrayMatchI(n,e.tableIds(t))?r.ls(3100):n.length<5?e.rowNames(t,n,s):n.length+" "+e.tools.itemName(t,n.length)}function C(e){var t,n=e.dbi,s=e.ttitem,r=e.table,i=e.id,a=e.tlr_part,o=e.showTime,l=e.swapAxis,u=e.small,c=e.grayed,d=e.onClick,m=n.req,p=e.box,b=e.colors,f=$.useColors(),_=f.darkMode,h="",g="";"classes"==r&&(g=i),"students"==r&&(g=null===(t=n.rowData("students",i))||void 0===t?void 0:t.classid);var v="";"top"!=a&&"bottom"!=a||(h="ellipsis",l&&(v="bottom"==a?"right":"left")),"supervisionside"!=a||l||(v="left",h="clip");var y=s.eventids,E=v?p.x2-p.x1:p.y2-p.y1,w=v?p.y2-p.y1:p.x2-p.x1,S=.9*E,x=Math.min(u?14:18,S),T=Math.min(u?9:10,S/2),C=s.name||"",k="",D="",I="",R="",A=s.ol_url,N=f.fgBlack,B=_?"#444":"#d0d0d0",j=void 0,P=!1,M=_?"#666":"#909090",O=_?"#353":"#d0ffd0",z=_?"repeating-linear-gradient(-45deg,#353,#353 5px,#666 5px,#666 10px)":"repeating-linear-gradient(-45deg,#d0ffd0,#d0ffd0 5px,#d0d0d0 5px,#d0d0d0 10px)";switch(s.type){case"absent":B=s.eventid?z:M,P=!0;break;case"event":B=s.absentid?z:O,P=!0;break;case"classroomsupervision":j="inset 0px 0px 0px 1px #b0b0b0",C="classrooms"==r?n.rowNames("teachers",s.teacherids,"short"):n.rowNames("classrooms",s.classroomids,"short");break;case"subst_duty":C=Z.createElement("img",{src:"/substitution/pics/must_be_32.svg",height:Math.min(32,E)});break;case"out":N=_?"#888":"#a0a0a0",B=_?"#444":"#e0e0e0";break;case"other":N=_?"#666":"#c0c0c0",B=f.bgBox}C=C||(s.igroupid?n.rowName("igroups",s.igroupid):n.rowName("subjects",s.subjectid,"short"));var F=m.isApp();if(!h&&"classroomsupervision"!=s.type){if(!s.groupnames||X.DBITools.groupnamesIsEntireClass(s.groupnames)||F||(k=n.tools.groupnames_names(s.groupnames)),"classrooms"!=r){var L=s.classroomids,G=!1;if(g&&1==L.length)n.rowData("classes",g).classroomid==L[0]&&(G=!0);G||(D=ne(n,"classrooms",L,"short"))}"classes"==r||"igroups"==r||"students"==r?(I=ne(n,"teachers",s.teacherids,"short"),o&&s.starttime&&s.endtime&&(R=ee.date_format_2times(m,s.starttime,s.endtime,{short:!0,ajSekundy:!1}))):(I=ne(n,"classes",s.classids),"teachers"==r?o&&s.starttime&&s.endtime&&(R=ee.date_format_2times(m,s.starttime,s.endtime,{short:!0,ajSekundy:!1})):R=ne(n,"teachers",s.teacherids,"short"))}s.removed&&(B=_?"#444":"#c0c0c0",N=_?"#000":"#e0e0e0");var U=b&&0<b.length;if(U){var q=Q.colorsLuma(b);"#000000"==N&&q<=.25&&(N="#ffffff")}j="0 0.5px 1px 0.5px rgba(0,0,0,0.25)";var H=$.swapBox(p,l),V=E<25?1:2,W=U?b[0]:B;U&&1<b.length&&(W=void 0);var K=void 0;c&&(K=.3,W=void 0);var Y=C;return h?Y=Z.createElement("span",{style:{textOverflow:h,whiteSpace:"nowrap",overflow:"hidden",backgroundColor:W}},C):W&&(Y=Z.createElement("span",{style:{backgroundColor:W}},C)),Z.createElement(Z.Fragment,null,Z.createElement($.RBox,J.__assign({},H,{className:"tt-cell",style:J.__assign({padding:1,background:U?Q.strippedBackground(b,H.x2-H.x1,H.y2-H.y1):B,boxShadow:j,borderRadius:P?4:3,cursor:d?"pointer":void 0,opacity:K},e.style||{}),onClick:d})),Z.createElement(Z.Fragment,null,Z.createElement($.RBox,J.__assign({},H,{style:{padding:V+"px 3px",color:N,fontSize:T,pointerEvents:"none",opacity:K}}),k,(D||A||y)&&Z.createElement("div",{style:{float:"right",maxWidth:w-6}},D,A&&Z.createElement(se,{style:{marginLeft:3,height:u?12:void 0}}),y&&y.map(function(e){return Z.createElement(te.EventIcon,{key:e,dbi:n,eventid:e,where:"timetable",style:{verticalAlign:"middle",marginLeft:3}})}))),I&&Z.createElement($.RTextBox,J.__assign({},H,{text:I,hAlign:"left",vAlign:"bottom",style:{color:N,paddingLeft:3,paddingBottom:V,fontSize:T,pointerEvents:"none",opacity:K}})),R&&Z.createElement($.RTextBox,J.__assign({},H,{text:R,hAlign:"right",vAlign:"bottom",style:{color:N,paddingRight:3,paddingBottom:V,fontSize:T,pointerEvents:"none",opacity:K}}))),Z.createElement($.RTextBox,J.__assign({},H,{hAlign:"center",vAlign:"center",rotate:v,style:J.__assign({color:N,fontSize:x,pointerEvents:"none",alignItems:"center",opacity:K},e.style||{}),text:Y})))}function se(e){var t=$.useReq();return Z.createElement("img",{src:"/global/pics/ui/videocall_16.svg",style:J.__assign({verticalAlign:"middle",filter:"drop-shadow(0px 0px 3px rgb(255,255,255,0.8))"},e.style||{}),title:t.ls(9794)})}function k(e){var t=e.box,n=e.swapAxis;return Z.createElement(Z.Fragment,null,Z.createElement($.RBox,J.__assign({},$.swapBox(t,n),{style:{boxShadow:"0px 0px 10px 2px #000000",zIndex:1,pointerEvents:"none",borderRadius:3}})),Z.createElement($.RBox,J.__assign({},$.swapBox(t,n),{style:{border:"1px solid #ffffff",zIndex:2,pointerEvents:"none",borderRadius:3}})))}t.COLOR_lines="#f5f5f5",t.TTView_OuterLines=function(e){return Z.createElement($.RBox,J.__assign({},e.outerBox,{style:{pointerEvents:"none",borderRight:"1px solid "+t.COLOR_lines,borderBottom:"1px solid "+t.COLOR_lines}}))},t.TTView_Header=a,t.TTView_Day=function(e){var t=e.box,n=e.date,s=e.splitLineTop,r=e.swap,i=v.client_req;return Z.createElement(a,{box:t,swap:r,splitLineTop:s,text:Z.createElement(Z.Fragment,null,ee.date_day_name(i,n,!0),Z.createElement("span",{style:{fontSize:10}},ASC.ASC_date2str(n,!1)))})},t.TTView_Object=function(e){var t=e.dbi,n=e.table,s=e.id,r=e.showTable;return Z.createElement(a,J.__assign({},J.__assign(J.__assign({},e),{text:t.rowName(n,s,"short"),bgIcon:r?t.table(n).icon():e.bgIcon})))},t.TTView_Periods=function(e){var t,n,r=v.client_req,s=e.tlr,i=e.dbi,a=e.onPeriodClick,o=e.periodsBox,l=e.swapAxis,u=e.showTime,c=$.useColors(),d=null!==(t=e.periodHeight)&&void 0!==t?t:o.y2-o.y1,m=null;if("hours"==(null!==(n=e.gridMode)&&void 0!==n?n:"periods"))m=y(s).map(function(e){var t=e.time,n=e.x,s={x1:n-20,x2:n+20,y1:0,y2:d-2};return Z.createElement($.RTextBox,J.__assign({key:t},$.swapBox(s,l),{hAlign:l?"right":"center",vAlign:l?"center":"bottom",style:{color:"#c0c0c0",fontSize:12},text:ee.date_format_time0(r,t,{short:!0,ajSekundy:!1})}))});else{var p=e.periods||i.tableData("periods"),b=(l?d:s.pSize/p.length)<100;s.clear(),s.qSize=d;for(var f=s,_=0,h=p;_<h.length;_++){var g=h[_];f.addItem("main",g)}f.render(),m=f.items.map(function(e){var t=e.data,n=$.swapBox(f.item2box(e),l),s=Math.min(1,(n.y2-n.y1)/40);return Z.createElement($.Fragment,{key:t.id},Z.createElement($.RTextBox,J.__assign({},n,{text:Z.createElement(Z.Fragment,null,Z.createElement("span",{style:{whiteSpace:"pre"}},t.short),u&&Z.createElement("span",{style:{fontSize:10*Math.min(s,(n.x2-n.x1)/65),whiteSpace:"pre"}},ee.date_format_2times(r,t.starttime,t.endtime,{ajSekundy:!1,short:b}))),hAlign:"center",vAlign:"center",style:{fontSize:18*s,cursor:a?"pointer":void 0},onClick:a?function(){return a(t.id)}:void 0})))})}return o?Z.createElement($.RBox,J.__assign({},$.swapBox(o,l),{style:{background:c.bgWhite}}),m):Z.createElement(Z.Fragment,null,m)},t.TTView_Lines=T,t.nameColor=w,t.TTView_Cell=b,t.TTView_CellTTItem=C,t.TTView_CellDP=function(e){var t=v.client_req,n=e.dbi,s=e.table,r=e.dp,i=$.useColors().darkMode,a=t.isApp(),o="",l="",u="",c="",d="",m=e.autoColor?"auto":"";if(r.eventid){var p=n.rowData("events",r.eventid,{});0!==p._uial&&(o=p.name||n.rowData("event_types",p.typ,{}).name||"",m=i?"#353":"#d0ffd0")}else{if(o=r.igroupid?n.rowName("igroups",r.igroupid):n.rowName("subjects",r.subjectid,"short"),!r.groupnames||X.DBITools.groupnamesIsEntireClass(r.groupnames)||a||(u=n.tools.groupnames_names(r.groupnames)),"classrooms"!=s)l=ne(n,"classrooms",r.classroomids,"short");"classes"==s||"igroups"==s||"students"==s?c=ne(n,"teachers",r.teacherids,"short"):(c=ne(n,"classes",r.classids),"teachers"==s||(d=ne(n,"teachers",r.teacherids,"short")))}return Z.createElement(b,{box:e.box,text_center:o,text_tl:u,text_tr:l,text_bl:c,text_br:d,style_center:e.style,background:m,small:e.small})},t.TTView_IconOL=se,t.TTView_TTDay=function(e){var i=e.dbi,t=e.box,n=e.gap_day,a=e.table,o=e.id,l=e.tlr,s=e.ttitems,u=e.onTTItemClick,c=e.selectedTTItem,d=e.highlightTTItem,m=e.swapAxis,r=e.showTime,p=t.y2-t.y1;l.clear(),l.qSize=p-n;for(var b=0,f=s;b<f.length;b++){var _=f[b],h="main";"event"==_.type&&(h="autotop"),"classroomsupervision"==_.type&&(h="supervision","break"==X.DBITools.typeOfUniPeriod(_.uniperiod)&&(h="supervisionside")),"absent"!=_.type&&"subst_duty"!=_.type||(h="autobottom"),_.removed&&"main"==h&&(h="autobottom"),_.main&&(h="main"),l.addItem(h,_,{slices:_.cellSlices,order:_.cellOrder})}l.render();var g=null;if(r){var v=l.t2p(l.data2t({starttime:r}).t1),y=Math.round(v-.5),E=Math.min(5,l.pSize-y),w={x1:y-5,y1:-5,x2:y+1+E,y2:p-n+5-0},S="#ff0000",x="rgba(0,0,0,0)";g=Z.createElement($.RBox,J.__assign({},$.swapBox(w,m),{style:{background:S,borderLeftWidth:5,borderTopWidth:5,borderRightWidth:m?5:E,borderBottomWidth:m?E:5,borderStyle:"solid",backgroundClip:"content-box",borderColor:m?x+" "+S:S+" "+x,pointerEvents:"none",zIndex:1}}))}return Z.createElement(Z.Fragment,null,Z.createElement($.RBox,J.__assign({},$.swapBox(t,m),{style:{overflow:"visible"}}),Z.createElement(T,{dbi:i,tlr:l,rowHeight:p,swapAxis:m,gridMode:e.gridMode}),l.renderOrderItems().map(function(e,t){var n=l.item2box(e,1,1),s=e.data,r=c==s;return Z.createElement($.Fragment,{key:t},Z.createElement(C,J.__assign({},{dbi:i,table:a,id:o,box:n,swapAxis:m,ttitem:s,style:{border:s.removed?"1px dashed #808080":s.changed?"2px dashed #000":void 0},colors:s.colors,showTime:e.wasAligned,grayed:d?!d(s):void 0,tlr_part:e.part,onClick:u?function(){return u(s)}:void 0})),r&&Z.createElement(k,{box:n,swapAxis:m}))}),g),Z.createElement($.RBox,J.__assign({},$.swapBox(t,m),{style:{pointerEvents:"none"}})))},t.TTView_CellSelect=k,t.calcTTViewBoxes=function(e){var t,n=e.clientWidth,s=e.clientHeight,r=e.fit,i=e.swapAxis,a=e.time_mode,o=e.nDays,l=e.nPeriods,u=6,c=void 0;e.showHeader&&(c=37);var d=45;a&&0==l&&!i&&(d=18);var m=80,p=e.small?60:110,b=n-m-0-1;if(i){m=(t=[d,m])[0],d=t[1],p=150,b=a?800:Math.max(52*l,400),u=6;var f=(n-d-1)/o;r&&(p="shrink"==r?Math.min(p,f):f,b=s-(c||0)-m-0-1),print&&(p=Math.min(p,f))}else{a||(m=Math.min(m,Math.max(n/(l+1),35))),b=n-m-0-1;var _=a?600:35*(l+1),h=Math.round(1.2*_);if(b<_&&(b=h),r){f=Math.floor((s-(c||0)-d-0-1)/o);p="shrink"==r?Math.min(p,f):f}}var g={x1:0,x2:m,y1:0,y2:d},v={x1:m+0,x2:m+0+b,y1:d+0,y2:d+0+p*o};return{gap:3,gap_day:u,ttWidth:b,periodHeight:d,rowHeight:p,dayWidth:m,headerWidth:Math.min(n,i?v.y2:v.x2),headerHeight:c,ttBox:v,weekBox:g,ttRowBox:function(e){var t=e*p;return{x1:0,x2:b,y1:t,y2:t+p}},dayBox:function(e){var t=p*e;return{x1:0,x2:m,y1:t,y2:t+p}}}},t.TTView_Boxes=function(e){var t,n=e.periods,s=e.days,r=e.corner,i=e.tt,a=e.ttBox;e.swapAxis&&(a=$.swapBox(a,!0),s=(t=[n,s])[0],n=t[1]);var o=$.useColors();return Z.createElement(l.Sticky,{style:{width:a.x2+1,height:a.y2+1,backgroundColor:o.bgWhite},backgroundColor:o.bgWhite,headerSize:a.y1,header:Z.createElement(l.Sticky,{side:"left",style:{height:a.y1},headerSize:a.x1,backgroundColor:o.bgWhite,header:r},n)},Z.createElement(l.Sticky,{side:"left",style:{height:a.y2-a.y1},backgroundColor:o.bgWhite,headerSize:a.x1,header:s,style_content:{borderRight:"1px solid "+o.faintLine,borderBottom:"1px solid "+o.faintLine}},i))},t.TTView_PageHeader=function(e){var t,n=e.dbi,s=e.table,r=e.id,i=e.headerHeight,a=e.headerWidth,o=n.rowName(s,r);return"students"==s&&(o=n.rowName("classes",null===(t=n.rowData("students",r))||void 0===t?void 0:t.classid)+" - "+o),i?Z.createElement("div",{style:{fontSize:32,whiteSpace:"pre",textAlign:"center",width:a,height:i,position:"sticky",left:0}},Z.createElement("span",{className:"print-font-resizable"},o)):null},t.ttview_div_style={overflow:"auto",color:"#000",backgroundColor:"#fff",fontFamily:"sans-serif"}},"/timetable/app/ttdoc.js":function(b,require,e){b.__esModule=!0;var t,n,s,r,f=require("tslib"),_=require("../../asc/asc_react"),h=require("../../asc/edurequest"),i=require("../../rpr/dbi"),g=require("react"),a=require("./server/ttdoc");function v(t){return!!b.metaclassrooms_priorita_def.find(function(e){return e.id==t})}function o(d,m,p){return f.__awaiter(this,void 0,void 0,function(){var t,n,s,r,i,a,o,l,u,c;return f.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.loadTTLang()];case 1:return e.sent(),[4,Promise.resolve().then(function(){return require("../../rpr/vyber")})];case 2:if(t=e.sent().DBIVyberDlg,n={current:null},"metaclassrooms"!=m)return[3,4];for(s=[],r="*optimal",i=0,a=p;i<a.length;i++)v(o=a[i])?r=o:s.push({id:o,select:r});return[4,_.RDialog.show(g.createElement(t,f.__assign({},{dbi:d,table:m,selected:s,filter:function(e){return!v(e)},selectTypes:b.metaclassrooms_priorita_def.map(function(e){return{id:e.id,icon:e.icon,name:h.client_req.localize(e.short)}}),selectedRef:n})))];case 3:if(!e.sent())return[2,null];for(p=[],r="*optimal",l=0,u=n.current;l<u.length;l++)(c=u[l]).select!=r&&(r=c.select,p.push(r)),p.push(c.id);return[2,p];case 4:return[4,_.RDialog.show(g.createElement(t,f.__assign({},{dbi:d,table:m,ids:p,selectedRef:n})))];case 5:return e.sent()?[2,n.current.map(function(e){return e.id})]:[2,null]}})})}function l(r,i){return i.seminargroup&&i.groupids&&i.classids?0<i.groupids.length?i.classids.filter(function(e){for(var t=0,n=i.groupids;t<n.length;t++){var s=n[t];if(r.rowData("groups",s,{}).classid==e)return!1}return!0}):i.classids:[]}function u(e,t,n){for(var s=0,r=e.tableData(t+"defs");s<r.length;s++){var i=r[s];if(!(1<i.vals.length)&&i.vals[0]==n)return i}return null}function c(e,t,n){var s=u(e,t,n);return s?e.rowName(t+"defs",s.id):n}function d(e,t,n){if(void 0===n&&(n="short"),!t.days)return"";for(var s=e.rowData("lessons",t.lessonid),r=f.__assign(f.__assign({},s),t),i="",a=0,o=["terms","weeks","days"];a<o.length;a++){var l=o[a],u=r[l];u.indexOf("0")<0||(i&&(i+=", "),i+=c(e,l,u))}return(i+" "+e.tools.uniperiodName(t.period,n,s)).trim()}function m(e,t,n){return void 0===n&&(n="short_name"),p(e,t,null,n)}function p(e,t,n,s){void 0===s&&(s="BHSN");var r=e.req;if(!t)return"";if(n)return"BHSN"==s&&"classes"==t.table&&"subjects"==n.id?"("+m(e,t,"short")+":"+m(e,n,"short")+") "+m(e,t,"name")+": "+m(e,n,"name"):m(e,t,s)+" : "+m(e,n,s);switch(t.table){case"cards":var i=e.rowData("cards",t.id),a=m(e,{table:"lessons",id:i.lessonid})+" - ";return i.days?a+=d(e,i,"short"):a+=r.ttls(1765),a;case"lessons":var o=e.rowData("lessons",t.id);a=e.rowName("subjects",o.subjectid);return o.seminargroup&&(a+=" "+o.seminargroup),a+=" (",0==o.classids.length?a+=r.ttls(2825):a+=e.rowNames("classes",o.classids,"short"),a+=")",0<o.groupnames.length&&!o.groupnames.includes("")&&(a+=" "+e.tools.groupnames_names(o.groupnames)),a;case"globals":return r.ttls(3756)}return e.rowName(t.table,t.id,s)}function y(e){var t={periodfrom:void 0,periodto:void 0,days:void 0,weeks:void 0,terms:void 0},n=e.tableData("periods");0<n.length&&(t.periodfrom=parseInt(n[0].id),t.periodto=parseInt(n[n.length-1].id));for(var s=0,r=["days","weeks","terms"];s<r.length;s++){var i=r[s],a=e.tableData(i);if(0<a.length)t[i]=a.length;else{var o=e.tableData(i+"defs");if(0<o.length){var l=o[0],u=l.vals||l[i];u&&(t[i]=u[0].length)}}}return t}function E(e,t){if(t<=1)return"";var n=Math.round(255*e/(t-1));return"rgb("+n+","+n+","+n+")"}function w(e){return e&&7==e.length?{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}:null}(t=b.TypCoGenerovat||(b.TypCoGenerovat={}))[t.TCG_VSETKO=0]="TCG_VSETKO",t[t.TCG_STUDENTI=1]="TCG_STUDENTI",t[t.TCG_STUDENTI_BEZKARIET=2]="TCG_STUDENTI_BEZKARIET",t[t.TCG_MASTER=3]="TCG_MASTER",t[t.TCG_MASTER_LOCKSTUDENTI=4]="TCG_MASTER_LOCKSTUDENTI",t[t.TCG_MASTER_HIDDENSTUDENTI=5]="TCG_MASTER_HIDDENSTUDENTI",t[t.TCG_UCEBNE=6]="TCG_UCEBNE",t[t.TCG_UCEBNE_LOCKPRIRADENE=7]="TCG_UCEBNE_LOCKPRIRADENE",t[t.TCG_VSETKO_BEZUCEBNI=8]="TCG_VSETKO_BEZUCEBNI",t[t.TCG_REARRANGESTUDENTSINSEMINARGROUPS=9]="TCG_REARRANGESTUDENTSINSEMINARGROUPS",t[t.TCG_ASSIGNSTUDENTS=10]="TCG_ASSIGNSTUDENTS",t[t.TCG_VSETKO_WEEK1=11]="TCG_VSETKO_WEEK1",t[t.TCG_VSETKO_WEEK2=12]="TCG_VSETKO_WEEK2",t[t.TCG_ANALYZE=13]="TCG_ANALYZE",t[t.TCG_MAX=14]="TCG_MAX",t[t.TCG_MASK_TCG=255]="TCG_MASK_TCG",t[t.TCG_FLAG_IMPROVE=256]="TCG_FLAG_IMPROVE",t[t.TCG_FLAG_USE_HIGHSCHOOL=512]="TCG_FLAG_USE_HIGHSCHOOL",t[t.TCG_FLAG_OBMEDZENYHIGHSCHOOL=1024]="TCG_FLAG_OBMEDZENYHIGHSCHOOL",t[t.TCG_FLAG_IBAOPTIMIZE=2048]="TCG_FLAG_IBAOPTIMIZE",(n=b.PRINTAREA||(b.PRINTAREA={}))[n.TRIEDA=0]="TRIEDA",n[n.UCITEL=1]="UCITEL",n[n.ZIAK=2]="ZIAK",n[n.UCEBNA=3]="UCEBNA",n[n.PREDMET=4]="PREDMET",n[n.SUHRN_TRIEDA=5]="SUHRN_TRIEDA",n[n.SUHRN_UCITEL=6]="SUHRN_UCITEL",n[n.SUHRN_UCEBNA=7]="SUHRN_UCEBNA",n[n.SUHRN_POSTER_TRIEDA=8]="SUHRN_POSTER_TRIEDA",n[n.SUHRN_POSTER_UCITEL=9]="SUHRN_POSTER_UCITEL",n[n.SUHRN_POSTER_UCEBNA=10]="SUHRN_POSTER_UCEBNA",n[n.SUHRN_TRIEDA_PO_DNOCH=11]="SUHRN_TRIEDA_PO_DNOCH",n[n.SUHRN_UCITEL_PO_DNOCH=12]="SUHRN_UCITEL_PO_DNOCH",n[n.SUHRN_UCEBNA_PO_DNOCH=13]="SUHRN_UCEBNA_PO_DNOCH",n[n.VOLNE_UCEBNE=14]="VOLNE_UCEBNE",n[n.LESSONGRID=15]="LESSONGRID",n[n.MASTER=16]="MASTER",n[n.SUHRN_ZIAK=17]="SUHRN_ZIAK",n[n.SUHRN_PREDMET=18]="SUHRN_PREDMET",n[n.CUSTOM1=19]="CUSTOM1",n[n.CUSTOM2=20]="CUSTOM2",n[n.CUSTOM3=21]="CUSTOM3",n[n.INSPEKCIA=22]="INSPEKCIA",n[n.INSPEKCIA_UCITEL=23]="INSPEKCIA_UCITEL",n[n.INSPEKCIA_UCITEL_EXTRA=24]="INSPEKCIA_UCITEL_EXTRA",n[n.CONTRACT_OVERVIEW=25]="CONTRACT_OVERVIEW",n[n.DAILYATTENDANCE=26]="DAILYATTENDANCE",n[n.TEACHERLIST=27]="TEACHERLIST",n[n.CLASSLIST=28]="CLASSLIST",n[n.NUMBER_OF=29]="NUMBER_OF",(s=b.TLACDEF_STRED||(b.TLACDEF_STRED={}))[s.HODINA=0]="HODINA",s[s.POCET=1]="POCET",s[s.POCETHODIN=2]="POCETHODIN",s[s.ZOZNAMHODIN_PODLATRIEDY=3]="ZOZNAMHODIN_PODLATRIEDY",(r=b.SCHOOLTYPE||(b.SCHOOLTYPE={}))[r.GENERIC=0]="GENERIC",r[r.USHIGH=1]="USHIGH",r[r.USHIGH_CLASSES=2]="USHIGH_CLASSES",b.metaclassrooms_linka_def=[{id:"*home",name:"{tt:1067}",icon:"/timetable/pics/app/homeroom.png"},{id:"*teacher",name:"{tt:3773}",icon:"/global/pics/ui/teacher_32.svg"},{id:"*shared",name:"{tt:1068}",icon:"/timetable/pics/app/sharedroom.png"},{id:"*subject",name:"{tt:3774}",icon:"/global/pics/ui/subject_32.svg"}],b.metaclassrooms_priorita_def=[{id:"*optimal",name:"{tt:4358}",short:"{tt:4359}",color:"#22B14C",icon:"/timetable/pics/app/standard/vyber_optimal_16.png"},{id:"*normal",name:"{tt:4360}",short:"{tt:4361}",color:"#B5E61D",icon:"/timetable/pics/app/standard/vyber_normal_16.png"},{id:"*bad",name:"{tt:4362}",short:"{tt:4363}",color:"#f1c40f",icon:"/timetable/pics/app/standard/vyber_bad_16.png"},{id:"*emergency",name:"{tt:4364}",short:"{tt:4365}",color:"#FF311D",icon:"/timetable/pics/app/standard/vyber_emergency_16.png"}],b.isMetaclassroomPriorita=v,b.metaclassrooms_def=f.__spreadArrays(b.metaclassrooms_linka_def,b.metaclassrooms_priorita_def),b.showTTDocVyberDlg=o,b.phpShowVyberDlg=function(n,s,r){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(h.client_req.ttuidocdbi(n,{tables:[s],columns:["name","short","firstname","lastname","color"]}))];case 1:return[4,o(e.sent(),s,r)];case 2:return(t=e.sent())?[2,"sel:"+t.join(",")]:[2,""]}})})},b.allItemsName=function(e,t){var n={classes:"{tt:1868}",subjects:"{tt:3056}",teachers:"{tt:3055}",students:"{tt:3329}"}[t]||"{tt:1297}";return e.localize(n)},b.entireClassGroupid=function(e,t){for(var n=0,s=e.tableData("groups");n<s.length;n++){var r=s[n];if(r.classid==t&&r.entireclass)return r.id}return""},b.findClassGroup=function(e,t,n){for(var s=0,r=e.tableData("groups");s<r.length;s++){var i=r[s];if(i.classid==t&&!i.entireclass&&i.name==n)return i.id}return""},b.ids2colors=function(e,t,n){for(var s=[],r=0,i=n;r<i.length;r++){var a=i[r],o=e.rowData(t,a);s.push(o&&o.color||"#ffffff")}return s},b.strippedBackground=function(e,t,n){var s=e.length;if(0==s)return"#fff";if(1==s)return e[0];var r=45;return 3<=t&&3<=n&&(r=Math.atan2(n,t/(s-1))/Math.PI*180),0===t&&(r=0),"linear-gradient("+(180-r)+"deg,"+e.map(function(e,t){return e+" "+100*t/s+"%,"+e+" "+100*(t+1)/s+"%"}).join()+")"},(b.lessonSeminarClasses=l).needed_part=i.typed({lessons:["seminargroup","groupids","classids"],groups:["classid"]}),b.trackTTOEvent=function(e,t,n){void 0===n&&(n="")},b.defaultShort=function(e,t,n){var s=n.name||"";switch(t){case"classes":case"classrooms":return s;case"teachers":case"students":var r=(n.firstname||"").substr(0,1),i=(n.lastname||"").substr(0,1);return e.sort_name_col.indexOf("F")<e.sort_name_col.indexOf("L")?r+i:i+r;case"subjects":for(var a="",o=0,l=s.split(" ");o<l.length;o++){a+=l[o].substr(0,1)}return a;default:return s.substr(0,1)}},b.obdobieBitsToRow=u,b.obdobieName=c,b.cardPositionName=d,b.idssArrayMatch=function(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!i.idsArrayMatch(e[n],t[n]))return!1;return!0},b.getUINazov=m,b.getUINazov2=p,(b.getTTDocStructure=y).needed_part=i.typed({periods:[],days:[],weeks:[],terms:[]}),b.bitfieldOr=function(e,t){for(var n="",s=0;s<e.length;s++)n+="1"==e[s]||"1"==t[s]?"1":"0";return n},b.bitfieldAnd=function(e,t){for(var n="",s=0;s<e.length;s++)n+="1"==e[s]&&"1"==t[s]?"1":"0";return n},b.bitfieldIsOverlap=function(e,t){for(var n=0;n<e.length;n++)if("1"==e[n]&&"1"==t[n])return!0;return!1},b.getFarbaFazy=E,b.fazyColors=function(i){if(i.find(function(e){return!e}))return null;if(!i.find(function(e){return e.includes("0")}))return null;for(var a=1,e=0,t=i;e<t.length;e++){var n=t[e];a*=n.length}var o=[],l=0;return function e(t,n){for(var s=i[t],r=0;r<s.length;r++)t+1<i.length?e(t+1,n||"1"!=s[r]):("1"!=s[r]||n||o.push(E(l,a)),l++)}(0,!1),l!=a&&ASC.dieError("8206886914",i),o},b.colorsLuma=function(e){if(0==e.length)return.5;for(var t,n=0,s=0,r=e;s<r.length;s++){var i=r[s];n+=(void 0,(t=w(i))?(299*t.r+587*t.g+114*t.b)/1e3/255:0)}return n/e.length},b.fixTTColor=function(e,t){void 0===t&&(t=!1);var n=w(e);if(!n)return"";function s(e){return Math.round(i-(i-r)/255*(255-e))}var r=t?0:128,i=t?127:255;return function(e){if(!e)return"";function t(e){var t=e.toString(16);return 1==t.length?"0"+t:t}return"#"+t(e.r)+t(e.g)+t(e.b)}({r:s(n.r),g:s(n.g),b:s(n.b)})},b.cloudgenEnabled=function(e){return void 0===e&&(e=h.client_req),!0},b.timetabledbiAsUIDoc=function(s,r){return f.__awaiter(this,void 0,void 0,function(){var t,n;return f.__generator(this,function(e){switch(e.label){case 0:return s?(t=r.req||h.client_req,[4,a.timetabledbiAsUIDocDBIAccessor(t,s,{op:"fetch",needed_part:r.needed_part})]):[2,null];case 1:return n=e.sent(),[2,i.DBI.fromAccessorResult(t,n)]}})})}},"/timetable/app/server/ttdoc.js":function(e,require,t){t.implementRpc(["ttuidocDBIAccessor","ttuidocAddRows","ttuidocUpdateRows","ttuidocRemoveRows","ttuidocUndo","ttuidocAddDivision","ttuidocAddDivisionMulti","ttuidocMoveGroup","ttuidocSeparateGroup","ttuidocSetTableOrder","ttuidocUpdateStructure","ttuidocAddBreak","showBellsInLessonDlg","getDefaultDozoryKriteria","ttuidocResetPrintSettings","ttuidocInfo","ttsnapshotDBIAccessor","timetabledbiAsUIDocDBIAccessor"])},"/react/sticky.js":function(e,require,t){e.__esModule=!0;var d=require("tslib"),m=require("react"),p=require("../asc/asc_react");e.Sticky=function(e){var t,n,s=e.backgroundColor,r=null!==(n=e.side)&&void 0!==n?n:"top",i="top"!=r,a=m.useRef(),o=m.useRef(),l=m.useState(!1),u=l[0],c=l[1];return p.useDomReader(function(){var e,t;c((null===(e=a.current)||void 0===e?void 0:e.getBoundingClientRect()[i?"right":"bottom"])>(null===(t=o.current)||void 0===t?void 0:t.getBoundingClientRect()[r]))}),m.createElement("div",{style:d.__assign({display:"flex",flexDirection:"left"==r?"row":"column",alignItems:"stretch"},e.style)},m.createElement("div",{ref:a,style:(t={position:"sticky"},t[r]=0,t["left"==r?"width":"height"]=e.headerSize,t.flex="0 0 auto",t.zIndex=2,t.backgroundColor=s,t.boxShadow=u?(i?"2px 0px":"0px 2px")+" 0px 0px #00000040":void 0,t)},e.header),m.createElement("div",{ref:o,style:d.__assign({flex:"1 1 0px",zIndex:1,backgroundColor:s,position:"relative"},e.style_content||{})},e.children))}},"/calendar/event_popup.js":function(e,require,t){e.__esModule=!0;var b=require("tslib"),f=require("../asc/asc_react2"),_=require("react"),h=require("../asc/edurequest"),n=require("../rpr/dbi"),g=require("../rpr/dbi_react"),v=require("../asc/asc_react"),y=require("../asc/actions"),E=require("./event_delete"),w=require("../rpr/maindbi_ui"),S=require("../react/popuppanel"),x=require("../asc/lib_date"),d=require("../dashboard/dbi_events");function T(e){var t=h.client_req,n=e.eventid,s=e.where,r=n.split(":")[0],i=g.useMainDBI(t.getSchoolYear(r),{needed_part:T.needed_part,needed_combos:T.needed_combos,vt_filter:{date:r}}),a=i.rowData("events",n,{}),o=a.typ,l=a._uial,u=i.rowData("event_types",o,{}),c=i.tools.ttitem_popis(a),d=a.studentids;d&&0<d.length&&(c.class+=": ",1<d.length&&(c.class+="("+d.length+") "),c.class+=i.rowNames("students",d,t.sort_name_col));var m="";if(a.repeat_datefrom&&a.repeat_dateto){m=x.date_format_2dates(t,a.repeat_datefrom,a.repeat_dateto);var p=a.repeat;p&&"day"!=p&&(m+=", "+i.column("events","repeat").textValue(p))}return _.createElement("div",{style:{minWidth:350,maxWidth:"50vw"}},_.createElement(f.DlgHeader,{title:u.name,icon:u.icon,small:!0,inDlg:!1,right:a.elearn_superid&&_.createElement(_.Fragment,null,_.createElement("img",{src:"/elearning/pics/icons/exams3.svg",style:{cursor:"pointer"},onClick:function(){return v.openUrl("/elearning/?cmd=EtestCreator&superid="+a.elearn_superid)},title:t.ls(2083)}),_.createElement(v.HGap,null))}),_.createElement("div",{style:{padding:"0px 10px 10px 10px"}},[[t.ls(1196),a.name],[t.ls(1579),a.note],[t.ls(2684),m],[i.tools.uniperiodLabel(a.uniperiod),c.period],[t.ls(1263),c.class],[t.ls(1299),c.subject],[t.ls(1300),c.teacher],[t.ls(1197),c.classroom]].map(function(e,t){var n=e[0],s=e[1];return s?_.createElement(S.PopupDetail,{key:t,label:n},s):null}),(t.isAdmin()||t.isUcitel())&&_.createElement(_.Fragment,null,_.createElement(f.SeparatorLine,null),_.createElement("div",{style:{display:"flex",flexDirection:"row"}},e.footer,"calendar"==s&&_.createElement(_.Fragment,null,_.createElement(v.RButton,{label:t.ls(2465),onClick:function(){!function(e,t){void 0===t&&(t={});ASC.ASC_action("/gcall",b.__assign(b.__assign({action:e},t),{gadget:"EventsDiv",gsh:ASC.gsechash,jscid:"Calendar_dummyJSC"}))}("duplicate",{date:a.date,subId:n.split(":")[1]})}}),_.createElement(v.RButton,{label:y.action_name("delete"),onClick:2<=l?function(){return E.showDeleteEventDlg(n)}:void 0})),_.createElement("div",{style:{flex:1}}),_.createElement(v.RButton,{label:y.action_name("edit"),type:"calendar"==s?"green":void 0,onClick:2<=l?function(){return w.showEventEditDlg(n)}:void 0})))))}function m(e){var t=e.eventid,n=e.dbi,s=e.where,r=S.useSimplePopup(),i=r[0],a=r[1],o=r[2],l=n.rowData("events",t);return l?_.createElement(_.Fragment,null,_.createElement("img",{src:n.rowData("event_types",l.typ,{}).icon,style:v.rtlCss(b.__assign(b.__assign(b.__assign({},m.style),{cursor:"pointer"}),e.style||{})),onClick:a}),o&&_.createElement(i,null,_.createElement(T,{eventid:t,where:s}))):null}function p(e){var t=h.client_req,n=e.eventid,s=e.where,r=n.split(":")[0],i=S.useSimplePopup(),a=i[0],o=i[1],l=i[2],u=g.useMainDBI(t.getSchoolYear(r),{needed_part:p.npp(),vt_filter:{date:r}}),c=u.rowData("events",n);return c?_.createElement("div",{style:b.__assign({cursor:"pointer"},e.style||{}),onClick:o},_.createElement("img",{src:u.rowData("event_types",c.typ,{}).icon,style:v.rtlCss(b.__assign(b.__assign({},m.style),{marginRight:3,verticalAlign:"middle"}))}),d.eventName(u,c),l&&_.createElement(a,null,_.createElement(T,{eventid:n,where:s}))):null}(e.EventPopup=T).needed_part=n.typed({events:["__ttitem","name","note","typ","studentids","repeat","repeat_datefrom","repeat_dateto","elearn_superid","_uial"],event_types:["name","icon"],subjects:["__name"],classes:["__name"],igroups:["__name"],teachers:["__name"],classrooms:["__name"],students:["__name"]}),T.needed_combos=n.typed({events:["repeat"]}),(e.EventIcon=m).needed_part=n.typed({events:["typ"],event_types:["icon"]}),m.style=n.typed({height:16,filter:"drop-shadow(rgba(0, 0, 0, 0.4) 0px 0px 3px)"}),(e.EventBar=p).npp=n.neededPartProvider(function(){return[d.eventName,{events:["typ","name"],event_types:["icon"]}]})},"/calendar/event_delete.js":function(e,require,t){e.__esModule=!0;var y=require("tslib"),E=require("../asc/asc_react"),w=require("react"),S=require("../rpr/dbi_react"),x=require("../asc/edurequest"),T=require("../asc/actions"),C=require("../asc/lib_date"),k=require("../react/datefield"),D=require("../dashboard/server/events");function n(e){var t,n=x.client_req,s=e.eventid,r=s.split(":"),i=r[0],a=r[1],o=n.getSchoolYear(i),l=S.useMainDBI(o,{needed_part:{events:["repeat_datefrom","repeat_dateto","repeat_dates","_uial"]},vt_filter:{date:i}}).rowData("events",s,{}),u=w.useMemo(function(){for(var e={},t=0,n=l.repeat_dates||[];t<n.length;t++){e[n[t]]="#fff97d"}return e},[l]),c=w.useRef(),d=E.useStateRef(i),m=d[0],p=d[1],b=null,f=null,_=["cancel"],h=void 0;function g(n){return y.__awaiter(this,void 0,void 0,function(){var t;return y.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(D.events_delete(null,m+":"+a,n))];case 1:return t=e.sent(),E.showUniResponse(t),c.current.confirmClose("delete"),[2]}})})}if((null!==(t=l._uial)&&void 0!==t?t:2)<2)b=n.ls(4788),h="fail";else if(l.repeat_datefrom){var v={width:200,textAlign:"center"};b=w.createElement(w.Fragment,null,n.ls(1883),w.createElement(E.VGap,{height:20}),w.createElement(E.RButton,{label:n.ls(1880),style:v,onClick:function(){return g()}}),w.createElement(E.HGap,null),C.date_format_2dates(n,l.repeat_datefrom,l.repeat_dateto),w.createElement(E.VGap,null),m>l.repeat_datefrom&&m<l.repeat_dateto&&w.createElement(w.Fragment,null,w.createElement(E.RButton,{label:n.ls(1881),style:v,onClick:function(){return g("next")}}),w.createElement(E.HGap,null),C.date_format_2dates(n,m,l.repeat_dateto),w.createElement(E.VGap,null)),w.createElement(E.RButton,{label:n.ls(1882),style:v,onClick:function(){return g("this")}}),w.createElement(E.HGap,null),C.date_format_date(n,m)),f=w.createElement(w.Fragment,null,n.ls(1251)+": ",w.createElement(k.default,{valueRef:p.onSet(function(e){return l.repeat_dates.includes(e)}),date2color:u}))}else b=n.ls(1157),_=[{label:T.action_name("delete"),type:"red",onClick:function(){return g()}},"cancel"];return w.createElement(E.RDialog,{controlRef:c,buttons:_,footer:f,msgType:h,width:400},w.createElement("div",null,b))}e.showDeleteEventDlg=function(t){return y.__awaiter(this,void 0,void 0,function(){return y.__generator(this,function(e){switch(e.label){case 0:return[4,E.RDialog.show(w.createElement(n,{eventid:t}))];case 1:return[2,"deleted"==e.sent()]}})})},e._hotswap=[n]},"/dashboard/server/events.js":function(e,require,t){t.implementRpc(["events_get","events_save","events_delete"])},"/react/prevnextarrows.js":function(e,require,t){e.__esModule=!0;var s=require("react"),r=require("../asc/asc_react");e.default=function(e){var t=e.onPrev||e.onDelta&&function(){return e.onDelta(-1)},n=e.onNext||e.onDelta&&function(){return e.onDelta(1)};return s.createElement(s.Fragment,null,s.createElement("i",{className:r.rtlStr("fa fa-arrow-circle-left"),style:{cursor:"pointer",marginLeft:0},onClick:t,onMouseDown:function(e){return e.preventDefault()}}),s.createElement("i",{className:r.rtlStr("fa fa-arrow-circle-right"),style:r.rtlCss({cursor:"pointer",marginLeft:5}),onClick:n,onMouseDown:function(e){return e.preventDefault()}}))}},"/substitution/online/editduties.js":function(m,require,e){m.__esModule=!0;var h=require("tslib"),g=require("../../timetable/server/timeoff"),v=require("../../timetable/timeoff_r"),y=require("../../asc/edurequest"),E=require("../../asc/asc_react"),w=require("react"),S=[[["."]]];m.timeoff_Icons_subst=[{d:"D",img:"/substitution/pics/must_be_32.svg",name:"{tt:1471}"},{d:"O",img:"/global/pics/ui/time_32.svg",name:"{tt:2529}"},{d:"0",img:"/global/pics/ui/item_bad_32.svg",name:"{tt:1472}"}],m.substVolnoJoiner=function(e,t){return"."==e||" "==e?t:e},m.showSubstTimeoffDlg=function c(d){return h.__awaiter(this,void 0,void 0,function(){var p,b,t,f,_,n,s,r,i,a,o,l,u;return h.__generator(this,function(e){switch(e.label){case 0:return p=y.client_req,b=d.teacherid,t=d.year||p.getSchoolYear(d.date),[4,ASC.blockUI(p.maindbi(t,{needed_part:{teachers:["__name","subst_tt_timeoff"],substonline_dates:["tt_num"]},vt_filter:{date:d.date||void 0}}))];case 1:return f=e.sent(),(_=(_=d.tt_num)||f.rowData("substonline_dates",d.date).tt_num)?[3,3]:[4,E.RDialog.showMessage(w.createElement(w.Fragment,null,p.ls(7244)),{srcFunction:c})];case 2:return e.sent(),[2,!1];case 3:return[4,ASC.blockUI(p.timetabledbi(_,v.TimeoffInput.tt_dbi))];case 4:return n=e.sent(),[4,ASC.loadTTLang()];case 5:for(e.sent(),s=f.rowData("teachers",b).subst_tt_timeoff[_]||S,s=v.timeoff_uncompress(s,n),(r=[]).push({d:"."}),i=0,a=m.timeoff_Icons_subst;i<a.length;i++)o=a[i],r.push(h.__assign(h.__assign({},o),{name:p.localize(o.name)}));return l={timeoff:s},[4,E.RDialog.showInput(l,function(e){var m=e.state,t=e.stateRef;return w.createElement(w.Fragment,null,w.createElement(v.TimeoffInput,{valueRef:t.sub("timeoff"),tt_dbi:n,icons:r,table:"teachers",id:b,overlay:function(e){for(var t=e.term,n=e.week,s=e.day,r=e.period,i=[],a=!1,o=0,l=f.tableData("teachers");o<l.length;o++){var u=l[o],c=u.id==b?m.timeoff:u.subst_tt_timeoff[_]||S,d=v.timeoff_get(c,t,n,s,r,function(e,t){return e==t?e:"D"==e||"D"==t?"*":"*"==e||"*"==t?"*":""});"*"!=d&&"D"!=d||(i.push(f.rowName("teachers",u.id)),"*"==d&&(a=!0))}return 0==i.length?null:w.createElement("div",{style:{position:"absolute",right:3,bottom:3,color:"#000",fontSize:10},title:p.ttls(1471)+":\n"+i.join("\n")},i.length,a&&"*")}}))},{header:p.ttls(1471)+" - "+f.rowName("teachers",b),width:600})];case 6:return(u=e.sent())?(s=v.timeoff_compress(u.timeoff),[4,ASC.blockUI(g.setTeacherSubstTimeoff(null,t,b,_,s))]):[2,!1];case 7:return e.sent(),[2,!0]}})})}},"/timetable/server/timeoff.js":function(e,require,t){t.implementRpc(["setTeacherSubstTimeoff"])},"/substitution/online/subst_popup.js":function(e,require,t){e.__esModule=!0;var k=require("tslib"),D=require("../../asc/edurequest"),I=require("../../rpr/dbi_react"),R=require("../../rpr/dbi"),A=require("react"),N=require("../../asc/asc_react2"),B=require("../../asc/asc_react"),j=require("../../asc/actions"),P=require("../commands"),M=require("../subst"),p=require("./timetable"),O=require("../server/commands"),z=require("../../react/popuppanel"),b=require("../dlg/absent"),F=require("../../calendar/event_popup"),L=require("../subststudents_popup");var G="name";function r(){return A.createElement(A.Fragment,null," ",A.createElement("i",{className:"fa fa-arrow-right"})," ")}function U(e){if(e.hidden)return null;var t=e.text,n=e.orig_text;if(!t&&!n)return null;var s=t;return void 0!==n&&n!==t&&(s=n?A.createElement(A.Fragment,null,n,A.createElement(r,null),t||"(X)"):"+"+t),A.createElement(z.PopupDetail,{label:e.label},s)}function q(r){var e,i=r.dbi,t=r.ttitem,n=r.column,s=t[n],a=null===(e=t.orig)||void 0===e?void 0:e[n];void 0===a&&(a=s);var o=i.column("substonline_ttitems",n);if(!o)return null;var l=o.linkedTable();if(l){var u=void 0,c=void 0;c="tableid"==o.type()?(u=[a],[s]):(u=a,s);var d=R.idsArrayMergeUnique(u,c).filter(function(e){return e}).length;if(0==d)return null;for(var m=(t.changes||[]).filter(function(e){return function(e){switch(e){case"subjectid":return"subjects";case"teacherid":case"teacherids":return"teachers";case"classids":return"classes";case"classroomid":case"classroomids":return"classrooms";case"period":return"periods";case"groupnames":return"groupnames";case"igroupid":case"igroupids":return"igroups";default:ASC.dieError("9616420779",e)}}(e.column)==l}),p=function(e){var t,n;if(!e)return"";n=i.rowName(l,e);var s=null===(t=r.item2onClick)||void 0===t?void 0:t.call(r,l,e);return s?A.createElement("span",{style:{color:"inherit",textDecoration:"underline",cursor:"pointer"},onClick:s},n):n},b=[],f=0,_=new Set,h=function(t){var e=t&&m.find(function(e){return e.old==t});_.add(e?e.new:t),e?b.push(A.createElement(A.Fragment,{key:f++},p(t)," âž” ",e.new?p(e.new):"(X)")):b.push(p(t))},g=0,v=u;g<v.length;g++){h(w=v[g])}for(var y=0,E=c;y<E.length;y++){var w;(w=E[y])&&!_.has(w)&&b.push(A.createElement(A.Fragment,{key:f++},"+",p(w)))}return A.createElement(z.PopupDetail,{label:i.tools.itemName(l,d)},A.createElement(N.RJoin,{children:b,glue:", "}))}function S(e){return"groupnames"==n?i.tools.groupnames_names(e):o.textValue(e)}return A.createElement(U,{label:o.name(),text:S(s),orig_text:S(a)})}function H(t){var e=t.dbi,n=t.eventids;return(null==n?void 0:n.length)?A.createElement(z.PopupDetail,{label:t.label||e.tools.itemName("events",n.length)},A.createElement(B.VGap,{height:3}),n.map(function(e){return A.createElement(F.EventBar,{key:e,eventid:e,where:t.where})})):null}function V(e){var t,n=this,s=D.client_req,r=e.ttitem,i=e.where,a=e.closeParent,o=e.join_doubles,l=e.dlg,u=e.kolizie,c=r.id.split(":")[0],d=I.useMainDBI(s.getSchoolYear(c),{needed_part:R.DBITools.mergeNeededParts(V),vt_filter:{date:c},suspense:!0}),m=d.rowData("substonline_dates",c,{}),p=!1;function b(){return k.__awaiter(this,void 0,void 0,function(){return k.__generator(this,function(e){switch(e.label){case 0:return a?[4,a()]:[3,2];case 1:if(!e.sent())return[2,!1];e.label=2;case 2:return ASC.hidePopups(),[2,!0]}})})}P.isSubstTTItemEditable(d,r)&&!m.uploaded_int&&(p="ttitem"!=i&&"addcard"!=i||!!a);var f=k.__assign(k.__assign({},r),r.orig||{}),_=r.cancelled?k.__assign(k.__assign({},f),{changes:[]}):r,h=s.ls(1301);"classroomsupervision"==r.type&&(h=s.ls(1723));var g="";r.added?g=s.ls(6270):r.cancelled?(g=s.ls(2322),0<r.origofids.length&&(g=s.ls(11611))):0<(null===(t=r.changes)||void 0===t?void 0:t.length)&&(g=s.ls(1826));var v=null;l&&(v=function(e,t){return function(){ASC.hidePopups(),l.setItem(e,t)}});var y=[];p&&(r.cancelled||(y.push({text:s.ttls(1476),onClick:function(){return k.__awaiter(n,void 0,void 0,function(){return k.__generator(this,function(e){switch(e.label){case 0:return[4,b()];case 1:return e.sent()?[4,B.RDialog.showConfirm(s.ttls(1476),{msgType:"areyousure"})]:[2];case 2:return e.sent()?[4,ASC.blockUI(O.removeSubstOnlineTTItem(null,r.id,o))]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})}}),0<r.classids.length&&y.push({text:s.ls(6201),onClick:function(){return k.__awaiter(n,void 0,void 0,function(){return k.__generator(this,function(e){switch(e.label){case 0:return[4,b()];case 1:return e.sent()&&Promise.resolve().then(function(){return require("./splitlesson")}).then(function(e){return e.showSplitTTitemDlg(r.id,o)}),[2]}})})}})));for(var E=d.rowDatas("substonline_substitutions",r.substids||[]),w=E.map(function(e){return e.absentid}).filter(function(e){return e}),S=[],x=0,T=r.changeeventids;x<T.length;x++){var C=T[x];S.push(A.createElement(F.EventBar,{key:S.length,eventid:C,where:i}))}return r.studentsinfo.subst&&S.push(A.createElement(L.StudentsinfoSubstBar,{key:S.length,subst:r.studentsinfo.subst,online:!0})),A.createElement(z.PopupWithHeader,{title:h,subtitle:g,icon:r.cancelled?M.ICON_subst_cancelled:"/global/pics/ui/timetables_32.svg"},A.createElement(U,{label:d.tools.uniperiodLabel(r.uniperiod,r),text:d.tools.uniperiodName(r.uniperiod,G,r),orig_text:d.tools.uniperiodName(f.uniperiod,G,r)}),A.createElement(q,{dbi:d,ttitem:_,column:"igroupid",item2onClick:v}),A.createElement(q,{dbi:d,ttitem:_,column:"classids",item2onClick:v}),A.createElement(q,{dbi:d,ttitem:_,column:"groupnames"}),A.createElement(q,{dbi:d,ttitem:_,column:"subjectid"}),A.createElement(q,{dbi:d,ttitem:_,column:"teacherids",item2onClick:v}),A.createElement(q,{dbi:d,ttitem:_,column:"classroomids",item2onClick:v}),E.map(function(s,e){return A.createElement(A.Fragment,{key:e},["substitution_typeid","note","inote"].map(function(e){var t=s[e];if(!t)return null;var n=d.column("substonline_substitutions",e);return A.createElement(U,{key:e,label:n.name(),text:n.textValue(t)})}))}),A.createElement(z.PopupDetail,{label:s.ls(1622),hidden:0==w.length},w.map(function(e){return A.createElement(W,{key:e,absentid:e,where:i})})),A.createElement(H,{dbi:d,eventids:r.eventids,where:i}),A.createElement(z.PopupDetail,{label:s.ls(2060),hidden:0==S.length},A.createElement(B.VGap,{height:3}),S),u&&A.createElement(z.PopupDetail,{label:"Collision"},u.map(function(e,t){return A.createElement("div",{key:t},A.createElement(K,{key:t,dbi:d,kolizia:e}))})),p&&A.createElement(A.Fragment,null,A.createElement(N.SeparatorLine,null),A.createElement("div",{style:{display:"flex",flexDirection:"row"}},e.footer,!r.cancelled&&A.createElement(A.Fragment,null,l&&M.substTTItemMovable(r)&&A.createElement(B.RButton,{label:s.ls(7441),onClick:function(){ASC.hidePopups(),l.setMoveTTItemid(r.id)}})),0<y.length&&A.createElement(B.RButton,{label:s.ls(1768),menu:y}),A.createElement("div",{style:{flex:1,width:10}}),A.createElement(B.RButton,{label:j.action_name("edit"),type:"green",onClick:function(){return k.__awaiter(n,void 0,void 0,function(){return k.__generator(this,function(e){switch(e.label){case 0:return[4,b()];case 1:return e.sent()&&P.showTTItemEditDlg(r.id,o),[2]}})})}}))))}function m(e,t,n){var s=e.rowName(t,n);return"classrooms"==t&&(s+=" ("+e.table(t).itemName()+")"),s}function W(e){var t=D.client_req,n=e.absentid,s=n.split(":")[0],r=I.useMainDBI(t.getSchoolYear(s),{needed_part:R.DBITools.mergeNeededParts(W),vt_filter:{date:s}}),i=r.rowData("substonline_absents",n),a=z.useSimplePopup(),o=a[0],l=a[1],u=a[2];if(!i)return null;var c=M.absentGetTable(i),d=M.absentGetId(i);return A.createElement(A.Fragment,null,A.createElement("div",{style:{cursor:"pointer"},onClick:l},A.createElement("img",{src:r.table("substonline_absents").icon(),style:{height:16,verticalAlign:"middle"}}),A.createElement(B.HGap,{width:5}),m(r,c,d)),u&&A.createElement(o,null,A.createElement(f,{absentid:n,where:e.where})))}function K(e){var t=e.dbi,n=e.kolizia,s="?";return n.table&&n.id&&(s=m(t,n.table,n.id)),n.todo&&(s="Unfinished"),A.createElement("div",{style:{}},A.createElement("img",{src:n.todo?M.ICON_subst_todo:M.ICON_subst_kolizia,style:{height:16,verticalAlign:"middle"}}),A.createElement(B.HGap,{width:5}),s)}function f(e){var t=this,n=D.client_req,s=e.absentid,r=e.where,i=e.eventids,a=s.split(":")[0],o=I.useMainDBI(n.getSchoolYear(a),{needed_part:R.DBITools.mergeNeededParts(P.showAbsentDeleteDlg,{substonline_absents:["period","durationperiods","allday","table","teacherid","classid","classroomid","groupname","absent_typeid"],absent_types:["__name"],teachers:["__name"],classes:["__name"],classrooms:["__name"],events:[]}),vt_filter:{date:a}}),l=o.table("substonline_absents"),u=o.rowData("substonline_absents",s,{}),c=M.absentGetTable(u),d=M.absentGetId(u),m=R.DBITools.getUniPeriod(u);return A.createElement(z.PopupWithHeader,{title:l.itemName(),icon:l.icon()},A.createElement(z.PopupDetail,{label:o.tools.itemName(c)},o.rowName(c,d)+("classes"==c&&u.groupname?" "+u.groupname:"")),A.createElement(z.PopupDetail,{label:o.tools.uniperiodLabel(m,u)},o.tools.uniperiodName(m,void 0,u)),u.absent_typeid&&A.createElement(z.PopupDetail,{label:o.tools.itemName("absent_types")},o.rowName("absent_types",u.absent_typeid)),A.createElement(H,{dbi:o,eventids:i,where:"subst"}),A.createElement(N.SeparatorLine,null),A.createElement("div",{style:{display:"flex",flexDirection:"row"}},"subst"==r&&A.createElement(A.Fragment,null,A.createElement(B.RButton,{label:n.ls(1001),onClick:function(){ASC.hidePopups(),p.showSubstTimetableDlg(a,c,d)}}),A.createElement(B.RButton,{label:j.action_name("lessons"),onClick:function(){return k.__awaiter(t,void 0,void 0,function(){return k.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../online/absentlessons")})];case 1:return e.sent().showAbsentLessonsDlg(u.id),[2]}})})}}),A.createElement(B.HGap,null),A.createElement(B.RButton,{label:j.action_name("delete"),onClick:function(){return P.showAbsentDeleteDlg(o,s)}})),A.createElement("div",{style:{flex:1,width:10}}),A.createElement(B.RButton,{label:j.action_name("edit"),type:"green",onClick:function(){ASC.hidePopups(),b.showSubstAbsentEditDlg(s)}})))}H.npp=R.neededPartProvider(function(){return[F.EventBar]}),(e.SubstTTItemPopup=V).npp=M.substOnlineNeededPartProvider(function(){return[H,W,P.isSubstTTItemEditable,{substonline_ttitems:["__ttitem","type","orig","added","cancelled","changes","substids","origofids","eventids","changeeventids","studentsinfo"],substonline_substitutions:["substitution_typeid","note","inote","absentid"],substonline_dates:["uploaded_int"],subjects:["__name"],classes:["__name"],igroups:["__name"],teachers:["__name"],classrooms:["__name"],substitution_types:["__name"],periods:["__name"],dayparts:["__name"]}]}),W.needed_part=R.typed({substonline_absents:["table","teacherid","classid","classroomid","groupname"],teachers:["__name"],classes:["__name"],classrooms:["__name"]}),e.AbsentPopup=f},"/substitution/commands.js":function(e,require,t){e.__esModule=!0;var _=require("tslib"),h=require("../rpr/dbi"),g=require("react"),v=require("../asc/asc_react"),c=require("../asc/actions"),y=require("./server/commands"),E=require("../asc/edurequest"),w=require("../asc/lib_date"),d=require("./server/generator"),m=require("./subst"),p=require("./dlg/ttitem"),b=require("./dlg/addcard"),f=require("./online/timetable"),S=require("../rpr/dbi_react"),x=require("../asc/asc_react2"),T=E.client_req&&E.client_req.isApp()?"SubstApp":"SubstOnline";function u(s,r){return _.__awaiter(this,void 0,void 0,function(){var t,n;return _.__generator(this,function(e){return s.mock||s.old?[2,!0]:((t=s.rowData("substonline_dates",r))||ASC.dieError("3637166007"),t.uploaded_int?(n=g.createRef(),v.RDialog.showMessage(ASC.ls(2740),{footer:g.createElement(g.Fragment,null,g.createElement(v.RButton,{label:ASC.ls(2741),onClick:function(){n.current.close(),i(r)}})),width:350,controlRef:n}),[2,!0]):[2,!1])})})}function i(s){return _.__awaiter(this,void 0,void 0,function(){var t,n;return _.__generator(this,function(e){switch(e.label){case 0:return t=E.client_req,n=t.ls(2741)+" ("+w.date_format_date(t,s)+") - "+t.ls(1054),[4,v.RDialog.showConfirm(n)];case 1:return e.sent()?[4,y.deleteSubstDay(null,s,{log_module:T})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}function n(o,l){return _.__awaiter(this,void 0,void 0,function(){var t,n,s,r,i,a;return _.__generator(this,function(e){switch(e.label){case 0:return t=o.req,n=l.split(":")[0],[4,u(o,n)];case 1:return e.sent()?[2,!1]:(s=o.rowData("substonline_absents",l),r=m.absentGetTable(s),i=m.absentGetId(s),a=t.ttls(2117),s&&"teachers"!=s.table&&(a=c.action_name("delete")+" - "+t.ls(1054)),[4,v.RDialog.showConfirm(g.createElement(g.Fragment,null,t.ls(1622)+": "+o.rowName(r,i),g.createElement(v.VGap,null),a))]);case 2:return e.sent()?[4,y.removeAbsent(null,l)]:[2,!1];case 3:return e.sent(),[2,!0]}})})}function s(s,r,i){return _.__awaiter(this,void 0,void 0,function(){var t,n;return _.__generator(this,function(e){switch(e.label){case 0:return t=s.req,(n=s.rowData("substonline_substitutions",r))||ASC.dieError("5944750757"),n.absent?[4,v.RDialog.show(t.ttlsf(3198,{s:n.absent.name}))]:[3,2];case 1:return e.sent(),[2,!1];case 2:return[4,v.RDialog.showConfirm(g.createElement(g.Fragment,null,t.ls(1054)))];case 3:return e.sent()?[4,y.removeSubstSubstitution(null,r,i)]:[2,!1];case 4:return e.sent(),[2,!0]}})})}function r(t,e){try{var n=e.type;return("card"==n||"tcard"==n||"classroomsupervision"==n)&&!e.cancelled_absent}catch(e){if(t.mock)return!1;throw e}}function C(u,c,d){return void 0===d&&(d={}),_.__awaiter(this,void 0,void 0,function(){var t,n,s,r,i,a,o,l;return _.__generator(this,function(e){switch(e.label){case 0:return t=E.client_req,n=d.filter,s=u.split(":")[0],r=t.getSchoolYear(s),(a=d.dbi)?[3,2]:[4,ASC.blockUI(t.maindbi(r,{needed_part:h.DBITools.mergeNeededParts(C),vt_filter:{date:s}}))];case 1:a=e.sent(),e.label=2;case 2:return(o=(i=a).rowData("substonline_ttitems",u)).cancelled&&1==o.origofids.length?(l=o.origofids[0]).split(":")[0]!=s?[3,3]:(u=l,o=i.rowData("substonline_ttitems",u),[3,5]):[3,5];case 3:return[4,k(o.substids[0],c)];case 4:return e.sent(),[2];case 5:return 1==o.substids.length&&m.substIsAddCard(i.rowData("substonline_substitutions",o.substids[0]))?[4,b.showSubstEditAddCardDlg(r,o.substids[0],{join_doubles:c})]:[3,7];case 6:return e.sent(),[2];case 7:return 0<o.origofids.length&&ASC.dieError("8792878433"),o.origsubstid&&!o.substids.includes(o.origsubstid)?(alert("TODO origsubstid presun"),[2]):[4,S.showRDialogWithDbi({dlg:p.SubstEditTTItemDlg,date:u.split(":")[0],ttitemid:u,select_change:d.select_change,join_doubles:c,filter:n})];case 8:return e.sent(),[2]}})})}function k(l,u,e){return void 0===e&&(e={}),_.__awaiter(this,void 0,void 0,function(){function t(){return _.__awaiter(this,void 0,void 0,function(){var t,n;return _.__generator(this,function(e){switch(e.label){case 0:return t=l.split(":")[0],[4,ASC.blockUI(s.maindbi(s.getSchoolYear(t),{needed_part:{substonline_substitutions:["origofids","card","tcard"]},vt_filter:{date:t}}))];case 1:return n=e.sent(),r=n.rowData("substonline_substitutions",l),[2]}})})}var s,r,n,i,a,o;return _.__generator(this,function(e){switch(e.label){case 0:return s=E.client_req,[4,t()];case 1:return e.sent(),0<r.origofids.length?(l=r.origofids[0],[4,t()]):[3,3];case 2:e.sent(),e.label=3;case 3:return n=l.split(":")[0],r?(a=i="",0<(o=m.subst_item_tableIds(r,"classes")).length&&(i="classes",a=o[0]),i&&a?[4,v.RDialog.show(g.createElement(f.SubstTimetableDlg,{table:i,id:a,date:n,move_substid:l,join_doubles:u}))]:[3,5]):[3,5];case 4:e.sent(),e.label=5;case 5:return[2]}})})}(e.checkUploaded=u).npp=h.neededPartProvider(function(){return[i,{substonline_dates:["uploaded_int"]}]}),(e.showDayDeleteDlg=i).needed_part=h.typed({}),(e.showAbsentDeleteDlg=n).npp=h.neededPartProvider(function(){return[u,{substonline_absents:["table"]}]}),(e.showSubstDeleteDlg=s).needed_part=h.typed({substonline_substitutions:["absent"]}),e.SubstNeedsRegenerateBar=function(e){var t=E.client_req,n="Substitution needs to be regenerated. (There was probably some change in the timetable, Edupage database, etc.)";return"de"==ASC.lang&&(n="Die Vertretung muss neu aufgebaut werden. (Scheinbar gab es im Stundenplan oder in der Edupage Datenbank VerÃ¤nderungen o.Ã¤.)"),"sk"!=ASC.lang&&"cz"!=ASC.lang||(n="Suplovanie je potrebnÃ© pregenerovaÅ¥. (Pravdepodobne doÅ¡lo ku zmene rozvrhu, Edupage databÃ¡zy a podobne...)"),g.createElement(g.Fragment,null,g.createElement(v.RButton,{label:t.ls(2790),icon:"/global/pics/ui/reload_32.png",onClick:function(){return function(l){var u;return _.__awaiter(this,void 0,void 0,function(){function n(e){var t=e.subst,n=e.dbi,s=m.subst_item(t),r=n.tools.ttitem_popis(s);return g.createElement("div",null,g.createElement("span",null,r.period)," - ",r.subject,", ",r.class,", ",r.teacher," (",r.classroom,")")}var t,s,r,i,a,o;return _.__generator(this,function(e){switch(e.label){case 0:return t=E.client_req,[4,ASC.blockUI(d.getRegenerateInfo(null,l))];case 1:return s=e.sent(),[4,ASC.blockUI(t.maindbi(t.getSchoolYear(l),{vt_filter:{date:l},needed_part:{substonline_substitutions:["card","tcard","classroomsupervision"],subjects:["__name"],classes:["__name"],teachers:["__name"],classrooms:["__name"],igroups:["__name"],periods:["__name"],dayparts:["__name"]}}))];case 2:return r=e.sent(),i={marginBottom:20},[4,v.RDialog.showMessage(g.createElement("div",{style:{overflow:"auto",flex:"1 1",minHeight:100}},g.createElement("h1",null,ASC.ls(2790)),g.createElement("div",null,g.createElement("b",null,ASC.ls(1920),":")),g.createElement("div",{style:{paddingLeft:15,maxHeight:600,overflow:"auto"}},0<s.remove_substids.length&&g.createElement("div",{style:i},g.createElement("div",null,c.action_name("delete"),":"),s.remove_substids.map(function(e){return g.createElement(n,{key:e,subst:r.rowData("substonline_substitutions",e)||{},dbi:r})})),0<s.update_substs.length&&g.createElement("div",{style:i},g.createElement("div",null,ASC.ls(7722),":"),s.update_substs.map(function(e,t){return g.createElement(n,{key:""+t,subst:_.__assign(_.__assign({},r.rowData("substonline_substitutions",e.id)||{}),e),dbi:r})})),0<s.add_substs.length&&g.createElement("div",{style:i},g.createElement("div",null,c.action_name("add"),":"),s.add_substs.map(function(e,t){return g.createElement(n,{key:""+t,subst:e,dbi:r})})),(null===(u=s.update_date)||void 0===u?void 0:u.subst_problems)&&g.createElement("div",{style:i},g.createElement("div",null,t.ls(2025)),s.update_date.subst_problems.map(function(e,t){return g.createElement("div",{key:t},e.text)})))),{buttons:["ok","cancel"],width:500})];case 3:return e.sent()?(o=(a=ASC).blockUI,[4,Promise.resolve().then(function(){return require("./server/generator")})]):[3,6];case 4:return[4,o.apply(a,[e.sent().regenerateDay(null,l)])];case 5:return e.sent(),[2,!0];case 6:return[2,!1]}})})}(e.date)}}),n)},e.showFeedbackDlg=function(){barNewDialog({source:"/znamky/?jwgc=ZnamkyFeedbackDialog"})},e.showNotifications=function(){return _.__awaiter(this,void 0,void 0,function(){return _.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("../timeline/notifications")})];case 1:return e.sent().showGenericNotifications("substitution",ASC.ls(1003)),[2]}})})},(e.isSubstTTItemEditable=r).needed_part=h.typed({substonline_ttitems:["type","cancelled_absent"]}),(e.showTTItemEditDlg=C).npp=m.substOnlineNeededPartProvider(function(){return[m.substIsAddCard,{substonline_ttitems:["cancelled","origofids","substids"]},p.SubstEditTTItemDlg,b.SubstEditAddCardDlg]}),e.showMoveSubstDlg=k,e.showSubstDaysDlg=function(n){return _.__awaiter(this,void 0,void 0,function(){var t;return _.__generator(this,function(e){switch(e.label){case 0:return[4,Promise.resolve().then(function(){return require("./online/days")})];case 1:return t=e.sent().SubstDaysDlg,v.RDialog.show(g.createElement(t,{date:n.date,onGoToDate:n.onGoToDate})),[2]}})})},e.showSubstPublishDlg=function(f,e){return void 0===e&&(e={}),_.__awaiter(this,void 0,void 0,function(){var n,t,s,r,i,a,o,l,u,c,d,m,p,b;return _.__generator(this,function(e){switch(e.label){case 0:return n=E.client_req,[4,y.getSubstPublishData(null,f)];case 1:return t=e.sent(),s=t.dates,r="???",r=h.idsArrayMatch(s,[f])?n.ls(2744):n.lsf(2827,{n:s.length})+"\n\n("+w.date_format_dates(n,s)+")",i=null,a=g.createRef(),l=!(o=[]),s.includes(f)&&(o.push({label:n.ls(1727)+" ("+w.date_format_date(n,f)+")",type:"green",onClick:function(){i="day",a.current.confirmClose()}}),l=!0),(1<s.length||!l)&&o.push({label:(l?n.ls(1349):n.ls(1587))+" ("+n.lsf(10514,{n:s.length})+")",type:l?"blue":"green",onClick:function(){i="all",a.current.confirmClose()}}),o.push("cancel"),u="tr"==n.school_country||"ascpalo"==n.edupage,[4,v.RDialog.showInput(t,function(e){var t=e.stateRef;return g.createElement(g.Fragment,null,g.createElement(x.DlgHeader,{title:n.ls(1587),icon:"/global/pics/ui/item_ok_32.svg",inDlg:!0,small:!0}),g.createElement("div",{style:{whiteSpace:"pre-wrap"}},r,g.createElement(v.VGap,null),n.ls(1587)+"?",u&&g.createElement(g.Fragment,null,g.createElement(x.SeparatorLine,null),g.createElement(v.RCheckBox,{valueRef:t.sub("skipTeachers").not(),label:n.ls(7373)}),g.createElement("br",null),g.createElement(v.RCheckBox,{valueRef:t.sub("skipStudents").not(),label:n.ls(7374)}),g.createElement("br",null))))},{width:500,buttons:o,controlRef:a})];case 2:return c=e.sent(),i&&c?u?[4,ASC.blockUI(y.updateSubstPublishData(null,f,{skipTeachers:c.skipTeachers,skipStudents:c.skipStudents}))]:[3,4]:[2];case 3:e.sent(),e.label=4;case 4:d=[],"day"==i&&(d=[f]),"all"==i&&(d=s),m=0,p=d,e.label=5;case 5:return m<p.length?(b=p[m],[4,ASC.blockUI(y.publishDay(null,b,_.__assign({log_module:T},u?{skipTeachers:c.skipTeachers,skipStudents:c.skipStudents}:{})))]):[3,8];case 6:e.sent(),e.label=7;case 7:return m++,[3,5];case 8:return[2]}})})}},"/substitution/server/generator.js":function(e,require,t){t.implementRpc(["getRegenerateInfo","regenerateDay","generateSubstitution"])},"/substitution/dlg/ttitem.js":function(e,require,t){e.__esModule=!0;var K=require("tslib"),V=require("react"),Y=require("../../rpr/dbi"),W=require("../../asc/asc_react"),J=require("../subst"),Z=require("../../asc/edurequest"),$=require("../../asc/asc_react2"),X=require("../online/timetable"),Q=require("../../asc/actions"),ee=require("../server/commands"),G=require("../online/combo"),f=require("../online/rightpanel"),te=require("../../react/pickfromhistory"),u=require("../../react/datatable"),ne=require("../../react/combobox"),se=require("../../asc/lib_date"),c=require("../commands"),d=require("../../rpr/maindbi_ui"),re="substonline_substitutions",ie="substonline_ttitems",ae="_no_teacher_",U={display:"flex",flexDirection:"row",minHeight:23,alignItems:"center"},q={flex:"0.7 1 0px",minWidth:0},H={flex:"1 1 0px",minWidth:0,textAlign:"right"};function oe(e){var l=e.dbi,u=e.table,t=e.valueRef,n=e.orig_value,s=e.disable_change,r=e.should_change,i=e.kolizie,a=e.cancelled,o=e.absents,c=e.join_duration,d=e.filter,m=e.ttdbi,p=e.editing_ttitem,b=e.remove_ttitemids,f=e.onCombo,_=Z.client_req,h=_.isApp(),g=e.new_value||"";t&&(g=t.value);var v=!1,y=V.useState(!(!t||s||!r&&g==n)),E=y[0],w=y[1];s||g==n||E||w(!0);var S=e.orig_text;S||n&&(S=l.tools.rowName(u,n),"groupnames"==u||l.rowData(u,n)||(v=!0));var x=e.new_text||"";!x&&g&&(x=l.tools.rowName(u,g)),"periods"==u&&1<c&&(S+="-"+l.rowName("periods",Y.DBITools.uniperiod_delta(n,c-1)),x+="-"+l.rowName("periods",Y.DBITools.uniperiod_delta(g,c-1)));var T=V.useMemo(function(){if(!E)return[];var e;if("teachers"==u||"classrooms"==u){e=[{value:"",name:"-"},[]];for(var t=0,n=G.substTTItemComboItems({table:u,dbi:l,tt_dbi:m,ttitem:p,remove_ttitemids:b,topid:g,filter:d});t<n.length;t++){var s=n[t];e.push({value:s.id,name:l.rowName(u,s.id,"teachers"==u?Z.client_req.sort_name_col+"u":void 0),classname:s.className})}"teachers"==u&&(e.push([]),e.push({value:ae,name:ASC.ttls(3118)}))}else if("periods"==u&&1<c){e=[];for(var r=0,i=l.tableIds("periods");r<i.length;r++){var a=i[r],o=Y.DBITools.uniperiod_delta(a,c-1);l.rowData("periods",o)&&e.push({value:a,name:l.rowName("periods",a)+"-"+l.rowName("periods",o)})}}else e=l.tools.tableCombo(u,void 0,0<=["subjects","periods"].indexOf(u)?null:void 0);return e},[E,l,u,m,p,b,d,g]),C=null;if(i)for(var k=!1,D=!1,I=0,R=i;I<R.length;I++){var A=R[I];A.table==u&&A.id==g&&(A.join?D=!0:k=!0),(k||D)&&(C=V.createElement("img",{src:k?J.ICON_subst_kolizia:J.ICON_subst_spojenie,style:{height:16,verticalAlign:"middle",paddingTop:-3,display:"inline-block",marginLeft:7},title:k?ASC.ttls(3447):ASC.ttls(1535)}))}var N=!1;if(n&&o)for(var B=0,j=o;B<j.length;B++){var P=j[B];J.absentGetTable(P)==u&&J.absentGetId(P)==n&&(N=!0)}var M=v&&V.createElement("img",{src:"/global/pics/ui/unlink_32.svg",style:{height:24,verticalAlign:"middle",marginLeft:5},title:_.ls(3109)}),O=V.createElement("span",{style:h?{color:"#c0c0c0"}:{textAlign:"right",verticalAlign:"middle",fontWeight:N?"bold":"normal"}},N?"("+S+")":S),z=null,F=null,L=null;return z=h?V.createElement("span",{style:{color:"#c0c0c0",marginLeft:4}},S?"âž”":"+"):V.createElement("img",{src:"/global/pics/ui/replace_32.svg",style:{verticalAlign:"middle",height:16,padding:"0px 5px"}}),a?F=V.createElement(V.Fragment,null):s?F=V.createElement(V.Fragment,null,x||(N?ASC.ls(1846):"-")):E?F=V.createElement(ne.default,{valueRef:t,items:T,style:"periods"==u?{}:{minWidth:150,width:h?"100%":void 0},onClick:f?function(){return f(),!1}:void 0}):(F=V.createElement(V.Fragment,null,x),s||v||(L=V.createElement("a",{style:{marginLeft:7,fontSize:"80%",color:"#a0a0a0",cursor:"pointer"},onClick:function(){w(!0)}},ASC.ls(1090)))),S!=x||N||E||(O=S,F=z=null),h?V.createElement(V.Fragment,null,V.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},V.createElement("div",{style:{flex:"1 1 0px",position:"relative"}},O,z),M,L),V.createElement(W.VGap,{height:3}),V.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},V.createElement("div",{style:{flex:"1 1 0px",position:"relative"}},F),C)):V.createElement("div",{style:U},V.createElement("div",{style:q},O,M),z,V.createElement("div",{style:H},F,C,L))}function le(e){var t=e.align,n=e.children;return Z.client_req.isApp()?V.createElement("div",{style:{textAlign:t}},n):V.createElement("div",{style:U},V.createElement("div",{style:q},"left"==t&&n),V.createElement("div",{style:H},"right"==t&&n))}function ue(e){return V.createElement(le,{align:"right"},V.createElement("a",{style:{marginLeft:7,fontSize:"80%",color:"#a0a0a0",cursor:"pointer"},onClick:e.onClick},ASC.ls(1257)))}function n(p){var t=this,s=Z.client_req,E=p.dbi,r=p.ttdbi,w=p.select_change,S=p.ttitemid,c=p.join_doubles,i=p.filter,a=S.split(":")[0];W.useTTLang();var o=W.useStateValueRef(function(){var e=E.rowData(ie,S),t=K.__assign({},e.orig||J.coreOfTTItem(e));t.teacherids=K.__spreadArrays(t.teacherids),t.classroomids=K.__spreadArrays(t.classroomids);for(var n=K.__assign(K.__assign({},t),{teacherids:K.__spreadArrays(t.teacherids),classroomids:K.__spreadArrays(t.classroomids),classids:K.__spreadArrays(t.classids)}),s={absents:[],orig_row:t,row:n,cancelled:e.cancelled,teacherids_cancelled:[],substs:[]},r=[],i=0,a=e.substids;i<a.length;i++){var o=a[i],l=E.rowData(re,o);if(l.absent&&s.absents.push(l.absent),!J.subst_isTargetAbsent(l)&&(s.substs.push(l),r=J.mergeSubstChanges(r,J.substBasicChanges(l)),l.cancel_teacher))for(var u=0,c=l.changes;u<c.length;u++){var d=c[u];if("teachers"==J.changeColumn2table(d.column)&&d.old)for(var m=0;m<t.teacherids.length;m++)t.teacherids[m]==d.old&&(s.teacherids_cancelled[m]=!0)}}for(var p=0,b=e.cancelled?r:e.changes;p<b.length;p++){switch(h=(d=b[p]).column){case"subjectid":case"igroupid":n.subjectid=d.new||"";break;case"period":n.uniperiod=d.new||"";break;default:"teacherid"==h&&(h="teacherids");var f=t[h],_=n[h];if(d.old){for(m=0;m<f.length;m++)if(f[m]==(d.old||"")){_[m]=d.new||"";break}}else f.push(""),_.push(d.new)}}if(w){var h,g=!1,v=n[h=Y.DBITools.removeEs(J.changeColumn2table(w.column))+"ids"],y=t[h];for(m=0;m<y.length;m++)if(y[m]==w.old){g=!0,v[m]=w.new;break}g||(w.old&&ASC.dieError("2580200144"),y.push(w.old||""),v.push(w.new||""))}return 0==s.substs.length&&s.substs.push({id:"",substitution_typeid:"",note:"",inote:"",changes:[]}),s}),e=o.value,b=e.row,f=e.orig_row,_=e.cancelled,l=e.absents,h=e.substs,g=e.teacherids_cancelled,u=s.isApp(),n=!1;(["ascpalo","schillertest2","esg-filderstadt","goethe-schule"].includes(s.edupage)||["de","at","ch"].includes(s.school_country))&&(n=!0);function d(e,t,n){e:for(var s=0;s<n.length;s++){var r=n[s];if(r=r||t[s]){for(var i=0,a=N;i<a.length;i++){var o=a[i];if(o.table==e&&o.id==r)continue e}N.push({table:e,id:r})}}}var m=V.useMemo(function(){return J.buildSubstOnlineTTItemsEx(E,a,c)},[E,a,c]).find(function(e){return e.id==S}),v=m.durationperiods,y=o.sub("row"),x={verticalAlign:"top"},T=K.__assign({},x),C=K.__assign({},x),k={display:"none"},D={},I={},R="period"==Y.DBITools.typeOfUniPeriod(b.uniperiod)&&!_,A="classroomsupervision"!=b.type,N=[];"classroomsupervision"==b.type?(d("classrooms",f.classroomids,b.classroomids),d("teachers",f.teacherids,b.teacherids)):(f.igroupid&&N.push({table:"igroups",id:f.igroupid}),d("classes",f.classids,b.classids),_||(d("teachers",f.teacherids,b.teacherids),d("classrooms",f.classroomids,b.classroomids))),N=W.useMemoStructure(N);var B=K.__assign(K.__assign({},b),{id:"_editing_",date:a,subId:"",type:"classroomsupervision"==b.type?"classroomsupervision":"tcard",durationperiods:v});_&&(B.orig=J.coreOfTTItem(B),B.cancelled=!0,B.subjectid="",B.classids=[],B.igroupid="",B.teacherids=[],B.classroomids=[]),B=W.useMemoStructure(B);function j(){var e={remove:[],update:[],add:[]};try{for(var t=E.rowData(ie,p.ttitemid),n=ce({dbi:E,ttitem:t,orig_row:f,row:b,teacherids_cancelled:g,cancelled:_,prev_substs:h,final:!0}),s=new Set,r=0,i=n;r<i.length;r++){var a={note:(d=i[r]).note,inote:d.inote,changes:d.changes,substitution_typeid:d.substitution_typeid,cancelled:d.cancelled,cancel_teacher:d.cancel_teacher};if(d.id){s.add(d.id);var o=E.rowData(re,d.id);J.substChangesEquals(a.changes,o.changes)&&(a.changes=o.changes),_&&(a.changes=void 0);var l=Y.DBITools.rowChanges2write(o,a);l&&e.update.push(Y.unpartial(l))}else e.add.push(a)}for(var u=0,c=t.substids;u<c.length;u++){var d,m=c[u];(d=E.rowData(re,m)).absent||s.has(d.id)||e.remove.push(d.id)}}catch(e){if(!E.old&&!E.mock)throw e}return e}function P(){var e=j();return 0!=e.add.length||0!=e.update.length||0!=e.remove.length}function M(){return K.__awaiter(t,void 0,void 0,function(){return K.__generator(this,function(e){switch(e.label){case 0:return P()?[4,ASC.blockUI(K.__awaiter(t,void 0,void 0,function(){var t,n,s,r,i,a,o,l,u;return K.__generator(this,function(e){switch(e.label){case 0:t=j(),n=0,s=t.update,e.label=1;case 1:return n<s.length?(a=s[n],[4,ee.updateSubstSubstitution(null,a.id,a,c)]):[3,4];case 2:e.sent(),e.label=3;case 3:return n++,[3,1];case 4:r=0,i=t.add,e.label=5;case 5:return r<i.length?(a=i[r],[4,ee.addSubstSubstitution(null,S,a,c)]):[3,8];case 6:e.sent(),e.label=7;case 7:return r++,[3,5];case 8:o=0,l=t.remove,e.label=9;case 9:return o<l.length?(u=l[o],[4,ee.removeSubstSubstitution(null,u,c)]):[3,12];case 10:e.sent(),e.label=11;case 11:return o++,[3,9];case 12:return[2]}})}))]:(L.current.close(),[2]);case 1:return e.sent(),L.current.confirmClose(),[2]}})})}var O=W.useMemoStructure(K.__spreadArrays([m.id],m.join_ttitemids||[])),z=V.useMemo(function(){return X.getSubstTTItemKolizie(E,r,B,O)},[E,r,B,O]),F="classroomsupervision"!=m.type&&!_,L=V.useRef(),G=!Y.idsArrayMatch(b.groupnames,b.groupnames)||!Y.DBITools.groupnamesIsEntireClass(b.groupnames),U=W.useHandler(function(e){return y.set(K.__assign(K.__assign({},b),{uniperiod:e,endtime:""}))}),q=W.useMemoStructure({where:"ttitem",closeParent:W.useHandler(function(){return K.__awaiter(t,void 0,void 0,function(){var t;return K.__generator(this,function(e){switch(e.label){case 0:return P()?[4,W.RDialog.showMessage(s.ls(1037)+"?",{msgType:"question",buttons:["yes","no","cancel"]})]:[3,2];case 1:if(!(t=e.sent()))return[2,!1];if("no"==t)return L.current.close(),[2,!0];e.label=2;case 2:return[4,M()];case 3:return e.sent(),[2,!0]}})})}),date:a,dbi:E,tt_dbi:r,items:N,style:W.useMemoStructure({height:Math.min(50+60*N.length,300)}),small:!0,remove_ttitemids:O,editing_ttitems:W.useMemoStructure([B]),join_doubles:c,onPeriodClick:R?U:null,kolizie:z}),H=V.useMemo(function(){return V.createElement(X.SubstDlgTimetableView,K.__assign({},q))},[q]);return V.createElement(W.RDialog,{header:ASC.ls(1003)+" - "+se.date_format_day(Z.client_req,a)+(P()?"*":""),width:970,controlRef:L,onConfirm:function(){return M()},buttons:u?["ok"]:["ok","cancel"],footer:V.createElement(W.RButton,{label:Q.action_name("help"),fa_icon:Q.action_fa_icon("help"),onClick:function(){return window.open("https://help.edupage.org/text.php?id=1639","_blank")}})},V.createElement(W.VGap,{height:6}),"classroomsupervision"!=b.type&&V.createElement(V.Fragment,null,V.createElement($.HorizontalSplit,null,V.createElement($.SectionWithIcon,{icon:E.table("subjects").icon(),small:!0,verticalCenter:u,style:T},V.createElement(W.RLabel,{text:E.table("subjects").itemName()+":",style:k}),V.createElement(oe,{dbi:E,table:"subjects",orig_value:f.subjectid,valueRef:y.sub("subjectid"),cancelled:_})),f.igroupid?V.createElement($.SectionWithIcon,{icon:E.table("igroups").icon(),small:!0,style:C},V.createElement(oe,{dbi:E,table:"igroups",orig_value:f.igroupid,new_value:b.igroupid,disable_change:!0,kolizie:z,cancelled:_,absents:l})):V.createElement($.SectionWithIcon,{icon:E.table("classes").icon(),small:!0,verticalCenter:u,style:C},V.createElement(W.RLabel,{text:E.table("classes").itemName()+":",style:k}),f.classids.map(function(e,t){return V.createElement(oe,{key:""+t,dbi:E,table:"classes",orig_value:e,new_value:b.classids[t],disable_change:!0,kolizie:z,cancelled:_,absents:l})}),G&&V.createElement(V.Fragment,null,V.createElement(W.VGap,{height:5}),V.createElement(oe,{dbi:E,table:"groupnames",orig_text:E.tools.groupnames_names(f.groupnames),new_text:E.tools.groupnames_names(b.groupnames),disable_change:!0,cancelled:_})))),V.createElement($.SeparatorLine,{style:D})),V.createElement($.HorizontalSplit,null,V.createElement($.SectionWithIcon,{icon:E.table("teachers").icon(),small:!0,verticalCenter:u,style:T},V.createElement(W.RLabel,{text:E.table("teachers").itemName()+":",style:k}),b.teacherids.map(function(e,n){var t=o.cast(function(e){return e.row.teacherids[n]||(e.teacherids_cancelled[n]?ae:"")},function(e,t){return t=K.__assign(K.__assign({},t),{row:K.__assign(K.__assign({},t.row),{teacherids:K.__spreadArrays(t.row.teacherids)}),teacherids_cancelled:K.__spreadArrays(t.teacherids_cancelled)}),e==ae?(t.row.teacherids[n]="",t.teacherids_cancelled[n]=!0):(t.row.teacherids[n]=e,t.teacherids_cancelled[n]=!1),t});return V.createElement(oe,{key:""+n,dbi:E,table:"teachers",filter:i,ttdbi:r,editing_ttitem:B,remove_ttitemids:O,orig_value:f.teacherids[n]||"",valueRef:t,kolizie:z,cancelled:_,should_change:!f.teacherids[n],absents:l,onCombo:s.isApp()?function(){return W.RDialog.show(V.createElement(de,{table:"teachers",valueRef:t,ttitemid:S,dbi:E,tt_dbi:r,join_doubles:c}))}:void 0})}),F&&(0==b.teacherids.length||b.teacherids[b.teacherids.length-1])&&V.createElement(ue,{onClick:function(){o.sub("row").set(K.__assign(K.__assign({},b),{teacherids:K.__spreadArrays(b.teacherids,[""])})),o.sub("orig_row").set(K.__assign(K.__assign({},f),{teacherids:K.__spreadArrays(f.teacherids,[""])}))}})),V.createElement($.SectionWithIcon,{icon:E.table("classrooms").icon(),small:!0,verticalCenter:u,style:C},V.createElement(W.RLabel,{text:E.table("classrooms").itemName()+":",style:k}),b.classroomids.map(function(e,t){return V.createElement(oe,{key:""+t,dbi:E,table:"classrooms",filter:i,ttdbi:r,editing_ttitem:B,remove_ttitemids:O,orig_value:f.classroomids[t]||"",valueRef:y.sub("classroomids").index(t),disable_change:!A,kolizie:z,cancelled:_,should_change:!f.classroomids[t],absents:l})}),F&&(0==b.classroomids.length||b.classroomids[b.classroomids.length-1])&&V.createElement(ue,{onClick:function(){o.sub("row").set(K.__assign(K.__assign({},b),{classroomids:K.__spreadArrays(b.classroomids,[""])})),o.sub("orig_row").set(K.__assign(K.__assign({},f),{classroomids:K.__spreadArrays(f.classroomids,[""])}))}}))),V.createElement($.SeparatorLine,{style:D}),V.createElement($.HorizontalSplit,null,V.createElement($.SectionWithIcon,{icon:"/timetable/pics/app/office/alarm_48.png",small:!0,verticalCenter:u,style:K.__assign(K.__assign({},T),{minHeight:70})},V.createElement(W.RLabel,{text:ASC.ls(1345)+":",style:k}),R?V.createElement(oe,{dbi:E,table:"periods",orig_value:f.uniperiod,valueRef:y.sub("uniperiod"),cancelled:_,join_duration:v}):V.createElement(oe,{dbi:E,table:"periods",orig_text:E.tools.uniperiodName(f.uniperiod,void 0,f)||"-",new_text:E.tools.uniperiodName(b.uniperiod,void 0,b)||"-",disable_change:!0,cancelled:_}),V.createElement("br",null),V.createElement(le,{align:u?"left":"right"},V.createElement(W.RCheckBox,{valueRef:o.sub("cancelled"),label:ASC.ls(2322)}))),V.createElement("div",null,V.createElement($.SectionWithIcon,{icon:E.table("substitution_types").icon(),small:!0,style:C},h.map(function(n,e){var s=o.sub("substs").index(e);return 1==h.length?V.createElement(W.Fragment,{key:""+e},_||V.createElement(V.Fragment,null,V.createElement(W.RLabel,{text:E.column(re,"substitution_typeid").name()+":",style:I}),V.createElement(ne.default,{valueRef:s.sub("substitution_typeid"),items:E.tools.tableCombo("substitution_types"),style:{width:u?"100%":200}}),V.createElement(W.VGap,{height:3})),V.createElement(W.RLabel,{text:E.column(re,"note").name(),style:K.__assign(K.__assign({},I),{verticalAlign:"top"})}),V.createElement(W.RTextArea,{valueRef:s.sub("note"),style:{width:u?"100%":200}}),V.createElement(te.PickFromHistory,{valueRef:s.sub("note"),table:"substonline_substitutions",column:"note",date:a})):V.createElement("div",{key:""+e},V.createElement("div",{style:{fontSize:"80%",color:"#808080"}},function(n,e){for(var t=e.absent?J.absentGetTable(e.absent):"teachers",s=null,r=null,i=0,a=e.changes;i<a.length;i++){var o=a[i],l=J.changeColumn2table(o.column);"teachers"==l?s=o:l==t&&(r=o)}var u=[];s&&u.push(s);r&&u.push(r);return 0!=u.length?u.map(function(e){var t=J.changeColumn2table(e.column);return n.tools.rowName(t,e.old)+" -> "+n.tools.rowName(t,e.new)}).join(", "):e.absent?"("+n.rowName(J.absentGetTable(e.absent),J.absentGetId(e.absent))+")":""}(E,n)),_||V.createElement(ne.default,{valueRef:s.sub("substitution_typeid"),items:E.tools.tableCombo("substitution_types"),style:{width:200}}),V.createElement(W.HGap,{width:4}),V.createElement("a",{style:{cursor:"pointer",display:"inline-block",whiteSpace:"nowrap",textOverflow:"ellipsis"},onClick:function(){return K.__awaiter(t,void 0,void 0,function(){var t;return K.__generator(this,function(e){switch(e.label){case 0:return[4,W.RDialog.showInput({note:n.note},function(e){return V.createElement("div",null,V.createElement(W.RTextArea,{valueRef:e.stateRef.sub("note"),style:{height:50}}),V.createElement(te.PickFromHistory,{valueRef:e.stateRef.sub("note"),table:"substonline_substitutions",column:"note",date:a}))},{header:E.column(re,"note").name()})];case 1:return(t=e.sent())&&s.sub("note").set(t.note),[2]}})})}},E.column(re,"note").name()+(n.note?": "+n.note:"")),V.createElement(W.VGap,{height:5}))})),n&&V.createElement($.SectionWithIcon,{icon:"/substitution/pics/inote_32.svg",small:!0,style:C},V.createElement(W.RLabel,{text:E.column(re,"inote").name(),style:K.__assign(K.__assign({},I),{verticalAlign:"top"})}),V.createElement(W.RTextArea,{valueRef:o.sub("substs").index(0).sub("inote"),style:{width:u?"100%":200}})))),V.createElement($.SeparatorLine,{style:D}),V.createElement("div",{style:{minHeight:200,overflow:"auto"}},H),V.createElement(W.RUpdateListener,{updateTriggers:[b,_],onUpdate:function(){var e=ce({dbi:E,ttitem:m,orig_row:f,row:b,teacherids_cancelled:g,cancelled:_,prev_substs:h,final:!1});o.sub("substs").set(e)},onMount:function(){return L.current.center()}}))}function ce(e){var t=e.dbi,n=e.ttitem,s=e.orig_row,r=e.row,i=e.teacherids_cancelled,a=e.prev_substs,o=e.cancelled,l=e.final,u=[],c=function(e,t){void 0===t&&(t="normal");for(var n=0,s=e.tableData("substitution_types");n<s.length;n++){var r=s[n];if(r.default_for==t)return r.id}return""}(t,"classroomsupervision"==n.type?"classroomsupervision":"normal"),d=[],m=new Set,p=[],b=[],f="classroomsupervision"==n.type?"teacherid":"teacherids";if(!o){for(var _=a.filter(function(e){return!J.subst_isTargetAbsent(e)}).filter(function(e){return e.absent}).filter(function(e){return"classrooms"==J.absentGetTable(e.absent)}).map(function(e){return J.absentGetId(e.absent)}),h=0;h<r.teacherids.length;h++){var g=s.teacherids[h]||"";!(v=r.teacherids[h]||"")&&i[h]&&g&&m.add(g),v!=g&&d.push({column:f,old:g||void 0,new:v||void 0})}for(h=0;h<r.classroomids.length;h++){var v,y={column:"classroomids",old:(g=s.classroomids[h]||"")||void 0,new:(v=r.classroomids[h]||"")||void 0};0<=_.indexOf(g)?p.push(y):v!=g&&b.push(y)}r.subjectid!=s.subjectid&&b.push({column:"subjectid",old:s.subjectid,new:r.subjectid}),r.uniperiod!=s.uniperiod&&("period"!=Y.DBITools.typeOfUniPeriod(r.uniperiod)&&ASC.dieError("1066666158"),b.push({column:"period",old:s.uniperiod,new:r.uniperiod}))}for(var E=[],w=[],S=[],x=0,T=a;x<T.length;x++){var C=(j=T[x]).absent?J.absentGetTable(j.absent):"";"teachers"==C?E.push(j):"classrooms"==C?w.push(j):S.push(j)}for(var k=new Set,D=function(e){for(var t=0,n=e.changes;t<n.length;t++){var s=n[t];if("teachers"==J.changeColumn2table(s.column))return}for(var r=0,i=d;r<i.length;r++){s=i[r];if(!k.has(s)){e.changes.push(s),k.add(s),e.cancel_teacher=m.has(s.old);break}}},I=function(e){if(!(e.cancelled=o))for(var t=0,n=b;t<n.length;t++){var s=n[t];e.changes.push(s)}},R=function(){if(k.size<d.length)return!1;if((0<b.length||o)&&0==u.length)return!1;if(0==u.length){if(!l)return!1;var e=a[0];if(e&&(e.substitution_typeid||e.note||e.inote))return!1}return!0},A=0,N=E;A<N.length;A++){var B=N[A],j=K.__assign(K.__assign({},B),{changes:[],cancelled:o});if(!o){for(var P=J.absentGetId(j.absent),M=!1,O=0,z=d;O<z.length;O++){(H=z[O]).old==P&&(k.add(H),j.changes.push(H),j.cancel_teacher=m.has(H.old),M=!0)}M||(ASC.logProblem("0897145113"),j.changes.push({column:f,old:P,new:P}))}I(j),u.push(j)}for(var F=0,L=w;F<L.length;F++){B=L[F],j=K.__assign(K.__assign({},B),{changes:[],cancelled:o});if(!o){for(var G=J.absentGetId(j.absent),U=(M=!1,0),q=p;U<q.length;U++){var H;(H=q[U]).old==G&&(j.changes.push(H),M=!0)}M||(ASC.logProblem("9288323371"),j.changes.push({column:"classroomids",old:G,new:G})),D(j)}I(j),u.push(j)}for(var V=0,W=S;V<W.length;V++){B=W[V];if(R())break;D(j=K.__assign(K.__assign({},B),{changes:[],cancelled:o})),I(j),u.push(j)}for(;!R();){D(j={id:"",date:n.date,substitution_typeid:c,note:"",changes:[],cancelled:o}),I(j),u.push(j)}return u}function de(e){var t=e.table,n=e.valueRef,s=e.ttitemid,r=e.dbi,i=e.tt_dbi,a=e.join_doubles,o=r.req,l=s.split(":")[0],u=V.useState(n.value)[0],c=V.useState(""),d=c[0],m=c[1],p=V.useRef(),b=[{text:"-",onClick:function(){n.set(""),p.current.confirmClose()}}];return"teachers"==t&&b.push({text:o.ttls(3118),onClick:function(){n.set(ae),p.current.confirmClose()}}),V.createElement(W.RDialog,{controlRef:p,width:400,height:600,buttons:[{action:"ok",type:"green",label:o.ls(2105)}],onConfirm:function(e){n.set(d),e.confirmClose()},footer:V.createElement(V.Fragment,null,V.createElement(W.RButton,{label:o.ls(1239),menu:b}))},V.createElement(f.TeachersView,{dbi:r,tt_dbi:i,date:l,join_doubles:a,ttitemid:s,table:t,topid:u,onRowSelect:function(e){return m(e)}}))}(e.SubstEditTTItemDlg=n).npp=J.substOnlineNeededPartProvider(function(){return[J.buildSubstOnlineTTItemsEx,G.substTTItemComboItems,ce,de,X.SubstDlgTimetableView,{substonline_ttitems:["subjectid","classids","teacherids","classroomids","igroupid","uniperiod","endtime","type","orig","changes","cancelled","substids"],substonline_substitutions:["changes","cancelled","cancel_teacher","note","inote","substitution_typeid"],substonline_dates:["tt_num"],periods:["period","starttime","endtime"],subjects:["__name"],classes:["__name"],igroups:["__name"],teachers:["__name"],classrooms:["__name"],substitution_types:["__name"]}]}),n.ttdbi={npp:Y.neededPartProvider(function(){return[G.substTTItemComboItems.ttdbi]})},ce.needed_part=Y.typed({substonline_substitutions:["absent","changes"],substitution_types:["default_for"]}),e.ChangeOtherLessonDlg=function(e){var t=e.app,s=t.naming_dbi,n=t.getDate(),r=t.state.join_doubles;V.useEffect(function(){return d.maindbiActionStat("ChangeOtherLessonDlg","substonline_ttitems","show")}),W.useTTLang();var i=W.useStateValueRef(""),a=J.buildSubstOnlineTTItemsEx(t.dbi,n,r).filter(function(e){return"event"!=e.type&&!(e.cancelled||e.added)}).map(function(e){var t=e.orig||e,n=s.tools.ttitem_popis(t);return n.teacher=s.tools.ttitem_popis(t,Z.client_req.sort_name_col).teacher,K.__assign(K.__assign({},n),{uniperiod:t.uniperiod,id:e.id})});function o(){var e=i.value;e?(l.current.confirmClose(),c.showTTItemEditDlg(e,r)):W.RDialog.showConfirm(ASC.ls(1574))}a.sort(function(e,t){return parseInt(e.uniperiod)-parseInt(t.uniperiod)});var l=V.useRef();return V.createElement(W.RDialog,{header:ASC.ttls(3794),width:700,height:600,controlRef:l,buttons:[{label:ASC.ttls(1054),type:"green",onClick:o},"cancel"]},V.createElement(u.RDatatable,{columns:[{key:"period",label:ASC.ls(1466),width:70,sortable:!0},{key:"teacher",label:ASC.ls(1300),width:130,sortable:!0},{key:"class",label:ASC.ls(1263),width:130,sortable:!0},{key:"subject",label:ASC.ls(1299),width:130,sortable:!0},{key:"classroom",label:ASC.ls(1197),width:80,sortable:!0}],data:a,style:{flex:"1 1 200px"},selectedIdRef:i,fitWidth:!0,onRowDoubleClick:o}))},de.npp=Y.neededPartProvider(function(){return[f.TeachersView]}),e._hotswap=[de,oe,ue,le,n]},"/react/pickfromhistory.js":function(e,require,t){e.__esModule=!0;var v=require("tslib"),l=require("../asc/asc_react"),u=require("react"),y=require("../asc/lib_date"),E=require("./datatable"),c=new Map;e.PickFromHistory=function(p){var e=this,b=l.useReq(),f=p.table,_=p.column,s=p.valueRef,t=f+"."+_,h=c.get(t);function g(t){(null==t?void 0:t.trim())&&(h.entries=h.entries.filter(function(e){return e.value!=t}),h.entries.unshift({value:t,time:Date.now()}))}h||c.set(t,h={initialized:!1,entries:[]});var n=u.useRef();n.current=s.value,u.useEffect(function(){return function(){return g(n.current)}},[]);var r=l.useHoverWithMenu(),i=r[0],a=r[1],o=r[2];return u.createElement("span",{style:{position:"relative",verticalAlign:"top"}},u.createElement("i",v.__assign({},a,{className:"fa fa-ellipsis-h",style:{fontSize:12,color:"#c0c0c0",backgroundColor:i?"rgba(0, 0, 0, 0.1)":void 0,padding:"3px 7px",cursor:"pointer",position:"absolute",right:0,top:0},title:b.ls(6551),onClick:function(n){return v.__awaiter(e,void 0,void 0,function(){var t;return v.__generator(this,function(e){switch(e.label){case 0:return t=n.currentTarget,h.initialized?[3,2]:[4,function(){return v.__awaiter(this,void 0,void 0,function(){var t,n,s,r,i,a,o,l,u,c,d,m;return v.__generator(this,function(e){switch(e.label){case 0:return t=p.date||b.timezone_date(),n=y.date_delta(t,-14),s=y.date_delta(t,14),[4,b.maindbi(b.getSchoolYear(t),{needed_part:(m={},m[f]=[_],m),vt_filter:{datefrom:n,dateto:s}})];case 1:if(r=e.sent(),(i=r.tableData(f)).sort(function(e,t){return E.compareStrings(t.date,e.date)}),a=i.map(function(e){return e[_]||""}),f.startsWith("subst")&&"note"==_)for(o=function(t){a=a.filter(function(e){return!(e.startsWith(t)&&e.length<t.length+15)})},l=0,u=[b.lsf(7442,{date:""}),b.lsf(7443,{date:""})];l<u.length;l++)o(u[l]);for(c=0,d=a;c<d.length;c++)g(d[c]);return h.initialized=!0,[2]}})})}()];case 1:e.sent(),e.label=2;case 2:return h.entries.splice(50),o(h.entries.map(function(e){return{text:e.value,onClick:function(){return s.set(e.value)}}}),t),[2]}})})}})))}},"/substitution/dlg/addcard.js":function(e,require,t){e.__esModule=!0;var E=require("tslib"),w=require("react"),S=require("../../rpr/dbi"),x=require("../server/commands"),T=require("../../asc/asc_react"),C=require("../../asc/edurequest"),k=require("../subst"),D=require("../online/timetable"),I=require("../../asc/asc_react2"),R=require("../../rpr/dbi_react"),A=(require("../../asc/actions"),require("../online/combo")),N=require("../../react/pickfromhistory"),B=require("../../react/combobox"),j=require("../../asc/lib_date"),P="_no_teacher_",M="_more_";function O(e){for(var t=e.kolizie,n=e.table,s=0,r=t;s<r.length;s++){if(r[s].table==n)return w.createElement("img",{src:"/global/pics/ui/item_bad_16.png",style:{height:16,verticalAlign:"top",paddingTop:3},title:ASC.ttls(3447)})}return null}function r(e){var i=e.dbi,t=e.ttdbi,a=e.date,o=e.substid,l=e.join_doubles;w.useEffect(function(){return barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstEditAddCardDlg.open",eventLabel:""})},[]),T.useTTLang();var n=w.useRef(),s=w.useMemo(function(){var e=null,t=[];if(o){var n=i.rowData("substonline_substitutions",o),s=k.buildSubstOnlineTTItemsEx(i,a,l),r=k.findTTItemFromSubstId(s,o);e={id:n.id,date:n.date,subId:n.subId,uniperiod:r.uniperiod,endtime:r.endtime,durationperiods:r.durationperiods||1,subjectid:r.subjectid,teacherids:r.teacherids,cancel_teacher:n.cancel_teacher,classids:r.classids,groupnames:r.groupnames,igroupid:r.igroupid,classroomids:r.classroomids,substitution_typeid:n.substitution_typeid,note:n.note,origid:n.origid},t=E.__spreadArrays([r.id],r.join_ttitemids||[])}return{orig:e,remove_ttitemids:t}},[]),r=s.orig,u=s.remove_ttitemids,c=T.useStateValueRef(r||{id:"",date:a,subId:"",uniperiod:"1",endtime:"",durationperiods:1,subjectid:"",teacherids:[],cancel_teacher:!1,classids:[],groupnames:[""],igroupid:"",classroomids:[],substitution_typeid:"",note:"",origid:""}),d=i.req,m=c.value,p=!o?ASC.ttls(3784):ASC.ttls(1058);r&&r.origid&&(p=ASC.lsf(7443,{date:j.date_format_date(C.client_req,r.origid.split(":")[0])})),v()&&(p+="*");var b={verticalAlign:"top"},f=d.isApp()?{}:{width:100},_=[];m.classids.forEach(function(e){return _.push({table:"classes",id:e})}),m.teacherids.forEach(function(e){return _.push({table:"teachers",id:e})}),m.classroomids.forEach(function(e){return _.push({table:"classrooms",id:e})});var h={id:"_editing_",date:a,subId:"",type:"tcard",uniperiod:m.uniperiod,endtime:m.endtime,durationperiods:m.durationperiods,subjectid:m.subjectid,teacherids:m.teacherids,classids:m.classids,groupnames:m.groupnames,classroomids:m.classroomids,igroupid:m.igroupid,added:!0,changes:[],substids:[],origofids:[]},g=D.getSubstTTItemKolizie(i,t,h,u);function v(){return!r||!!S.DBITools.rowChanges2write(r,m)}function y(){return E.__awaiter(this,void 0,void 0,function(){var t;return E.__generator(this,function(e){switch(e.label){case 0:return[4,i.frontend.showVyberDlg("teachers",m.teacherids)];case 1:return(t=e.sent())&&c.sub("teacherids").set(t),[2]}})})}return w.createElement(T.RDialog,{header:p,width:970,controlRef:n,onConfirm:function(){return function(){return E.__awaiter(this,void 0,void 0,function(){var t;return E.__generator(this,function(e){switch(e.label){case 0:return v()?[4,ASC.blockUI(x.updateSubstSubstitutionAddCard(null,m))]:(n.current.close(),[2]);case 1:return(t=e.sent()).fail?[4,T.showUniResponse(t)]:[3,3];case 2:return e.sent(),[3,4];case 3:n.current.confirmClose(),barTrackEvent({eventCategory:"SubstOnline",eventAction:"SubstEditAddCardDlg.ok",eventLabel:""}),e.label=4;case 4:return[2]}})})}()},buttons:["ok","cancel"]},w.createElement(T.VGap,{height:6}),w.createElement(I.HorizontalSplit,null,w.createElement(I.SectionWithIcon,{icon:i.table("subjects").icon(),small:!0,style:b},w.createElement(T.RLabel,{text:i.table("subjects").itemName()+":",style:f}),w.createElement(B.default,{valueRef:c.sub("subjectid"),items:i.tools.tableCombo("subjects")})),w.createElement(I.SectionWithIcon,{icon:i.table("classes").icon(),small:!0,style:b},w.createElement(T.RLabel,{text:i.table("classes").itemName()+":",style:f}),w.createElement(R.UniClassPicker,E.__assign({},{dbi:i,date:a,rowRef:c})),w.createElement(O,{kolizie:g,table:"classes"}))),w.createElement(I.SeparatorLine,null),w.createElement(I.HorizontalSplit,null,w.createElement(I.SectionWithIcon,{icon:i.table("teachers").icon(),small:!0,style:b},w.createElement(T.RLabel,{text:i.table("teachers").itemName()+":",style:f}),1<m.teacherids.length?w.createElement(T.RButton,{label:i.rowNames("teachers",m.teacherids),onClick:y,style:{width:200}}):w.createElement(B.default,{valueRef:c.cast(function(e){return 0==e.teacherids.length?e.cancel_teacher?P:"":e.teacherids[0]},function(e,t){return E.__assign(E.__assign({},t),{teacherids:e&&e!=P?[e]:[],cancel_teacher:e==P})}).onSet(function(e){if(e==M)return y(),!1}),items:E.__spreadArrays([{value:"",name:"-"}],A.substTTItemComboItems({table:"teachers",dbi:i,tt_dbi:t,ttitem:h,remove_ttitemids:u,topid:m.teacherids[0]}).map(function(e){return{value:e.id,name:i.rowName("teachers",e.id),classname:e.className||void 0}}),[[],{value:P,name:d.ttls(3118)},[],{value:M,name:d.ls(1239)}]),style:{width:200}}),w.createElement(O,{kolizie:g,table:"teachers"})),w.createElement(I.SectionWithIcon,{icon:i.table("classrooms").icon(),small:!0,style:b},w.createElement(T.RLabel,{text:i.table("classrooms").itemName()+":",style:f}),w.createElement(R.UniClassroomPicker,E.__assign({},{dbi:i,rowRef:c,style:{width:200},substCombo:A.substTTItemComboItems({table:"classrooms",dbi:i,tt_dbi:t,ttitem:h,remove_ttitemids:u,topid:m.classroomids[0]})})),w.createElement(O,{kolizie:g,table:"classrooms"}))),w.createElement(I.SeparatorLine,null),w.createElement(I.HorizontalSplit,null,w.createElement(I.SectionWithIcon,{icon:"/timetable/pics/app/office/alarm_48.png",small:!0,style:b},w.createElement(T.RLabel,{text:ASC.ls(1345)+":",style:f}),w.createElement("span",{style:{display:"inline-block",verticalAlign:"top"}},w.createElement(R.UniPeriodPicker,E.__assign({},{dbi:i,rowRef:c,modes:["period","starttime","daypart"]})),1<m.durationperiods&&"period"==S.DBITools.typeOfUniPeriod(m.uniperiod)&&w.createElement("span",{style:{verticalAlign:"middle"}}," - ",i.rowName("periods",S.DBITools.uniperiod_delta(m.uniperiod,m.durationperiods-1))))),w.createElement(I.SectionWithIcon,{icon:i.table("substitution_types").icon(),small:!0,style:b},w.createElement(T.RLabel,{text:i.column("substonline_substitutions","substitution_typeid").name()+":",style:f}),w.createElement(B.default,{valueRef:c.sub("substitution_typeid"),items:i.tools.tableCombo("substitution_types"),style:{width:200}}),w.createElement(T.VGap,{height:3}),w.createElement(T.RLabel,{text:i.column("substonline_substitutions","note").name()+":",style:E.__assign(E.__assign({},f),{verticalAlign:"top"})}),w.createElement(T.RTextArea,{valueRef:c.sub("note"),style:{width:200}}),w.createElement(N.PickFromHistory,{valueRef:c.sub("note"),table:"substonline_substitutions",column:"note",date:a}))),w.createElement(I.SeparatorLine,null),w.createElement("div",{style:{minHeight:200}},!1,w.createElement(D.SubstDlgTimetableView,E.__assign({},{where:"addcard",date:a,dbi:i,tt_dbi:t,join_doubles:l,items:_,style:{height:Math.min(50+60*_.length,300)},remove_ttitemids:u,editing_ttitems:[h],onPeriodClick:"period"==S.DBITools.typeOfUniPeriod(m.uniperiod)?function(e){return c.set(E.__assign(E.__assign({},m),{uniperiod:e,endtime:""}))}:void 0,kolizie:g}))))}(e.SubstEditAddCardDlg=r).npp=k.substOnlineNeededPartProvider(function(){return[D.getSubstTTItemKolizie,k.buildSubstOnlineTTItemsEx,A.substTTItemComboItems,D.SubstDlgTimetableView,{subjects:["__name"],classes:["__name"],teachers:["__name"],classrooms:["__name"],igroups:["__name"],periods:["__name"],dayparts:["__name"],substitution_types:["__name"],substonline_substitutions:["cancel_teacher"]}]}),r.ttdbi={npp:S.neededPartProvider(function(){return[D.getSubstTTItemKolizie.ttdbi]})},e.showSubstEditAddCardDlg=function(e,n,s){return E.__awaiter(this,void 0,void 0,function(){var t;return E.__generator(this,function(e){return!(t=s.date)&&n&&(t=n.split(":")[0]),[2,R.showRDialogWithDbi({dlg:r,date:t,substid:n,join_doubles:s.join_doubles})]})})},e._hotswap=[r]},"/substitution/dlg/absent.js":function(E,require,e){E.__esModule=!0;var w=require("tslib"),S=require("react"),x=require("../../asc/asc_react"),T=S.Fragment,C=require("../../rpr/dbi"),k=require("../subst"),D=require("../../rpr/dbi_react"),I=require("../server/commands"),R=require("../../asc/edurequest"),A=require("../../timetable/server/timetable"),N=require("../../asc/asc_react2"),B=require("../../asc/actions"),j=require("../commands"),P=require("../../react/datefield"),M=require("../../react/combobox");E.TABLE_absents="substonline_absents",E.TABLE_ttitems="substonline_ttitems",E.TABLE_substs="substonline_substitutions";var O=["teachers","classes","classrooms"];function z(e){return"absent_"+C.DBITools.removeEs(e)+"ids"}function F(e){return!(!e.longtime_datefrom&&!e.longtime_dateto)}function r(n,s){return void 0===s&&(s={}),w.__awaiter(this,void 0,void 0,function(){var t;return w.__generator(this,function(e){return t=s.date||n.split(":")[0],[2,D.showRDialogWithDbi({dlg:i,date:t,absentid:n,add_data:s.row,add_teacherids:s.teacherids,add_classids:s.classids,add_classroomids:s.classroomids})]})})}E.showSubstAbsentEditDlg=r;var L={multiple:!(E.showSubstOnlineAbsentDlg=function(e,t,n,s){return w.__awaiter(this,void 0,void 0,function(){return w.__generator(this,function(e){return[2,r(n,s)]})})}),absent_user:"",groupname:"",split_entireclass:!1,absent_teacherids:[],absent_classids:[],absent_classroomids:[],absent_typeid:"",allday:!0,period:"",durationperiods:1,exclude_breaks:"",is_longtime:!1,longtime_datefrom:"",longtime_dateto:"",note:"",su_dozory:!1};function i(n){var e=this,t=R.client_req,p=n.dbi,b=n.date,f=n.absentid,_=!f;"string"!=typeof f&&ASC.dieError("6320169500"),b||ASC.dieError("5946326033"),x.useTTLang();function s(r){return w.__awaiter(e,void 0,void 0,function(){var t,n,s;return w.__generator(this,function(e){switch(e.label){case 0:return t=z(r),n=g[t],[4,Promise.resolve().then(function(){return require("../../rpr/vyber")})];case 1:return[4,e.sent().showDBIVyberDlg(p,r,n,{date:b})];case 2:return!(s=e.sent())||0==s.length&&0==n.length||(i.sub(t).set(s),i.sub("multiple").set(!0)),[2]}})})}var h=p.rowData(E.TABLE_absents,f),i=x.useStateValueRef(function(){var e,t=w.__assign({},L);return _?(e=n.add_data,t.absent_teacherids=n.add_teacherids||[],t.absent_classids=n.add_classids||[],t.absent_classroomids=n.add_classroomids||[],w.__spreadArrays(t.absent_teacherids,t.absent_classids,t.absent_classroomids).length?t.multiple=!0:(null==e?void 0:e.table)&&(t.absent_user=C.DBITools.rowid2user(k.absentGetTable(e),k.absentGetId(e)))):(h||ASC.dieError("6304814492",[f]),t.absent_user=C.DBITools.rowid2user(k.absentGetTable(h),k.absentGetId(h)),e=h),e&&(t.groupname=e.groupname||"",t.absent_typeid=e.absent_typeid||"",t.note=e.note||"",e.period&&(t.period=e.period,t.durationperiods=e.durationperiods||null),t.exclude_breaks=e.exclude_breaks||"",t.split_entireclass=e.split_entireclass||!1,t.longtime_datefrom=e.longtime_datefrom||"",t.longtime_dateto=e.longtime_dateto||"",t.is_longtime=F(e)),t}),r=S.useMemo(function(){var e=[];e.push({name:"-",value:""});for(var t=0,n=O;t<n.length;t++){var s=n[t];e.push([]);for(var r=p.table(s).icon(),i=[],a=0,o=p.tableData(s);a<o.length;a++){var l=o[a],u=l.id;if(!(l.dateto&&l.dateto<b)){var c={value:C.DBITools.rowid2user(s,u),name:p.rowName(s,u,R.client_req.sort_name_col+"u"),icon:r};l.cb_hidden||l.subst_hidden?(c.classname="cb_hidden",i.push(c)):e.push(c)}}e=w.__spreadArrays(e,i)}return e},[p]),g=i.value,a=C.DBITools.user2rowid(g.absent_user),o=a.table,l=a.id,u=O.map(function(t){return{text:p.table(t).name(),onClick:function(){return w.__awaiter(e,void 0,void 0,function(){return w.__generator(this,function(e){return[2,s(t)]})})}}}),c={width:160},d={dbi:p,table:"substonline_absents",rowRef:i},m=!1;g.period&&(g.exclude_breaks?m=!0:g.su_dozory&&(g.multiple?(0<g.absent_teacherids.length||0<g.absent_classroomids.length)&&(m=!0):o&&"classes"!=o&&(m=!0)));var v=""!=g.groupname&&S.createElement(x.RCheckBox,{valueRef:i.sub("split_entireclass"),label:ASC.ls(3775)}),y=S.useRef();S.useEffect(function(){barTrackEvent({eventCategory:"SubstOnline",eventAction:"AbsentDlg.open",eventLabel:""}),A.suDozory(null,b).then(function(e){return i.sub("su_dozory").set(e)})},[]);return S.createElement(x.RDialog,{header:_?ASC.ttls(1447):ASC.ls(1622),width:520,controlRef:y,onConfirm:function(){return w.__awaiter(e,void 0,void 0,function(){var t,n,s,r,i,a,o,l,u,c,d,m;return w.__generator(this,function(e){switch(e.label){case 0:if(t=p.table(E.TABLE_absents),n=[],g.multiple)for(s=0,r=O;s<r.length;s++)for(i=r[s],a=0,o=g[z(i)];a<o.length;a++)l=o[a],n.push(C.DBITools.rowid2user(i,l));else g.absent_user&&n.push(g.absent_user);return 0!=n.length?[3,2]:[4,x.RDialog.showMessage(ASC.ttls(2165))];case 1:return e.sent(),[2];case 2:for(c in u={},g)t.column(c)&&(u[c]=g[c]);return g.is_longtime||(u.longtime_datefrom="",u.longtime_dateto=""),_||(d=h,(u=C.DBITools.rowChanges2write(d,u))||n[0]==C.DBITools.rowid2user(k.absentGetTable(d),k.absentGetId(d))||(u={})),u?[4,ASC.blockUI(I.absentEditWrite(null,_?b:f,n,u))]:(y.current.close(),[2]);case 3:return(m=e.sent()).fail?[4,x.showUniResponse(m)]:[3,5];case 4:return e.sent(),[3,6];case 5:y.current.confirmClose(),barTrackEvent({eventCategory:"SubstOnline",eventAction:"AbsentDlg.ok",eventLabel:""}),e.label=6;case 6:return[2]}})})},buttons:t.isApp()?["ok"]:["ok","cancel"],footer:!_&&S.createElement(x.RButton,{label:B.action_name("delete"),onClick:function(){return w.__awaiter(e,void 0,void 0,function(){return w.__generator(this,function(e){switch(e.label){case 0:return[4,j.showAbsentDeleteDlg(p,f)];case 1:return e.sent()&&y.current.confirmClose("delete"),[2]}})})}})},S.createElement(N.SectionWithIcon,{icon:"/timetable/pics/app/office/help_48.png"},g.multiple?S.createElement(S.Fragment,null,O.map(function(e){var t=g[z(e)];return S.createElement("div",{key:e},S.createElement(x.RButton,{content:S.createElement("img",{src:p.table(e).icon(),style:{height:16}}),onClick:function(){return s(e)}})," ",p.rowNames(e,t),"classes"==e&&1==t.length&&S.createElement(S.Fragment,null," ",S.createElement(D.GroupNameCombo,{date:b,classid:t[0],groupnameRef:i.sub("groupname")}),v))})):S.createElement(S.Fragment,null,S.createElement("div",null,S.createElement(x.RLabel,{text:ASC.ttls(1449)+":"}),S.createElement(M.default,{items:r,valueRef:i.sub("absent_user"),style:c}),S.createElement(x.HGap,{width:5}),_&&S.createElement(x.RButton,{label:t.ls(1239)+"...",menu:u,style:{minWidth:"auto"}})),S.createElement("div",null,"classes"==o&&S.createElement(S.Fragment,null,S.createElement(x.RLabel,{text:""}),S.createElement(D.GroupNameCombo,{date:b,classid:l,groupnameRef:i.sub("groupname")}),v)))),S.createElement(N.SeparatorLine,null),S.createElement(N.SectionWithIcon,{icon:"/timetable/pics/app/office/reason_absence_48.png"},S.createElement(x.RLabel,{text:ASC.ttls(1450)+":"}),S.createElement(M.default,{valueRef:i.sub("absent_typeid"),items:p.tools.tableCombo("absent_types"),style:c})),S.createElement(N.SeparatorLine,null),S.createElement(N.SectionWithIcon,{icon:"/timetable/pics/app/office/alarm_48.png"},S.createElement(x.RLabel,{text:ASC.ttls(1451)+":"}),S.createElement("div",{style:{display:"inline-block",verticalAlign:"top"}},S.createElement(D.UniPeriodExpPicker,{modes:["allday","periods_interval"],rowRef:i,dbi:p}),m&&S.createElement("div",{style:{marginTop:3}},S.createElement(G,{valueRef:i.sub("exclude_breaks"),enable_inbetween:1<g.durationperiods})))),S.createElement(N.SeparatorLine,null),S.createElement(N.SectionWithIcon,{icon:"/timetable/pics/app/office/calendar_48.png"},S.createElement(x.RCheckBox,{valueRef:i.sub("is_longtime"),label:ASC.ttls(1453),disabled:h&&F(h)}),S.createElement("br",null),g.is_longtime&&S.createElement(T,null,S.createElement("div",{style:{marginLeft:100,marginTop:5}},S.createElement(P.default,{valueRef:i.sub("longtime_datefrom")})," - ",S.createElement(P.default,{valueRef:i.sub("longtime_dateto")})))),S.createElement(D.DlgField,{dlgRow:d,column:"note",label_style:"top",style:{width:"100%"}}))}function G(e){function t(e){return e.cast(function(e){return!e},function(e){return!e})}var n=e.valueRef.cast(function(e){return{exclude_b:0<=e.indexOf("b"),exclude_i:0<=e.indexOf("i"),exclude_a:0<=e.indexOf("a")}},function(e){return(e.exclude_b?"b":"")+(e.exclude_i?"i":"")+(e.exclude_a?"a":"")});return S.createElement(T,null,ASC.ls(2846),": ",S.createElement(x.RCheckBox,{label:ASC.ttls(3275),valueRef:t(n.sub("exclude_b"))})," ",e.enable_inbetween&&S.createElement(x.RCheckBox,{label:ASC.ttls(4352),valueRef:t(n.sub("exclude_i"))})," ",S.createElement(x.RCheckBox,{label:ASC.ttls(3276),valueRef:t(n.sub("exclude_a"))}))}(E.AbsentEditDlg=i).npp=C.neededPartProvider(function(){return[{substonline_absents:["table","classid","teacherid","classroomid","groupname","absent_typeid","note","period","durationperiods","exclude_breaks","split_entireclass","longtime_datefrom","longtime_dateto"],teachers:["__name","cb_hidden","subst_hidden","dateto"],classes:["__name"],classrooms:["__name","cb_hidden"],absent_types:["__name"],periods:["__name"]},j.showAbsentDeleteDlg]}),E._hotswap=[i]},"/timetable/server/timetable.js":function(e,require,t){t.implementRpc(["timetableGroupnameCombo","suDozory"])},"/substitution/subststudents_popup.js":function(e,require,t){e.__esModule=!0;var h=require("tslib"),g=require("../asc/edurequest"),v=require("react"),l=require("../calendar/event_popup"),y=require("../asc/asc_react"),E=require("../react/popuppanel"),w=require("../rpr/dbi_react"),S=require("../asc/asc_react2"),x=require("../asc/actions"),T=require("../rpr/maindbi_ui"),C=require("../asc/lib_date"),k=require("../rpr/dbi"),u="/substitution/pics/subst_students_32.svg";function c(e,t){if(!t)return"";var n=e.ls(12014)+" (";return 0<t.add_st.length&&(n+="+"+t.add_st.length),0<t.remove_st.length&&(n+="-"+t.remove_st.length),n+=")"}function D(e,t){var n=e.rowName("classes",t.classid);return t.groupname&&(n+=" - "+e.tools.groupnames_names([t.groupname])),n+=" Â· "+e.rowName("subjects",t.subjectid)}function d(e){var t=e.subst,n=e.online,s=h.__spreadArrays(t.add_ss,t.remove_ss);return v.createElement(r,{table:n?"substonline_students":"subst_students",ids:s})}function s(e){var t,n,s=this,r=g.client_req,i=e.table,a=e.id,o=a.split(":")[0],l=r.getSchoolYear(o),u="substonline_students"==i,c=w.useMainDBI(l,{needed_part:(t={},t[i]=["date","studentids","longtime_datefrom","longtime_dateto","longtimeids","uniperiod","durationperiods","moveto"],t.students=["__name","classid"],t.classes=["__name"],t.subjects=["__name"],t.groupsubjects=["__name"],t.periods=["__name"],t),vt_filter:{date:o},suspense:!0}),d=c.rowData(i,a);if(!d)return null;for(var m=new Map,p=0,b=d.studentids;p<b.length;p++){var f=b[p],_=c.rowData("students",f,{classid:""});k.map2array_get(m,_.classid).push(f)}return v.createElement(v.Fragment,null,v.createElement(E.PopupDetail,{hidden:d.longtime_datefrom==d.longtime_dateto,label:r.ls(1602)},C.date_format_2dates(r,d.longtime_datefrom,d.longtime_dateto,!1)),v.createElement(E.PopupDetail,{hidden:"ad"==d.uniperiod,label:c.tools.uniperiodLabel(d.uniperiod)},c.tools.uniperiodName(d.uniperiod,"name",d)),v.createElement(E.PopupDetail,{label:r.ls(2060)},k.map2array(m).map(function(e){var t=e[0],n=e[1];return v.createElement("div",{key:n},c.rowName("classes",n)+": "+c.rowNames("students",t))}),v.createElement("div",{style:{padding:3}},v.createElement("i",{className:"fa fa-arrow-down"})),v.createElement(S.RJoin,{glue:", "},null===(n=d.moveto)||void 0===n?void 0:n.map(function(e){return D(c,e)}))),u&&v.createElement(v.Fragment,null,v.createElement(S.SeparatorLine,null),v.createElement("div",{style:{display:"flex",flexDirection:"row"}},v.createElement(y.RButton,{label:x.action_name("delete"),onClick:function(){return h.__awaiter(s,void 0,void 0,function(){var t;return h.__generator(this,function(e){switch(e.label){case 0:return t=x.action_name("delete"),d.longtime_datefrom<d.longtime_dateto&&(t+="\n"+C.date_format_2dates(r,d.longtime_datefrom,d.longtime_dateto)),[4,y.RDialog.showConfirm(t,{msgType:"areyousure"})];case 1:return e.sent()&&ASC.blockUI(c.backend.removeRows(i,d.longtimeids,{log_module:"SubstStudentsPopupDiv"})),[2]}})})}}),v.createElement("div",{style:{flex:"1"}}),v.createElement(y.RButton,{label:x.action_name("edit"),type:"green",onClick:function(){return h.__awaiter(s,void 0,void 0,function(){return h.__generator(this,function(e){return[2,T.showMainDbiItemDlg(l,i,a)]})})}}))))}function r(e){var n=e.table,t=k.idsArrayUnique(e.ids||[e.id]);return v.createElement(E.PopupWithHeader,{icon:u,title:function(e){return void 0===e&&(e=g.client_req),e.ls(12014)}()},v.createElement(S.RJoin,{glue:v.createElement(S.SeparatorLine,null)},t.map(function(e,t){return v.createElement(s,{key:t,table:n,id:e})})))}e.studentsinfoSubstText=c,e.substStudents_mvtText=D,e.StudentsinfoSubstBar=function(e){var t=e.subst,n=e.online,s=g.client_req,r=E.useSimplePopup(),i=r[0],a=r[1],o=r[2];return t?v.createElement(v.Fragment,null,v.createElement("div",{style:h.__assign({cursor:"pointer"},e.style||{}),onClick:a},v.createElement("img",{src:u,style:y.rtlCss(h.__assign(h.__assign({},l.EventIcon.style),{marginRight:3,verticalAlign:"middle"}))}),c(s,t)),o&&v.createElement(i,null,v.createElement(d,{subst:t,online:n}))):null},e.SubstStudentsPopup=r,e.showSubstStudentsPopup=function(e,t){E.showPopup(e,v.createElement(r,h.__assign({},t)))}},"/substitution/server/settings.js":function(e,require,t){t.implementRpc(["getSubstOnlineUISettings","updateSubstOnlineUISettings"])},"/substitution/online/leftpanel.js":function(e,require,t){e.__esModule=!0;var B=require("tslib"),j=require("react"),P=require("../../rpr/dbi"),M=require("../../asc/asc_react"),O=require("../../dashboard/dbi_events"),z=require("../subst"),F=require("../../asc/actions"),L=require("../server/commands"),y=require("../../asc/edurequest"),E=require("../../asc/lib_date"),r=require("../../react/menu"),_=require("../filter"),p=require("../../react/popuppanel"),m=require("../../calendar/event_popup"),b=require("./subst_popup"),w=require("../subststudents_popup");function f(e,t){return t.name||e.rowName("event_types",t.typ)}function G(S){for(var x=this,T=S.dbi,C=S.getDate(),k=T.req,D={eventInfo:new Map,eventTypeInfo:new Map,absentInfo:new Map},e=S.getEvents(),I=S.getAbsents(),R=z.buildSubstOnlineTTItemsEx(T,C,!1),A=z.buildSubstOnlineTTItemsEx(T,C,!0),t=0,n=I;t<n.length;t++){var s=n[t];D.absentInfo.set(s.id,{eventids:[]})}for(var N=[],r=function(e){var t={state:"",menu:[]};if("changeroom"==e.typ){for(var n=e.teacherids[0],s=e.classroomids[0],r=e.classroomids[1],i=null,a=null,o=0,l=1<e.durationperiods?A:R;o<l.length;o++){var u=l[o];u.uniperiod==P.DBITools.getUniPeriod(e)&&u.teacherids.includes(n)&&("period"==P.DBITools.typeOfUniPeriod(u.uniperiod)&&(u.durationperiods||1)!=e.durationperiods||(u.classroomids.includes(s)&&(i=u),u.classroomids.includes(r)&&(a=u)))}if(i){if(0==i.substids.length&&1==i.classroomids.length){var c=function(){return B.__awaiter(x,void 0,void 0,function(){return B.__generator(this,function(e){switch(e.label){case 0:return[4,L.updateSubstTTItem(null,i.id,{classroomids:[r]},{substitution_typeid:z.getDefault_substitution_typeid(T,"changeroom")},1<i.durationperiods)];case 1:return e.sent(),[2]}})})};t.menu.push({text:ASC.ls(1257)+" -> "+k.ls(1003),icon:F.action_icon("add"),onClick:function(){return B.__awaiter(x,void 0,void 0,function(){var t;return B.__generator(this,function(e){switch(e.label){case 0:return"short",t=T.tools.ttitem_popis(i,"short"),[4,M.RDialog.showConfirm(j.createElement("div",null,k.ttls(3794)+"?",j.createElement("br",null),j.createElement("br",null),t.period+" "+t.subject+" "+t.class,j.createElement("br",null),j.createElement("br",null),t.classroom," -> ",T.rowName("classrooms",r,"short")),{srcFunction:G})];case 1:return e.sent()?[4,c()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}}),N.push(c)}}else a&&(t.state="handled")}else if("bookroom"==e.typ);else{var d={teachers:[],classes:[],classrooms:[]},m=!1;for(var p in d)if(!("classes"==p&&O.isTTCancelEvent(T,e)&&(null===(b=e.groupnames)||void 0===b?void 0:b.includes(""))))for(var b=0,f=O.event_tableIds(e,p,{dbi:T,date:C,expand_ctevent:!0});b<f.length;b++){var _=f[b],h=m=!0,g=e.groupnames;if("classes"!=p||!g||0!=g.length&&!P.DBITools.groupnames_sg(g)){if(e.period)for(var v=parseInt(e.period),y=v+(e.durationperiods||1)-1,E=v;E<=y;E++){var w;(w=z.findAbsent(I,p,_,{groupnames:g,period:""+E}))?P.idsArraySetAdd(D.absentInfo.get(w.id).eventids,e.id):h=!1}else(w=z.findAbsent(I,p,_,{groupnames:g,starttime:e.starttime,endtime:e.endtime,daypart:e.daypart}))?P.idsArraySetAdd(D.absentInfo.get(w.id).eventids,e.id):h=!1;h||d[p].push(_)}}0==d.classes.length&&0==d.teachers.length&&0==d.classrooms.length?t.state=m?"handled":"":(t.state="",t.menu.push({text:ASC.ls(1257)+" -> "+ASC.ls(1622),icon:F.action_icon("add"),onClick:function(){return S.showAbsentEditDlg("",{classids:d.classes,teacherids:d.teachers,classroomids:d.classrooms,period:e.period,durationperiods:e.durationperiods,groupname:e.groupnames[0]})}}))}D.eventInfo.set(e.id,t)},i=0,a=e;i<a.length;i++){r(a[i])}if(1<N.length){var o=k.ls(1257)+" -> "+k.ls(1003)+" ("+N.length+")";D.eventTypeInfo.set("changeroom",{menu:[{text:o,icon:F.action_icon("add"),onClick:function(){return B.__awaiter(x,void 0,void 0,function(){var t,n,s;return B.__generator(this,function(e){switch(e.label){case 0:return[4,M.RDialog.showConfirm(j.createElement(j.Fragment,null,o,j.createElement(M.VGap,{height:10}),k.ls(1054)))];case 1:if(!e.sent())return[3,5];t=0,n=N,e.label=2;case 2:return t<n.length?(s=n[t],[4,ASC.blockUI(s())]):[3,5];case 3:e.sent(),e.label=4;case 4:return t++,[3,2];case 5:return[2]}})})}}]})}return D}function h(e){var t=e.online,n=e.event,s=e.eventInfo,r=t.dbi,i=r.tools.ttitem_popis(n).period,a=p.useSimplePopup(),o=a[0],l=a[1],u=a[2],c=f(r,n),d=[];return 0<n.classids.length&&(c=r.rowNames("classes",n.classids,"short")+": "+c,P.DBITools.groupnamesIsEntireClass(n.groupnames)||d.push(r.tools.groupnames_names(n.groupnames))),n.subjectid&&d.push(r.rowName("subjects",n.subjectid,"short")),0<n.teacherids.length&&d.push(r.rowNames("teachers",n.teacherids,"short")),0<n.classroomids.length&&d.push(r.rowNames("classrooms",n.classroomids,"short")),j.createElement(j.Fragment,null,j.createElement(S,B.__assign({},{key:n.subId,state:s.state,icon:O.eventIcon(r,n),name:c,when:i,reason:d.join("; "),popupShown:u,onClick:function(e){return l(e)}})),u&&j.createElement(o,null,j.createElement(m.EventPopup,{eventid:n.id,where:"subst",footer:s.menu.map(function(e,t){return j.createElement(M.RButton,{key:t,label:e.text,icon:e.icon,onClick:e.onClick})})})))}function i(e){var s=e.online,r=e.eventsInfo,i=s.dbi,t=s.filter,n=M.useStateValueRef(!1),a=n.value,o=M.useStateAsValueRef(M.useLocalState("SubstOnline.AbsentPanelEvents.etCollapsedRef",{},{where:"localStorage"})),l=i.tableFilterData("events",{date:s.getDate()});if(0==(l=_.substFilterRows(i,t,"events",l)).length)return null;for(var u={},c=0,d=l;c<d.length;c++){var m=d[c],p=m.typ;u[p]||(u[p]=[]),u[p].push(m)}var b=i.tableIds("event_types"),f=(b=B.__spreadArrays(["changeroom"],b.filter(function(e){return"changeroom"!=e}))).map(function(e){var t=u[e];if(!t)return null;var n=r.eventTypeInfo.get(e);return j.createElement(g,{key:e,title:i.rowName("event_types",e),collapsedRef:o.sub(e,!1),count:t.length,level:1,menu:n?n.menu:void 0},t.map(function(e){return j.createElement(h,{key:e.id,online:s,event:e,eventInfo:r.eventInfo.get(e.id)})}))});return j.createElement(j.Fragment,null,j.createElement(g,{title:ASC.ls(1844),collapsedRef:n,count:l.length}),j.createElement(M.AnimatedCollapseDiv,{collapsed:a},f))}function n(e){var t=e.online,n=G(t),s=t.getDateRow(),r=t.getAbsents();return j.createElement("div",{style:B.__assign({width:"200px",display:"flex",flexDirection:"column"},e.style||{}),className:"absent_d"},j.createElement(a,{online:e.online,uploaded:!!s.uploaded_int,holiday:s.is_holiday,isAbsent:0<r.length,date:t.getDate()}),j.createElement("div",{className:"list",style:{overflow:"auto",flex:"1 100px"}},j.createElement(o,{online:e.online,table:"teachers",title:ASC.ttls(3817),eventsInfo:n}),j.createElement(o,{online:e.online,table:"classes",title:ASC.ttls(3779),eventsInfo:n}),j.createElement(o,{online:e.online,table:"classrooms",title:ASC.ttls(3780),eventsInfo:n}),j.createElement(c,{online:e.online}),j.createElement(i,{online:e.online,eventsInfo:n})))}function a(t){var e=y.client_req,n="",s="/timetable/pics/app/office/patient_ok_128.png";return t.uploaded?n=e.ttls(1995):t.holiday?(n=e.ls(1245),s="/timetable/pics/app/office/rest_area_128.png"):n=t.isAbsent?e.ttls(1447):e.ttls(3815)+"\n"+E.date_format_date(e,t.date,!1)+"\n"+e.ttls(3816),j.createElement("div",{className:"add isAbsent",onClick:function(e){t.uploaded?t.online.checkUploaded(t.date):t.online.showAbsentEditDlg("")}},j.createElement("div",{className:"img",style:{backgroundImage:"url("+s+")"}}),n)}function g(t){var e=t.children||[],n=t.collapsedRef.value,s=t.count;return void 0===s&&(s=e.length),j.createElement(j.Fragment,null,j.createElement("div",{className:t.level?"subheader":"header",style:{cursor:"pointer",userSelect:"none",display:"flex",flexDirection:"row"},onClick:function(){return t.collapsedRef.set(!n)}},j.createElement("span",{style:{flex:1}},t.title+(n?" ("+s+")":":")),t.menu&&j.createElement("span",{style:{padding:"1px 4px"},onClick:function(e){return r.showMenu(t.menu,e.currentTarget)}},j.createElement("i",{className:"fa fa-caret-down"}))),j.createElement(M.AnimatedCollapseDiv,{collapsed:n},e))}function S(e){var t=M.useHover(),n=t[0],s=t[1],r=e.onClick,i="",a="#ffffff";switch(e.state){case"handled":i="/global/pics/ui/item_ok_16.png",a="#d0ffd0";break;case"event":i="/global/pics/ui/events_32.png";break;case"error":i="/global/pics/ui/item_bad_16.png"}return e.smallicon&&(i=e.smallicon),(n||e.popupShown)&&(a="#b3d4ff"),j.createElement("div",B.__assign({},s,{onClick:r,onContextMenu:r,style:{backgroundColor:a,padding:4,cursor:"pointer",minHeight:32,position:"relative"}}),j.createElement("img",{src:e.icon,style:M.rtlCss({height:32,float:"left",marginRight:4})}),j.createElement("div",{style:{float:"right",color:"#808080",fontSize:"80%"}},e.when),j.createElement("div",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},e.name),j.createElement("div",{style:{marginTop:3,color:"#808080"}},e.reason),!!i&&j.createElement("img",{src:i,style:M.rtlCss({position:"absolute",left:21,top:23,height:16,filter:"drop-shadow(1px 1px 2px rgba(0,0,0,0.5))"})}))}function l(e){var t=e.absent,n=e.online.naming_dbi,s=e.absentInfo.eventids,r=p.useSimplePopup(),i=r[0],a=r[1],o=r[2],l=z.absentGetTable(t),u=z.absentGetId(t),c=n.rowName(l,u);"groups"==t.table&&(c+=" ("+n.tools.groupnames_names([t.groupname])+")");var d="";t.longtime_datefrom&&(d=ASC.ASC_date2str(t.longtime_datefrom,!1)+"-"+ASC.ASC_date2str(t.longtime_dateto,!1)+" "),void 0!==t.period&&(d+=n.tools.ttitem_popis(t).period);var m=n.rowName("absent_types",t.absent_typeid);return j.createElement(j.Fragment,null,j.createElement(S,{key:t.subId,icon:"/global/pics/ui/"+P.DBITools.removeEs(l)+"_32.png",state:0<s.length?"event":"",smallicon:void 0,name:"teachers"==l?j.createElement("span",{className:"ascSeCnt"},c):c,when:d,reason:m,popupShown:o,onClick:function(e){return a(e)}}),o&&j.createElement(i,null,j.createElement(b.AbsentPopup,{where:"subst",absentid:t.id,eventids:s})))}function o(t){var e=t.online,n=e.filter,s=e.dbi,r=M.useStateValueRef(!1),i=t.online.getAbsents().filter(function(e){return z.absentGetTable(e)==t.table});i=_.substFilterRows(s,n,"substonline_absents",i);var a=new Map;e.dbi.tableData(t.table).forEach(function(e,t){return a.set(e.id,t+1)});function o(e){return a.get(z.absentGetId(e))||1e3}return i.sort(function(e,t){return o(e)-o(t)}),0==i.length?null:j.createElement(g,{title:t.title,collapsedRef:r},i.map(function(e){return j.createElement(l,{key:e.id,online:t.online,absent:e,absentInfo:t.eventsInfo.absentInfo.get(e.id)})}))}function u(e){for(var t,n,s=y.client_req,r=e.dbi,i=e.row,a=r.table("substonline_students"),o=i.studentids||[],l=new Map,u=0,c=o;u<c.length;u++){var d=c[u],m=r.rowData("students",d,{}).classid||"";P.map2array_get(l,m).push(d)}for(var p=[],b=0,f=r.tableIds("classes");b<f.length;b++){m=f[b];var _=l.get(m);if(_){var h=r.rowName("classes",m,"short")+": ";1<l.size?h+=_.length:h+=s.lsf(10885,{n:_.length}),p.push(h)}}var g="";i.longtime_datefrom<i.longtime_dateto&&(g=E.date_format_2dates(s,i.longtime_datefrom,i.longtime_dateto,!1)),"ad"!=i.uniperiod&&(g&&(g+=", "),g+=r.tools.uniperiodName(i.uniperiod,"short",i));var v="âž” ";return v+=r.rowNames("classes",i.moveto_classids||[],"short")+": ",v+=s.lsf(12018,{n:(null===(t=i.moveto)||void 0===t?void 0:t.length)+(null===(n=i.groupsubjectids)||void 0===n?void 0:n.length)}),j.createElement(j.Fragment,null,j.createElement(S,{name:p.join(", "),icon:a.icon(),when:g,reason:v,onClick:function(e){return w.showSubstStudentsPopup(e,{table:"substonline_students",id:i.id})}}))}function c(e){var t=e.online,n=t.dbi,s=t.getDate(),r="substonline_students",i=M.useStateValueRef(!1),a=n.table(r);if(!a)return null;var o=n.tableFilterData(r,{date:s});return 0==o.length?null:j.createElement(g,{title:a.name(),collapsedRef:i},o.map(function(e){return j.createElement(u,{key:e.id,dbi:n,row:e})}))}(e.eventName=f).needed_part=P.typed({events:["name","typ"],event_types:["name"]}),G.npp=P.neededPartProvider(function(){return[z.buildSubstOnlineTTItemsEx,O.event_tableIds,O.isTTCancelEvent,{events:["date","typ","__ttitem_old"],substonline_absents:["date","table","teacherid","classroomid","classid","groupname","period","durationperiods"]}]}),i.npp=P.neededPartProvider(function(){return[f,O.eventIcon,{events:["date","typ","__ttitem_old"],event_types:["name"]}]}),(e.LeftPanel=n).npp=P.neededPartProvider(function(){return[i,o,c,G]}),o.needed_part=P.typed({substonline_absents:["date","table","classid","teacherid","classroomid","groupname","note","absent_typeid","longtime_datefrom","longtime_dateto"],absent_types:["__name"]}),c.needed_part=P.typed({substonline_students:["date","studentids","groupsubjectids","longtime_datefrom","longtime_dateto","uniperiod","durationperiods","moveto","moveto_classids"],students:["classid"],classes:["__name"],periods:["short"]})},"/substitution/server/substdbi.js":function(e,require,t){t.implementRpc(["substDBIAccessor"])},"/react/splitline.js":function(e,require,t){e.__esModule=!0;var b=require("tslib"),f=require("../asc/asc_react"),_=require("react");e.SplitLine=function(e){var t=e.sizeRef,n=e.style,s=e.axis,r=e.unit,i=e.min,a=e.max,o=_.useRef(),l=_.useState(1),u=l[0],c=l[1],d=s.includes("x");f.useDomReader(function(){if("%"==r){var e=o.current.parentElement,t=d?e.clientWidth:e.clientHeight;c(Math.max(t,10)/100)}});var m=1==u?t:t.cast(function(e){return e*u},function(e){return e/u}),p=f.useMouseResize(m,{axis:s,min:(null!=i?i:0)*u,max:null!=a?a*u:void 0});return _.createElement("div",{ref:o,onMouseDown:p,style:b.__assign(b.__assign({boxSizing:"border-box",flex:"0 0 auto"},d?{width:5,cursor:"e-resize"}:{height:5,cursor:"s-resize"}),n||{})})}},"/asc/purchase.js":function(e,require,t){e.__esModule=!0;var l=require("tslib"),s=require("./server/purchase"),u=require("../rpr/dbi"),c=require("../rpr/dbi_react"),d=require("./edurequest"),m=require("react"),p=require("./asc_react"),b=require("./lib_date"),f=require("../rpr/maindbi_ui");function _(n){return void 0===n&&(n={}),l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return[4,ASC.blockUI(s.getPurchaseEdupageLink(null,n))];case 1:return t=e.sent(),p.openUrl(t),[2]}})})}function h(e){var t,n,s=d.client_req,r=c.useMainDBI(e.dbi?null:s.getSchoolYear(),{needed_part:h.needed_part,interactive:!1})||e.dbi,i=u.patchmissingobj(r.rowData("global_settings","1",{}).license);if("Xascpalo"==s.edupage&&(i={expire:"2022-04-01",pro:!1,ttonline:!0,limited:!1,standard:!1,certik_url:"https://www.asctimetables.com"}),r.mock)return null;if(!(s.isAdmin()||s.hasRight("timetable")||s.hasRight("subst")||s.hasRight("agenda")))return null;if(["sk","cz","de","at","ch","pl","tr","ru"].includes(s.school_country)&&"ascpalo"!=s.edupage)return null;var a=function(){return _()},o="";if(i.certik_url)t=s.ls(11860),a=function(){return p.openUrl(i.certik_url)},o="certik";else if(i.ttonline||i.pro){if(!(i.expire&&i.expire<b.date_delta(s.timezone_date(),31)))return null;t=s.lsf(9338,{date:b.date_format_date(s,i.expire)}),n=s.ls(9336)}else i.expire?(t=s.ls(9337),n=s.ls(9335),o="expired"):(t=s.ls(11609),n=s.ls(11610));return m.createElement("div",{style:l.__assign({backgroundColor:"#ffeee9",padding:4,display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer"},e.style||{}),onClick:a},m.createElement("img",{src:"/timetable/pics/app/office/register_32.png",style:{height:32}}),m.createElement(p.HGap,null),m.createElement("div",{style:{fontSize:16,lineHeight:"90%"}},t,n&&m.createElement(m.Fragment,null,m.createElement("br",null),m.createElement("span",{style:{fontSize:10,color:"#888"}},n))),m.createElement(p.ROnMount,{onMount:function(){o&&f.maindbiActionStat("LicenseExpiredBanner."+o,"global_settings","show")}}))}e.showPurchaseEdupage=_,(e.LicenseExpiredBanner=h).needed_part=u.typed({global_settings:["license"]})},"/asc/server/purchase.js":function(e,require,t){t.implementRpc(["getPurchaseEdupageLink"])},"/substitution/vieweradmin.js":function(e,require,t){e.__esModule=!0;var a=require("tslib"),o=require("react"),l=require("./online/report"),u=require("../asc/asc_react"),c=require("./viewer"),d=require("../asc/edurequest"),i=require("./server/viewer"),m=require("../asc/asc_react2"),p=require("../customize/privacy"),b=require("../react/combobox");function r(e){var t=e.settingsRef,n=e.dbi,s=e.type,r=e.substViewerAdmin,i=d.client_req;return o.createElement("div",{style:{flex:1}},o.createElement(m.ModuleHeader,{title:i.localize(l.substReportTypeName[s]),icon:n.table(s).icon(),small:!0}),o.createElement(u.RLabel,{text:i.ls(1671)+":"}),o.createElement(b.default,{items:p.privacyCombo2(i,{students_me:"classes"==s}),valueRef:t.sub("privacy")}),o.createElement(u.VGap,{height:20}),o.createElement("div",{style:"disabled"==t.value.privacy?{visibility:"hidden"}:{}},o.createElement(l.SubstReportSettingsDiv,{settingsRef:t.sub("settings"),type:s,substViewerAdmin:r})))}function f(e){var t=e.settingsRef,n=e.dbi,s=d.client_req;return o.createElement(o.Fragment,null,o.createElement("div",{style:{display:"flex",flexDirection:"row",position:"relative"}},o.createElement(r,{settingsRef:t.sub("classes"),type:"classes",dbi:n,substViewerAdmin:!0}),o.createElement(m.VSeparatorLine,{height:"auto",style:{alignSelf:"stretch"}}),o.createElement(r,{settingsRef:t.sub("teachers"),type:"teachers",dbi:n,substViewerAdmin:!0})),o.createElement(m.SeparatorLine,null),o.createElement("div",null,o.createElement(u.RLabel,{text:s.ls(2206)+":",style:{width:"auto"}}),o.createElement(u.HGap,{width:10}),o.createElement(b.default,{items:function(e,t){void 0===t&&(t=31);for(var n=[{value:"-1",name:e.ls(1349)},{value:"-2",name:e.ls(3146)},[]],s=0;s<=t;s++)n.push({value:""+s,name:e.lsf(2261,{n:s})});return n}(s),valueRef:t.sub("past_limit_days").cast(function(e){return""+e},function(e){return parseInt(e)})})))}function _(){return a.__awaiter(this,void 0,void 0,function(){var t,n,s,r;return a.__generator(this,function(e){switch(e.label){case 0:return t=d.client_req,[4,ASC.loadTTLang()];case 1:return e.sent(),[4,i.getSubstViewerSettings(null)];case 2:return n=e.sent(),[4,t.maindbi(t.getSchoolYear(),{tables:["teachers","subjects","classes","classrooms","absent_types","substitution_types"],columns:["short","name"],info_columns:["__name"]})];case 3:return s=e.sent(),[4,u.RDialog.showInput({settings:n},function(e){var t=e.stateRef.sub("settings");return o.createElement(f,a.__assign({},{settingsRef:t,dbi:s}))},{header:t.ls(1003)+" - "+t.ls(1989)+" / "+t.ls(6950)+" - "+t.ls(1637),width:800})];case 4:return(r=e.sent())?[4,i.setSubstViewerSettings(null,r.settings)]:[2,!1];case 5:return e.sent(),[2,!0]}})})}e.SubstViewerAdmin=function(e){var t=o.useState(0),n=t[0],s=t[1];function r(){return a.__awaiter(this,void 0,void 0,function(){return a.__generator(this,function(e){switch(e.label){case 0:return[4,_()];case 1:return e.sent()&&s(function(e){return e+1}),[2]}})})}var i=u.useReq();return o.createElement(u.RScopedStyle,{rules:l.EditSettingsBtn.rules,style:{position:"relative"},className:"SubstViewerAdmin"},o.createElement("div",{className:"messageBox customize",style:{marginBottom:5}},o.createElement(u.HGap,{width:8}),o.createElement(u.RButton,{label:i.ls(2339),type:"green",onClick:function(){return r()}}),o.createElement(u.HGap,{width:8}),o.createElement(u.RButton,{label:i.ls(2340),type:"green",onClick:function(){return document.location.href="/substitution/online.php"}})),o.createElement(l.EditSettingsBtn,{onClick:function(){return r()}}),o.createElement(c.SubstViewer,a.__assign({},a.__assign(a.__assign({},e),{refresh:n}))))},e.showSubstViewerAdminSettingsDlg=_,e._hotswap=[r,f]},"/substitution/online/report.js":function(p,require,e){p.__esModule=!0;var I=require("tslib"),R=require("react"),g=require("react-dom"),C=require("../../dashboard/printSheet"),A=require("../subst"),k=require("../../rpr/dbi"),x=require("../../asc/asc_react"),T=require("../../dashboard/dbi_events"),o=require("../../rpr/dbi_react"),D=require("../../asc/lib_date"),v=require("../server/report"),N=require("../../asc/asc_react2"),B=require("../../timetable/ttitem"),l=require("../../react/combobox"),j=require("../filter");function s(e,t){return{names_teachers:e.sort_name_col,names_classes:"name",names_classrooms:"name",names_subjects:"name",names_igroups:"classes"==t?"hide":"name",names_absent_types:"hide",names_substitution_types:"hide",show_signatures:"",show_absents:"absent",show_time:!1,hideabsentteacher:"classes"==t&&"de/th"==e.school_country,hideabsentclass:!1,absent_summary_teachers:!1,absent_summary_classes:!1,absent_summary_classrooms:!1,pagebreak_date:!0,change_format:"",style:""}}p.substReportTypeName={teachers:"{1929}",classes:"{1930}"},p.substReportTypes=[{type:"teachers",name:p.substReportTypeName.teachers},{type:"classes",name:p.substReportTypeName.classes}],p.substReportDefaultSettings=s;var u=[{value:"",name:ASC.ls(1858)},{value:"compact",name:ASC.ls(4953)},{value:"compact_extra",name:ASC.ls(4953)+" (Extra)"},{value:"bars",name:ASC.ls(8996)},{value:"table",name:ASC.ls(1891)}];ASC.asc&&(u.push([]),u.push({value:"mobile",name:ASC.ls(6950)+" (aSc)"}));var c=[{value:"",name:"-"},{value:"subst_day",name:ASC.ls(1003)+" - "+ASC.ls(1465)},{value:"subst_lesson",name:ASC.ls(1003)+" - "+ASC.ls(1301)}],d=[{value:"",name:"-"},{value:"absent",name:ASC.ls(1846)},{value:"absent_lesson",name:ASC.ls(1846)+" + "+ASC.ls(1460)}],m=[{value:"",name:ASC.req.localize("{1858} - {2323}")},{value:"ss",name:ASC.req.localize("{2324}")}],P=100,M="---";function _(e){return{TABLE_ttitems:e?"substonline_ttitems":"subst_ttitems",TABLE_substs:e?"substonline_substitutions":"subst_substitutions",TABLE_absents:e?"substonline_absents":"subst_absents",TABLE_dates:e?"substonline_dates":"subst_dates",TABLE_subst_students:e?"substonline_students":"subst_students"}}function y(n){return I.__awaiter(this,void 0,void 0,function(){var t;return I.__generator(this,function(e){switch(e.label){case 0:return t=[I.__assign(I.__assign({filter:{}},n),_(n.unpublished))],[4,function(f){return I.__awaiter(this,void 0,void 0,function(){var t,n,s,r,i,a,o,l,u,c,d,m,p,b;return I.__generator(this,function(e){switch(e.label){case 0:return t=f.req,n=f.unpublished,s=f.dates,r=s[0],i=s[s.length-1],a=_(n),o=k.DBITools.mergeNeededParts({subst_dates:["date","tt_num","subst_dbid","subst_note"],subst_absents:["date","allday","period","durationperiods","table","teacherid","classid","classroomid","groupname","absent_typeid","note"],subst_substitutions:["date","absent","changes","substitution_typeid","note"],subst_students:["date","studentids","uniperiod","durationperiods","groupsubjectids","moveto","moveto_classids"],subst_ttitems:["date","__ttitem","type","orig","changes","cancelled","substids","origofids","origsubstid"],absent_types:["__name"],substitution_types:["__name"],subjects:["__name"],teachers:["__name","nameprefix","namesuffix"],classes:["__name"],igroups:["__name"],classrooms:["__name","buildingid"],periods:["__name"],dayparts:["__name"],events:["date","__ttitem_old","studentids","_uial"],event_types:[],students:["classid","changes"],groupsubjects:["classids"]},T.eventPrivacy,T.splitClassTeacherEvents,T.eventName,T.isAttachEvent,T.isEntireSchoolEvent,A.buildSubstOnlineTTItemsEx,j.substFilterRows),n&&(o=A.substOnlineNeededPartProvider(function(){return[o,{substonline_dates:["is_online"]}]})()),[4,t.maindbi(t.getSchoolYear(r),{needed_part:o,vt_filter:{datefrom:r,dateto:i}})];case 1:l=e.sent(),d=c=null,m=0,p=(u=l).tableData(a.TABLE_dates),e.label=2;case 2:return m<p.length?(b=p[m],c||!b.tt_num?[3,4]:[4,t.timetabledbi(b.tt_num,{needed_part:k.DBITools.mergeNeededParts(B.TTItemTimeProvider.tt_dbi_needed_part,{classes:["__name"],teachers:["__name"],subjects:["__name"],classrooms:["__name"],custombells:["day","period","break","classids","lessonids","starttime","endtime"]})})]):[3,7];case 3:c=e.sent(),e.label=4;case 4:return d||!b.subst_dbid?[3,6]:[4,t.substdbi(b.subst_dbid,{tables:["classes","teachers","classrooms","subjects","absent_types","substitution_types"],columns:["name","short"]})];case 5:d=e.sent(),e.label=6;case 6:return m++,[3,2];case 7:return d&&(u=c||d?new k.MergeDBI(l,c,d):l),[2,{dbi:u,main_dbi:l,tt_dbi:c,subst_dbi:d}]}})})}(n)];case 1:return[2,I.__assign.apply(void 0,[I.__assign.apply(void 0,t.concat([e.sent()])),{settings:n.settings||s(n.req,n.type)}])]}})})}function E(e){return R.createElement("div",{className:"editSettings print-skip",onClick:e.onClick},R.createElement("i",{className:"fa fa-fw fa-pencil"}))}function w(e){var n=e.settingsRef,s=e.type,t=e.multidate,r=e.substViewerAdmin,i=x.useReq();x.useTTLang();var a=o.useMainDBI(e.year||i.getSchoolYear(),{needed_part:{teachers:[],subjects:[],classes:[],classrooms:[],igroups:[],absent_types:[],substitution_types:[]}});return R.createElement("div",null,R.createElement(x.RLabel,{text:i.ls(1353)+(r?" ("+i.ls(1989)+")":"")}),R.createElement(l.default,{valueRef:n.sub("style"),items:u}),R.createElement(x.VGap,{height:10}),R.createElement(N.RGroupBox,{title:i.ls(6473)},["teachers","subjects","classes","igroups","classrooms","absent_types","substitution_types"].map(function(e){if("classes"==s&&["absent_types","substitution_types"].includes(e))return null;var t=!1;return["absent_types","substitution_types"].includes(e)&&(t=!0),"classes"==s&&("teachers"!=e&&"igroups"!=e||(t=!0)),R.createElement(x.Fragment,{key:e},R.createElement(x.RLabel,{text:a.table(e).name()+":"}),R.createElement(o.DBINameColInput,{valueRef:n.sub("names_"+e),table:e,allowHide:t}),R.createElement("br",null))}),R.createElement(x.VGap,{height:10}),R.createElement(x.RLabel,{text:i.ls(1622)+" - "+i.ls(1489)}),R.createElement(l.default,{valueRef:n.sub("show_absents"),items:d}),R.createElement(x.VGap,{height:10}),R.createElement(x.RLabel,{text:i.ls(2325)+":"}),R.createElement(l.default,{valueRef:n.sub("change_format"),items:m})),R.createElement(x.VGap,{height:10}),R.createElement(N.RGroupBox,{title:i.ls(1363)+" - "+i.ls(1898)},["teachers","classes","classrooms"].map(function(e){return R.createElement(x.Fragment,{key:e},R.createElement(x.RCheckBox,{label:i.localize(ue[e]),valueRef:n.sub("absent_summary_"+e)}),R.createElement("br",null))})),R.createElement(x.VGap,{height:10}),"teachers"==s&&R.createElement(R.Fragment,null,R.createElement(x.RCheckBox,{valueRef:n.sub("hideabsentclass"),label:i.ls(1933)}),R.createElement("br",null),R.createElement(x.RLabel,{text:i.ls(2694)+":"}),R.createElement(l.default,{valueRef:n.sub("show_signatures"),items:c}),R.createElement("br",null)),"classes"==s&&R.createElement(R.Fragment,null,R.createElement(x.RCheckBox,{valueRef:n.sub("hideabsentteacher"),label:i.ls(2074)}),R.createElement("br",null)),R.createElement(x.VGap,{height:10}),R.createElement(x.RLabel,{text:i.ls(1345)+":"}),R.createElement(x.RCheckBox,{label:i.ls(1489),valueRef:n.sub("show_time")}),t&&R.createElement(R.Fragment,null,R.createElement(x.VGap,{height:10}),R.createElement(x.RCheckBox,{valueRef:n.sub("pagebreak_date"),label:i.ls(3157)})))}p.substReportScope=y,p.showSubstReportDlg=function(o){return I.__awaiter(this,void 0,void 0,function(){var t,n,s,r,i,a;return I.__generator(this,function(e){switch(e.label){case 0:return n=(t=x.RDialog).show,r=(s=R).createElement,i=[b],a={},[4,y(o)];case 1:return n.apply(t,[r.apply(s,i.concat([(a.scope=e.sent(),a)]))]),[2]}})})},(p.EditSettingsBtn=E).rules=k.typed({"div.editSettings":{display:"none",padding:"0.25em",backgroundColor:"rgba(0,0,0,0.4)",color:"#fff",cursor:"pointer",margin:"1px",textDecoration:"none",position:"absolute",right:0,top:0},"&:hover div.editSettings":{display:"block"}}),p.SubstReportInReportovac=function(e){var t=this,n=R.useState(null),s=n[0],i=n[1],r=R.useState(0),a=r[0],o=r[1],l=e.dates,u=e.reportid,c=e.subst_unpublished,d=e.buildingid,m=e.classes_cz_zs_stupen,p=e.classes_sk_zs_stupen,b=x.useReq(),f=u.split("_")[1],_=x.useAsyncMemo(function(){return I.__awaiter(t,void 0,void 0,function(){var t,n;return I.__generator(this,function(e){switch(e.label){case 0:return t=y,n={req:b,type:f,where:"report",unpublished:c,filter:{buildingid:d,cz_zs_stupen:m,sk_zs_stupen:p},dates:l},[4,v.getSubstReportInReportovacSettings(b,f)];case 1:return[4,t.apply(void 0,[(n.settings=e.sent(),n)])];case 2:return[2,e.sent()]}})})},[f,c,l.join(),d,a],null,{inputs_reset:[a]});function h(){return I.__awaiter(this,void 0,void 0,function(){var t,n,s,r;return I.__generator(this,function(e){switch(e.label){case 0:return t=_.settings,n=_.dbi,s=_.dates,[4,x.RDialog.showInput({settings:t},function(e){var t=e.stateRef.sub("settings").cast(function(e){return e},function(e){return i(e),e});return R.createElement(w,{settingsRef:t,type:f,year:parseInt(n.dbid),multidate:1<s.length})},{header:b.ls(1637),width:400})];case 1:return(r=e.sent())?[4,v.setSubstReportInReportovacSettings(null,f,r.settings)]:[3,3];case 2:return e.sent(),i(null),o(function(e){return e+1}),[3,4];case 3:i(null),e.label=4;case 4:return[2]}})})}return _?R.createElement(x.RAutoUnmount,null,R.createElement(x.RScopedStyle,{className:"SubstReportInReportovac",rules:E.rules,style:{position:"relative"},ref:function(e){e&&(g.findDOMNode(e)._editSettings=function(){return h()})}},R.createElement(E,{onClick:function(){return h()}}),R.createElement(de,I.__assign({},I.__assign(I.__assign({},_),{settings:s||_.settings}))))):R.createElement(x.Loading,null)},p.showSubstReportInReportovacSettings=function(s){return I.__awaiter(this,void 0,void 0,function(){var t,n;return I.__generator(this,function(e){return t=$j(s).find(".SubstReportInReportovac").first(),(n=t.get(0))&&n._editSettings(),[2]})})},p.SubstReportSettingsDiv=w;var n,b=(n=R.Component,I.__extends(t,n),t.prototype.render=function(){var e=this,t=this.props.scope,r=t.type,i=t.req,n=this.state.settings;return R.createElement(C.PrintSheet,{renderer:function(){return null},asDialog:!0,filename:i.ls(1003),onCustomize:function(){return I.__awaiter(e,void 0,void 0,function(){var t,n,s=this;return I.__generator(this,function(e){switch(e.label){case 0:return t=this.state.settings,[4,x.RDialog.showInput({settings:t},function(e){var t=e.stateRef.sub("settings").cast(function(e){return e},function(e){return s.setState({settings:e}),e});return R.createElement(w,I.__assign({},{settingsRef:t,type:r}))},{header:i.ls(1637),width:400})];case 1:return n=e.sent(),this.setState({settings:n?n.settings:t}),[2]}})})}},R.createElement(de,I.__assign({},I.__assign(I.__assign({},t),{settings:n}))))},t.prototype.componentDidMount=function(){barTrackEvent({eventCategory:"SubstPrintSheet",eventAction:"SubstPrintSheet.open",eventLabel:""})},t);function t(e){var t=n.call(this,e)||this;return t.state={settings:e.scope.settings},t}var O="/global/pics/ui/absent_32.svg",z="/global/pics/ui/events_32.svg";function F(e){return R.isValidElement(e)?e.type==N.RJoin&&0==R.Children.count(e.props.children):""==e||null==e||null==e||"boolean"==typeof e}function L(e){var t=e.scope,n=e.uniperiod,s=e.data,r=e.what,i=e.info,a=e.info_detail,o=e.className,l=e.show_signature,u=t.settings,c=t.dbi,d=t.timeProvider,m=t.req,p=u.show_time,b="",f="";switch(o){case"event":b=z;break;case"event_absent":b=z,f=O;break;case"absent":b=O}var _="remove"==o,h=k.DBITools.typeOfUniPeriod(n),g=c.tools.uniperiodName(n,void 0,s);"starttime"==h&&p&&(g=""),_&&(g="("+g+")");var v="";if(p&&n&&!["daypart","allday"].includes(h)){var y=s||{},E=d.provide({uniperiod:n,classids:y.classids||[],endtime:y.endtime||"",durationperiods:y.durationperiods||null});if(E){var w=function(e){return D.date_format_time0(m,e,{ajSekundy:!1,short:!0})};v=w(E.starttime)+"-"+w(E.endtime)}}var S=g,x=null;b&&(x=R.createElement("img",{src:b,style:{height:16,display:"inline-block",verticalAlign:"text-bottom",marginRight:5}}),f&&(x=R.createElement("span",{style:{position:"relative"}},x,R.createElement("img",{src:f,style:{height:10,display:"block",position:"absolute",left:8,bottom:-1}}))));var T=R.createElement(R.Fragment,null,v&&R.createElement(R.Fragment,null,v,", "),x,r,!F(r)&&!F(i)&&" - ",i);return"table"==u.style?R.createElement(R.Fragment,null,R.createElement("td",{className:"period"},R.createElement(C.PrintFontResizable,null,S)),p&&R.createElement("td",{className:"time"},R.createElement(C.PrintFontResizable,null,v)),R.createElement("td",{className:"what"},R.createElement(C.PrintFontResizable,null,x,r)),R.createElement("td",{className:"info"},R.createElement(C.PrintFontResizable,null,i)),"subst_lesson"==u.show_signatures&&R.createElement("td",{className:"signature"},l||M)):R.createElement("div",{className:"row "+o},R.createElement("div",{className:"period"},R.createElement(C.PrintFontResizable,null,S)),R.createElement("div",{className:"info"},R.createElement(C.PrintFontResizable,null,T,l&&R.createElement(Z,null),a&&R.createElement("div",{className:"detail"},a))))}function G(e){var t=e.scope,n=e.old,s=e.new,r=e.prefix;return n==s?R.createElement(R.Fragment,null,r,s):n?"ss"==t.settings.change_format?R.createElement(R.Fragment,null,r,R.createElement("s",null,n),s&&R.createElement(R.Fragment,null," âž” ",s)):R.createElement(R.Fragment,null,r,"(",n,")",s&&R.createElement(R.Fragment,null," âž” ",s)):s?R.createElement(R.Fragment,null,r,"+",s):null}function U(e){var t=e.scope,n=e.infos,s=e.ttitem,r=e.orig,i=e.col,a=e.ignoreid,o=e.force_show,l=t.dbi,u=t.settings,c=t.req,d=u.hideabsentteacher,m=A.changeColumn2table(i);if(!m)throw ASC.dieError("9561628993");var p=u["names_"+m];if("teachers"!=m||"hide"!=p){var b=new Set,f=!!o;if(!k.idsArrayMatchI(s[i],r[i]))if(s.added&&0==r[i].length)f=!0;else for(var _=0,h=s.changes;_<h.length;_++){var g=h[_];if(A.changeColumn2table(g.column)==m&&(!a||g.old!=a&&g.new!=a))if(g.new){if(g.old)if("teachers"==m&&d)n.push(c.ls(1003)+": "+l.rowName(m,g.new,p));else{var v="?";"teachers"==m&&(v=c.ls(1003),"mobile"==u.style&&(v="")),"classrooms"==m&&(v=c.ls(1895)),n.push(R.createElement(G,{scope:t,prefix:v&&v+": ",old:l.rowName(m,g.old,p),new:l.rowName(m,g.new,p),key:""+n.length}))}else n.push(R.createElement(G,{scope:t,new:l.rowName(m,g.new,p),key:""+n.length}));b.add(g.new)}else if(g.old)if("teachers"==m&&d)if(0==s.teacherids.length){var y=c.ttls(3118);n.includes(y)||n.push(y)}else n.push(R.createElement(G,{scope:t,old:c.ls(3356),key:""+n.length}));else n.push(R.createElement(G,{scope:t,old:l.rowName(m,g.old,p),key:""+n.length}))}if(f){var E=s[i];E=E.filter(function(e){return!b.has(e)}),a&&(E=E.filter(function(e){return e!=a})),E.length&&n.push(l.tools.itemName(m,E.length)+": "+l.rowNames(m,E,p))}}else k.idsArrayMatchI(s[i],r[i])||n.push(c.ls(1003))}function q(e){var t=e.infos,n=e.scope,s=e.ttitem,r=e.orig,i=n.dbi,a=n.settings,o=n.req,l=k.idsArrayDiff(r.classids,s.classids);0<l.length&&t.push("("+o.ttls(2825)+" "+i.rowNames("classes",l,a.names_classes)+")")}function H(e){var t=e.infos,n=e.scope,s=e.ttitem,r=e.orig,i=n.dbi,a=n.req;k.idsArrayMatchI(s.groupnames,r.groupnames)||t.push(R.createElement(G,{scope:n,prefix:a.ls(6964)+": ",old:i.tools.groupnames_names(r.groupnames),new:i.tools.groupnames_names(s.groupnames),key:""+t.length}))}function V(e){for(var t=e.infos,n=e.scope,s=e.ttitem,r=n.dbi,i=n.TABLE_substs,a=n.req,o="",l=0,u=[7442,7443];l<u.length;l++)for(var c=u[l],d=a.lsf(c,{date:""}).trim(),m=0,p=t;m<p.length;m++){var b=p[m];if("string"==typeof b&&b.includes(d)){o=d;break}}for(var f=0,_=s.substids;f<_.length;f++){var h=_[f],g=r.rowData(i,h);if(g){var v=g.note;o&&v.includes(o)&&v.length<=o.length+8&&(v=""),v&&(t.includes(v)||t.push(v))}}}function W(e){var t=e.infos,n=e.ttitem,s=e.scope,r=s.dbi,i=s.date,a=s.req,o="";if(n.cancelled&&0<n.origofids.length){var l=n.origofids[0].split(":")[0];if(l!=i)o=a.lsf(7442,{date:D.date_format_day(a,l,!1,!0)});else for(var u=0,c=n.changes;u<c.length;u++){var d=c[u];"period"==d.column&&d.new&&(o=a.lsf(9701,{period:r.tools.uniperiodName(d.new,"name",n)}))}}return!!o&&(t.push(o),!0)}function S(e){var t=e.scope,n=e.ttitem,s=t.dbi,r=t.teacherid,i=t.classid,a=t.absents,o=t.TABLE_substs,l=r?"teachers":"classes",u=r||i;if(!u)return!1;if(A.substTTItem_tableIds(n,l).includes(u))return!1;for(var c=0,d=n.substids;c<d.length;c++){var m=d[c],p=s.rowData(o,m);if(p)if((_=p.absent)&&A.absentGetTable(_)==l&&A.absentGetId(_)==u)return!0}if(n.cancelled&&"teachers"==l)for(var b=0,f=a;b<f.length;b++){var _=f[b];if(A.absentGetTable(_)==l&&A.absentGetId(_)==u){if(_.allday)return!0;if(_.period&&"period"==k.DBITools.typeOfUniPeriod(n.uniperiod)){var h=parseInt(_.period),g=h+(_.durationperiods||1)-1,v=parseInt(n.uniperiod);if(h<=v&&v<=g)return!0}}}return!1}function K(e){var t=e.scope,n=e.ttitem,s=t.dbi,r=t.TABLE_substs;if(!n.orig)return!1;if(n.classids.length==n.orig.classids.length)return!1;if(t.classid&&!n.classids.includes(t.classid))return!0;for(var i=0,a=n.substids;i<a.length;i++){var o=a[i],l=s.rowData(r,o);if(!l.absent)return!1;if("classes"!=A.absentGetTable(l.absent))return!1}return!0}function Y(e){var t=e.infos,n=e.ttitem,s=e.scope,r=s.dbi,i=s.date,a=s.req,o="";if(n.origsubstid){var l=n.origsubstid.split(":")[0];if(l!=i)o=a.lsf(7443,{date:D.date_format_day(a,l,!1,!0)});else for(var u=0,c=n.changes;u<c.length;u++){var d=c[u];"period"==d.column&&d.old&&(o=a.lsf(9702,{period:r.tools.uniperiodName(d.old,"name",n)}))}}return!!o&&(t.push(o),!0)}function f(e){var t=e.scope,n=e.ttitem,s=t.dbi,r=t.settings,i=t.classid,a=t.req,o=n.orig||n,l="",u="";if(k.idsArrayMatchI(n.groupnames,o.groupnames)||n.cancelled){var c="",d=n.groupnames.length?n.groupnames:o.groupnames;k.DBITools.groupnamesIsEntireClass(d)||(c=s.tools.groupnames_names(d)),c&&("mobile"==r.style?l=c:u=c+": ")}var m=R.createElement(G,{scope:t,prefix:u,old:s.rowName("subjects",o.subjectid||n.subjectid,r.names_subjects),new:s.rowName("subjects",n.subjectid||o.subjectid,r.names_subjects)}),p=[],b="";return!n.classids.includes(i)||n.cancelled?(n.cancelled&&0<o.teacherids.length&&"hide"!=r.names_teachers&&p.push(s.rowNames("teachers",o.teacherids,r.names_teachers)),W({infos:p,scope:t,ttitem:n})||p.push(a.ls(2322)),b="remove"):(n.added?(Y({infos:p,scope:t,ttitem:n})||p.push(a.ls(6270)),b="add"):0<n.changes.length&&(b="change"),U({scope:t,infos:p,ttitem:n,orig:o,col:"teacherids",force_show:0<n.teacherids.length||0<o.teacherids.length}),U({scope:t,infos:p,ttitem:n,orig:o,col:"classroomids"}),q({infos:p,scope:t,ttitem:n,orig:o}),H({infos:p,scope:t,ttitem:n,orig:o})),V({infos:p,scope:t,ttitem:n}),0==p.length&&p.push(a.ls(2252)),R.createElement(L,I.__assign({},{scope:t,uniperiod:n.uniperiod,data:n,className:b,what:m,info:R.createElement(N.RJoin,{children:p,glue:", "}),info_detail:l}))}function h(e){var t=e.scope,n=e.ttitem,s=t.dbi,r=t.settings,i=t.req,a=n.orig||n,o="";if(k.idsArrayMatchI(n.groupnames,a.groupnames)||n.cancelled){var l=n.groupnames.length?n.groupnames:a.groupnames;k.DBITools.groupnamesIsEntireClass(l)||(o=s.tools.groupnames_names(l)+": ")}var u=R.createElement(G,{scope:t,prefix:o,old:s.rowName("subjects",a.subjectid||n.subjectid,r.names_subjects),new:s.rowName("subjects",n.subjectid||a.subjectid,r.names_subjects)}),c=[],d="";return!n.igroupid||n.cancelled?(W({infos:c,scope:t,ttitem:n})||c.push(i.ls(2322)),d="remove"):(n.added?(Y({infos:c,scope:t,ttitem:n})||c.push(i.ls(6270)),d="add"):0<n.changes.length&&(d="change"),U({scope:t,infos:c,ttitem:n,orig:a,col:"teacherids"}),U({scope:t,infos:c,ttitem:n,orig:a,col:"classroomids"})),V({infos:c,scope:t,ttitem:n}),0==c.length&&c.push(i.ls(2252)),R.createElement(L,I.__assign({},{scope:t,uniperiod:n.uniperiod,data:n,className:d,what:u,info:R.createElement(N.RJoin,{children:c,glue:", "})}))}function J(e){var t=e.scope,n=e.ttitem,s=t.dbi,r=t.settings,i=t.teacherid,a=t.TABLE_substs,o=t.req,l=n.orig||n,u="";if("classroomsupervision"==n.type)u=o.ls(1723)+": "+s.rowNames("classrooms",l.classroomids,r.names_classrooms);else{var c=void 0,d=n.cancelled?l:n;c=d.igroupid?s.rowName("igroups",d.igroupid,r.names_igroups):s.tools.ttitem_popis(d,r.names_classes).class,u=R.createElement(G,{scope:t,prefix:c+": ",old:s.rowName("subjects",l.subjectid||n.subjectid,r.names_subjects),new:s.rowName("subjects",n.subjectid||l.subjectid,r.names_subjects)})}var m=[],p="",b=!1;if(n.cancelled)W({infos:m,scope:t,ttitem:n})||m.push(o.ls(2322)),p="remove";else if(n.teacherids.includes(i)){if(b=!0,n.added)Y({infos:m,scope:t,ttitem:n})||m.push(o.ls(6270)),p="add";else{0<n.changes.length&&(p="change");for(var f=0,_=n.changes;f<_.length;f++){D=_[f];if("teachers"==A.changeColumn2table(D.column)&&D.new==i){var h=o.ls(1003);D.old&&(h=o.ls(8987)+": "+s.rowName("teachers",D.old,r.names_teachers)),m.push(h)}}}for(var g=0,v=n.substids;g<v.length;g++){var y=v[g],E=s.rowData(a,y);if(E){for(var w=!1,S=0,x=E.changes;S<x.length;S++){D=x[S];if("teachers"==A.changeColumn2table(D.column)&&D.new==i){w=!0;break}}w&&E.substitution_typeid&&"hide"!=r.names_substitution_types&&m.push(o.ls(1619)+": "+s.rowName("substitution_types",E.substitution_typeid,r.names_substitution_types))}}U({scope:t,infos:m,ttitem:n,orig:l,col:"teacherids",ignoreid:i}),U({scope:t,infos:m,ttitem:n,orig:l,col:"classroomids",force_show:!l.teacherids.includes(i)}),q({infos:m,scope:t,ttitem:n,orig:l}),H({infos:m,scope:t,ttitem:n,orig:l})}else{for(var T=!1,C=0,k=n.changes;C<k.length;C++){var D=k[C];"teachers"==A.changeColumn2table(D.column)&&D.old==i&&(T=!0,D.new?m.push(o.ttls(1481)+": "+s.rowName("teachers",D.new,r.names_teachers)):m.push(o.ttls(1481)+": "+o.ttls(3118)))}T||m.push("Error9952969758"),p="remove"}return V({infos:m,scope:t,ttitem:n}),0==m.length&&m.push(o.ls(2252)),R.createElement(L,I.__assign({},{scope:t,uniperiod:n.uniperiod,data:n,className:p,show_signature:b&&"subst_lesson"==r.show_signatures,what:u,info:R.createElement(N.RJoin,{children:m,glue:", "})}))}function Z(e){return R.createElement("div",{className:"signature"},"Â ")}function $(e){var t=e.scope,n=e.event,s=e.absent,r=t.dbi,i=t.settings,a=t.req,o=[],l=[],u="";if(o.push(T.eventName(r,n,{brief:!0})),0==n.groupnames.length)0<n.studentids.length&&o.push(a.ls(6253));else if(!k.DBITools.groupnamesIsEntireClass(n.groupnames)){var c=r.tools.groupnames_names(n.groupnames);"mobile"==i.style?u=c:o.push(c)}return n.subjectid&&l.push(r.rowName("subjects",n.subjectid)),0<n.classids.length&&!k.idsArrayMatchI(n.classids,[t.classid])&&l.push(r.rowNames("classes",n.classids,i.names_classes)),0<n.teacherids.length&&!k.idsArrayMatchI(n.teacherids,[t.teacherid])&&"hide"!=i.names_teachers&&l.push(r.rowNames("teachers",n.teacherids,i.names_teachers)),0<n.classroomids.length&&l.push(r.tools.itemName("classrooms",n.classroomids.length)+": "+r.rowNames("classrooms",n.classroomids,i.names_classrooms)),s&&s.absent_typeid&&"hide"!=i.names_absent_types&&l.push(a.ttls(1464)+": "+r.rowName("absent_types",s.absent_typeid,i.names_absent_types)),R.createElement(L,I.__assign({},{scope:t,uniperiod:k.DBITools.getUniPeriod(n),data:n,className:s?"event_absent":"event",what:o.join(", "),info:R.createElement(N.RJoin,{children:l,glue:", "}),info_detail:u}))}function X(e){var t=e.scope,n=e.absent,s=t.dbi,r=t.settings,i=t.req,a=[],o=[],l="",u=i.ls(1846);return"classes"==t.type&&n.groupname&&("mobile"==r.style?l=n.groupname:u=n.groupname+": "+u),a.push(u),n.absent_typeid&&"hide"!=r.names_absent_types&&o.push(i.ttls(1464)+": "+s.rowName("absent_types",n.absent_typeid,r.names_absent_types)),R.createElement(L,I.__assign({},{scope:t,uniperiod:k.DBITools.getUniPeriod(n),data:n,className:"absent",what:a.join(", "),info:R.createElement(N.RJoin,{children:o,glue:", "}),info_detail:l}))}function Q(e){var n=e.scope,s=e.header,r=e.items,i=e.signature,t=e.hideHeader,a=n.settings,o=R.createElement(ne,I.__assign({},{scope:n,items:r}));switch(a.style){case"compact_extra":return R.createElement("div",{className:"section print-nobreak"},R.createElement("div",{className:"header"},R.createElement(C.PrintFontResizable,null,s)),R.createElement("div",{className:"rows"},i,o));case"bars":return R.createElement("div",{className:"section print-nobreak"},R.createElement("div",{className:"header"},R.createElement(C.PrintFontResizable,null,i,s)),R.createElement("div",{className:"rows"},o));case"table":return R.createElement("tbody",{className:"print-nobreak"},r.map(function(e,t){return R.createElement("tr",{key:""+t},0==t&&R.createElement("td",{rowSpan:r.length,className:"header"},s),R.createElement(te,I.__assign({},{scope:n,item:e},{key:""+t})),0==t&&"subst_day"==a.show_signatures&&R.createElement("td",{rowSpan:r.length,className:"signature"},!i&&M))}))}return R.createElement("div",{className:"section print-nobreak"},i,t||R.createElement("div",{className:"header"},R.createElement(C.PrintFontResizable,null,s)),R.createElement("div",{className:"rows"},o))}function r(e){switch(k.DBITools.typeOfUniPeriod(e)){case"period":return parseInt(e);case"allday":return-10;case"daypart":return-9+parseInt(e[1])}return 0}function i(e){return e.event?-2:e.absent?-1:e.cancelled?1:0}function ee(e){e.sort(function(e,t){var n=r(e.uniperiod),s=r(t.uniperiod);return n!=s?n-s:i(e)-i(t)})}function te(e){var t=e.scope,n=e.item,s=n.ttitem,r=n.event,i=n.absent,a=n.text,o=n.uniperiod;return s?"teachers"==t.type?R.createElement(J,I.__assign({},{scope:t,ttitem:s,key:s.id})):s.igroupid||s.orig&&s.igroupid?R.createElement(h,I.__assign({},{scope:t,ttitem:s,key:s.id})):R.createElement(f,I.__assign({},{scope:t,ttitem:s,key:s.id})):r?R.createElement($,I.__assign({},{scope:t,event:r,absent:i,key:r.id})):i?R.createElement(X,I.__assign({},{scope:t,absent:i,key:i.id})):a?R.createElement(L,I.__assign({},{scope:t,uniperiod:o,data:n.text_data||null,className:n.nosubst?"nosubst":"",what:n.text_what,info:a})):null}function ne(e){var n=e.scope,t=e.items;return R.createElement(R.Fragment,null,t.map(function(e,t){return R.createElement(te,I.__assign({},{scope:n,item:e},{key:""+t}))}))}function se(e){var t=e.classid,u=I.__assign(I.__assign({},e.scope),{classid:t}),n=u.req,c=u.dbi,s=u.settings,r=u.my_classids,d=u.TABLE_substs,i=[];u.ttitems.filter(function(e){return!!e.classids.includes(t)||!(!e.orig||!e.orig.classids.includes(t))}).filter(function(e){for(var t=0,n=e.substids;t<n.length;t++){var s=n[t],r=c.rowData(d,s);if(r){if(r.note)return!0;if(r.cancelled||0<r.changes.length)return!0}}for(var i=function(t){if(u.events.find(function(e){return e.id==t}))return{value:!0}},a=0,o=e.changeeventids;a<o.length;a++){var l=i(o[a]);if("object"==typeof l)return l.value}return!1}).forEach(function(e){"absent_lesson"!=s.show_absents&&S({scope:u,ttitem:e})||s.hideabsentclass&&K({scope:u,ttitem:e})||i.push({uniperiod:e.uniperiod,cancelled:e.cancelled,ttitem:e})});var a=u.events.filter(function(e){return!!T.event_tableIds(e,"classes",{expand_ctevent:!0,dbi:c}).includes(t)});a=j.substFilterRows(c,u.filter,"events",a);var o=new Set;u.absents.filter(function(e){return"classes"==A.absentGetTable(e)&&A.absentGetId(e)==t}).forEach(function(e){var t=le(e,a);i.push({uniperiod:k.DBITools.getUniPeriod(e),absent:e,event:t}),t&&o.add(t)}),a.filter(function(e){return!o.has(e)}).forEach(function(e){return i.push({uniperiod:k.DBITools.getUniPeriod(e),event:e})});for(var l=0,m=u.subst_students;l<m.length;l++){for(var p=m[l],b=[],f=0,_=p.studentids;f<_.length;f++){var h=_[f],g=c.rowData("students",h);g&&(g=k.DBITools.rowApplyChanges(g,u.date)).classid==t&&b.push(h)}if(0<b.length){var v=n.lsf(10885,{n:b.length});0<p.moveto_classids.length&&(v+=" âž” "+c.rowNames("classes",p.moveto_classids)),i.push({uniperiod:p.uniperiod,subst_students:p,text:v,text_what:n.ls(12014),text_data:p})}}if(!r){if(0==i.length)return null;if(!s.show_absents&&!i.find(function(e){return!e.absent}))return null}return 0==i.length&&i.push({uniperiod:"",text:n.ls(1348),nosubst:!0}),ee(i),R.createElement(Q,{scope:u,header:c.rowName("classes",t,s.names_classes),items:i})}function re(e){var t=e.igroupid,n=I.__assign(I.__assign({},e.scope),{igroupid:t}),s=n.req,i=n.dbi,r=n.settings,a=n.my_igroupids,o=n.TABLE_substs,l=[];n.ttitems.filter(function(e){return e.igroupid==t||!(!e.orig||e.orig.igroupid!=t)}).filter(function(e){if(0<e.changes.length)return!0;for(var t=0,n=e.substids;t<n.length;t++){var s=n[t],r=i.rowData(o,s);if(r&&r.note)return!0}return!1}).forEach(function(e){"absent_lesson"!=r.show_absents&&S({scope:n,ttitem:e})||l.push({uniperiod:e.uniperiod,cancelled:e.cancelled,ttitem:e})});var u=n.events.filter(function(e){return!!T.event_tableIds(e,"igroups").includes(t)});u=j.substFilterRows(i,n.filter,"events",u);var c=new Set;if(n.absents.filter(function(e){return"igroups"==A.absentGetTable(e)&&A.absentGetId(e)==t}).forEach(function(e){var t=le(e,u);l.push({uniperiod:k.DBITools.getUniPeriod(e),absent:e,event:t}),t&&c.add(t)}),u.filter(function(e){return!c.has(e)}).forEach(function(e){return l.push({uniperiod:k.DBITools.getUniPeriod(e),event:e})}),a){var d=!1;if(n.ttitems.forEach(function(e){e.igroupid==t&&(d=!0),e.orig&&e.orig.igroupid==t&&(d=!0)}),!d)return null}else{if(0==l.length)return null;if(!r.show_absents&&!l.find(function(e){return!e.absent}))return null}return 0==l.length&&l.push({uniperiod:"",text:s.ls(1348),nosubst:!0}),ee(l),R.createElement(Q,{scope:n,header:i.rowName("igroups",t,r.names_igroups),items:l})}function ie(e){var r=e.teacherid,i=I.__assign(I.__assign({},e.scope),{teacherid:r}),t=i.req,a=i.dbi,o=i.settings,n=i.my_teacherids,l=i.TABLE_substs,u=[],c=!1;i.ttitems.filter(function(e){return!!e.teacherids.includes(r)||!(!e.orig||!e.orig.teacherids.includes(r))}).filter(function(e){if(0<e.changes.length)return!0;for(var t=0,n=e.substids;t<n.length;t++){var s=n[t],r=a.rowData(l,s);if(r&&r.note)return!0}return!1}).forEach(function(e){if(("absent_lesson"==o.show_absents||!S({scope:i,ttitem:e}))&&(!o.hideabsentclass||!K({scope:i,ttitem:e}))&&(u.push({uniperiod:e.uniperiod,cancelled:e.cancelled,ttitem:e}),e.teacherids.includes(r))){e.added&&(c=!0);for(var t=0,n=e.changes;t<n.length;t++){var s=n[t];"teachers"==A.changeColumn2table(s.column)&&s.new==r&&(c=!0)}}});var s=i.events.filter(function(e){return!!T.event_tableIds(e,"teachers",{expand_ctevent:!0,dbi:a}).includes(r)});s=j.substFilterRows(a,i.filter,"events",s);var d=new Set;if(i.absents.filter(function(e){return"teachers"==A.absentGetTable(e)&&A.absentGetId(e)==r}).forEach(function(e){var t=le(e,s);u.push({uniperiod:k.DBITools.getUniPeriod(e),absent:e,event:t}),t&&d.add(t)}),s.filter(function(e){return!d.has(e)}).forEach(function(e){return u.push({uniperiod:k.DBITools.getUniPeriod(e),event:e})}),!n){if(0==u.length)return null;if(!o.show_absents&&!u.find(function(e){return!e.absent}))return null}return 0==u.length&&u.push({uniperiod:"",text:t.ls(1348),nosubst:!0}),ee(u),R.createElement(Q,{scope:i,hideHeader:1==(i.my_teacherids||[]).length,header:a.rowName("teachers",r,o.names_teachers).trim(),signature:c&&"subst_day"==o.show_signatures&&R.createElement(Z,null),items:u})}function ae(e){return R.createElement(R.Fragment,null,R.createElement("div",{style:{fontSize:25,textAlign:"center"}},e.title),R.createElement("div",{style:{fontSize:16,textAlign:"center"}},e.subtitle),R.createElement(x.VGap,{height:5}))}function oe(e){var t=e.scope,n=e.hideTitle,s=e.repeatHeader,r=t.date,i=t.dbi,a=t.type,o=t.settings,l=t.TABLE_dates,u=t.req,c=t.unpublished,d=i.rowData(l,r),m=R.createElement(R.Fragment,null,n||R.createElement(ae,{title:u.ls(1003)+" - "+p.substReportTypes.filter(function(e){return e.type==a}).map(function(e){return u.localize(e.name)}),subtitle:D.date_format_day(u,r,!0,!0)}),d.subst_note&&R.createElement("div",{className:"subst_note",style:{textAlign:"center",whiteSpace:"pre-wrap",marginBottom:3}},R.createElement(C.PrintFontResizable,null,d.subst_note)),!t.me&&R.createElement(R.Fragment,null,R.createElement(ce,I.__assign({},{scope:t,table:"teachers"})),R.createElement(ce,I.__assign({},{scope:t,table:"classes"})),R.createElement(ce,I.__assign({},{scope:t,table:"classrooms"}))),c&&d.is_online&&R.createElement("div",{style:{textAlign:"center",marginTop:5,fontWeight:"bold"}},u.ls(1645)),o.show_signatures&&R.createElement("div",{style:{float:"right",color:"#c0c0c0",textAlign:"center",width:P,marginRight:10}},u.ls(2694)),"mobile"!=o.style&&R.createElement(x.VGap,{height:15}));return s?R.createElement("div",{className:"print-header"},m):m}function le(e,t){for(var n=A.absentGetTable(e),s=A.absentGetId(e),r=k.DBITools.getUniPeriod(e),i=0,a=t;i<a.length;i++){var o=a[i];if(T.event_tableIds(o,n).includes(s)&&(k.DBITools.getUniPeriod(o)==r&&(o.durationperiods||1)==(e.durationperiods||1)&&("classes"!=n||o.groupnames.includes(e.groupname||""))))return o}return null}p.SubstReportTitle=ae;var ue={teachers:"{tt:3817}",classes:"{tt:3779}",classrooms:"{tt:3780}"};function ce(e){var t=e.scope,n=e.table,s=t.req,r=t.dbi,i=t.absents,a=t.events,o=t.settings;if(!o["absent_summary_"+n])return null;for(var l=i.filter(function(e){return A.absentGetTable(e)==n}),u=[],c=0,d=r.tableIds(n);c<d.length;c++)for(var m=d[c],p=0,b=l;p<b.length;p++){var f=b[p];if(A.absentGetId(f)==m){var _=le(f,a),h=k.DBITools.getUniPeriod(f),g="classes"==n&&f.groupname||"",v=_?T.eventName(r,_,{brief:!0}):"",y=!1;if(v)for(var E=0,w=u;E<w.length;E++){var S=w[E];if(S.uniperiod==h&&(S.durationperiods==f.durationperiods&&S.groupname==g&&S.eventname==v)){S.ids.push(m),S.absents.push(f),y=!0;break}}y||u.push({uniperiod:h,durationperiods:f.durationperiods,ids:[m],absents:[f],groupname:g,eventname:v})}}if(0==u.length)return null;var x=o["names_"+n];return R.createElement("div",{style:{textAlign:"center"}},R.createElement(C.PrintFontResizable,null,s.localize(ue[n]),": ","hide"==x?u.length:R.createElement(N.RJoin,{glue:", "},u.map(function(e,t){return R.createElement(N.RJoin,{glue:" ",key:""+t},[R.createElement(N.RJoin,{glue:"short"==x?"+":" + ",key:"names"},e.ids.map(function(e){return r.rowName(n,e,x)})),e.groupname||null,R.createElement(N.RJoin,{glue:" ",before:" (",after:")",key:"details"},["ad"!=e.uniperiod&&r.tools.uniperiodName(e.uniperiod,void 0,e),e.eventname||null])])}))))}function de(e){var c=e.req,d=e.dbi,t=e.dates,m=e.type,p=e.me,b=e.my_classids,f=e.my_igroupids,_=e.my_teacherids,h=e.settings,g=e.filter,v=e.where,y=e.hideTitle,E=e.repeatHeader,n="mobile"==h.style&&!c.isApp();R.useEffect(function(){n&&barCssLoad("/app/pics/css/substitution.css")},[n]);var s={},r={float:"right",borderBottom:"1px dashed #c0c0c0",width:P,marginRight:4,marginLeft:10},i={fontSize:16,textAlign:"center",flexGrow:0,marginRight:10},a={".signature":I.__assign({},r),".row":I.__assign({},{display:"flex",flexDirection:"row",alignItems:"baseline",fontSize:12,marginBottom:1}),".period":I.__assign({},i),".period>span":I.__assign({},{whiteSpace:"pre",display:"inline-block",minWidth:30}),".info":I.__assign({},{flex:1})};switch(h.style){case"compact":s=I.__assign(I.__assign({},a),{".section":{paddingLeft:4,paddingRight:4,paddingBottom:1,borderBottom:"1px solid #c0c0c0",marginBottom:1},".header":{fontSize:14,fontWeight:"bold",marginBottom:1},".rows":{paddingLeft:5},".period":I.__assign(I.__assign({},i),{fontSize:"inherit"})});break;case"compact_extra":s=I.__assign(I.__assign({},a),{".section":{paddingLeft:4,paddingRight:4,paddingBottom:1,borderBottom:"1px solid #c0c0c0",marginBottom:1,display:"flex",flexDirection:"row"},".header":{fontSize:14,fontWeight:"bold",display:"block",flex:0,minWidth:"teachers"==m&&"short"!=h.names_teachers?150:50},".rows":{paddingLeft:5,flex:1},".period":I.__assign(I.__assign({},i),{fontSize:"inherit"})});break;case"bars":s=I.__assign(I.__assign({},a),{".section":{marginBottom:20},".header":{fontSize:20,fontWeight:"bold",padding:4,backgroundColor:"#e0e0e0",marginBottom:5},".header .signature":{borderColor:"#a0a0a0"},".rows":{paddingLeft:20}});break;case"mobile":s=I.__assign({},a);break;case"table":s=I.__assign(I.__assign({},a),{table:{width:"100%",tableLayout:"auto"},tbody:{border:"2px solid #808080"},td:{border:"1px solid #808080",padding:2},".header":{fontSize:16,textAlign:"center"},".period":{fontSize:12,textAlign:"center",whiteSpace:"nowrap"},".time":{fontSize:12,textAlign:"center",whiteSpace:"pre"},".period>span":{},".signature":{width:P,textAlign:"center",color:"#a0a0a0"}});break;default:s=I.__assign(I.__assign({},a),{".section":{marginBottom:15,border:"1px solid #c0c0c0",borderRadius:6,padding:4},".header":{fontSize:20,marginBottom:5,fontWeight:"bold",border:"2px solid #c0c0c0",borderRadius:6,padding:4,display:"inline-block"},".rows":{paddingLeft:5},".signature":I.__assign({fontSize:20},r),".rows .signature":{fontSize:"inherit"}})}var w=e,o=null;if("viewer"==v){var l=d.rowData(e.TABLE_dates,t[0]);if(l&&l.published_int){var u=c.timezone_datetime(l.published_int),S="www.asctimetables.com";["de","at","ch"].includes(c.school_country)&&(S="www.asc-raabe.de"),o=R.createElement("div",{style:{textAlign:"center",fontSize:12}},"mobile"!=w.settings.style&&R.createElement(R.Fragment,null,R.createElement("a",{href:"https://"+S,target:"_blank"},S)," - "),D.date_format_time(c,u,{ajDenSlovom:!1}))}}return R.createElement(x.RScopedStyle,{rules:s,className:n&&"app-subst"},t.map(function(e,t){var n;n=A.buildSubstOnlineTTItemsEx(d,e,!0,{table:w.TABLE_ttitems}).map(function(e){return I.__assign(I.__assign({},e),{eventids:[]})}),n=j.substFilterRows(d,g,"subst_ttitems",n);var s=T.splitClassTeacherEvents(d,d.tableFilterData(T.TABLE_events,{date:e})),r=(s=(s=s.filter(function(e){if("infoscreen"!=v&&"report"!=v)return 0<e._uial;var t=T.eventPrivacy(d,e);if("teachers"==m)switch(t){case"public":case"teachers":case"private":case"students":case"participants+teachers":return!0}if("classes"==m)switch(t){case"public":case"students":return!0}return!1})).filter(function(e){return!T.isAttachEvent(d,e)})).filter(function(e){return T.isEntireSchoolEvent(d,e)});"teachers"==m&&s.forEach(function(e){5<=e.teacherids.length&&(r.includes(e)||r.push(e))}),"classes"==m&&s.forEach(function(e){5<=e.classids.length&&(r.includes(e)||r.push(e))}),0<r.length&&(s=s.filter(function(e){return!r.includes(e)}));var i=d.tableFilterData(w.TABLE_subst_students,{date:e}),a=d.tableFilterData(w.TABLE_substs,{date:e}),o=new B.TTItemTimeProvider(d);o.setDate(d.rowData(w.TABLE_dates,e),w.tt_dbi);var l=I.__assign(I.__assign({},w),{date:e,timeProvider:o,absents:d.tableFilterData(w.TABLE_absents,{date:e}),ttitems:n,events:s,subst_students:i}),u=[];return 0<r.length&&u.push(R.createElement(Q,{scope:l,header:c.ls(1155),items:r.map(function(e){return{uniperiod:k.DBITools.getUniPeriod(e),event:e}})})),"classes"==m&&((b||j.substFilterRows(d,g,"classes",d.tableData("classes"),{onlyDirect:!0}).map(function(e){return e.id})).forEach(function(e){return u.push(R.createElement(se,I.__assign({},{scope:l,classid:e,key:e})))}),"hide"!=h.names_igroups&&(f||j.substFilterRows(d,g,"igroups",d.tableData("igroups"),{onlyDirect:!0}).map(function(e){return e.id})).forEach(function(e){return u.push(R.createElement(re,I.__assign({},{scope:l,igroupid:e})))})),"teachers"==m&&(_||d.tableIds("teachers")).forEach(function(e){return u.push(R.createElement(ie,I.__assign({},{scope:l,teacherid:e,settings:h,key:e})))}),0<a.length||0<r.length||"classes"==m&&0<i.length||p||u.push(R.createElement(Q,{scope:l,header:"",hideHeader:!0,items:[{uniperiod:"",text:c.ls(1348),nosubst:!0}]})),R.createElement(x.Fragment,{key:e},"mobile"!=h.style&&0<t&&(h.pagebreak_date?R.createElement("div",{className:"print-pagebreak"}):R.createElement(x.VGap,{height:15})),R.createElement("div",{"data-date":e},R.createElement(oe,I.__assign({},{scope:l,hideTitle:y,repeatHeader:E})),"table"==h.style?R.createElement("table",null,u):u))}),o)}p.SubstReport=de,p._hotswap=[b,w]},"/dashboard/printSheet.js":function(i,require,e){i.__esModule=!0;var a=require("tslib"),o=require("react"),n=require("react-dom"),l=require("../asc/asc_react"),u=require("../asc/actions"),c=require("../asc/edurequest"),d=require("../react/combobox");i.initUI=function(e,t){t.asDialog?l.RDialog.show(o.createElement(r,a.__assign({},t))):n.render(o.createElement(r,a.__assign({},t)),e)},i.PrintToolbar={formats:[{id:"a4-portrait",name:"A4 - "+ASC.ls(1835),width:716,height:1044},{id:"a4-landscape",name:"A4 - "+ASC.ls(1836),width:1044,height:716}],fontSizes:[80,90,100,110,120,130,140,150,170,200]};var s,r=(s=o.Component,a.__extends(t,s),t.prototype.render=function(){var t=this,e=c.client_req,n=o.createElement("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,padding:"100px 40% 20px 40%",backgroundColor:"rgba(222, 234, 217, 0.5)"}},o.createElement("div",{style:{textAlign:"right",padding:"1em 0"}},o.createElement("i",{className:"fa fa-close",style:{cursor:"pointer",padding:"0.5em"},onClick:function(){t.setState({hideReloadBtn:!0})}})),o.createElement(l.RButton,{label:"Reload the report content",type:"blue",onClick:function(){t.setState({hideReloadBtn:!0}),t.props.renderer(t.refs.sheet)}})),s=o.createElement("div",{ref:"sheet",className:"print-sheet print-"+this.state.format,id:"sheet"},this.props.showReloadBtn&&!this.state.hideReloadBtn&&n,this.props.children),r=o.createElement(l.Fragment,null,this.props.onCustomize&&o.createElement(o.Fragment,null,o.createElement(l.RButton,{label:u.action_name("customize"),fa_icon:u.action_fa_icon("customize"),onClick:this.props.onCustomize}),o.createElement(l.HGap,{width:15})),o.createElement(l.RButton,{label:ASC.ls(1638),fa_icon:"print",onClick:this.print.bind(this)}),o.createElement(l.RButton,{label:ASC.ls(1529),fa_icon:"download",menu:a.__spreadArrays(e.isAdmin()||e.isUcitel()?[{text:"PDF",onclick:this.download.bind(this,"pdf")},[]]:[],[{text:"HTML",onclick:this.download.bind(this,"html")},{text:"HTML ("+ASC.ls(1906)+")",onclick:this.download.bind(this,"html_p")}])}),o.createElement(l.RButton,{label:ASC.ls(1837),fa_icon:"search",onClick:this.print.bind(this,{preview:!0})}),o.createElement("span",{style:{marginLeft:"10px"}},this.props.showConvertToA3&&o.createElement(l.RButton,{label:ASC.ls(1837)+" (A3)",onClick:function(){var e=window.open("about:blank","_blank");t.print({preview:!0,window:e}),ASC.PaginatedDiv.convertToA3(e.document.body)}}),this.props.showFormat&&o.createElement(d.default,{items:i.PrintToolbar.formats.map(function(e){return{value:e.id,name:e.name}}),valueRef:l.stateRef(this,"format")}),this.props.showFontSize&&o.createElement(d.default,{items:i.PrintToolbar.fontSizes.map(function(e){return{value:""+e,name:ASC.ls(2153)+" "+e+"%"}}),valueRef:l.stateRef(this,"fontSize")})));return this.props.asDialog?o.createElement(l.RDialog,{header:ASC.ls(1641)+" - "+this.props.filename,width:900,height:650,buttons:["close"],footer:r,allowMaximizeBtn:!0},o.createElement("div",{style:{overflow:"auto",padding:"0 1px"}},s)):o.createElement(l.Fragment,null,o.createElement("div",{style:{flex:"1 1 auto",overflow:"auto",padding:"0 1px"}},s),o.createElement("div",{ref:"toolbar",className:"ui-widget-content print-toolbar",style:{flex:"0 0 auto",padding:"10px"}},r))},t.prototype.componentDidMount=function(){var e=this;setTimeout(function(){e.props.showReloadBtn||e.props.renderer(e.refs.sheet)},100)},t.prototype.componentDidUpdate=function(){var t=this;i.PrintToolbar.formats.forEach(function(e){$j(t.refs.sheet).toggleClass("print-"+e.id,e.id==t.state.format)}),i.PrintToolbar.fontSizes.forEach(function(e){$j(t.refs.sheet).toggleClass("print-font-size-"+e,e==parseInt(t.state.fontSize))})},t.prototype.componentWillReceiveProps=function(e){this.setState({hideReloadBtn:!e.showReloadBtn})},t.prototype.print=function(e){void 0===e&&(e={}),!e.preview&&$j(this.refs.sheet).hasClass("landscape")&&!confirm('Please do not forget to configure printer settings to "Landscape".')||ASC.printDiv(this.refs.sheet,a.__assign(a.__assign({},e),{watermark:this.props.watermark}))},t.prototype.download=function(r){return a.__awaiter(this,void 0,void 0,function(){var t,n,s=this;return a.__generator(this,function(e){switch(e.label){case 0:return""!=this.refs.sheet.innerHTML?[3,1]:(ASC.flashMessage(ASC.ls(3161)),[3,5]);case 1:switch(t=ASC.paginateDiv(this.refs.sheet,"html"==r?0:"auto",{watermark:this.props.watermark,css_inline:!0}),r){case"html":case"html_p":return[3,2];case"pdf":return[3,3]}return[3,5];case 2:return this.downloadBlob(new Blob([t.html],{type:"text/html"})),[3,5];case 3:return(n=new ASC.ui.Dialog({title:this.props.filename,width:"300px"})).setBody("<img src='/global/pics/bar/dialogLoading.gif' style='vertical-align:middle'/> "+ASC.ls(8769)),[4,Promise.resolve().then(function(){return require("./server/print_pdf")})];case 4:return e.sent().getHTMLToPdf(null,t.html,{format:this.state.format.substr(0,2).toUpperCase(),landscape:0<=this.state.format.indexOf("landscape")}).then(function(e){ASC.timer_start(),s.downloadBlob(new Blob([new Uint8Array(e.data)],{type:"text/pdf"})),n.hide(),ASC.timer_dump("downloaded")}),[3,5];case 5:return[2]}})})},t.prototype.downloadBlob=function(e){var t="text/pdf"==e.type?"pdf":"html";if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(e,this.props.filename+"."+t);else{var n=window.document.createElement("a");n.href=window.URL.createObjectURL(e),n.download=this.props.filename+"."+t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}},t.defaultProps={showFormat:!0,showFontSize:!0},t);function t(e){var t=s.call(this,e)||this;return t.state={format:t.props.format||"a4-portrait",fontSize:"100"},t}i.PrintSheet=r,i.PrintFontResizable=function(e){return o.createElement("span",{className:"print-font-resizable"},e.children)}},"/substitution/server/report.js":function(e,require,t){t.implementRpc(["getSubstReportInReportovacSettings","setSubstReportInReportovacSettings"])},"/substitution/viewer.js":function(u,require,e){u.__esModule=!0;var _=require("tslib"),h=require("react"),g=require("./online/report"),v=require("../asc/lib_date"),y=require("../asc/asc_react"),E=require("./server/viewer");u.substViewerModeName={teachers:"{1929}",classes:"{1930}",me:"{9092}",admin:"Information for admin"};var c={teachers:"{1005}",classes:"{1194}",me:"{1751}",admin:"Admin"};function w(e){var t=e.mode,n=e.selected,s=e.onClick,r=y.useReq(),i=y.useHover(),a=i[0],o=i[1],l=y.useResponsiveLevel();return h.createElement("span",_.__assign({},o,{style:{color:n?"#000000":"#A0A0A0",marginLeft:10,cursor:s?"pointer":void 0,backgroundColor:a||n?"#e8e8e8":void 0,padding:0<l?5:void 0},onClick:s}),r.localize((0<l?c:u.substViewerModeName)[t]))}function S(i){var a=y.useReq(),n=0<y.useResponsiveLevel(),e=y.useColors(),t=h.useState(function(){if(n)return i.date;var e=v.date_week(a,v.date_delta(i.date,-7)),t=v.week_start(a,e);return i.date_limitfrom&&i.date_limitfrom>t&&(t=i.date_limitfrom),t}),s=t[0],r=t[1],o=h.useState(!1),l=o[0],u=o[1];h.useEffect(function(){return u(!0)});var c=i.date_limitfrom,d=v.date_delta(s,n?6:18),m=v.date_interval_array(s,d),p=[-1,1].map(function(t){return h.createElement("div",{className:"scroller",onMouseDown:function(e){return e.preventDefault()},style:{},onClick:function(e){t<0&&s==c||r(v.date_delta(s,t))}},t<0?"<":">")}),b=n?35:Math.floor((704-1*m.length)/m.length);return h.createElement(y.RScopedStyle,{className:"SubstViewDateSwitcher",rules:{".switcher":{display:"flex",flexDirection:"row",flex:1},".cell":{whiteSpace:"pre",textAlign:"center",flex:"1 1 0px",minWidth:b,width:b,flexBasis:b,color:e.fgGrey,cursor:"pointer",marginRight:1,transition:"opacity 0.1s"},".cell::first-line":{fontSize:15,fontWeight:"bold"},".cell:hover":{backgroundColor:e.bgHover},".cell.weekend":{color:"#d0d0d0"},".cell.selected":{backgroundColor:e.bgHover,color:e.fgBlack,cursor:"auto",opacity:1},".cell.filler":{visibility:"hidden",height:0,display:"none"},".scroller":{paddingTop:7,cursor:"pointer",minWidth:n?25:30,width:30,flex:"0 0 auto",textAlign:"center",color:"#808080",visibility:n?void 0:"hidden"},".scroller:hover":{backgroundColor:"#e8e8e8"},"&:hover .scroller":{visibility:"visible"}},style:{display:"flex",flexDirection:"row",fontSize:11,flex:"none"}},p[0],h.createElement("div",{className:"switcher"},m.map(function(e){var t=v.date_isWeekend(a,e),n=v.date_format_day(a,e,!1,"short"),s=n.indexOf(" ");0<=s&&(n=n.substr(0,s)+"\n"+n.substr(s+1)),n=n.replace(/ /g,"");var r=e==i.date;return h.createElement("div",{key:e,className:y.classNames({cell:!0,selected:r,weekend:t}),style:_.__assign({},l||r?{}:{opacity:.5,pointerEvents:"none",cursor:"auto"}),onClick:r?void 0:function(){return i.onDate(e)}},n)}),y.rangeFromTo(1,21).map(function(e){return h.createElement("div",{key:""+e,className:"cell filler"})})),p[1])}function x(e,t,n,s){for(var r=v.date_delta(t,n),i=0;i<3&&v.date_isWeekend(e,r);i++)r=v.date_delta(r,n);return r<s.date_limitfrom?"":r}function T(s){var r=s.date,i=y.useReq();function e(e){var t=x(i,r,e,s),n=!!t;return h.createElement("div",{onClick:function(){return n&&s.onDate(t)},style:{cursor:"pointer",padding:"0px 10px",color:n?void 0:"#c0c0c0"},onMouseDown:function(e){return e.preventDefault()}},e<0?"<":">")}return h.createElement("div",{style:{fontSize:20,display:"flex",flexDirection:"row"}},e(-1),h.createElement("div",{style:{textAlign:"center",flex:"1 1 0px"}},v.date_format_day(i,r,!0,!0)),e(1))}u.SubstViewer=function(n){var e=this,t=h.useState(n.date),s=t[0],r=t[1],i=h.useState(n.mode),a=i[0],o=i[1],l=h.useRef(!0),u=y.useResponsiveLevel(),c=y.useReq(),d=y.useAsyncMemo(function(){return _.__awaiter(e,void 0,void 0,function(){return _.__generator(this,function(e){switch(e.label){case 0:return l.current?(l.current=!1,[2,n.report_html]):[4,E.getSubstViewerDayDataHtml(null,{date:s,mode:a})];case 1:return[2,e.sent()]}})})},[s,a,n.refresh],function(){return l.current?n.report_html:""},{inputs_reset:[s,a,n.refresh]}),m=0<u?T:S,p=function(i){var a=h.useRef();return{onTouchStart:function(e){e.persist(),a.current=e},onTouchEnd:function(e){var t=a.current,n=t.changedTouches[0],s=e.changedTouches[0];if(i.onHoziontalSwipe){var r=n.pageX-s.pageX;e.timeStamp-t.timeStamp<300&&80<Math.abs(r)&&i.onHoziontalSwipe(r<0?-1:1,e)}}}}({onHoziontalSwipe:function(e){var t=x(c,s,e,n);t&&r(t)}}),b=n.date_limitfrom,f=n.enabled_modes;return h.createElement("div",_.__assign({},p,{className:n.mobile?"app-view-fullHeight":"",style:{backgroundColor:"#ffffff",color:"#000000",padding:5}}),h.createElement(m,_.__assign({},{date_limitfrom:b,date:s,onDate:function(e){return r(e)}})),h.createElement(y.VGap,{height:20}),0<f.length?h.createElement(h.Fragment,null,h.createElement(g.SubstReportTitle,{title:0<u?void 0:c.ls(1003)+" - "+v.date_format_day(c,s,!0,!0),subtitle:f.map(function(e){var t=a==e;return h.createElement(w,_.__assign({},{req:c,key:e,mode:e,selected:t,onClick:t?void 0:function(){o(e)}}))})}),d?h.createElement("div",{dangerouslySetInnerHTML:{__html:d}}):h.createElement(y.Loading,null)):h.createElement("div",{style:{textAlign:"center"}},c.ls(2854)))},u.DateSwitcher=S},"/substitution/server/viewer.js":function(e,require,t){t.implementRpc(["getSubstViewerSettings","setSubstViewerSettings","getSubstViewerDayDataHtml","substViewerProps","getMobileSubstViewerData","getSubstViewerAdminProps"])},"/customize/privacy.js":function(e,require,t){e.__esModule=!0;var i=require("tslib"),a=require("../asc/edurequest"),o=require("../asc/asc_react"),l=require("../rpr/itemdlg"),u=require("react"),c=require("../rpr/dbi_react"),d=require("../asc/asc_react2");function n(e){var t=a.client_req,n=l.useMainDBIItemDlgState(t.getSchoolYear(),"global_settings","1",{needed_part:{global_settings:["privacy_public"]}}),s=n.rdlgProps,r=n.dlgRow;return u.createElement(o.RDialog,i.__assign({},s,{header:void 0}),u.createElement(d.DlgHeader,{title:t.ls(10190),icon:"/global/pics/ui/privacy_32.svg"}),u.createElement("div",null,u.createElement("span",{style:{fontWeight:"bold"}},t.ls(10191)),u.createElement(o.VGap,{height:10}),u.createElement(c.DlgField,{dlgRow:r,column:"privacy_public",subcolumn:"teachers_name",label_style:"embeded"}),u.createElement(c.DlgField,{dlgRow:r,column:"privacy_public",subcolumn:"students_name",label_style:"embeded"})))}e.privacyCombo2=function(e,t){void 0===t&&(t={});var n=[];return n.push({value:"disabled",name:e.ls(1686),icon:"/global/pics/ui/delete_32.svg"}),n.push({value:"teachers",name:e.ls(1005),icon:"/global/pics/ui/teacher_32.svg"}),t.students_me?(n.push({value:"participants+teachers",name:e.ls(1006)+" - "+e.ls(9092),icon:"/global/pics/ui/home_32.svg"}),n.push({value:"students",name:e.ls(1006)+" - "+e.ls(1349),icon:"/global/pics/ui/student_32.svg"})):n.push({value:"students",name:e.ls(1006),icon:"/global/pics/ui/student_32.svg"}),n.push({value:"public",name:e.ls(2064),icon:"/global/pics/ui/privacy_public_32.svg"}),n},e.showPrivacyPublicDlg=function(){o.RDialog.show(u.createElement(n,null))},e._hotswap=[n]}});
